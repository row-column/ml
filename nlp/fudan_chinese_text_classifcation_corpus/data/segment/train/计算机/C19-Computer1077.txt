自动化 学报 
 ACTA   AUTOMATICA   SINICA 
 1999 年   第 25 卷   第 1 期   vol.25   No.1   1999 
 
 
 
 机器人 轨线 跟踪 的 视觉 与 控制 集成 方法 1 ) 
 
 蒋 　 平 　 林 　 靖 　 陈辉堂 　 王月娟 
 
 摘 　 要 　 针对 视觉 引导 的 机器人 轨线 跟踪 控制 问题 ， 结合 视觉 传感器 的 测量 特点 提出 了 视觉 与 控制 集成 的 控制 方案 ， 在 跟踪 轨线切 向 实现 等 速度 控制 ， 而 在 法向 实现 位置 控制 ， 这一法 向 位置 误差 容易 由 采样 图象 直接 获得 ， 采用 一 并行 控制器 可 实现 伺服 级 上 的 视觉 引导 ， 使 系统 跟踪 性能 得到 明显提高 ， 在 小 视场 条件 下 ( 26.4 mm × 26.4 mm ) 跟踪 速度 达到 250mm / s . 
 关键词 　 视觉 伺服 ， 轨线 跟踪 ， 直接 驱动 机器人 . 
 INTEGRATION   OF   VISION   AND   CONTROL   FOR 
 ROBOT   CURVE   TRACKING 
 JIANG   Ping 　 LIN   Jing 　 CHEN   Huitang 　   WANG   Yuejuan 
 ( Dept . of   Electrical   Engineering , Tongji   University , Shanghai 　 200092 ) 
 Abstract 　 Aiming   at   high   speed   visual   tracking , this   paper   presents   a   new   control   scheme   from   the   point   of   integration   of   vision   and   control . To   track   a   curve , the   control   is   decomposed   into   two   subfunctions . One   is   the   velocity   control   which   controls   the   center   of   a   CCD   camera   to   move   along   the   tangential   direction   of   the   curve . The   other   is   the   position   control   which   controls   the   cneter   of   the   CCD   camera   to   move   in   the   normal   direction   approaching   to   the   curve . In   order   to   improve   the   tracking   performances , the   proposed   control   scheme   was   realized   in   servo   rate   by   the   aid   of   a   transputer   based   parallel   controller . The   tracking   speed   reached   250mm / s   with   a   small   field   of   view ( 26.4 mm × 26.4 mm ) . 
 Key   words 　 Visual   servoing , trajectory   tracking , D . D . robot . 
 1 　 引 　 言 
 　 　 从 提高 机器人 对 环境 的 适应性 及 快速 反映 能力 的 角度 出发 ， 近几年来 许多 研究者 探索 将 机器 视觉 作为 反馈 控制 源 参与 伺服 控制 形成 视觉 伺服 反馈 控制系统 ， 文 ［ 1 ］ 采用 顶部 固定 摄像机 方式 ， 由 摄像机 检测 手爪 标记 ， 产生 定位 偏差 后 直接 生成 控制 力矩 . 文 ［ 2 ］ 采用 手部 摄象机 方式 ， 利用光 流 检测 特征 点 运动 ， 设计 了 基于 特征 点 的 PI ， LQG 等 实时 视觉 反馈 控制 方法 ， 实验 平均 跟踪 速度 为 25 ～ 30mm / s . 然而 提高 快速性 的 主要 障碍 仍 在于 图象 数据 的 采集 及 处理 延时 上 ， 目前 的 多数 系统 只能 在 低于 25hz 的 频率 下 实现 视觉 闭环 . 
 　 　 视觉 引导 的 机器人 运动 控制 的 另 一种 典型 应用 是 轨线 跟踪 ［ 3 ， 4 ］ ， 如 自动 焊缝 跟踪 、 仿型 加工 、 图纸 自动 输入 等 ， 通常 的 工作 方式 是 由 视觉 搜索 轨线 产生 位置 指令 ， 使 机械手 跟踪 加工 ， 因此 其 视觉 信息 只 作为 指令 依据 ， 而 并未 引入 闭环 ， 跟踪 过程 的 动态 品质 难以 保证 ， 仅能 在 极 低 速度 下 实现 平稳 跟踪 ( 10 ～ 20mm / s ) . 为此 本文 在 文 ［ 4 ］ 的 基础 上 采用 手部 摄象机 方式 ， 力图 实现 视觉 实时 闭环 ， 提高 跟踪 速度 及 跟踪 品质 . 考虑 到 视觉 引导 的 轨线 跟踪 特点 ， 要求 机械手 根据 摄像机 所 摄取 的 局部 轨线 ， 使 摄像机 中心 不 偏离 轨线 平稳 运动 ， 而 并 无 严格 的 轨迹 要求 ， 因此 本文 的 视觉 伺服 控制 在 这 一 局部 轨线 的 弧 坐标 中 进行 ， 实行 切向 、 法向 分解 ， 在 两个 正交 方向 上 分别 采用 不同 的 控制 方式 ， 切向 采用 等 速度 控制 保证 其 跟踪 速度 ， 法向 进行 位置 控制 保证 位置 跟踪 精度 . 其 特点 在于 切向 采用 速度 控制 ， 因此 不再 需要 实时 生成 轨迹 ， 避免 了 轨线 搜索 方法 中 两幅 图象 的 局部 轨迹 衔接 问题 ， 且 速度 控制 比 位置 控制 更加 平稳 ； 此外 法向 偏差 的 图象 抽取 非常 简便 ， 因此 一幅 视觉 图象 ( 40ms / 帧 ) 可 在 若干次 伺服 控制 周期 中 ( 2ms ) 采用 ， 实现 了 准 伺服 周期 下 的 视觉 反馈 ( 2ms ) ， 避免 了 图象 采集 、 处理 的 大 延时 与 高 伺服 频率 间 的 矛盾 . 根据 这一 基本思路 ， 本文 提出 了 基于 切向 、 法向 任务 分解 的 机器人 反馈 控制 律 ， 证明 了 该 方法 应用 于 刚 连杆机构 视觉 轨线 跟踪 的 渐近 稳定性 ， 并 针对 一 基于 Transputer 的 机器人 并行 控制器 进行 了 实验设计 ， 实现 了 视觉 引导 的 高速 轨线 跟踪 ， 在 26.4 mm × 26.4 mm 的 小 视场 条件 下 轨线 跟踪 速度 可达 250mm / s ， 达到 原来 速度 的 10 倍 . 
 2 　 采用 正交 分解 的 轨线 跟踪 控制 
 　 　 设 摄像机 摄取 的 待 跟踪 局部 轨线 如图 1 所示 . 其中 x - y 为 工作 坐标 ， 摄像机 中心 由 矢量 r 描述 ， 则 容易 由 图象 获得 其法 向 偏差 e ， 设其 对应 轨线 交点 为 o ′ ， 则 对于 任意 采样 时刻 可 建立 自然 轴系 i - j , 其中 i 为 切线 单位向量 ， j 为 法线 单位向量 ， 可 得 
 
 
 
 图 1 　 轨线 坐标系 i - j 
 设待 跟踪 轨线 对 弧长 二阶 导数 存在 ， 由于 o ′ 位于 该 轨线 上 ， 因此 
 
 其中 s 为 轨线 弧 坐标 . 注意 到 ， 而 ， 其中 α 为 切线 角 ， ω 为 自然 轴系 旋转 角速度 ， 它 与 机械手 运动 有关 ， K 为 轨线 曲率 ， 因此 , 可 得 
 ( 1 ) 
 所以 机械手 运动 速度 在 i 轴 的 分量 ， 同时 可得 轨线 跟踪 速度 
 ( 2 ) 
 ( 2 ) 式 说明 ， 轨线 跟踪 速度 与 机械手 在 i 轴 速度 分量 成正比 ， 而 其 比例 系数 与 轨线 曲率 半径 及法 向 跟踪 误差 e 有关 . 令 机械手 工作 空间 动力学 方程 为 
 ( 3 ) 
 设 期望 跟踪 速度 为 u ( 常数 ) ， 定义 速度 误差 向量 ev = ui - ， 法向 位置 误差 向量 ep = ej , 欲令 摄像机 中心 匀速 跟踪目标 轨线 ， 因此 控制目标 为 
 
 　 　 下面 我们 设计 基于 切向 及法 向 分解 的 机器人 轨线 跟踪 控制器 ， 以 实现 以上 控制目标 . 
 
 　 　 定理 1 . 采用 关节 空间 控制 律 可 保证 摄像机 中心 对 轨线 的 渐近 稳定性 ， 且 跟踪 速度 收敛 于 u , 其中 J 为 机械手 Jacobian 矩阵 ， 
 　 　 证 . 建立 Lyapunov 函数 
 
 则 
 
 由 ( 1 ) 式 得 　 代入 上式 得 
 
 因为 i , j 正交 ， 所以 
 
 代入 动力学 方程 ( 3 ) 得 
 
 由 对称性 ， 上式 可 化简 为 
 
 当取 工作 空间 控制 律 
 ( 4 ) 
 则 ， 按 期望 速度 跟踪 . 为了 说明 法向 误差 e 收敛 于 0 ， 将 控制 律 ( 4 ) 代入 ( 3 ) 式 得 
 
 　 　 由于 
 若令 期望 跟踪 速度 d = ui , 及 向心 加速度 
 
 则 结论 得证 . 
 　 　 这一 控制 律 由 非线性 补偿 及 线性 反馈 两 部分 构成 ， 结构 框图 如图 2 所示 ， 由图 2 可 看出 控制 分别 被 分解 至 两个 正交 方向 上 ， 其中 法向 偏差 直接 根据 图像 获得 进行 位置 反馈 控制 ， 而切 向 只 进行 速度 反馈 控制 ， 此外 根据 图像 反馈 信息 引入 动力学 补偿 以 改善 高速 跟踪 时 的 动态 品质 . 
 
 
 图 2 　 控制 框图 
 3 　 图象 特征 抽取 
 　 　 这一 视觉 引导 轨线 跟踪 控制算法 ， 需要 根据 采集 图象 确定 轨线 特征 K ， i , j ， 及 摄像机 中心 偏离 轨线 的 法向 偏差 e , 能否 实现 高速 跟踪 依赖于 图象 特征 抽取 的 实时性 ， 为此 我们 必须 采用 最为 简洁 的 办法 以 保证 这一 抽取 过程 能 在 伺服 周期 ( 2ms ) 内 完成 . 
 　 　 设 采集 第 m 幅 图象 Im , 待 跟踪 轨线 在 其 上 表现 为 一条 黑色 带状 象素 集 ， 在 图象 坐标 中 最小 黑色 线宽 为 Wmin ， 为了 据此 获得 摄像机 中心 附近 的 轨线 特征 ， 围绕 中心 坐标 ( xo , yo ) 建立 子 窗口 W ， 窗口 边长 为 d ( d < < 1 / K ， K 为 轨线 曲率 ) ， 则 沿子 窗口 边界 顺时针 搜索 ， 记录 连续 黑色 象素 点 个数 n , 若 n ＞ Wmin ， 则 确认 为 轨线 上 的 坐标 点 ， 计算 连续 黑色 象素 点 中心 可得 轨线 与 窗口 的 一个 交点 坐标 ( x1 , y1 ) ， 重复 以上 过程 可得 另 一 交点 ( x2 , y2 ) ， 在 d < < 1 / K   的 假定 下 ， 轨线 与 窗口 交点 仅 有 两个 ， 则 本次 轨线切 向 角 可 计算 得 
 α i = arctg   2 ( y2 - y1 , x2 - x1 ) + θ m + n π 　 ( n = 0 , 1 ) . ( 5 ) 
 这里 ， θ m 为 摄像机 固联 坐标系 与 工作 坐标系 间 的 旋转 角度 ， 由本幅 图象 采样 时刻 的 机械手 关节 角度 决定 ； n 值 由 前次 伺服 周期 中 的 切向角 采样 值 α i - 1 确定 ， 满足 ｜ α i - α i - 1 ｜ ＜ π / 2 . 
 　 　 轨线 单位 切线 向量 及 单位 法线 向量 可 表示 为 
 i = ［ cos （ α i ) , sin ( α i ) ］ T , 　 j = ［ - sin （ α i ) , cos ( α i ) ］ T , ( 6 ) 
 并 可 建立 摄像机 中心点 附近 局部 直线 方程 
 sin ( α ) x - cos ( α ) y = sin ( α ) x1 - cos ( α ) y1 , 
 所以 摄像机 中心 偏离 轨线 的 法向 误差 为 
 e = sin ( α ) xo - cos ( α ) yo - sin ( α ) x1 + cos ( α ) y1 . 
 　 　 获得 i , j , e 后切 向 及法 向 的 反馈 控制 部分 已 可 完成 ， 为了 进行 动力学 补偿 ， 需 计算 轨线 曲率 K ， 事实上 曲率 K 在 控制 律中 只 用于 计算 期望 向心 加速度 , 所以 只要 计算 即可 ， 因此 我们 采用 如下 常 系数 Kalman 滤波 方程 
 
 直接 获得 ， 式 中   T 为 伺服 控制 周期 ， 在 本 系统 中 T = 2ms . 
 　 　 考虑 到 图象 采样 周期 ( 40ms ) 与 伺服 控制 周期 ( 2ms ) 相比 已显 过 大 ， 而 事实上 一幅 轨线 图象 包含 了 若干次 伺服 控制 所 需 的 轨线 信息 ， 因此 我们 在 40ms 的 图象 采样 周期 内 使用 同 一幅 图象 进行 20 次 轨线 特征 抽取 及 伺服 控制 运算 ， 以 达到 伺服 周期 下 的 视觉 反馈 . 在 第 i 个 伺服 周期 中 ， 根据 关节 角度 测量 值 计算 当前 摄像机 中心 在 第 m 幅 图象 中 的 坐标值 ［ xo ( i ) , yo ( i ) ］ T ， 从而 获得 e ( i ) , i ( i ) , j ( i ) , , 以此 作为 反馈 信息 ， 实现 准 伺服 周期 下 的 视觉 反馈 ， 
 ［ xo ( i ) 　 yo ( i ) 　 1 ］ T = CTB ( θ m )  φ ( θ i ) , ( 8 ) 
 
 
 图 3 　 伺服 周期 下 的 视觉 反馈 
 其中 φ 为 机械手 运动学 方程 ， CTB 为 工作 坐标 至 摄像机 固联 坐标 的 齐次 变换 阵 ， 由 图象 采样 时刻 的 机械手 关节 角度 θ m 确定 . 
 　 　 这 一准 伺服 周期 下 的 视觉 反馈 可由图 3 加以 解释 ： 由 图象 周期 角度看 ， 系统对 运动 图象 序列 进行 伺服 控制 ； 由 伺服 周期 角度看 ， 系统 在 40ms 内 针对 本幅 采样 图象 跟踪 静止 轨线 . 
 4 　 实验设计 及 结果 
 　 　 这一 控制 方案 的 应用 背景 为 一 平面 两 关节 直接 驱动 异形 玻璃 切割 机器人 ， 引入 视觉 轨线 跟踪 的 目的 在于 使 其 既 能 用于 玻璃 切割 ， 又 具有 加工 图纸 的 自动 输入 功能 ［ 4 ］ ， 为了 实现 实时 视觉 伺服 反馈 ， 我们 建立 了 一个 基于 Transputer 的 机器人 视觉 伺服 并行 控制器 ， 这一 并行 控制器 由 四片 T800 ( root , slot1 , slot2 , slot3 ) 构成 ， 其 结构 如图 4 所示 . 　 　 
 
 
 图 4 　 并行 控制器 结构图 
 
 　 　 其中 图象 采集 电路 是 专为 Transputer 系统 自行设计 的 ， 它 将 视频信号 经 A / D 转换 后 直接 由 link 串行 分配 给 root 及 slot2 . 为了 提高 系统 实时性 ， root 及 slot2 以 40ms / 帧 周期 轮流 采样 ， 即 root 采集 图象 时 ， slot2 中 图象 供 控制 使用 ， slot2 采集 图象 时 ， root   中 图象 供 控制 使用 . 图象 分辨率 为 256 × 256 ， 仅 做 奇场 采样 . slot1 分别 与 root 及 slot2 联接 构成 图象 信息流 ， 同时 与 slot3 联接 构成 伺服 控制流 . slot3 经 伺服 控制 接口 电路 分别 与 大臂 、 小臂 的 鉴相器 及 PWM 连接 ， 每 2ms 进行 一次 关节 角 测量 及 控制 量 输出 ， slot3 将 关节 采样 值送 至 slot1 , slot1 据此 将 当前 摄像机 中心点 映射 至 当前 图象 坐标 中 并 交由 空闲 处理器 ( root 或 slot2 ) 运算 ， 对应 处理器 以该 点 为 中心 建立 局部 窗口 ， 并 将 所 求得 的 局部 直线 方程 回送 ， 而后 slot1 据此 计算 当前 e ( i ) ， i ( i ) , j ( i ) , ( i ) 供 slot3 进行 控制 力矩 运算 . 全部 过程 在 2ms 内 完成 ， 实现 了 伺服 周期 下 的 视觉 反馈 . 
 　 　 作为 实例 ， 我们 在 白色 图纸 上 绘制 一 半径 为 197.5 mm 的 圆 ， 令 机械手 进行 视觉 跟踪 ， 末端 摄像机 视场 26.4 mm × 26.4 mm ， 动力学 参数 如文 ［ 5 ］ ， 控制参数 取值 
 kp = 40.0 , 　 kv = 1.0 , 　 KPO = 0.2 , 　 KVO = 43.1 . 
 令 机械手 期望 跟踪 速度 为 u = 150mm / s ， 记录 跟踪 一周 的 误差 曲线 如图 5   中   u = 150mm / s 所示 ， 共 进行 了 216 幅 图象 采集 ， 历时 8.64 s , 运行 相当 平稳 ， 可 计算 得 机械手 平均 跟踪 速度 为 143.6 mm / s ， 由 误差 曲线 可以 看出 ， 除 起动 时 由于 期望 速度 从 静止 跳变 至 150mm / s 引起 1mm 的 起动 误差 外 ， 全部 跟踪 偏差 低于 0.6 mm . 提高 期望 跟踪 速度 至 250mm / s ， 其 跟踪 误差 曲线 如图 5 中   u = 250mm / s 所示 ， 最大 起动 误差 3.8 mm ， 最大 跟踪 误差 1.1 mm ， 平均 跟踪 速度 242.4 mm / s ， 共 采集 128 幅 图象 . 可以 发现 改变 跟踪 速度 不会 对 性能 产生 很大 影响 ， 特别 在 跟踪 的 平稳性 方面 . 与 文 ［ 4 ］ 所提 采用 轨线 搜索 后 进行 位置 跟踪 的 控制 效果 相比 ， 运行 平稳性 得到 很大 改善 ， 同时 在 跟踪 速度 提高 10 倍 的 情况 下 控制精度 达到 同一 水平 . 　 　 
 
 
 图 5 　 150mm / s 及 250mm / s 速度 跟踪 时 的 法向 误差 
 
 5 　 结论 
 　 　 本文 提出 了 一个 实现 视觉 轨线 跟踪 的 机器人 控制 方案 ， 这一 控制 被 分解 至 轨线切 向 及法 向上 ， 由于 切向 只 进行 速度 控制 ， 比 采取 位置 方式 跟踪 控制 更加 平稳 ， 而法 向 进行 位置 伺服 ， 保证 轨线 跟踪 精度 . 本文 针对 这一 方案 建立 了 一个 机器人 视觉 伺服 并行 控制器 ， 实现 了 准 伺服 周期 下 的 视觉 反馈 ， 体现 了 优良 的 控制 性能 ， 在 26.4 mm × 26.4 mm 的 小 视场 条件 下 ， 实现 了 250mm / s 的 快速 跟踪 . 这一 方法 可 应用 于 图纸 输入 、 焊缝 跟踪 等 多种 场合 . 
 1 ) 国家教委 博士点 基金项目 ， 编号 9424713 . 本文 英文稿 曾 在 十三届 ( 1996 年 ) IFAC 世界 大会 上 宣读 . 
 　 　 蒋 　 平 　 1963 年生 ， 1992 年 毕业 于 西安交通大学 信息 与 控制 工程系 ， 获工学 博士学位 ， 现为 同济大学 电气 系 教授 . 主要 研究 领域 机器人 控制 与 智能 机器人 . 
 　 　 林 　 靖 　 1973 年生 ， 1996 年于 同济大学 获工学 硕士学位 ， 现为 同济大学 博士 研究生 . 
 作者 单位 ： ( 同济大学 电气 系 　 上海 　 200092 ) 
 参考文献 
 1 　 Wijesoma   S   W , Wolfe   D   F   H , Richards   R   J . Eye - to - hand   coordination   for   vision - guided   robot   control   applications . Int . J . of   Robotics   Research , 1993 , 12 ( 1 ) : 64 — 78 
 2 　 Papanikolopoulos   N   P , Khosla   P   K , Kanade   T . Visual   tracking   of   a   moving   target   by   a   camera   mounted   on   a   robot : a   combination   of   control   and   vision . IEEE   Trans . on   Robotics   and   Automation , 1993 , 9 ( 1 ) : 14 — 35 
 3 　 Morgan   C   G , Bromley   J   S   E , Davey   P   G   et   al . Visual   guidance   techniques   for   robot   arc   welding . Proc.3 th   Int . Conf . Robot   Vision   and   Sensory   Controls , 1983 , 615 — 624 
 4 　 蒋平 ， 陈辉堂 ， 王月娟 . 基于 视觉 的 机器人 轨线 跟踪 系统 . 机器人 ， 1994 ， 16 ( 1 ) ： 45 — 49 
 5 　 Chen   H   T , Jiang   P , Zhu   W   H   et   al . Comparative   study   of   D . D . robot   control   algorithms   for   trajectory   tracking . Preprint   of   12th   IFAC   World   congress , 1993 , 157 — 160 
 
 
 收稿 日期 　 1995 - 06 - 06 　 收到 修改稿 日期 　 1998 - 05 - 15 
