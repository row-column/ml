计算机 工程 
 Computer   Engineering 
 1999 年 　 第 25 卷 　 第 4 期 　 Vol.25 　 No.4 　 1999 
 
 
 
 虚拟 潜望镜 视景 系统 的 研制 
 崔汉国 　 王伟忠 　 冯雷 　 周 朝晖 
 摘 　 要 　 介绍 了 一个 基于 虚拟现实 技术 模拟器 中 虚拟 潜望镜 视景 系统 的 结构 、 功能 及 主要 技术 要点 。 系统 在 微机 上 实现 。 
 关键词 　 虚拟环境 多媒体计算机 动画 PC 平台 
 The   Development   of   Virtual   Periscops ’ s   3D   Scene   System 
 Cui   Hanguo   Wang   Weizhong   Feng   Lei   Zhou   Zhaohui 
 （ Naval   Academy   of   Engineering   Wuhan   430033 ） 
 Abstract ： A   virtual   Periscope ' s   scene   system   used   for   simulator   is   developed   on   microcomputer . The   structure , functions   and   some   key   technical   details   of   the   system   are   presented   in   this   paper . 
 Key   words : Virtual   environment ; Multimedia ; Computer   animation ; PC   platform 
 　 　 虚拟现实 是 一种 高度 逼真 地 模拟 人 在 自然 或 特定 环境 中视 、 听 、 动等 行为 的 人机界面 技术 ， 具有 多 感知 性 、 存在 性 、 交互性 及 自主性 等 重要 特征 ， 最终 将 成为 人机交互 的 最高 形式 。 基于 虚拟现实 技术 的 训练 模拟器 通常 由 视景 系统 、 运动 系统 、 操作 负荷 系统 及 多媒体计算机 系统 组成 ， 形成 一个 虚拟 的 环境 ， 用户 通过 视觉 、 听觉 、 触觉 及 运动感 等 来 感受 这个 环境 ， 从而 产生 身临其境 的 感受 。 由于 人类 的 视觉 占 其 感受 信息 的 80% 以上 ， 故 视景 系统 是 基于 虚拟现实 技术 模拟器 中 极为重要 的 组成部分 ， 是   VR   的 核心 与 基础 ， 其 目的 是 根据 应用 的 需要 来 建立 、 生成 相应 的 虚拟环境 模型 并 进行 人机交互 。 我们 研制 了 一个 虚拟 潜望镜 视景 系统 ， 它 为 操作 人员 实时 提供 一个 与 潜艇 地理位置 、 战场 环境 及 运动 相对 应 的 连续 艇 外 景象 ： 在 模拟 潜艇 水下 运动 过程 中 ， 视景 系统 将 提供 操作 人员 通过 潜望镜 观测 到 的 天空 、 海浪 及其 它 水上 景物 ； 在 模拟 作战 过程 中 ， 视景 系统 将 提供 操作 人员 通过 潜望镜 观测 到 的 天空 、 海浪 及 目标 舰 的 运动 状况 、 鱼雷 发射 及 射击 效果 的 景象 ， 从而 完成 虚拟 海战 等 其它 模拟训练 任务 。 该 系统 在 微机 上用 Visual   C++ 语言 实现 ， 采用 面向对象 机制 ， 建立 在 MFC 和 OpenGL 上 ， 支持 多线程 、 异步 对话 ， 具有 中文 菜单 、 工具条 、 状态 条及 多窗口 界面 ， 操作 简便 快捷 。   
 1 　 系统结构 及 功能 
 　 　 虚拟 潜望镜 视景 系统 分为 计算机 实时 图象 生成 系统 和 光学 显示 系统 两 大部分 ， 由 视景 数据库 、 控制 / 管理 计算机 、 几何 处理器 、 图象 显示 处理器 和 光学 显示 系统 组成 [ 1 ] ( 图 1 ) 。 视景 数据库 用于 生成 、 存储 景象 的 三维 数据 ， 某个 瞬时 潜望镜 操作 人员 所 能 看到 的 视景 与 潜艇 所处 的 具体 环境 及 潜望镜 的 观测 方向 有关 ； 几何 处理器 完成 各种 与 运动 仿真 及 投影 有关 的 坐标 变换 和 遮挡 、 消隐 处理 等 ， 将 天空 、 海浪 、 目标 舰 及其 它 水上 景物 的 三维 数据 转换 为 二维 坐标 数据 ； 显示 模块 将 几何 处理 模块 传送 来 的 二维 数据 进行 扫描 变换 ， 并 进行 纹理 、 浓淡 、 能见度 、 透明 、 火光 、 抗混叠 等 各种 逼真 效果 修正 ， 最后 将 得到 的 图象 数据 传给 帧 缓冲器 ， 控制 显示器 的 RGB 信号 ， 输出 模拟 视频信号 供 显示 输出 。 
 
 图 1 　 视景 系统结构   
 本 系统 具有 以下 功能 ： ( 1 ) 敌舰 既 可以 是 单舰 航行 ， 亦 可以 是 多舰 编队 航行 ( 可 有 多种 舰型 供选择 ) ； ( 2 ) 用户 可 随时 改变 以下 要素 并 实时 引起 虚拟 视景 动态变化 ： ① 我舰 的 航向 、 航速 ； ② 潜望镜 观测 方向 、 观测 高度 ( 当 潜望镜 降 至 海平面 以下 时 ， 则 播放 水下 景象 的 视频 ) 、 观测 放大 倍数 ( 1.5 X 、 6X ) ； ③ 任一 敌舰 的 航向 、 航速 ； ④ 鱼雷 发射 的 深度 等 ； ( 3 ) 系统 可以 不同 的 声音 生动 地 表现 出 鱼雷 发射 及 命中 目标 时 的 音响效果 ， 并 可 对 鱼雷 命中 目标 时 的 状态 进行 " 照相 " 、 存储 及 进行 鱼雷 发射 次数 、 训练 时间 等 的 统计 、 分析 工作 ； ( 4 ) 系统 可 提供 白天 及 黑夜 等 多种 天气状况 下 的 景象 。 
 2 　   若干 技术 要点 
 2.1 　 面向对象 技术 
 　 　 面向对象 技术 是 一种 围绕 真实世界 的 概念 来 组织 模型 的 思考 方法 ， 它 使 描述 问题 的 问题 空间 和 解决问题 的 方法 空间 在结构上 尽可能 一致 ， 其 基本 构造 是 对象 ， 对象 将 数据结构 与 数据 操作 合并 在 一个 实体 中 ， 例如 景物 模型 集为 D ， 其中 包含 有 许多 子 模型 Di ( 天空 、 海浪 、 岛屿 、 敌舰 、 鱼雷 等 ) ， D = ∪ Di ， 每个 模型 都 是 一个 对象 ， 每 一种 对象 都 有 自己 的 属性 和 行为 ， 对象 与 对象 间 通过   " 消息 " 相互作用 ， 即 对象 统一 了 数据 和 对 数据 的 处理 、 对象 间 的 " 消息 " 统一 了 数据流 和 控制流 。 类 把 具有 相同 功能 的 对象 归并 ， 是 功能 相同 实例 对象 的 抽象 ， 它 定义 的 是 对象 类型 ， 描述 了 属于 该 类型 的 所有 对象 的 性质 。 我们 在 编程 中 使用 Visual   C++ 完成 整个 三维 图形 应用 ， 从 图形 类库 中 派生 出新 的 类 ， 用 这些 类 组成 图形 模型 集 ， 并 把 图形操作 对象 和 图形 模型 对象 联系 在 一起 ， 从而 实现 对 图形 模型 的 操作 。 
 2.2 　   三维 视景 模型 的 生成 
 　 　 构造 三维 视景 模型 的 主要 工作 包括 模型 化 和 描述 生成 两 大部分 ， 模型 化是 对 环境 动态性 、 交互性 及 外部 形状 特征 的 抽象 ， 描述 生成 主要 利用 计算机辅助 设计 技术 进行 几何 模型 的 交互式 构造 。 视景 模型 可以 分为 两类 ， 其一 是 自然 视景 ( 如 天空 、 海浪 等 ) ， 其二 是 人工 视景 ( 如 敌舰 、 鱼雷 、 岛屿 等 ) 。 
 　 　 自然 视景 ( 天空 、 海浪 等 ) 是 三维 视景 的 重要 组成部分 , 它 的 模拟 一直 是 计算机 图形学 中 具有 挑战性 的 研究 方向 之一 , 其 原因 在于 白云 及 海浪 的 形状 具有 不规则 性 、 复杂性 及 随意性 , 它们 的 产生 要 满足 一定 的 条件 , 在 运动 过程 中 还要 受到 多种 力 的 作用 , 其 模型 多为 偏微分 方程组 , 求解 难度 大 。 文献 [ 2 ] 从 水力学 方程组 出发 ， 提出 了 一个 基于 物理 模型 的 模拟 流水 及 波浪 的 计算机 动画 方法 ， 利用 该 方法 ， 通过 方便 和 直观 地 调整 方程 的 初始条件 ， 可以 真实 地 模拟出 流水 和 波浪 的 不同 状态 ， 如 急流 、 瀑布 及 不同 形态 的 波浪 等 ， 效果 良好 ， 但 在 SGI   INDIGO2 上 平均 需要 5 分钟 才能 生成 一帧 画面 。 为了 快速 生成 天空 及 海浪 等 自然 景物 ， 我们 采用 的 是 贴 纹理 的 方法 ， OpenGL 也 支持 这种 功能 。 纹理 可 分为 颜色 纹理 和 几何 纹理 两种 ， 颜色 纹理 取决于 景物 表面 的 光学 属性 ， 而 几何 纹理 则 与 景物 表面 的 微观 几何 形状 有关 。 贴 纹理 是 把 一个 指定 图象 的 一部分 映射 到 允许 贴 纹理 的 每 一个 图元 上 ， 通常 此 映射 是 针对 矩形 光栅 图象 的 ， 而 对于 非 矩形 的 光栅 图象 ( 如 天空 、 海浪 、 舰艇 的 舰体 表面 及 岛屿 的 表面 等 ) 则 需要 综合 应用 融合 技术 和 纹理 映射 技术 来 实现 ， 详细情况 见 文献 [ 3 ] 。 纹理 技术 能 大幅度 地 提高 三维 视景 的 逼真度 ， 当然 由于 逼真度 效果 的 提高 将 加重 几何 处理器 和 显示 处理器 的 处理 负担 ， 因此 也 会 降低 系统 的 实时性 ， 实际 应用 中应 根据 实际 情况 在 逼真度 和 实时性 之间 作出 折衷 。 
 　 　 人工 视景 ( 敌舰 、 岛屿 、 鱼雷 等 ) 是 以 向量 或 参数 方式 存储 的 图象 数据 ， 其点 、 线 、 面 符合 广义 的 欧拉 定理 。 对于 这 类 数据 的 模型 构造 ， 从技术上 来讲 可 分为 以下 2 个 步骤 ： 第一步 是 几何 建模 ， 主要 包括 用 多边形 或 三角形 拼 构成 对象 的 立体 外形 ； 第二步 是 形象 建模 ， 主要 包括 对 几何 模型 的 结果 进行 纹理 、 颜色 、 光照 等 处理 。 OpenGL 是 使用 专用 图形处理 硬件 的 软件 接口 ， 该 接口 由 数百个 过程 与 函数 组成 ， 支持 用户 对 高质量 三维 对象 的 图形 ( 象 ) 操作 ， 然而 它 在 许多 方面 都 只 提供 了 最底层 的 操作 ， 例如 在 物体 建模 方面 ， OpenGL 基本 库仅 提供 了 点 、 线 、 多边形 这些 基本 图元 的 生成 函数 ， 对 复杂 几何 物体 的 建模 则 没有 提供 直接 实现 功能 ， 需要 用户 利用 虚拟环境 生成 工具 来 完成 。 从头开始 设计 一个 虚拟环境 生成 工具 来 构造 三维 视景 模型 是 不明智 的 ， 我们 的 方法 是 利用 AutoCAD 和 3DS 交互 地 建立 起 敌舰 、 岛屿 、 鱼雷 等 三维 视景 的 几何 模型 ， 待 满意 后 利用 名为   Wcvt2pov 的 转换 软件 将 * . DXF 或 * . 3DS 类型 的 文件 转换 为 符合 OpenGL 格式 的 C 类型 文件 ， 用 显示 列表 予以 显示 、 处理 。 三维 视景 对象 的 几何 描述 直接 影响 整个 视景 图象 的 复杂性 、 真实性 及 绘制 的 速度 。 
 2.3 　 三维 视景 显示 
 　 　 视景 的 显示 主要 包括 以下 几个 步骤 ： ( 1 ) 计算 生成 具有 真实感 ( 包括 颜色 及 立体感 、 运动感 ) 的 环境 对象 ( 如 敌舰 、 岛屿 、 鱼雷 等 ) ； ( 2 ) 从 背景 图象 库中 检索 获取 具有 真实感 的 背景 图象 ( 如 天空 、 海浪 及 敌舰 和 岛屿 的 表面 等 ) ； ( 3 ) 经过 扫描转换 将 环境 对象 统一 在 同一 坐标系 中 ； ( 4 ) 运动 视景 的 显示 。 
 　 　 虚拟 潜望镜 视景 系统 是 一种 对 时间 要求 很 高 的 应用 ， 是 一种 典型 的 限时 计算 、 显示 问题 ， 且 视景 是 一个 随 时间 变化 的 三维 世界 ， 为了 表现 出 视景 随 潜望镜 视向 的 变化 情况 ， 需要 连续 地 显示 视景 的 运动 图象 。 要 提高 视景 图形 ( 图象 ) 的 显示 速度 ， 高性能 的 CPU 和 图形 加速 部件 是 视景 显示 的 基本 硬件 需求 ， 同时 还 需要 在 软件 方面 精心设计 算法 ， 一个 实践证明 非常 有效 的 方法 是 降低 视景 的 复杂度 〖 4 〗 。 实时性 和 图形处理 能力 是 虚拟 视景 的 关键技术 。   
 　 　 ( 1 )     视域 聚焦 性 与 LOD ( Level   of   Detail ) 特征 
 　 　 实时 视景 一般 具有 以下 两个 特征 ： ( 1 ) 用户 在 观察 视景 时其 注意力 一般 均 集中 于 目标 ( 可能 是 多个 ) 及其 周围 很小 的 区域 , 而 对 其它 区域 的 景物 一般 并 不 非常 注意 , 因此 目标 所在 局部 区域 的 视景 模型 就 应 复杂 些 , 而 其它 区域 的 视景 模型 就 可以 选 得 简单 一些 , 我们 将 用户 注视 某个 对象 时 对象 所在 的 局部 区域 清晰 而 其它 区域 模糊 这个 特征 称为 视域 聚焦 性 ； ( 2 ) 若 某个 对象 在 屏幕 上 所 占 的 面积 大 , 则 它 对 整个 场景 的 贡献 也 大 , 其 细节 模型 也 就 应 复杂 一些 , 因此 当 视点 移动 速度 快 或 离 目标 远时 , 可 采用 粗略 的 模型 显示 , 反之 采用 较 细致 的 模型 显示 , 这个 特征 称为 LOD 特征 , 该 特征 不仅 可以 有效 地 提高 显示 速度 , 而且 符合 人类 的 视觉 感受 。 LOD 技术 为 每个 对象 建立 多个 相似 的 模型 , 不同 的 模型 对 景物 的 细节 描述 不同 , 景物 细节 的 描述 越 精确 , 模型 也 就 越 复杂 。 基于 以上 分析 , 我们 在 系统 实现 中 动态 地 根据 对象 在 屏幕 上 所 占 区域 的 大小 及 用户 视点 的 不同 , 为 每个 对象 选择 不同 的 细节 模型 , 从而 有效 减少 需要 处理 、 显示 多边形 的 数目 , 详细情况 见 文献 [ 5 ] 。 
 　 　 ( 2 ) 逼真度 效果 
 
 图 2 　 图例 
 　 　 对于 天空 ， 系统 使 天空 的 图象 随 潜望镜 视点 ( 视向 、 视距 ) 的 变化 而 变化 ； 对于 运动 的 海浪 ， 一方面 使 海浪 的 图象 随 潜望镜 视点 的 变化 而 变化 ， 另一方面 对 帖 纹理 的 海浪 模型 进行 扰动 ， 从而 获得 其 不规则 的 表面 形状 和 运动 效果 ： 海浪 的 纹理 以 余弦 波状 曲面 的 方式 运动 ， 运动 效果 可 通过 调整 余弦 波 的 振幅 及 相位 等 参数 来 达到 。 
 　 　 一个 余弦 波状 曲面 可 表示 为 如下 形式 ： 
 z ( x , y , z , t ) = Acos ( K ( X - Ct ) ) 
 其中 A 为 振幅 ， K 为波 向量 ( u , v , w ) ， X 为 向量 ( x , y , z ) , C 为 速度 向量 ， t 为 时间 。 
 　 　 运行 结果表明 ： 系统 建立 了 符合实际 的 虚拟 视景 环境 ， 运动 的 蓝天白云 ( 或 星空 ) 、 海浪 、 三维 目标 舰 、 鱼雷 及 静止 的 岛屿 融为一体 ， 系统 具有 良好 的 交互性 能 和 视听 效果 及 分析 、 统计 功能 ， 图例 见图 2 。 进一步 的 工作 将 更加 密切 地 结合实际 ， 将 系统 应用 于 潜艇 潜浮 过程 中 艇长 的 基本 指挥 、 鱼雷 攻击 、 导弹 发射 及 潜艇 水下 避碰 、 定位 等 实际 训练 中 。 
 作者简介 ： 崔汉国 　 男 , 33 岁 , 副教授 , 主要 研究 方向 为 计算机 图形学 、 工程 信息 的 可视化 及 虚拟环境 
 作者 单位 ： 海军工程学院 武汉 　 430033 
 参考文献 
 　 1 　 汪 成为 ， 高文 ， 王行仁 . 灵境 ( 虚拟现实 ) 技术 的 理论 、 实践 及 应用 . 清华大学 、 广西 科学技术 出版社 ， 1996 - 09 
 　 2 　 徐迎庆 ， 苏成 ， 李华 ， 刘慎权 ， 齐东旭 . 基于 物理 模型 的 流水 及 波浪 模拟 . 计算机 学报 ( 计算机 图形学 专辑 ) ， 1996 ， 19 ( 增刊 ) ： 153 ～ 159 
 　 3 　 陈华斌 ， 邱静 ， 张爱军 . 利用 OpenGL 开发 视景 仿真 软件系统 . 微 计算机 世界 ， 1997 - 06 ： 47 ～   49 
 　 4 　 潘志庚 ， 马小虎 ， 石教英 . 虚拟环境 中多 细节 层次模型 自动 生成 算法 . 软件 学报 ， 1996 ， ( 9 ) ： 526 ～ 531 
 　 5 　 崔汉国 ， 张惠 ， 陈 玉林 . 虚拟环境 中 视景 的 表示 与 生成 . 海军工程学院 学报 ， 1997 - 03 ： 12 ～ 17 
 收稿 日期 : 1998 - 06 - 01 
