微型机 与 应用 
 MICROCOMPUTER   &   ITS   APPLICATIONS 
 2000 　 Vol.19 　 No.4 　 P.21 - 23 
 
 
 
 基于 Ｐ Ｓ Ｄ 芯片 的 单片机 系统 的 接口 与 编程 
 孙 国华 
 摘   要 ：   新型 大规模 可编程 通用 接口 芯片 Ｐ Ｓ Ｄ ５ Ｘ Ｘ 的 原理 、 特点 及 使用 方法 。 
 关键词 ：   Ｐ Ｓ Ｄ 芯片   现场 可编程 系统 器件   单片机   可编程 逻辑 器件 
 　 　 传统 的 单片机 系统 设计 中 ， 通常 需要 外扩 程序 存储器 、 数据 RAM 、 地址 锁存 译码 逻辑 、 I ／ O 端口 、 中断 控制器 及 计数器 等 。 这样 设计 出 的 电路 不仅 复杂 、 而且 电路 可靠性 降低 、 产品 开发周期 延长 ， 实际 使用 时 ， 还 存在 调试 困难 、 抗干扰能力 差 、 不 具有 通用性 等 问题 。 随着 超大规模 集成电路 技术 的 发展 ， 美国 WSI 公司 推出 了 PSD 器件 ， 将 系统 所 需 的 众多 外围 器件 集成 在 1 片 芯片 上 ， 这样 单片机 与 PSD 芯片 就 构成 了 简单 方便 的 2 片 系统 （ 如图 1 所示 ） ， 从而 大大简化 了 系统 硬件 设计 ， 提高 了 系统 的 集成度 和 可靠性 。 
 
 图 1 　 使用 PSD5XX 前 、 后 原理 框图 比较 
 　 　 基于 PSD 芯片 的 硬件 设计 方法 采用 PSDsoft 开发工具 ， 利用 其中 的 PSDabel 软件 生成 符合 PSD 芯片 要求 ， 在 电路 结构 上 可行 的 数字 逻辑 ， 再 采用 PSDconfiguration 软件 来 构造 总线 接口 与 I ／ O 端口 ， 借助 PSD 编程器 生成 的 目标 文件 对 芯片 编程 ， 从而 完成 1 次 设计 。 调试 时 ， 可以 不 改变 电路板 而 直接 通过 软件 配置 进行 现场 编程 ， 修改 极为 方便 。 本文 主要 介绍 其中 功能 较强 的 PSD5XX 系列 芯片 。 
 1   PSD5XX 系列 芯片 硬件 性能 及 特点 
 1 ． 1   存储器 
 　 　 PSD5XX 芯片 内含 256Kb ， 或 512Kb ， 或 1Mb 的 EPROM ， 可以 构造 成 8 位 或 16 位 数据 宽度 。 EPROM 被 分成 4 个 相等 部分 ， 可以 分配 给 不同 的 地址 空间 ， 存取时间 为 90ns ， 包括 地址 锁存 与 译码 PLD 时间 。 EPROM 具有 低功耗 模式 ， 由 软件 控制 。 此外 ， 芯片 内部 含有 16Kb 的 StandbySRAM ， 也 可以 构造 成 8 位 或 16 位 数据 宽度 ， 存取时间 为 90ns ， 包括 地址 锁存 与 译码 PLD 时间 。 芯片 有 Vstby 引脚 ， 可 连接 备用 电池 ， 当 SRAM 掉电 时 实现 自动 切换 ， 保证 SRAM 中 的 数据 不 丢失 ， 可 在 调试 中 作为 EEPROM 使用 。 另外 ， 页面 逻辑 连接 到 ZPLD  零 功率 PLD  ， 便 能够 扩展 具有 有限 地址 空间 的 单片机 的 地址 空间 ， 最大 可 扩展 到 16 个 页面 。 软件 控制 的 加密 位 可以 防止 对 PSD 构造 、 ZPLD 、 EPROM 内容 的 读取 ， 保密性 好 。 
 1 ． 2   总线 控制 逻辑 
 　 　 经 软件 构造 后 ， 总线 控制 逻辑 能 直接 译码 由 8031 、 80196 、 68HC11 、 683XX 、 16000 、 Z80 等 单片机 产生 的 控制 信号 ， 不 需要 附加 的 连接 逻辑 ， 具有 广泛 的 适应性 。 具有 “ 无 连接 逻辑 ” 的 用户 编程 接口 ， 能 与 8 位 或 16 位 多路复用 或非 多路复用 微控制器 接口 ， 扩展 地址 能力 达 24 位 。 此外 ， RESET 、 ALE 信号 可 由 软件 编程 控制 其 极性 。 对于 没有 复位 信号 输出 的 单片机 ， PSD5XX 系列 能够 以 输入 的 RESET 信号 产生 滞后 的 复位 信号 ， 使得 单片机 与 PSD5XX 能够 有序 复位 。 
 1 ． 3   I ／ O 端口 
 　 　 PSD5XX 系列 具有 40 根 I ／ O 引脚 ， 分为 PA 、 PB 、 PC 、 PD 、 PE5 个 端口 ， 其中 端口 A 、 B 、 E 都 能够 构造 成 标准 微控制器 I ／ O 口 ， 或 地址 ／ 数据 多路复用 控制器 的 锁存 地址 输出 或 特殊 功能 I ／ O 口 。 端口 C 、 D 是 标准 I ／ O 口 ， 也 可 构造 成 ZPLD 输入 引脚 或非 多路复用 总线 单片机 的 数据总线 。 
 1 ． 4   可编程 逻辑 PLD 
 　 　 PSD5XX 系列 的 核心 是 能 执行 以下 功能 的 ZPLD ： 
 　 　 （ 1 ） 译码 ZPLD  DPLD  ， 执行 对 内部 I ／ O 、 外围 芯片 、 4 个 EPROM 块 、 SRAM 和 端口 A 外围 模式 的 地址 空间 译码 ； 
 　 　 （ 2 ） 通用 功能 ZPLD  GPLD  ， 用来 实现 状态机 和 其它 一般 逻辑 ， 具有 多达 61 个 输入 ， 118 个 乘积 项 ， 连接 到 端口 A 、 B 、 E 的 24 根 I ／ O 引脚 。 此外 ， GPLD 还 能 对 单片机 的 地址总线 译码 ， 并 对 外围 芯片 产生 片选 信号 ； 
 　 　 （ 3 ） 外围 ZPLD  PPLD  ， 能为 计数器 ／ 定时器 单元 和 中断 控制器 产生 输出 。 
 1 ． 5   中断 控制 
 　 　 具有 8 级 中断 。 PPLD 产生 4 个 中断 ， 可以 由 用户 定义 ， 从 端口 D 输入 ； 其它 4 个 中断 由 计数器 ／ 定时器 终止 计数 标志 产生 。 每个 中断 都 能 单独 屏蔽 ， 并 可 构造 为 边缘 触发 或 电平 触发 。 
 1 ． 6   计数器 ／ 定时器 
 　 　 PSD5XX 有 4 个 16 位 的 计数器 ／ 定时器 ， 都 有 5 种 操作 模式 ， 分别 为 脉冲 、 波形 、 时间 捕捉 、 事件 计数 和 看门狗 定时器 ， 由 PPLD 宏单元 控制 。 其 时钟 输入 具有 分频器 ， 分频 系数 为 4 ～ 280 。 
 2   PSD5XX 与 单片机 的 接口 和 配置 
 　 　 由于 INTEL   80C196KC 单片机 使用 广泛 ， 并且 能 动态 配置 成 8 位 或 16 位 总线 ， 所以 选用 80C196KC 单片机 为例 ， 与 PSD5XX 构成 8 位 或 16 位 总线 的 2 片 系统 ， 如图 2 所示 。 图中 ， 80C196KC 单片机 总线 宽度 动态 配置 ， PSD5XX 配置 为 16 位 多路复用 总线 ， 控制 信号 RD 、 WRL 、 WRH 、 RESET 极性 为 低 ， ALE 极性 为 高 。 
 
 图 2 　 PSD5XX 与 80C196 的 接口 
 3   PSD5XX 与 单片机 接口 的 软件 构造 
 3 ． 1   系统 存储器 的 配置 
 　 　 程序代码 存储 在 3 个 32KB   EPROM 块 中 ， 占据 了 0000H ～ 7FFFH 相同 的 地址 空间 。 这样 就 要求 将 EPROM 块 指定 到 3 个 不同 的 页面 中 ， 分配 表如表 1 所示 。 而且 单片机 在读 SRAM 时 ， 采用 8 位 总线 宽度 ， 并 插入 等待 状态 。 
 器件 存储器 空间 存储器 页面 
 EPROM 块 00000H ～ 7FFFH 页面 0 
 EPROM 块 10000H ～ 7FFFH 页面 1 
 EPROM 块 20000H ～ 7FFFH 页面 2 
 SRAM8000H ～ 8FFFH 所有 页面 
 I / O 设备 D000H ～ D0FFH 所有 页面 
 
 3 ． 2   I ／ O 端口 的 配置 
 　 　 PSD5XX 的 端口 具有 多种 工作 模式 ， 某些 基本功能 为 ZPLD 和 计数器 ／ 定时器 提供 输入 ／ 输出 ， 或者 用作 标准 I ／ O 端口 ， 每 1 根 端口 引线 都 可以 单独 构造 。 为此 要求 用户 ： 在 应用软件 中 对 某些 端口 构造 寄存器 进行 初始化 ； 在 PSDsoft 软件 中 构造 PSD5XX ， 并 把 未用 的 输入 引脚 拉到 VCC 或 GND 。 
 　 　 1 ． 标准 I ／ O 模式 
 　 　 此 模式 为 单片机 提供 附加 的 I ／ O 功能 ， 本例 中 ， 将 端口 A 、 B 构造 成 标准 I ／ O 口 ， 构造方法 如下 ： 
 　 　 （ 1 ） 在 ABEL 文件 中 命名 用作 I ／ O 引脚 或 信号 ； 
 　 　 （ 2 ） 将 控制 寄存器 相应 位置 为 “ 1 ” ； 
 　 　 （ 3 ） 如 作为 输入 端口 ， 设置 方向 寄存器 为 输入 模式 ， 从 数据 输入 寄存器 读数据 ； 
 　 　 （ 4 ） 如 作为 输出 端口 ， 设置 方向 寄存器 为 输出 模式 ， 将 数据 写 到 数据 输出 寄存器 。 
 　 　 2 ． PLD   I ／ O 模式 此 模式 使 端口 能 构造 为 ZPLD 输入 ， 或 作为 GPLD 的 输出 ， 并 能 使 输出 为 三态 ， 控制 信号 由 来自 GPLD 的 乘积 项 定义 ， 构造方法 如下 ： 
 　 　 （ 1 ） 在 ABEL 文件 中 命名 引脚 或 信号 ； 
 　 　 （ 2 ） 在 ABEL 文件 中写 逻辑 方程 ； 
 　 　 （ 3 ） 用 PSD 编译器 给 PSD 配置 PLD 功能 。 
 　 　 3 ． 地址 输出 模式 
 　 　 对于 多路复用 地址 ／ 数据总线 的 单片机 ， 此 模式 下 I ／ O 端口 能 给 外部 器件 提供 锁存 的 地址 输出 ， 构造方法 如下 ： 
 　 　 （ 1 ） 在 ABEL 文件 中 命名 用作 地址 输出 的 引脚 ； 
 　 　 （ 2 ） 把 “ 0 ” 写 到 与 每个 I ／ O 端口 有关 的 控制 寄存器 的 相应 位 ； 
 　 　 （ 3 ） 把 方向 寄存器 设置 为 输出 模式 。 
 　 　 4 ． 特殊 功能 输出 模式 
 　 　 该 模式 下 每个 端口 引脚 都 可以 单独 构造 ， 当使 能 有效 时 ， 指定 给 特定 引脚 的 特殊 功能 被 驱动 输出 ， 特殊 功能 由 定时器 和 中断 输出 组成 ， 构造方法 如下 ： 
 　 　 （ 1 ） 在 PSDsoft 软件 中 规定 输出 功能 ； 
 　 　 （ 2 ） PSD 编译器 为 选定 的 功能 指定 引脚 ； 
 　 　 （ 3 ） 把 “ 1 ” 写 到 特殊 功能 寄存器 的 相应 位 。 
 　 　 5 ． 替换 功能 输入 模式 
 　 　 用户 在 模式 下能 定义 端口 E 的 引脚 ， 以 执行 替换 功能 ， 主要 是 计数器 ／ 定时器 的 输入 ， 构造方法 如下 ： 
 　 　 （ 1 ） 在 PSDsoft 软件 中 选择 输入 功能 ； 
 　 　 （ 2 ） PSD 编译器 为 选定 的 功能 指定 引脚 。 
 　 　 6 ． 漏极 开路 输出 模式 此 模式 使 用户 能 把 端口 C 、 D 构造 为 漏极 开路 输出 ， CMOS 模式 输出 是 默认 构造 ， 只要 将 “ 1 ” 写 进漏 极 开路 寄存器 的 相应 位 即可 。 除了 上述 工作 模式 外 ， 还有 在 非 多路复用 下 的 地址 输入 模式 、 数据 端口 模式 、 以及 用以 执行 DMA 操作 外围 I ／ O 模式 。 因 本例 中未 用到 不再 介绍 。 4   PSD 软件 编程 本例 中 ， 端口 A 、 B 为 标准 I ／ O 模式 ， 端口 C 为 地址 输出 模式 ， 端口 D 为 漏极 开路 输出 模式 ， 端口 E 的 部分 引脚 为 替换 功能 输入 模式 ， 以便 对外部 输入 信号 计数 ， 部分 引脚 作为 PLD   I ／ O 及 特殊 功能 输出 。 各 端口 及 控制 寄存器 地址 由基 地址  CSIOP  ＋ 偏移量 确定 ， 其中 的 基 地址 由 PSD 软件 配置 。 具体 的 ABEL 文件 如下 ： MODULE   80C196KCTITLE   “ example   of   80C196KC   using   PLD5XX ” A15 ， A14 ， A13 ， A12 ， A11 ， A10 ， A9 ， A8   PIN ； Pgr3 ， Pgr1 ， Pgr2 ， Pgr0   NODE ； CSIOP ， RS0 ， ES0 ， ES1 ， ES2   NODE ； BUSWIDTH ， READY ， RESET ＿ OUT ， CSOUT   PIN   30 ， 31 ， 33 ， 36 ； RESET ＿ IN   PIN ； X   ＝ ． X ． ； PE ＝  Pgr3 ， Pgr1 ， Pgr2 ， Pgr0  ； ADDRESS ＝  A15 ， AAG14 ， A13 ， A12 ， A11 ， A10 ， A9 ， A8 ， X ， X ， X ， X ， X ， X ， X ， X ，  ； EQUATIONSCSIOP ＝  ADDRESS ＞ ＝ ＾ HD000  ＆  ADDRESS ＜ ＝ ＾ HD0FF  ； RS0 ＝  ADDRESS ＞ ＝ ＾ H8000  ＆  ADDRESS ＜ ＝ ＾ H87FF  ； ES0 ＝  ADDRESS ＞ ＝ ＾ H0000  ＆  ADDRESS ＜ ＝ ＾ H7FFF  ＆  PAGE ＝ ＝ 0  ； ES1 ＝  ADDRESS ＞ ＝ ＾ H0000  ＆  ADDRESS ＜ ＝ ＾ H7FFF  ＆  PAGE ＝ ＝ 1  ； ES2 ＝  ADDRESS ＞ ＝ ＾ H0000  ＆  ADDRESS ＜ ＝ ＾ H7FFF  ＆  PAGE ＝ ＝ 2  ；  CSOUT ＝  ADDRESS ＞ ＝ ＾ HC000  ＆  ADDRESS ＜ ＝ ＾ HCFFF  BUSWIDTH ＝ CSIOP ＋ RS0 ； READY ＝ RS0 ； RESET ＿ OUT ＝ RESET ＿ IN ； END   80C196KC ； 上述 文件 经过 仿真 、 编译 后 ， 即可 用 PSDsoft 软件 生成 的 目标 文件 对 PSD5XX 芯片 编程 ， 从而 完成 PSD5XX 芯片 的 最后 设计 。 SRAM 单片机 程序 存储器 PLDI ／ O 中断 控制器 计数器 定时器 PSD5XX 单片机 图 1   使用 PSD5XX 前 、 后 原理 框图 比较 图 2   PSD5XX 与 80C196 的 接口 器件 EPROM 块 0EPROM 块 1EPROM 块 2SRAMI ／ O 设备 存储器 空间 0000H ～ 7FFFH0000H ～ 7FFFH0000H ～ 7FFFH8000H ～ 8FFFHD000H ～ D0FFH 存储器 页面 页面 0 页面 1 页面 2 所有 页面 所有 页面 表 1   系统 存储器 分配 表孙 国华 （ 南京 船舶 雷达 研究所  210003 ） 
 参考文献 
 １ ， 许少云 ， 李伟鹏 ． Ｐ Ｓ Ｄ 原理 、 开发 与 应用 ． 北京 ： 电子 工业 出版社 ， １ ９ ９ ６ 
  收稿 日期 ： １ ９ ９ ９ － １ １ － ３ ０ 
