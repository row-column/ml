计算机 应用 研究 
 APPLICATION   RESEARCH   OF   COMPUTERS 
 2000   Vol.17   No.3   P.80 - 82 
 
 
 
 
 N - ISDN 基本 速率 入口 ( BRA ) 呼叫 控制 的 实现 
 韩和生 　 黄 桂金 
 摘 　 要 ： 近几年来 ， 综合 业务 数字网 ( Integrated   Services   Digital   Network ) 取得 了 较 快 的 发展 。 特别 是 窄带 ISDN ( Narrowband   ISDN ) ， 已经 进入 到 大量 应用 的 阶段 。 主要 介绍 窄带 ISDN 的 基本 速率 接口 ( 2B + D ) 的 呼叫 控制 的 方案 及 实现 。 
 关键词 ： 窄带 ISDN   2B + D   呼叫 控制 
 l 　 引言 
 　 　 由于 社会 对 信息处理 的 需求 迅速 增长 ， 出现 了 很多 新型 的 电信业务 ， 包括 声音 、 图象 、 文字 、 数据 等等 。 人们 为了 满足 这些 业务 ， 建立 了 专门 的 网络 。 网络 之间 的 互通 只有 通过 网间 的 特殊 信关 ( Gateway ) 设备 来 实现 。 无论 对 用户 还是 对于 运行 管理 部门 来说 ， 都 存在 很多 缺点 ， 如 经济性 差 、 效率 低下 、 使用 不便 、 维护 复杂 等 。 为了 克服 这些 缺点 ， 必须 用 一个 单一 的 网络 来 提供 各种 不同 的 业务 ， 实现 完全 的 开放系统 互连 和 通信 。 这个 单一 的 网络 就是 综合 业务 数字网 ISDN ( Integrated   Services   Digital   Network ) 。 
 　 　 因为 不 可能 抛弃 现存 的 网络 ， ISDN 的 发展 将 分为 两步 ： 第一步 先 发展 窄带 ISDN ( Narrow   ISDN ) ， 即将 用户 - 网络接口 上 的 速率 限制 在 2Mbit / s 之内 ； 第二步 是 发展 宽带 ISDN ( Broadband   ISDN ) ， 以 提供 高得 多 的 速率 ， 并 使 图象 通信 和 快速 数据 传送 等 业务 成为 可能 。 
 　 　 窄带 ISDN 有 两种 不同 速率 的 标准接口 ： 一种 是 基本 入口 ( Basic   Rate   Access ) ， 速率 为 144   kbit / s ， 支持 2 条 64   kbit / s 的 用户 信道 和 一条 16   kbit / s 的 信令 信道 ； 另 一种 是 一次 群 速率 入口 ( Primary   Rate   Access ) ， 其 速率 和 PCM 一次 群 速率 相同 ( 2 , 048   kbit / s 或 1 , 544   kbit / s ) ， 支持 30 或 24 条 64   kbit / s 的 用户 信道 和 一条 64   kbit / s 的 信令 信道 。 
 2 　 相关 协议 
 　 　 CCITT 对于 ISDN 制定 了 一整套 的 相关 协议 ， 与 呼叫 控制 有关 的 协议 是 I.451 ( 即 ITU - T   Q.931 ) 。 该 协议 描述 了 D 通路 第三层 的 各种 功能 ， 规定 了 在 ISDN 用户 - 网络接口 上 建立 、 保持 和 清除 网络连接 的 程序 。 其 主要 功能 包括 以下 各项 ： 
 　 　 ( a ) 处理 与 数据 链路层 通信 的 原语 ； 
 　 　 ( b ) 产生 和 解释 同层 通信 的 第三层 消息 ； 
 　 　 ( c ) 管理 呼叫 控制程序 中 使用 的 定时器 和 逻辑 实体 ； 
 　 　 ( d ) 接入 资源 的 管理 ， 包括 对 B 通路 和 分组 层 逻辑 通路 的 管理 ； 
 　 　 ( e ) 保证 提供 的 业务 与 用户 要求 一致 的 检查 ( 如 ， 承载能力 、 地址 、 低层 和 高层 兼容性 ) 。 
 　 　 Q.931 协议 可以 分成 两 部分 ： 协议 控制 部分 和 呼叫 控制 部分 。 前者 主要 完成 上述 的 前 三项 功能 ， 后者 主要 完成 后 两项 功能 及 逻辑 实体 的 管理 ， 两 部分 之间 以 原语 进行 通信 。 图 1 给出 了 用户 - 网络接口 示意图 。 
 
 　 　 Q.931 对于 协议 控制 作 了 很 详细 的 规定 ： 包括 需要 的 状态 定义 ， 具体 的 消息 结构 ， 用户 侧 和 网络 侧 的 消息 交换 的 流程 及 相关 的 SDL 图 。 而 对于 呼叫 控制 部分 则 给出 较为 抽象 的 说明 及 参考 的 原语 名称 。 这样 做 是因为 这 一部分 无法 制定 成 统一 的 标准 ， 特别 是 在 网络 侧 ， 各 厂商 的 设计 结构 、 设计 思想 都 不会 一致 ； 当然 ， 另一方面 也 给 设计者 以 较大 的 灵活性 。 
 3 　 开发 协议 软件 的 工程 方法 
 　 　 通信 网络 的 发展 已经 进入 了 一个 系统化 和 工程化 的 时代 ， OSI 参考模型 在 任何 涉及 到 异种 网络 互连 的 地方 都 可以 看到 ， 各种 系统 的 实现 都 必须 遵循 相应 的 OSI 协议 标准 。 因此 ， 如何 系统地 开发 协议 软件 ， 以 确保 在 不同 的 实现 之间 能 协调 地 工作 是 一个 十分 重要 的 问题 。 在 这 一 背景 下 ， 产生 了 “ 协议 工程 ” 。 协议 工程 为 协议 软件 的 研制 和 开发 提供 了 一套 工程 规范 ， 它 是 软件工程 理论 在 分布式 协议 系统 中 的 具体 应用 ( 图 2 ) 。 
 
 图 2 　 开发 协议 软件 的 主要 模型 
 　 　 所谓 的 协议 概念模型 是 指用 自然语言 描述 的 协议 工程 。 自然语言 不够 严格 、 不够 精确 ， 必须 用 形式 描述 技术 ( FDT ， Formal   Description   Technique ) 将 协议 的 概念模型 变成 精确 的 规格 说明 。 FDT 模型 很多 ， 主要 有 FSM 、 Petri 网 模型 、 形式语言 模型 等 。 对 电信 系统 而言 ， 常用 的 是 SDL 图 表示 的 FSM 模型 。 从 协议 的 概念模型 到 精确 的 规格 说明 是 一个 反复 的 过程 ， 也 是 实现 协议 的 关键 。 
 　 　 Q.931 中有 相当 一部分 是 SDL 图 ， 这些 图是 其中 协议 控制 部分 的 功能 描述 ， 对于 呼叫 控制 部分 来说 ， SDL 图要 自己 制定 。 这部分 必须 慎重 ， 确保 整个 呼叫 控制 模块 功能 即 与 协议 控制 的 接口 与 规范 一致 。 
 4 　 FSM 的 管理 
 　 　 有限 状态机 ( FSM ) 是 自动机 理论 中 的 研究 对象 ， 其 基本特征 是 具有 有限 的 状态 集 、 有限 的 输入 集 和 有限 的 输出 集 ， 某一 时刻 的 输出 取决于 系统 前 一 状态 和 此刻 的 输入 。 
 　 　 FSM 有 两种 实现 方法 ： 表格 驱动 ( Table - driven ) 和 过程 驱动 ( Procedure - driven ) 。 表格 驱动 法 利用 一个二维 数组 ， 该 数组 中 的 每 一行 与 一个 状态 相对 应 ， 每 一列 与 一个 可能 的 输入 事件 或 引起 的 转换 操作 相对 应 ， 每一 表项 则 与 在 某 一 状态 下 对 某 一 事件 的 处理 相对 应 。 过程 驱动 法为 每 一个 状态 都 定义 一个 过程 。 当 一个 事件 发生 时 ， 根据 当前 的 状态 来 选择 正确 的 过程 ， 这个 过程 用 “ case ... ” 区分 事件 ， 并 采取相应 的 处理 。 
 　 　 表格 驱动 法 适合 于 一个 具有 规则 结构 、 简单 语义 和 相对 复杂 的 转换 图表 的 有限 状态机 。 过程 驱动 适合 于 实现 具有 几个 转换 和 复杂 语义 的 有限 状态机 。 呼叫 控制 部分 的 实现 采用 了 过程 驱动 法 。 
 5 　 呼叫 控制 的 实现 
 　 　 呼叫 控制 部分 的 功能 为 ： 
 　 　 ( a ) 完成 端到 端 D 信令 的 交互 ； 
 　 　 ( b ) 进行 资源管理 ( 如 B 通路 ， 呼叫 参考 ) ； 
 　 　 ( c ) 通过 和 原 交换机 中 MPU ( Micro   Processing   Unit ) 的 通信 ， 完成 呼叫 的 建立 、 接续 、 拆除 等 过程 。 
 　 　 我们 要 实现 的 是 网络 侧 的 呼叫 控制 部分 ， 而且 是 在 原先 普通 交换机 ( 更 确切 地 说 是 调度机 ) 上 ， 因此 充分 参考 了 该机 的 特点 。 它 采用 的 是 全 分散式 结构 ， 即 每块 用户 板 只 负责 处理 4 路 普通 电话 ， 这样 就 保证 了 整个 系统 的 高可靠性 。 相应 地 ， ISDN 的 设计 也 采用 了 类似 的 方式 ， 每块 ISDN 用户 板 只 负责 处理 1 路 2B + D 。 这样 ， 呼叫 控制 所 管理 的 资源 将 大大减少 。 即使 某块 用户 板 不能 正常 工作 ， 也 不会 影响 其它 的 用户 板 。 
 　 　 由于 交换机 的 上述 特点 ， 为了 完成 端到 端的 D 信令 的 交互 过程 ， 呼叫 控制 模块 除了 要 与 协议 控制 进行 原语 通信 ， 还要 与 其它 用户 板上 的 呼叫 控制 模块 进行 对 等 实体 间 的 消息 通信 。 
 　 　 呼叫 的 接续 过程 ， 主要 由原 交换机 的 MPU 来 完成 。 ISDN 用户 板由原 交换机 的 普通用户 板 改造 而 来 ， 它 和 交换机 的 接口 与 原 用户 板到 交换机 的 接口 完全相同 。 但是 由于 原 普通用户 板 与 MPU 的 通信 能力 很差 ， 无法 满足 实现 ISDN 功能 所 需 的 对 交换机 的 控制 。 因此 ， 对 接续 的 控制 就 交由 ISDN 接续 控制板 来 完成 。 ISDN 接续 控制板 负责 和 MPU 通信 ， 而 ISDN 用户 板则 和 接续 控制板 通信 ， 通过 接续 控制板 间接 完成 对 呼叫 的 接续 过程 。 
 　 　 图 3 为 其 接口 示意图 。 
 
 图 3 　 呼叫 控制 模块接口 示意图 
 　 　 呼叫 控制 模块 与 协议 控制 模块 以 原语 进行 通信 ， 属于 板内 通信 。 在 整个 呼叫 的 过程 中 ， 呼叫 控制 模块 为了 得到 有关 用户 的 信息 ( 如 用户 号码 、 用户 权限 ) ， 必须 查询数据库 ， 主要 是 调用 数据库 提供 的 API 函数 。 另一方面 通过 与 X 总线 驱动程序 接口 ， 呼叫 控制 模块 与 系统 中 的 其它 ISDN 用户 板上 的 呼叫 控制 模块 及 接续 控制板 的 接续 控制 模块 进行 板 间通信 。 
 　 　 图 4 ( a ) ～ ( c ) 给出 了 ISDN 设备 呼叫 ISDN 设备 ， ISDN 呼叫 普通 电话 、 普通 电话 呼叫 ISDN 电话 的 消息 流程图 ， 图中 的 振铃 信号 来自 MPU 。 ( b ) 和 ( c ) 的 呼叫 释放 的 消息 流程 是 相同 的 ， 为 节省 篇幅 ， 在 图 ( b ) 中 没有 给出 呼叫 释放 的 过程 。 
 
 图 4 （ a ） 　 ISDN 呼叫 ISDN 的 呼叫 过程 消息 流程 
 
 图 4 （ b ） 　 ISDN 电话 呼叫 普通 　 　 　 　 图 4 （ c ） 　 普通 电话 呼叫 ISDN 
 电话 的 消息 流程 　 　 　 　 　 　 　 　 　 电话 的 消息 流程 
 　 　 呼叫 控制 模块 采用 了 有限 状态机 ( FSM ) 结构 。 将 呼叫 控制 进行 的 不同 时刻 抽象 为 不同 的 状态 ， 将 来自 外部 和 内部 的 激励 分别 表示 成 原语 和 消息 ， 一次 呼叫 的 处理过程 就是 在 一系列 消息 和 原语 激励 下 的 呼叫 状态 的 演变 。 由于 呼叫 控制 要 处理 ISDN 到 ISDN 的 呼叫 ， 以及 ISDN 到 普通 电话 、 普通 电话 到 ISDN 的 呼叫 ， 而 对于 每 一个 呼叫 ， 主 、 被叫 端口 分开 单独 考虑 。 因此 ， 共 定义 了 4 组 状态机 来 分别 处理 。 
 　 　 对 每 一个 正在 进行 的 呼叫 ， 都 有 一个 和 它 相 联系 的 独立 的 动态 数据结构 ， 称之为 呼叫 控制 块 ( Call   Control   Block ， 简称 CCB ) ， 它 记录 了 当前 某一 正在 进行 的 呼叫 所 需 的 各种 动态数据 ， 控制 呼叫 的 进行 。 每当 一个 新 的 呼叫 产生 时 ， 呼叫 控制 为 其 分配 一个 新 的 呼叫 控制 块 ， 而 当 一个 呼叫 结束 时 ， 将 返还 该 呼叫 控制 块 。 
 6 　 数据结构 
 　 　 呼叫 控制 部分 所 涉及 的 数据结构 有 三种 ： 和 协议 控制 部分 交互 的 原语 结构 、 和 其它 呼叫 控制 交互 的 消息 结构 以及 与 接续 控制 部分 通信 的 消息 结构 。 
 　 　 原语 结构 应由 呼叫 控制 和 协议 控制 协商 决定 ， 由于 协议 控制 部分 采用 的 是 商用 软件 ， 原语 结构 已经 提供 了 ， 这里 不 作 讨论 。 
 　 　 两种 消息 的 整体 结构 大致相同 ， 即 由 公共 的 消息 头 和 数据 部分 组成 。 
 　 　 消息 头 的 结构 为 ： 
 struct   message _ header 
 { 
 　 　 ushort   DestAddr ； 　 　 　 　 　 　 / *   目的 地址   * / 
 　 　 uchar   SourAddr ； 　 　 　 　 　 　 / *   源地址   * / 
 　 　 uchar   MsgType ； 　 　 　 　 　 　 / *   消息 类型   * / 
 　 　 ushort   MsgLen ； 　 　 　 　 　 　 / *   实际 有效 数据 长度   * / 
 　 　 uchar   MsgCode ； 　 　 　 　 　 　 / *   消息 编码   * / 
 　 　 uchar   Reserved ； 
 } 
 　 　 由于 采用 的 是 全 分散式 结构 ， 板 间通信 是 必须 的 。 消息 头 提供 的 正是 相关 的 信息 ， 如 ： 目的 板 ( 高字节 为 接续 控制板 ， 低字节 为 用户 板 ) 和 源板 地址 ， 消息 类型 ( 用户 板到 用户 板 、 用户 板到 接续 控制板 等 ) ， 传送 的 消息 长度 ， 消息 编码 。 
 　 　 各 消息 的 数据 部分 则 各不相同 ， 呼叫 控制 与 接续 控制 通信 的 消息 根据 交换机 MPU 的 特点 制定 ， 呼叫 控制 与 呼叫 控制 之间 的 消息 则 参考 了 Q.931 中 第三层 的 消息 的 组成 及 各 信息 单元 的 结构 ， 如图 5 所示 。 
 
 图 5 　 呼叫 控制 消息 结构 
 　 　 每条 消息 都 包含 了 可能 存在 的 信息 单元 ， 在 这些 信息 单元 中 ， 有 任选 的 ， 也 有 必选 的 。 对于 任选 的 信息 单元 ， 它 可能 存在 于 该 消息 中 ， 也 可能 并 不 存在 。 为了 指示 这 一点 在 信息 单元 加 了 一个 标志 。 接收 消息 的 呼叫 控制 实体 可 根据 标志 ， 正确 地 得到 存在 的 信息 单元 的 内容 。 消息 结构 的 这样 定义 是 为了 简单 ， 因为 它 并 没有 涉及 到 内存 的 动态分配 ， 因而 不会 给 整个 系统 带来 什么 影响 ， 而 在 处理 上 则 一目了然 。 
 7 　 结束语 
 　 　 上述 呼叫 控制 的 方案 证明 是 切实可行 的 ， 目前 已经 成功 地 实现 了 语音 、 数据 及 图象 的 传输 。 有 了 可靠 的 网络连接 ， 用户 终端 可以 在 此基础 上 开发 出 更 多 的 应用程序 ， 特别 是非 通话 业务 的 实现 。 
 韩和生 ( 华中理工大学   武汉   430074 ) 
 黄 桂金 ( 华中理工大学   武汉   430074 ) 
 参考文献 
 1   ITU - T   Recommendation   Q.931 :   Digital   Subscriber   Signalling   No.1   ( DSS   1 ) - ISDN   User -   Network   Interface   Layer   3   Specification   For   Basic   Call   Control   1993 
 2   中华人民共和国 标准 :   ISDN 用户 - 网络接口 第三层 基本 呼叫 技术规范 及 测试方法 
 3   程时 端 编著 .   综合 业务 数字网 .   北京 ： 人民邮电出版社 ,   1997.10 
 4   李津生 ,   秋山稔 著 .   综合 业务 数字网 与 异步 转移 模式 .   合肥 ： 中国 科学技术 大学 出版社 ,   1993.1 
 5   深圳 德开 通讯设备 有限公司 .   DK - 1 全 分散 数字式 汇接 调度 交换 系统 技术 说明书 .   1998 
 收稿 日期 ： 1999 年 10 月 1 日 
