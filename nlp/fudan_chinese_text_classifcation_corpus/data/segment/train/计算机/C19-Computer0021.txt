计算机 应用 
 COMPUTER   APPLICATIONS 
 1999 年   第 19 卷   第 6 期   Vol.19   No.6   1999 
 
 
 
 防火墙 技术 与 防火墙 系统 设计 
 肖 　 捷 
 　 　 摘 　 要 　 本文 通过 对 防火墙 系统 的 两种 基本 技术 的 分析 ， 提出 了 防火墙 系统 总体设计 的 基本 思想 ， 并 设计 了 一种 基于 包 过滤 技术 、 代理 技术 和 身份验证 技术相结合 的 实用 防火墙 系统 。 
 　 　 关键词 　 包 过滤 技术 ， 代理 技术 ， 身份验证 
 1 　 防火墙 
 　 　 随着 Internet   在 世界 范围 内 的 普及 ， 网络安全 问题 变得 愈来愈 重要 。   为了 防止 侵入 者 盗窃 、 修改 或 破坏 系统 上 的 数据 ， 维护 私用 网络 和 防止 对 计算机 资源 的 非 授权 使用 ， 获得 对 Internet 比较 安全 的 应用 ， 防火墙 系统 是 一种 重要 的 应用 模式 。 
 2 　 防火墙 技术 分析 
 　 　 根据 ISO / OSI 参考模型 ， 防火墙 技术 主要 分为 两大类 ： 一类 是 建立 在 网络层 上 的 基于 包 过滤 技术 的 防火墙 ; 另一类 是 建立 在 应用层 上 的 基于 代理 技术 的 防火墙 。 
 2.1 　 包 过滤 技术 防火墙 
 　 　 包 过滤 技术 防火墙 ， 也 称 网络层 防火墙 ， 作用 于 IP 层 ， 通常 由 过滤 路由器 来 构建 ， 其 实现 原理 是 ： 对 每 一个 到达 过滤 路由器 的 IP 包 ， 过滤 路由器 从 IP 包头 中 获得 有关 信息 ， 如 ： IP 包头 中 协议 类型 、 源 IP地址 、 目的 IP地址 、 源 端口号 、 目的 端口号 及 各种 标志 位 等 信息 ， 根据 过滤 路由器 中 预先 制订 好 的 过滤 规则 进行 检查 ， 决定 IP 包 的 通过 或 阻塞 ， 从而 实现 对 IP 包 的 过滤 ， 其 核心 就是 过滤 规则 的 制订 。 连接结构 如图 1 。 这种 防火墙 技术 的 优点 是 简单 方便 ， 透明性 好 ， 速度 快 ， 对 网络 性能 影响 不 大 ， 缺点 是 正确 建立 和 管理 包 过滤 规则 比较 困难 ， 同时 还 缺乏 审计 、 跟踪 及 身份验证 功能 。 
 
 图 1 　 过滤 路由器 防火墙 系统 连接结构 
 2.2 　 代理 技术 防火墙 
 　 　 代理 技术 防火墙 ， 也 称 应用层 防火墙 ， 作用 于 应用层 。 其 核心 是 运行 于 防火墙 主机 上 的 代理服务器 进程 ， 它 代替 网络 用户 完成 特点 的 TCP / IP 功能 。 一个 代理服务器 实际上 是 一个 为 特定 网络应用 而 连接 两个 网络 的 网关 ， 对于 每 一种 不同 的 应用服务 ， 都 必须 有 一个 相应 的 代理 。 外部 网络 和 内部 网络 之间 要 建立 连接 ， 必须 通过 代理 的 中间 转换 ， 内部 网络 只 接受 代理服务 提出 的 服务 请求 ， 拒绝 外部 网络 的 直接 连接 。 连接结构 如图 2 。 这种 防火墙 技术 的 优点 是 它 能 完全 控制 通信 双方 的 会 话 过程 ， 具有 用户 级 的 身份验证 、 日志 管理 和 帐号 管理 功能 ， 提供 了 比 过滤 路由器 更为 严格 的 安全性 ， 缺点 是 缺乏 透明性 ， 影响 网络 性能 ， 必须 针对 每一项 服务 都 建立 对应 的 应用层 网关 ， 才能 提供 全面 的 安全 保证 ， 这 势必 严重 限制 新 应用 的 采纳 。 能否 开发 一个 包罗万象 的 代理服务器 ， 将 有利于 新 应用 的 挂接 。 
 
 图 2 　 代理服务器 防火墙 系统 连接结构 
 　 　 综合 上述 两种 防火墙 技术 的 优缺点 ， 在 实际 构建 防火墙 系统 时 ， 通常 由 过滤 路由器 和 代理服务器 组合 在 一起 构成 一个 混合 的 多级 防火墙 系统 ， 由 过滤 路由器 提供 第一级 的 安全 防护 ， 主要 用于 防止 IP 欺骗 攻击 ， 再 由 代理服务器 提供 更 高级 的 安全 防护 机制 。 连接结构 如图 3 。 
 
 图 3 　 过滤 路由器 + 代理服务器 防火墙 系统 连接结构 
 3 　 防火墙 系统 总体设计 基本 思想 
 3.1 　 设计 防火墙 系统 的 拓扑 结构 
 　 　 在 确定 防火墙 系统 的 拓扑 结构 时 ， 首先 必须 确定 被 保护 网络 的 安全级别 。 从 整个 系统 的 成本 、 安全 保护 的 实现 、 维护 、 升级 、 改造 以及 重要 资源 的 保护 等 方面 进行 考虑 ， 以 决定 防火墙 系统 的 拓扑 结构 。 通常 有 三种 主要 的 拓扑 结构 。 一 、 双 宿主 主机 结构 ， 通过 在 主机 中 插入 两块 网卡 实现 硬件 连接 ， 它 是 防火墙 系统 使用 的 最 基本 配置 ， 这种 防火墙 主机 的 重要性 是 路由 被 禁止 ， 网络 段 之间 唯一 的 路径 是 通过 应用层 的 服务程序 来 实现 。 二 、 屏蔽 主 网关 结构 ， 即 由 过滤 路由器 和 代理 主机 分别 实现 包 过滤 和 代理服务 两级 安全 防护 ， 其中 代理 主机 是 这种 结构 防火墙 系统 的 中心 主机 ， 通常 称为 堡垒 主机 。 三 、 屏蔽 子网 网关 结构 ， 即 由 两台 路由器 和 一台 堡垒 主机 构成 一个 中间 的 过滤 子网 ， 由 其 实现 外部 网 与 内部网 的 分离 ， 但 内部网 、 外部 网都 可以 访问 中间 的 过滤 子网 ， 显然 ， 这种 结构 的 安全性 较 好 。 
 3.2 　 制定 网络安全 策略 
 　 　 不同 的 组织 有 各自 特定 的 安全 要求 ， 在 实现 的 过程 中 ， 有 两条 基本 的 安全策略 原则 ， 也 即 没有 授权 认可 的 服务 都 被 禁止 ， 不 受 授权 限制 的 服务 都 被 允许 。 前 一条 策略 拒绝 一切 未经 认可 的 服务 ， 防火墙 封锁 所有 的 信息流 ， 逐一 完成 每 项 许可 的 服务 。 后 一条 策略 允许 一切 没有 被 禁止 的 服务 ， 防火墙 转发 所有 信息 ， 逐一 删除 被 禁止 的 服务 。 
 3.3 　 确定 包 过滤 规则 
 　 　 包 过滤 规则 是 以 处理 IP 包头 信息 为 基础 ， 在 设计 包 过滤 规则 时 ， 一般 先 组织 好包 过滤 规则   ， 然后 再 进行 具体 设置 。 
 3.4 　 规划 代理服务器 
 　 　 代理服务器 ( PROXY ) 是 防火墙 系统 中 的 一个 服务器 进程 ， 安装 运行 在 防火墙 主机 上 ， 为 内部 网络 与 外部 网络 充当 中继 ， 阻止 内部 网络 与 外部 网络 的 直接 连接 。 由于 它 作用 于 应用层 ， 故 可以 利用 各种 安全 技术 ， 如 ： 身份验证 、 日志 记录 、 审计 跟踪 等 技术 来 加强 内部 网络 安全性 ， 解决 包 过滤 所 不能 解决 的 问题 ， 从而 建立 一个 更加 严密 的 防火墙 系统 。 对于 网络管理员 来说 ， 选择 一个 成熟 且 便于管理 和 配置 的 代理服务器 程序 非常 重要 ， 图 4 给出 了 代理服务器 的 逻辑 结构 。 
 
 FTP 代理 TELNET 代理 WWW 代理 … … 
 用户 身份验证 模块 
 监控 、 记录 模块 
 
 图 4   代理服务器 的 逻辑 结构 
 4 　 防火墙 系统 设计 实例 
 　 　 按照 防火墙 系统 总体设计 基本 思想 ， 本文 给出 了 一个 基于 包 过滤 技术 、 代理 技术 以及 身份验证 技术相结合 的 实用 防火墙 系统 ， 拓扑 结构 如图 5 。 该 防火墙 系统 由 一个 内部 路由器 、 一个 代理服务器 和 一个 边界 路由器 构成 一个 中间 的 过滤 子网 ， 以 实施 安全 防护 。 
 
 图 5 　 实用 防火墙 系统 拓扑 结构 
 4.1 　 包 过滤 规则 的 设计 
 　 　 对于 过滤 路由器 中 过滤 规则 的 设计 ， 我们 采用 的 安全策略 是 ： 不 允许 IP 源 路由 ， 起于 内部 网络 的 服务 允许 给 过滤 子网 中 的 代理服务器 ， 允许 外部 网络 到 代理服务器 的 流量 ， 允许 过滤 子网 中 代理服务器 到 内部 网络 的 流量 。 设计 的 过滤 规则 如下 表 。 采用 这种 过滤 机制 ， 使得 路由器 中 的 规则 库仅 包含 3 条 规则 ， 既 方便 维护 和 管理 ， 又 易于 验证 过滤 规则 的 完备 性 和 正确性 。 
 表 1 　 外部 路由器 过滤 规则 表 
 
 过滤 规则 号 允许 / 拒绝 源 IP地址 源 端口号 目的 IP地址 目的 端口号 协议 ACK 位 描述 
 1 允许 外部 网络 ＊ 代理服务器 ＊ TCPACK 　 
 2 允许 内部 网络 ＊ ＊ ＊ TCPACK 　 
 3 允许 代理服务器 ＊ ＊ ＊ TCPACK 　 
 
 表 2 　 内部 路由器 过滤 规则 表 
 
 过滤 规则 号 允许 / 拒绝 源 IP地址 源 端口号 目的 IP地址 目的 端口号 协议 ACK 位 描述 
 1 允许 内部 网络 ＊ ＊ ＊ TCP ＊ 　 
 2 允许 ＊ ＊ ＊ ＊ TCPACK 　 
 3 允许 代理服务器 ＊ ＊ ＊ TCP ＊ 　 
 
 4.2 　 代理服务器 的 设计 
 　 　 代理服务器 为 内部 网络 和 外部 网络 双方 的 通信 充当 中继 ， 阻止 内部 网络 和 外部 网络 的 直接 连接 ， 再 辅以 用户 身份验证 模块 和 监控 、 记录 模块 ， 可以 完全 控制 通信 双方 的 会 话 过程 ， 提供 更 高级 的 安全性 。 本文 提供 了 一种 常用 的 代理服务 模型 ， 其 逻辑 结构 如图 6 。 
 
 图 6 　 代理服务器 逻辑 结构 
 　 　 我们 选用 Netscape   Proxy   server3.5 代理 服务器软件 ， 在 安装 好 代理服务器 后 ， 再 设计 一个 代理服务器 的 配置文件 ， 代理服务器 根据 该 配置文件 的 源 IP地址 、 目的 IP地址 和 身份验证 控制 内外 网络 的 访问 权限 ， 利用 监控 、 记录 模块 实现 对 所有 数据流 的 监控 和 记录 ， 以 提供 网管 所 需 的 各种 数据 。 另外 ， 为了 防止 侵入 者 窃取 系统 口令 文件 和 通过 偷听 网络连接 来 获取 合法 用户 ID 和 口令 ， 从而 对 内部 网络 进行 攻击 ， 本 系统 采用 了 一次性 口令 系统 （ OTP ） 对 用户 身份 进行 认证 ， 以 进一步提高 整个 网络系统 的 安全性 。 
 5 　 结论 
 　 　 网络 的 安全性 涉及 许多 方面 ， 本文 主要 从 防火墙 的 设计 、 实现 方面 进行 探讨 ， 给出 了 一种 实用 的 防火墙 构建 模型 ， 希望 能 给 读者 有所 帮助 。 
 作者简介 ： 肖捷 　 工程师 。 研究 方向 ： 计算机网络 及 数据库系统 。 
 作者 单位 ： 广东省 韶关 大学 　 广东 . 韶关 （ 512005 ） 
 参考文献 
 ［ 1 ］ 　 （ 美 ） Chris   Hare   Karanjit   Siyan , 著 . Internet 防火墙 与 网络安全 . 北京 : 机械 工业 出版社 , 1998 
 ［ 2 ］ 　 （ 美 ） David   Wolfe , 著 .   Microsoft   Proxy   Server 开发 指南 . 北京 : 电子 工业 出版社 , 1998 
 ［ 3 ］ 　 ( 美 ) William   A . T . ,   Mary   A . P . ,   Keith   A . B , 著 . Internet   使用 大全 . 北京 : 清华大学出版社 , 1995 
 收稿 日期 : 1999 - 01 - 10 ( 修改稿 ) 
