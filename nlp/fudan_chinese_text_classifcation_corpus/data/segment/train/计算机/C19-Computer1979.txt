微型机 与 应用 
 MICROCOMPUTER   &   ITS   APPLICATIONS 
 1999 年   第 18 卷   第 2 期   Vol.18   No.2   1999 
 
 
 
 ATM 交换机 中 的 优先级 控制技术 
 余 　 英 
 　 　 摘 　 要 ： 分析 了 无 优先级 ATM 交换机 内部 交换 结构 ， 介绍 了 在 此基础 上 引入 适应 于 多媒体 传输 的 优先级 控制技术 。 
 　 　 关键词 ： ATM 交换机 　 交换 技术 　 优先级 控制 
 　 　 ATM ( 异步 转移 模式 ) 是 B — ISDN ( 宽带 综合 业务 数字网 ) 中 采用 的 传输 与 交换 方式 。 由于 ATM 技术 的 出现 ， B — ISDN 与 N — ISDN ( 窄带 综合 业务 数字网 ) 相比 ， 不仅 是 带宽 与 服务 能力 的 扩展 ， 而且 是 信息 传递 方式 的 一场 革命 。 在 信道 利用率 、 处理 时延 、 传输 多媒体信息 、 接入 新 业务 能力 方面 ， ATM 有着 其它 技术 无法比拟 的 优势 。 ATM 技术 由于 能 在 一个 单一 的 主体 网络 上 携带 多种 信息 媒体 ， 进行 多种 通信 业务 ， 所以 从 一 开始 就 受到 人们 的 重视 ， 成为 国内外 网络 领域 的 研究 热点 。 越来越 多 的 厂家 推出 了 自己 的 ATM 产品 ， 从 适合 公用 网 的 大型 ATM 主干 交换机 到 企业级 、 校园 级 的 ATM 交换 集线器 ， 其 应用 逐步 成熟 。 本文 从 无 优先级 ATM 交换机 内部结构 入手 ， 分析 其 交换 机理 ， 在 此基础 上 引入 适应 于 多媒体 传输 的 优先级 交换 技术 。 
 1 　 宽带 业务 对 ATM 的 要求 
 　 　 ATM 要 为 各种类型 的 业务 提供 服务 ， 就 必须 满足 各种 业务 的 服务质量 要求 。 对 宽带 业务 而言 ， 传输 过程 的 二大 基本 要求 是 ： 信元 丢失 率 、 时延 与 时延 抖动 。 
 　 　 宽带 业务 对 信元 丢失 率 的 要求 ： 对 话音 和 视频信号 而言 ， 由于 听觉 与 视觉 效应 的 特点 ， 对于 一定 的 信元 丢失 是 完全 允许 的 ， 但 对于 一些 关键 信元 ( 如 量化 表 、 运动 矢量 等 ) 必须 保证 传输 的 准确性 ， 否则 会 破坏 几帧 的 图像 质量 。 而 对 一般 数据 信元 的 丢失 率 的 要求 不高 ， 可 通过 高层 重传 机制 弥补 信元 丢失 的 影响 。 
 　 　 宽带 业务 对 信元 时延 与 时延 抖动 的 影响 ： 话音 和 视频信号 要求 在 传输 过程 中有 尽可能 小 的 时延 与 时延 抖动 ， 超出 一定 范围 的 时延 与 时延 抖动 会 导致 话音 和 视频信号 的 严重 失真 。 如 高清晰度电视 由 音频 、 标准 图像 、 图文 电视 等 业务 成分 组成 ， 这些 业务 成分 之间 的 时延 差 不能 大于 100 μ s ， 否则 将 造成 可以 感知 的 不良后果 。 而 单一 数据 信元 对 时延 与 时延 抖动 的 要求 不高 ， 重要 的 是 数据 传送 的 准确性 ， 故由 上面 提到 的 重传 机制 即可 保证 。 虽然 由 重传 会 带来 相应 的 时延 及时 延 抖动 ， 但 对 数据业务 基本 没什么 影响 。 
 　 　 按照 以上 基本 宽带 业务 特性 ， 为 满足 各类 业务 服务质量 的 要求 ， ATM 交换机 应 具有 优先级 交换 功能 ， 即 优先 传送 对 时延 与 时延 抖动 较 敏感 的 话音 与 视频信号 ， 同时 具有 优先级 流控 功能 ， 即 在 信元 超载 时 优先 丢弃 优先级 较 低 的 信元 。 
 2 　 ATM 信元 结构 与 优先级 
 　 　 如图 1 所示 ， 在 ATM 网络 中 ， 信息 传输 是 以 固定 长度 ( 53B ) 的 信元 ( cell ) 为 单位 进行 的 ， 每个 信元 由 48B 的 信息 字段 和 5B 的 信头 ( header ) 组成 。 在 5B 的 信头 中 ， 关系 到 优先级 传输 的 有关 字段 是 ： 一般 流量 控制 GFC 、 信元 丢失 优先级 CLP 以及 虚 通道 标识 VPI 和 虚 信道 标识 VCI 。 在 用户 网络接口 ( UNI ： 用于 接入 交换机 端口 ) 的 信头 中 定义 了 一般 流量 控制 GFC 字段 ， 对 不同 时间 优先级 的 信元 可 通过 GFC 中 的 相应 位 设定 优先级 信元 ， 但 在 用户 节点 接口 ( NNI ： 用于 节点 交换机 端口 ) 中 无 GFC 字段 ， 其 位置 被 占 更 多 信息 位 的 VPI 占据 ， 在 交换 译码 表 查询 输入 信元 的 VPI 和 VCI 过程 中 ， 延迟 优先级 就 由 VPI 和 VCI 确定 ， 它 包含 在 信元 附加 的 内部 路由 选择 标签 中 。 由此 ， 可以 对 不同 优先级 信元 分配 不同 的 虚 通道 ( VP ) 或 不同 的 虚 信道 ( VC ) ， 以 实现 不同 信元 的 时间 优先级 控制 。 同时 不同 业务 有 不同 的 服务质量 参数 ， 这些 参数 也 向 网络 提供 了 不同 业务 的 时间 优先级 特性 。 
 
 图 1     ATM 信元 结构 
 　 　 此外 ， ATM 信头 中 还 定义 了 另 一个 决定 丢失 特性 的 优先级 比特 CLP ， 用于 ATM 网 的 流量 控制 ， 以此 实现 流控 中 的 优先级 。 CLP 比特 位 在 ATM 信元 编码 过程 中 生成 。 为了 传输 以上 各类 业务 ， 且 能 在 传输 过程 中 满足 相应 的 服务质量 ， 首先 解决 的 问题 是 信元 编码 问题 。 而 针对 ATM 网 支持 突发 业务 的 特性 ， 关键 的 又 是 突发 编码 问题 。 目前 比较 新 的 突发 编码 技术 是 可变 速率 编码 和 分层 编码 结合 在 一起 的 可变 速率 分层 编码 技术 。 利用 分层 编码 可 将 突发 信源 信息 分成 不同 的 重要 等级 ( 依据 对 时延 及 丢失 率 等 参数 的 要求 ) ， 并 分配 以 不同 的 优先级 ， 使 信元 丢弃 限制 于 较 低优先级 的 信元 ， 保证 高 优先级 信元 正确 传输 。 2 种 编码 技术 的 结合 使 传输 质量 得到 了 保证 。 有 了 丢失 特性 优先级 标识 位 CLP 后 ， 在 信元 的 交换 和 对 信元 的 流量 控制 过程 中 ， 由于 缓冲器 满 、 需要 丢失 选择 的 时候 ， 就 有 了 依据 ， 进而 可以 进行 符合 业务 服务质量 要求 的 优先级 控制 。 
 3 　 ATM 交换 结构 
 　 　 ATM 交换机 中 交换 部分 的 一般 结构 如图 2 。 它 由 输入 、 输出 控制器 、 交换 机构 和 控制 处理器 构成 ， 对 输入 信号 进行 处理 ， 完成 连接 的 建立 、 释放 、 带宽 的 分配 、 维护 和 管理 功能 。 输入 控制器 对 各 输入 端口 的 处理 是 同步 的 ， 这样 使得 到达 交换 机构 的 所有 输入 端口 的 信元 处于 同一时间 点上 ， 从而 简化 了 交换 机构 的 设计 且 允许 按信元 的 优先级 来 进行 接收 处理 。 ATM 交换机 从 给定 端口 接收数据 单元 ， 并 根据 接收 信元 信头 中 的 VPI / VCI 字段 的 信息 ， 将 输入 的 信元 切换 到 相应 的 输出 端口 上 。 由于 VPI / VCI 字段 很小 ， 并 具有 层次结构 ， 因此 转发 任务 相当 简单 。 ATM 交换 机构 内部 由 多个 基本 交换 单元 组成 ， 由 这些 基本 交换 单元 完成 信元 从入 端 到 出 端的 交换 任务 。 在 目前 生产 的 ATM 交换机 中 采用 的 基本 交换 单元 有 如下 几类 ： 矩阵 型 交换 单元 、 中央 存储 交换 单元 、 总线 制 交换 单元 、 环型 交换 单元 等 。   
 
 图 2     ATM 交换 结构 
 4 　 无 优先级 控制 ATM 交换机 机理 
 　 　 由图 2   ATM 交换机 结构 可知 ， 在 宽带 业务 传输 过程 中 ， 信元 从 某 一 输入 端口 进入 交换机 后 ， 由 交换机 内部 的 交换 单元 进行 处理 ， 继而 从 相应 的 端口 输出 。 在 交换机 对 信元 进行 交换 的 过程 中 存在 这样 的 情况 ： 多个 输入 端口 的 信元 竞争 同一 输出 端口 ， 这时 交换机 因 无力 在 1 个 信元 时间 内 同时 完成 所有 信元 的 传送 而 导致 部分 信元 丢失 ， 故 在 实际 的 交换机 内部 往往 根据 所 采用 交换 单元 的 特性 分别 在 输入 、 输出 或 中央 位置 设置 相应 的 缓冲存储器 。 根据 信元 缓存 所处 的 不同 位置 ， 交换 单元 可 分为 输入 排队 、 输出 排队 和 中央 排除 等 几大类 。 对 上 一节 所 提到 的 几类 交换 单元 ， 根据 其 不同 特性 可 分别 采用 不同 的 排队 策略 ， 如 ： 矩阵 型 交换 单元 可以 有 输入 排队 型 、 输入 出 排队 型 和 交叉 缓冲 型 等 几种 情况 ； 中央 存储器 交换 单元 为 中央 排队 型 ； 总线 制 交换 单元 和 环形 交换 单元 采用 输出 排队 型 。 
 
 图 3     无 优先级 输入输出 排队 交换 
 　 　 图 3 是 目前 主干网 交换机 产品 中 采用 得 较 多 的 一种 带 输入 、 输出 缓存 的 交换 结构 示意图 。 在 每条 输入 线上 设置 缓存 队列 ， 对 进入 的 信元 进行 排队 ， 由 一个 仲裁 机构 根据 各 输出 线 的 忙 闲 、 输入 队列 的 状态 、 交换 传送 媒体 的 状态 ， 决定 允许 哪些 队列 中 的 信元 可以 通过 交换 媒体 进行 交换 。 同时 在 每条 输出 线上 也 设置 缓存 队列 ， 因为 在 实际 的 交换机 内 采用 了 快速 交换 技术 ， 使得 对 信元 的 交换 速度 大大提高 ， 而 信元 到 了 输出 端口 后 又 由于 输出 端口 线路 传输速度 的 限制 ， 聚集 在 同一 输出 端口 的 多个 信元 无法 同时 输出 ， 必然 造成 信元 丢失 。 故应 在 交换机 各 输出 端口 处 设置 缓存 ， 以 保存 暂时 不能 传送 出去 的 信元 ， 减少 信元 丢失 。 
 5 　 优先级 控制 ATM 交换机 机理 
 　 　 ATM 交换机 应 具有 以下 特点 ： 高速率 、 大 信息 容量 、 高 通过 量 、 低 延时 、 易于 交换 控制 等 。 其中 延时 特性 是 多媒体信息 传输 的 一个 重要 因素 。 而 交换机 内部 的 延时 除了 交换机 本身 对 单一 信元 的 交换 处理速度 外 ， 主要 是 交换机 内部 多个 输入 端口 竞争 一个 输出 通道 失败 时 ， 在 输入 缓存 中 的 排队 时延 及 在 输出 缓存 中 等待 输出 的 排队 时延 。 而且 ， 无 优先级 控制 时 ， 由于 信元 在 传输 信道 中 的 统计 复用 形式 ， 信元 时延 难以确定 ， 且 时延 抖动 较大 。 
 
 图 4     优先级 输入 、 输出 排队 交换 
 　 　 优先级 控制 ATM 交换机 机理 如图 4 。 在 每个 输入 端口 ( 输出 端口 ) 设置 多个 队列 ， 进入 每个 输入 端口 的 信元 按 优先 级别 进入 不同 优先级 队列 中 ， 每个 输入 端口 当前 等待 交换 的 信元 只有 1 个 ， 即队 头 信元 。 该队 头应 由 各 输入 端口 的 多个 队列 依据 优先 级别 竞争 而 得 ， 由此 ， 队头 信元应 是 该 端口 所有 队列 中 优先 级别 最高 的 信元 。 在 输出 端口 也 设置 类似 的 队列 ， 交换 时 不同 优先级 别的 输入 信元 输出 到 不同 优先级 别的 输出 队列 中 ， 以便 优先 传送 级别 较 高 的 信元 。 由 以上 控制 方法 可知 ， 高 优先级 信元能 以 尽可能 小 的 时延 与 时延 抖动 进行 交换 ， 从而 满足 多媒体 信元 的 传输 特性 。 
 　 　 在 ATM 交换机 传输 信元 的 过程 中 ， 影响 传输 质量 的 另 一 环节 就是 ATM 信元 的 流量 控制 。 ATM 网络 支持 突发性 信元 ， 利用 统计 复用 方式 可以 获得 较 高 的 频带 利用率 ， 使 多种 业务 灵活 有效 地 共享 网络资源 。 在 发送 信元 之前 ， 用户 首先 发出 呼叫 ， 按 申报 业务 的 特性 和 所 要求 的 传输 质量 提出申请 ， 网络 控制点 以此 统计 参数 、 性能 要求 以及 当前 网络 的 负荷 来 决定 是否 满足用户要求 ， 进而 按 要求 建立 1 条虚 电路 。 但 当 大量 突发 业务 同时 进入 网络 时 ， 多个 瞬间 峰值 信元 的 同时 出现 将 导致 网络 严重 阻塞 ， 因此 必须 进行 优先级 控制 ， 以 使 要求 质量 高 的 业务 有 较 高 的 优先级 ， 从而 优先 传送 ， 有 选择地 丢弃 一些 分组 。 这样 不仅 可以 保证 重构 信息 的 质量 ， 同时 对 网络 的 延时 性能 也 有 较大 改善 。 在 以上 优先级 交换 控制 机理 中 可以 看出 ， 交换机 中 设置 的 输入 、 输出 队列 长度 不 可能 无限大 ， 即 在 信元 突发 度 很大 的 情况 下 ， 存在 信元 溢出 的 问题 。 这种 情况 下 就 可以 利用 优先级 流控 机制 ， 丢弃 优先级 较 低 的 信元 ， 保证 优先 级别 较 高 的 信元 得以 传送 。 
 6 　 结束语 
 　 　 优先级 控制技术 在 ATM 网 的 交换 、 流控 等 环节 起着 十分 重要 的 作用 ， 并 为 ATM 传送 多媒体业务 提供 了 可能 。 目前 ， 双 优先级 ATM 交换机 产品 已 投入 市场 ( 如 日本 NEC 公司 开发 的 ATOMIS — 5 型 ATM 交换机 ) 。 相信 有关 多 优先级 问题 的 研究 将 对 ATM 交换机 性能 的 提高 产生 重要 的 推动 作用 ， 为 宽带 综合 业务 数字网 的 最终 实现 奠定 基础 。 
 作者 单位 ： 昆明 云南 师范大学 计算机科学 系 ( 650092 ) 
 参考文献 
 1 　 裘晓峰 ， 张春红 . 宽带 网络 技术 及其 应用 . 北京 ： 清华大学出版社 ， 1997 
 2 　 张宏科 ， 裘 正定 . ATM 网络 互连 原理 与 工程 . 北京 ： 清华大学出版社 ， 1996 
 3 　 邢秦 中 . ATM 通讯网 . 北京 ： 人民邮电出版社 , 1998 
 4 　 沈兰荪 . ATM 网络 的 视频 编码 技术 . 电子学 报 ， 1995 ； 23 ( 4 ) 
 ( 收稿 日期 ： 1998 - 09 - 23 ) 
