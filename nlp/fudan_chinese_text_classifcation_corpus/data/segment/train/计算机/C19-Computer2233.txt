计算机 应用 研究 
 APPLICATION   RESEARCH   OF   COMPUTERS 
 2000   Vol.17   No.3   P.59 - 61 
 
 
 
 
 基于 四叉树 分割 和 多 分辨率 相关 的 快速 小 波分 形 编码 
 陈晓棠 　 余英林 
 摘 　 要 ： 提出 一种 基于 四叉树 分割 和 多 分辨率 相关 的 快速 小 波分 形 编码 算法 。 在 对 图象 小 波 变换 后 进行 四叉树 分割 编码 的 过程 中 ， 利用 小 波 变换 的 多 分辨率 分析 特性 ， 在 多 分辨率 相关 的 基础 上 ， 对 分形 匹配 搜索 域 进行 自 适应 调整 。 实验 结果 证明 该 算法 的 有效性 ： 压缩比 和 信噪比 下降 很少 ， 编码 时间 只 需 十秒钟 左右 。 
 关键词 ： 小 波 变换   分形 编码   四叉树 分割   多 分辨率 相关 
 1 　 引言 
 　 　 分形 编码 在 90 年代 初因 其 高 的 压缩比 和 压缩 潜力 在 图象 编码 的 研究 中 倍受青睐 。 分形 编码 是 基于 图象 局部 与 整体 之间 的 相似性 ， 利用 局部 的 定义域 块 经过 包括 收缩 、 旋转变换 、 尺度 变换 在内 的 仿射变换 ， 来 替代 整体 中 的 值域 块 的 迭代 搜索 的 过程 。 由于 分形 压缩 的 编码 时间 和 解码 时间 很 不 平衡 ， 编码 时间 很长 ， 而 解码 时间 很 短 。 而且 ， 由于 通常 的 分形 编码 采用 基于 方块 的 匹配 搜索 ， 所以 恢复 图象 存在 方块 效应 ， 影响 视觉 质量 。 近年来 ， 随着 对小波 研究 的 深入 ， 小 波 变换 对 图象 的 多 分辨率 描述 逐渐 引起 了 图象 编码 研究 人员 的 关注 ， 对 利用 小 波 进行 图象 编码 展开 了 研究 ， 并 取得 了 一些 成果 ( 如 Shapiro [ 4 ] 的 零树 编码 ) 。 但 在 小波 编码 的 算法 中 ， 由于 没有 充分利用 小波 多 分辨率 图象 之间 的 相似性 ， 所以 压缩比 有待 提高 。 而 我们 注意 到 ， 这种 相似性 正是 分形 编码 要 达到 高 压缩比 的 基础 。 所以 ， 将 分形 和 小波 结合 起来 编码 ， 充分利用 两者 的 优点 ， 是 我们 研究 分形 和 小波 混合 编码 算法 的 初衷 。 由于 在 混合 编码 中 ， 同样 存在 着 搜索 域 的 匹配 问题 ， 因此 ， 编码 时间 较长 仍然 是 该 编码 算法 的 瓶颈 之一 。 本文 提出 的 算法 ， 正是 为 力图 有效 解决 这一 问题 而 提出 的 。 
 　 　 本文 共 分为 几 部分 ， 第二 、 三 、 四 部分 分别 介绍 算法 的 基本原理 。 第五 部分 是 本 算法 的 实验 结果 ， 表明 在 整个 系统 的 编码 时间 很 短时 ， 仍能 保持 较 高 的 压缩比 和 信噪比 。 
 2 　 图象 的 多 分辨率 小 波 分解 
 　 　 小 波 变换 具有 描述 非 平稳 图象 信号 的 本领 和 适应 人 的 视觉 系统 特性 的 良好 品质 ， 其 最大 特点 是 能够 多 分辨率 地 描述 图象 信号 ， 并 将 图象 信号 分解 为 一组 多 尺度 子带 图象 ， 分解 后 各子 带 图象 相对 平稳 ， 易于 编码 。 我们 采用 Mallat 提出 的 塔式 多 分辨率 分解 算法 ( 文献 [ 1 ] ) 。 得到 的 小波 图象 的 各个 子带 分别 对应 了 原 图象 在 不同 尺度 和 不同 分辨率 下 的 高频 细节 分量 ， 以及 一个 对 原始 图象 的 低频 分量 。 从 多 分辨率 分析 的 角度 来看 ， 这些 子带 之间 存在 相关性 。 如 对 各 高频 分量 ， 由于 它们 是 图象 同一 边缘 ， 轮廓 和 纹理 信息 在 不同 方向 、 不同 分辨率 下 由 细到 粗 的 描述 ， 所以 在 频带 中 对应 边缘 、 轮廓 的 相对 位置 都 应 是 相同 或 相近 的 。 这种 空间 位置 上 的 相似性 和 相关 冗余 ， 为 我们 在 小波域 内 进行 分形 编码 提供 了 便利 。 
 　 　 另外 ， 对 图象 进行 金字塔 小 波 变换 后 ， 它 具有 如下 性质 。 
 　 　 设 I ， J 为 两幅 图象 ， 大小 都 为 2r × 2r ， K = I - J 为 误差 图象 ， 则 经过 r 层 金字塔 小 波 变换 后 有 ： 
 K ( r ) i = Iri - J ( r ) i , ( I = 0 , 1 , 2 , … , r )   ( 证明 略 ) 
 　 　 我们 令 I 为原 图象 ， J 为原 图象 减去 均值 以后 的 灰度 图象 ， K 为 均值 图象 ， 则 对 I ， J ， K 作小波 变换 之后 ， 各子 带 之间 有 如下 关系 ： I 的 最 低频 子带 的 系数 等于 K 和 J 的 最 低频 子带 系数 之 和 ； K 的 其余 各级 子 带系 数值 均 为 零 ， 即 均值 图象 不 存在 高频 分量 ； I 和 J 的 其余 各级 子带 系数 相等 。 因此 ， 我们 可以 将 小波域 内 的 分形 编码 视为 传统 空域 的 去 均值 后 的 分形 编码 ， 即 在 编码 过程 中 不 考虑 偏置 因子 ( 因为 值为 零 ) 。 这样 计算 分 形码 时 只有 尺度 因子 ， 可以 简化 计算 ， 加速 编解码 过程 。 
 　 　 同时 ， 由于 对 信号 进行 小 波 变换 后 ， 将 信号 分解 为 不同 方向 和 不同 分辨率 上 的 子 带 图象 ， 各个 子带 分别 进行 分形 预测 ， 这 就 相当于 一个 自动 块 分类器 ， 将 方块 分类 到 各个 子 带上 ， 所以 可以 简化 计算 ， 加快 编码 过程 。 
 3 　 原理 简述 
 3.1 　 方块 分形 编码 原理 
 　 　 分形 编码 是 利用 IFS 系统 来 提取 图象 中 自然 存在 的 自 相似性 ， 用 图象 中 的 一个 子块 经过 仿射变换 W 来 逼近 图象 中 的 另 一子 块 ， 从而 达到 分形 压缩 的 目的 。 W 可以 是 平移 、 旋转 、 对称 、 灰度变换 等 数学 运算 。 在 解码 时 ， 利用 拼贴 定理 ， 从 任意 的 起始 图象 经过 反复 迭代 快速 重建 原来 的 压缩 图象 。 其 基本 步骤 如下 ： 
 　 　 ( 1 ) 将 图象 分割 为 互不 重叠 的 B × B 大小 的 子 图象 Ri 。 
 　 　 ( 2 ) 用 大小 为 D × D   ( D 和 B 均 是 正整数 ) 的 截取 窗口 在 原 图象 ψ 上 分别 沿 水平 方向 ( 步长 为 δ h ) 和 垂直 方向 ( 步长 为 δ v ) 移动 以 形成 定义域 块 Dj ， 而 Dj 的 集合 形成 搜索 域 。 
 　 　 ( 3 ) 对 各 值域 块 Ri ， 在 整个 搜索 域 寻找 与 Ri 最佳 匹配 的 Di ， 从而 得到 与 Ri 对应 的 分 形码 ( 包括 位置 信息 dx ， dy ， 旋转 对称 变换 A ， 尺度 因子 S ， 偏置 因子 σ ) 存储 该分 形码 即可 。 
 　 　 ( 4 ) 解码 过程 为 对 任意 初始 图象 ， 根据 分 形码 对 其 进行 仿射变换 的 过程 。 该 过程 要 通过 反复 迭代 以 保证 其 收敛 。 
 3.2 　 基于 四叉树 分割 的 小 波分 形 混合 编码 算法 
 　 　 四叉树 分解 在 分形 编码 中 较为 常用 。 它 作为 一种 自 适应 的 图象 分割 的 方法 ， 主要 是 对 那些 平滑 区域 块 和 能 在 阈值 范围 内 被 分形 编码 的 图象 块 进行 粗略 匹配 ， 用 较大 的 块 来 表示 ， 而 对 灰度 急剧 变化 的 不能 在 阈值 范围 内 分形 编码 的 方块 ， 继续 将 其 细分 为 四个 小 的 子块 进行 分形 编码 ， 直到 在 误差 许可 范围 内 为止 。 这样 ， 根据 不同 区域 的 内容 ， 自 适应 的 调整 方块 的 大小 ， 可 保证 在 压缩比 和 图象 质量 之间 取得 较 好 的 折衷 。 
 　 　 我们 将 上述 思想 应用 到 小 波分 形 编码 过程 中 ， 得到 编解码 算法 如下 。 
 　 　 1 ) 编码 算法 
 　 　 ① 将 图象 做 五级 小 波 分解 。 
 　 　 ② 标量 量化 保存 第五 级 分解 得到 的 最 低频 子带 LL0 和 同级 各子 带 LH0 ， HL0 ， HH0 。 
 　 　 ③ 对 其余 各级 子带 ， 进行 分形 编码 。 设 最大 四叉树 分解 级数 为 3 ， 最小值 子块 大小 为 2 × 2 ， 每 一级 的 定义域 块 取自 上级 同方向 子带 。 定义域 块 大小 和 值域 块 大小 一致 ， 搜索 步长 为 待 匹配 子块 大小 的 一半 。 对 每 一 值域 块 ， 在 对应 的 定义域 块 中 搜索 匹配 块 ， 若 误差 小于 预定 的 门 限值 ， 则 置 标志 位为 1 ， 表明 该块 不用 进行 四叉树 分割 ， 并 保存 标志 位和分 形码 。 否则 ， 置 标志 位为 0 ， 保存 ， 并 对 其四 叉 树 分割 的 各个 子块 进行 分形 编码 ， 此时 的 定义域 块 也 要 相应 进行 四叉树 分割 ， 然后 再 进行 搜索 匹配 。 如此 直到 达到 最大 级数 或 不能 再 分 为止 。 值得注意 的 是 ， 在 最后 一级 不能 再 分割 时 ， 我们 不用 保留 标志 位 ， 以 节约 存储空间 。 
 　 　 2 ) 解码 算法 
 　 　 ① 在 解码 时 ， 首先 恢复 LL0 ， LH0 ， HL0 ， HH0 子带 的 小波 系数 。 
 　 　 ② 对 LH1 ， HL1 ， HH1 子带 进行 分形 解码 。 以 上级 的 HL0 ， LH0 ， HH0 为 定义域 块 范围 ， 读出 分 形码 ， 由 标志 位为 0 或 1 判断 ， 是 对 当前 块 进行 分形 解码 ， 还是 对 其 各级 子块 分别 进行 解码 。 
 　 　 ③ 对 LH2 ， HL2 ， HH2 ～ LHn ， HLn ， HHn 的 各子 带 的 解码 如 2 中 进行 ， 定义域 块 均 取自 上级 同方向 子带 。 ④ 将 解码 后 的 小波 系数 进行 小 波 逆变换 ， 得到 恢复 图象 。 
 4 　 进一步 的 加速 算法 
 　 　 我们 的 加速 编码 基于 以下 多 分辨率 相关 的 假设 ： 假定 待 编码 图象 为 F ， 大小 为 2M × 2M ， 将 F 进行 1 ： 2n   ( n = 1 ， 2 ， ... ) 抽样 得到 的 缩小 的 低分辨率 图象 G ， 大小 为 2n - 1M × 2n - 1M 。 对 图象 G 编码 ， 若 以 ( x ， y ) 为 起始 点 的 最佳 匹配 映射 的 起始 点为 ( x1 ， y1 ) ， 则 对 图象 F 编码 时 ， 以 ( 2nx ， 2ny ) 为 起始 点 的 编码 方块 的 最佳 匹配 映射 ， 在 一定 误差 门限 的 限制 下 ， 在 ( 2n - 1x1 ， 2n - 1y1 ) 的 δ 邻域 内 概率 较大 。 据 我们 实验 统计 ， 以 五级 小 波 分解 后 分形 匹配 为例 ， 在 以 第一级 分形 匹配 的 ( dx ， dy ) 对应 的 该级子 带 ( 2dx ， 2dy ) 为 中心 的 2 邻域 内 概率 近 70% ， 3 邻域 内近 80% ， 而 到 第四 级 分形 匹配 时 ， 在 其 4 邻域 内 的 概率 均 达到 90% 以上 。 因此 ， 根据 此 假定 带来 的 误差 在 算法 中是 可以 允许 的 。 我们 后面 的 实验 也 证实 了 这 一点 。 而 由 前 知道 ， 对 图象 做小波 分解 后 ， 可 得到 大小 依次 为 1 ： 2n 的 分辨率 由 低 到 高 的 多 分辨率 图象 ， 这样 我们 利用 小波 多 分辨率 分析 的 特点 ， 在 搜索 过程中将 多 分辨率 相关 假定 结合 进去 ， 是 很 自然 的 一个 想法 。 
 　 　 另外 ， 根据 文献 [ 7 ] 的 原理 ， 我们 可以 将 初始 的 搜索 窗 限制 在 待 匹配 子块 ( 值域 块 ) 的 邻域 附近 ， 若 在 误差 范围 内 不 匹配 ， 则 再 将 它 进一步 四叉树 分割 。 
 　 　 因此 ， 我们 在 多 分辨率 相关 的 基础 上 ， 采用 如上 四叉树 分割 算法 ， 提出 如下 编码 算法 ： 
 　 　 ( 1 ) 将 图象 五级 分解 ， 得到 LL0 ， LH0 ， HL0 ， HH0 ， LH1 ， HL1 ， HH1 共 16 个子 带 。 
 　 　 ( 2 ) 对 LL0 ， LH0 ， HL0 ， HH0 子带 ， 采用 8 比特 标量 量化 ， 或 经过 DPCM 编码 ， 以 保证 其 量化 精度 ， 因为 它 对 恢复 图象 的 质量 影响 极大 。 
 　 　 ( 3 ) 对 LH1 ， HL1 ， HH1 子带 图象 进行 分形 编码 ， 置 初始 子块 大小 为 8 × 8 ， 四叉树 分割 深度 为 三级 ， 在 上级 子带 同样 大小 的 定义域 块 集合 中 进行 全 搜索 ， 以 保证 下 一级 匹配 的 精度 。 
 　 　 ( 4 ) 对 其它 各级 子带 编码 。 若上 一级 的 同大 小子 块 已 编码 ( 标志 位为 1 ) ， 则 以 其分 形码 中 dx ， dy 所 对应 的 定义域 块 为 中心 ， 在 其 δ 1 邻域 内 搜索 。 若 未 编码 ( 标志 位为 0 ) ， 则 在 该子 块 位置 ( rx ， ry ) 的 δ 2 邻域 范围 内 搜索 。 其后 的 过程 同 于 上述 四叉树 分割 算法 。 当 匹配 误差 小于 误差 阈值 时 ， 置 标志 位为 1 ， 停止 分割 ， 否则 置 标志 位为 0 。 并 对 其四 叉 树 分割 子块 进行 分形 编码 ， 此时 定义域 块 大小 也 要 进行 四叉树 分割 ， 即 定义域 块 集合 也 要 调整 大小 。 值得注意 的 是 ， 误差 门限 以及 δ 1 δ 2 随着 子带 的 分辨率 和子 带 的 方向不同 而 不同 ， 分辨率 越高 ， 误差 门限 越大 ， δ 1 δ 2 的 取值 范围 越广 ， 垂直 方向 和 对角 方向 的 误差 门限 高于 水平 方向 。 这样 做 ， 可以 对 低分辨率 的 重要 系数 细 匹配 ， 而 相对 不 重要 的 系数 粗 匹配 。 此外 ， 当子块 四叉树 分割 后 ， 其 邻域 大小 也 应 进行 相应 的 调整 。 
 　 　 解码 过程 完全 同于 四叉树 分割 的 解码 算法 ， 可不 做 任何 调整 。 
 5 　 实验 结果 及 分析 
 　 　 对 512 × 512 × 8 的 Lena 图象 做 如 上 实验 ， 实验 平台 为 PII300 ， 邻域 值 的 大小 根据 具体 要求 设定 。 本文 权衡 各 相关 因素 ， 选取 邻域 ， 并 随 分解 深度 的 增加 而 增大 一倍 。 各级 子带 的 阈值 大小 由 实验 来 不断 调整 ， 不同 方向不同 分解 级 的 子 带 其 阈值 也 相应 的 不同 。 这样 可以 根据 各级 子带 系数 的 重要性 不同 ， 合理 降低 其 匹配 精度 。 实验 原始 图象 和 恢复 图象 如图 1 所示 。 表 1 列出 了 不同 阈值 时 的 四叉树 分割 算法 和 进一步 加速 算法 的 结果 ( 未 进行 熵 编码 ) 。 若 进行 熵 编码 ， 则 数据量 还 可以 进一步 压缩 。 
 
 图 1 　 实验 图象 和 恢复 图象 
 表   1   实验 结果 列表 
 
 四叉树 分割 四叉树 分割 结合 多 分辨率 相关 
 信噪比 
 ( dB ) 压缩比 
 ( 倍 ) 编码 时间 
 ( 秒 ) 文件 长度 
 ( bytes ) 信噪比 
 ( dB ) 压缩比 
 ( 倍 ) 编码 时间 
 ( 秒 ) 文件 长度 
 ( bytes ) 
 131.3330 . 2075868030.928 . 1616.59310 
 230.5038 . 3350683930.1436 . 9012.37105 
 329.6046 . 7641.2560629 . 6442.5610 . 56159 
 429.2150 . 2735.2521529 . 3849.059 . 55438 
 528.2761 . 2326.7428128 . 0461.117 . 84290 
 
 6 　 结论   
 　 　 由此可见 ， 本文 的 算法 还是 比较 有效 的 。 编码 时间 大大 加快 ， 压缩比 和 信噪比 稍 有 减少 。 这 是因为 缩小 搜索 域 后 ， 找 不到 误差 范围 内在 搜索 域外 的 最佳 匹配 块 ， 所以 要 进行 四叉树 分割 继续 搜索 ， 这样 就 增加 了 需 存储 的 信息 ， 导致 压缩比 会 轻微 降低 。 与 同类 方法 相比 ， 例如 相对 于 基于 块 分类 的 加速 算法 ， 本文 在 压缩比 和 信噪比 方面 占有优势 ， 且 保持 图象 质量 不太受 影响 ， 而 编码 时间 也 可以 和 其它 方法 相比 ， 本文 结果 没有 采用 熵 编码 如 算术 编码 等 ， 如果 采用 ， 还 可以 进一步提高 压缩比 。 
 本文 获 国家自然科学基金 69972076 资助 
 本文 获 广东省 自然科学 基金 资助 
 陈晓棠 ( 华南理工大学   广州   510641 ) 
 余英林 ( 华南理工大学   广州   510641 ) 
 参考文献 
 1   S .   Mallat .   A   Theory   for   Multiscale   Signal   Decomposition :   the   Wavelet   Representation .   IEEE   Trans ,   Patt .   Anal   and   Mach ,   Intell .   1989.11   pp.674 ～ 693 
 2   Y .   Zhang   and   L .   M .   Po ,   Speeding   Up   Fractal   Image   Encoding   By   Wavelet - Based   Block   Classification .   Electronics   Letters   Vol .   32 .   No .   23   pp .   2140 ～ 2141 .   Nov .   1996 
 3   Y .   Fisher .   Fractal   Image   Compression   -   Theory   and   Applications   to   Digital   Images ,   Springer - Verlag ,   New   York ,   1994 
 4   Jerome   M .   Shapiro .   Embeded   Image   Coding   Using   Zerotrees   of   Wavelet   Coeffients ,   IEEE   Trans .   on   Signal   Processing ,   1993 ,   No .   12 
 5   R .   Rinaldo   and   G .   Calvagno .   Image   Coding   by   Block   Prediction   of   Multiresolution   Subimages ,   IEEE   Trans .   on   Image   Processing ,   1995 ,   No .   7 
 6   张   覃 ,   陈   刚 ,   金以文 .   基于 金字塔 正交 小 波 分解 的 快速 分形 图象 编码 .   电子学 报 ,   Vol.26 ,   No.8 ,   Aug .   l998 
 7   王   舟 ,   余英林 .   一种 新 的 分形 图象 编码方法 ,   通信 学报 ,   1996 ,   17 ( 3 ) .   pp84 ～ 90 
 8   房育栋 ,   余英林 .   快速 分形 图象 压缩 编码 .   电子学 报 ,   Vol.24 ,   No.1 ,   1996 ,   pp28 ～ 33 
 9   谢   鑫 ,   马 争鸣 .   基 于小波 分解 的 分形 预测 编码 .   中国 图象 图形学 报 ,   Vol.4 ,   No.3 ,   1999 ,   pp223 ～ 228 
 收稿 日期 ： 1999 年 10 月 1 日 
