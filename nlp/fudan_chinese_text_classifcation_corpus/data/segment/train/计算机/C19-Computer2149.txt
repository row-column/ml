计算机 应用 研究 
 APPLICATION   RESERCH   OF   COMPUTERS 
 2000     Vol.17 　 No.1 　 P.41 - 43 
 
 
 
 
 一个 仿人 疾病诊断 专家系统 模型 
 张 红梅   王永成 
 摘   要   通过 研究 医学专家 的 诊断 思维过程 ， 提出 了 一个 疾病诊断 专家系统 模型 。 该 模型 以 层次 分类 结 
 构 作为 知识库 的 组织 形式 ， 分类 过程 作为 疾病诊断 的 推理 过程 ， 用 这种 自顶向下 ， 逐层 分类 的 方法 提高 诊断 效率 。 此外 ， 还 通过 对 层次 分类 体系 的 分析 ， 压缩 特征向量 ， 减少 系统 的 计算 量 。 
 关键词   层次 分类 结构   知识 表示   推理 机制   压缩 特征向量 
 1 　 引言 
 　 　 自从 人工智能 诞生 以来 ， 专家系统 一直 是 最 活跃 的 分支 之一 ， 而 医疗 领域 也 一直 是 专家系统 的 典型 实际 应用 。 众所周知 ， 疾病 的 诊断 不仅 是 医疗 中 的 第一 关口 ， 而且 对 大多数 疾病 来说 ， 也 是 决定性 的 关口 。 为此 ， 研究 医疗 专家系统 ， 首当其冲 就 必须 研究 疾病 的 自动 诊断 。 通过 研究 医学专家 的 诊病 过程 ， 我们 在 本文 中 提出 一个 实用 的 疾病 诊断模型 。 
 　 　 纵观 专家 诊病 的 过程 ， 我们 发现 ： 疾病 的 诊断 过程 实际上 也 是 一个 疾病 分类 过程 ， 是 根据 病人 的 疾病 特征 ( 病症 ) 划归 到 某个 疾病 或 疾病 类 的 过程 ， 一般 的 医学 书上 也 是 这样 一个 把 复杂 的 问题 ( 疾病 类 ) 逐次 分解成 一个个 小 问题 ( 疾病 ) 的 体系结构 ， 读者 再 根据 症状 特征 或 不适 部位 定位 到 具体 疾病 类 的 具体 疾病 。 本文 就是 在 此基础 上 提出 一个 疾病 诊断模型 。 该 模型 接近 于 一般 医学书籍 的 知识 表示 ， 它 把 医学专家 或 医学书籍 中 的 知识 表示 成 森林 状 的 层次 分类 结构 ， 结构 中 的 非 叶子 节点 代表 疾病 类 ， 叶子 节点 代表 疾病 ， 每个 节点 包含 以 疾病 或 疾病 类 的 症状 作为 类别 特征向量 。 当然 ， 这样 的 表示 对于 规模 较大 的 系统 ， 往往 由于 特征 项 数目 过大而 影响 系统 的 性能 。 解决 的 办法 是 筛选 特征 ， 将 那些 不 具备 区分 能力 或 区分 能力 很小 的 症状 从 特征 项中 删除 。 然后 根据 类别 体系 的 层次结构 ， 自顶向下 ， 逐层 分类 ， 最终 把 病人 的 病症 或 综合症 归属 到 层次结构 的 某个 叶子 节点 。 
 
 图 1 　 系统结构 
 　 　 一个 专家系统 结构 如图 1 ， 其 最 核心 的 部分 是 知识库 和 推理 机制 ， 上述 的 层次 分类 结构 是 知识库 的 组织 形式 ， 其上 的 分类 过程 实质 上 是 推理 过程 。 下面 将 给出 这个 模型 的 知识 表示 ， 以及 其上 的 推理 机制 的 详细描述 。 
 2 　 知识 表示 
 　 　 知识库 分为 描述性 知识 和 过程 性知识 。 
 　 　 描述性 知识 有 ： 
 　 　 分类 知识 ： 疾病 类 和 疾病 等 ； 
 　 　 事实 知识 ： 症状 和 病史 等 ； 
 　 　 关系 知识 ： 症症 、 病症 及病 病间 的 各种 关系 ； 
 　 　 统计 知识 ： 疾病 、 症状 出现 的 概率 等 。 
 　 　 过程 性知识 有 ： 
 　 　 动作 知识 ： 处理 和 治疗 等 ； 
 　 　 函数 知识 ： 隶属 函数 和 相似 度 计算公式 等 。 
 　 　 上述 的 描述性 知识 隐含 在 数据库 中 ， 动作 知识 由 规则 表示 ， 函数 知识 由 数据 驱动 。 
 　 　 。 分类 知识 — 是 诊断 的 基本 依据 ， 医学知识 的 分类 系统 ， 如图 2 的 层次 分类 结构 所示 。 每一 层次 的 疾病 类 包含 它 的 类别 特征向量 以及 应 采取 的 治疗 措施 的 规则 ， 越往 低层 ， 病类 越细 ， 叶子 节点 代表 具体 疾病 ， 方框 上方 的 数字 代表 病人 症状 特征向量 与 疾病 或 疾病 类 特征向量 的 相似 度 ， 也 就是 病人 属于 该病 或 病类 的 可信度 
 
 图 2 　 内科 疾病 层次 分类 子树 
 　 　 在 数据库 中 ， 我们 用 以下 的 表来 表示 上述 的 层次 关系 。 
 表   1   病表 
 标识符 病名 父类 标识符 描述 特征向量 指针 
 D _ id1 感冒 D _ idx 　 　 
 
 表   2   症状 表 
 标识符 症状 名 描述 发作 部位 持续时间 性质 并发症 … 
 S _ id1 头痛 　 前额 2 ～ 3 天 阵发性 恶心 　 
 
 表   3   病症 关系 表 
 标识符 病表 id 症状 表 id 关系 性质 可信度 … 
 R _ id1S _ id1D _ id1 充分 症状 CF ( D1 ,   S1 ) 　 
 
 　 　 层次结构 中 所有 节点 的 内容 都 可以 通过 表与表 的 连接 操作 和 查询 命令 来 得到 。 其中 类别 特征向量 是 通过 从本 疾病 类 的 特征向量 以及 它 的 各个 子类 中 抽取 的 区分 能力 较强 的 特征 项 ， 并 将 原 特征向量 中 的 其它 分量 置 为 零 ， 构成 的 新 向量 作为 类别 特征向量 ， 这样 便 突出 了 这些 类别 特征向量 的 区分 能力 ， 同时 也 减少 了 分类 时 的 计算 量 。 
 　 　 下面 我们 给出 构造 类 特征向量 的 算法 ： 
 　 　 ( 1 ) 用 医学书籍 上 的 知识 构造 一个 含有 所有 症状 的 辞表 。 假设 辞表中 有 N 个 辞条 ， 那么 用于 描述 疾病 或 疾病 类 的 特征向量 便 有 N 个 分量 。 对于 某一 疾病 ， 其 对应 的 特征向量 Di   ( di1 ,   ... ,   dij ,   ... ,   diN ) ， 其中 i 是 节点 序号 ， j 是 分量 序号 ， dij = CF ( Di ,   Sij ) ，   CF ( Di ,   Sij ) 是 由 专家 给出 的 由 症状 Sij 导致 病 Di 的 规则 强度 。 
 　 　 ( 2 ) 执行 ( v 是 当前 节点 及其 子类 节点 ) 。 即 逐类 将 属于 该类 及其 子类 的 所有 疾病 或 疾病 类 的 特征向量 相加 ， 得到 各个 疾病 类 的 原始 特征向量 ， 为了 方便 起 见 ， 将 各个 向量 规范化 ， 使得 向量 的 模为 1 ， 即将 各个 分量 除以 。 
 　 　 ( 3 ) 用 每 一 节点 的 所有 直接 子 节点 的 特征向量 ， 分别 构成 一个 矩阵 中 的 一行 ， 删除 所有 全为 0 或 全为 1 的 列 ， 然后 计算 ( 其中 Cj 是 本列 中 的 非 0 个数 ) ， 也 就是 逐列 计算 出 各列 非 0 元素 的 乘积 ， 再 乘以 本列 中 的 非 0 个数 ， 并 依其 乘积 大小 将 各列 排序 ( 同时 记录 下 各列 的 原始 位置 ) 。 
 　 　 ( 4 ) 按照 乘积 越小 说明 该 分量 的 区分 能力 越强 的 规律 ， 逐行 从 乘积 较 小 的 列中 选取 nl 个 非 0 元素 及其 原始 位置 ， 构成 压缩 的 特征向量 。 其中 nl 是 各 节点 所在 l 层次 预先确定 的 分量 个数 ， 其中 n1   n2n3   ... ， 因为 在 层次 较 低 的 节点 的 各个 子 节点 间 的 相似 度要 高于 层次 较 高 的 节点 的 各个 子 节点 间 的 相似 度 。 相应 地 ， 其 对应 的 特征向量 中 区分 能力 较强 的 特征 项 的 数目 也 较 少 ， 即 对应 的 压缩 的 特征向量 中 的 特征 项 数目 较 少 。 
 　 　 ( 5 ) 用 ( 下 标值 ， 特征值 ， 下 一项 ) 形式 的 数组 结构 来 表示 选出 的 特征向量 ， 这种 变换 的 实际 作用 是 把 原来 特征向量 中 的 其它 分量 置 零 。 当非 零 分量 很少 时 ， 可以 减少 分类 时 的 计算 量 。 
 　 　 。 事实 知识 — 是 病人 症状 的 描述 ， 它 的 特征向量 由 诊断 开始 形成 ， 在 推理 过程 中 经 交互式 问诊 步 完善 。 
 　 　 。 关系 知识 — 包括 疾病 与 症状 间 的 充分 症状 、 必要 症状 、 关键 症状 关系 ， 症症 间 的 相互 排斥 关系 ， 还有 病病间 的 并发 关系 。 
 　 　 。 统计 知识 — 症状 的 出现 对 疾病 可能性 的 影响 一般 是 用 可信度 来 衡量 ， 可信度 在 很大 程度 上 依赖于 专家 的 经验 ， 但 症状 出现 的 频率 和 重要性 也 是 决定 疾病 可能性 的 另 一个 重要 因素 。 
 　 　 。 函数 知识 — 主要 是 用来 表示 推理 中 可用 数值 计算 或 过程 执行 的 动作 。 隶属 函数 用来 计算 症状 的 值 对 某个 辞集 的 隶属 程度 ， 例如 ， 用 分段 函数 来 表示 体温 的 值 属于 高烧 、 发烧 、 低烧 和 不 发烧 的 辞集 。 此外 ， 还有 控制 推理 路径 用 可信度 计算公式 等 。 
 3 　 推理 过程 
 　 　 经 调查 我们 发现 ， 医生 在 作 诊断 时 ， 一般 首先 寻找 主要 的 诊断 根据 ， 也 就是 “ 特殊 病症 ” ， 然后 将 核实 的 主要 材料 加以 综合 分析 ， 弄清 它们 之间 的 相互 关系 ， 进一步 推测 病变 可能 存在 的 部位 ( 系统 或 脏器 ) 、 性质 或 病因 ， 为 建立 正确 的 诊断 打下基础 。 在 疾病 的 早期 ， 复杂 的 或 不 典型 的 病例 当然 找 不到 可以 确诊 的 “ 特殊 病症 ” ， 此时 就 采用 下述 方法 ， 根据 一个 主要 病症 或 先 将 几个 重要 的 病症 组成 一个 综合症 ， 然后 提出 一组 待 鉴别 的 疾病 ， 根据 某一 疾病 本身 的 特点 ， 对 组内 各个 疾病 加以 肯定 或 否定 ， 如此 反复 ， 直到 拟诊 的 疾病 能 解释 病人 的 全部 主要 临床表现 ， 并 已 找到 预期 应 见于 该病 的 “ 特殊 病症 ” 。 
 　 　 同样 ， 我们 的 模型 系统 的 推理 过程 由 系统 通过 提问 ， 根据 症状 轻重 程度 CF ( Sj ) ( 1jN ) 以及 症状 的 重要 程度 wj ， 构成 病人 症状 的 特征向量 D '   ( d ' 1 ,   d ' 2 ,   ... ,   d ' N ) ， 其中 d ' j = CF ( Sj ) * wj ,   wj 可 根据 属于 同一 系统 、 脏器 或 病因 的 症状 数 给定 ， 一般来说 ， 属于 同一 系统 或 病因 的 症状 数较 多 的 症状 比较 重要 。 然后 对 事先 构造 好 的 层次 分类 结构 中 第一层 各 疾病 类 节点 的 特征向量 计算 相似 度 ， 相似 度 的 计算 利用 夹角 余弦公式 ： 
 
 　 　 取 相似 度 最大 的 节点 作为 D ' 所属 的 疾病 类 ， 记住 相似 度 大于 阈值 T 的 节点 ， 以便 回溯 时 用到 ， 然后 对 当前 疾病 类 的 各个 直接 子 节点 分别 计算 相似 度 ， 把 D ' 归属 到 相似 度 最大 的 子类 。 这样 自顶向下 执行 疾病 类 ( 一组 待 鉴别 的 疾病 ) 到 疾病 的 自上而下 的 反向 推理 ， 在 此 过程 中 ， 进一步 提问 有关 症状 ， 不断 修改 病人 症状 的 特征向量 ， 若 结论 不能 解释 所有 的 症状 ， 则 还要 回溯到 上 一层 ， 取 相似 度次 大 的 节点 再 继续 搜索 ， 直到 找出 所有 的 症状 都 能 解释 节点 为止 。 若 用户 需要 ， 还 可 根据 疾病 的 可信度 从大到 小 排序 输出 可能 疾病 。 输出 节点 可信度 的 计算方法 有 三种 ： 
 　 　 ( 1 ) 取 最小值 ， 即 
 　 　 ( 2 ) 相乘 ， 即 
 　 　 ( 3 ) 取 最大值 ， 即 其中 T 是从 顶层 到 叶子 的 分类 路径 节点 集合 。 
 　 　 一般 的 专家系统 考虑 到 可信度 的 传递性 ， 采用 取 最小值 或 相乘 计算 可信度 ， 本 模型 采用 的 是 取 最大值 ， 因为 病人 症状 的 特征向量 在 推理 过程 中是 不断 通过 提问 修改 的 ， 很 有 可能 在 计算 最后 的 相似 度时 ， 其 特征向量 还 在 修改 ， 因此 应该 以 相似 度 最大值 为 可信度 排序 输出 。 对应 于图 2 的 推理 结果 应该 是 ： { 伤风 ( 0.9 ) ， 感冒 ( 0.7 ) } 。 
 　 　 根据 这种 层次结构 ， 自顶向下 地 逐层 分类 ， 可以 提高 分类 精度 ， 降低 计算 量 。 因为 第一层 的 类别 差异 大 ， 而且 类别 数目 较 小 ， 区分 一个 疾病 属于 哪 一类 比较 容易 。 而 在 此后 的 进一步 细分 的 过程 中 ， 分类 路径 是 沿 第一层 的 某个 节点 的 子 节点 逐层 向下 ， 每 一次 细分 都 是 在 很小 的 类别 范围 内 进行 的 ， 所以 ， 分类 质量 易于 保证 。 从 这 一 过程 中 ， 我们 还 可以 看出 ， 病人 病症 的 特征向量 并 不是 与 所有 的 类别 特征向量 进行 比较 ， 而是 只 与 部分 类别 特征向量 进行 比较 ， 这 就 大大 地 减少 了 比较 次数 。 
 4 　 结论 
 　 　 医疗 专家系统 的 知识 表示 和 推理 机制 很多 ， 怎样 的 知识 表示 是 好 的 ， 使 知识 易于 获取 、 推理 机制 便于 理解 和 实现 是 专家系统 的 一个 重要 研究 方面 。 本文 是 在 研制 疾病诊断 系统 的 过程 中 ， 发现 疾病诊断 与 现实 世界 中 的 分类 过程 十分相似 ， 因此 把 它 应用 到 专家系统 的 知识库 以及 其上 的 推理 机制 中 ， 提出 了 一种 接近 医学专家 和 医学书籍 中 的 知识 表示 ， 以及 直接 在 其 上 进行 的 推理 机制 ， 它 类似 于 人类 的 思维过程 ， 因此 易于 为 医学专家 理解 和 接受 。 但是 把 本 模型 变成 一个 实用 系统 还有 许多 工作 要 做 ， 如 进一步 完善 知识库 的 内容 和 解决 在 推理 过程 中 可能 出现 的 死锁 问题 等 ， 这些 都 是 将来 的 工作 要 考虑 的 。 
 张 红梅 （ 上海交通大学 计算机科学 与 工程系   上海   200030 ） 
 王永成 （ 上海交通大学 网络 中心   上海   200030 ） 
 参考文献 
 1 陆汝钤 .   人工智能 .   北京 ： 科学出版社 ,   1996 
 2Justin   ZobelAlistair   Moffat ,   Exploring   the   similarity   space ,   SIGIR ' 97 
 3 战学刚 ,   林鸿飞 ,   姚 天顺 .   中文 文献 的 层次 分类 方法 .   中文信息 学报 ,   1999 
 4 王永成 .   中文信息处理 技术 及其 基础 .   上海 ： 上海交通大学 出版社 ,   1992 
 收稿 日期 ： 1999 年 6 月 20 日 
