计算机 工程 
 COMPUTER   ENGINEERING 
 1999 年   第 25 卷   第 12 期   vol.25   No.12   1999 
 
 
 
 车 管业 客 网络 官理 信息系统 中 “ 黑匣子 ” 功能 的 设计 与 实现 
 淡 战平 　 侯义斌 
 　 　 车管 业务 网络 管理信息系统 是 结合 我国 现状 ， 针对 省市级 车辆管理 所 开发 的 一套 机动车 和 驾驶员 档案 网络 管理信息系统 ， 目前 承担 着 西安市 50 多万份 机动车 和 驾驶员 档案 的 日常 管理 任务 ， 系统 采用 Client / Server 模式 ， Sybase / Powerbuilder 开发 环境 ， 是 国内 同类 系统 中 技术 较为 先进 的 一个 。 
 　 　 本 系统 运行 环境 和 操作 人员 组成 十分复杂 ， 两个 安装 着 Windows   NT   Server 的 HP 中心 服务器 连接 着 微机 中心 、 证照 大厅 、 档案室 、 车检 中心 、 体检中心 、 交通指挥 中心 、 4 个 车管 分所 等 局域网 和 DDN 专线 用户 共计 80 多个 ， 网络 用户 使用 的 操作系统 有 Windows   3.1 / 3.2 和 Windows   95 / 98 。 虽然 提供 了 严格 的 权限 设置 功能 ， 但 为了 进一步 保证系统 安全性 和 数据 可靠性 、 完整性 及 权威性 ， 防止 操作失误 ， 杜绝 操作 人员 徇私舞弊 ， 参照 一些 大型 系统 中 的 系统日志 设计 并 实现 了 一个 功能强大 的 " 黑匣子 " 功能 ， 该 功能 自动记录 每 一个 用户 什么 时间 在 什么 地方 通过 哪台 计算机 进入 系统 ， 又 在 什么 时间 进行 了 哪些 具体操作 等等 信息 ， 该 功能 的 设计 思想 对 同类 管理信息系统 具有 一定 的 借鉴 作用 。   
 1   " 黑匣子 " 的 设计 
 　 　 " 黑匣子 " 中要 记录 的 信息 包括 两个 大 类 ， 一类 是 与 网络 和 操作系统 相关 的 ， 一类 是 与 具体 业务 相关 的 。 与 网络 和 操作系统 相关 的 信息 包括 入网 计算机 名及 IP地址 、 入网 时间 、 入网 用户名 等 ， 与 具体 业务 相关 的 信息 则 对应 着 本 系统 的 各个 子 功能 项 。 
 　 　 本 系统 包括 机动车 和 驾驶员 档案管理 两 大部分 。 机动车 档案管理 以 车牌号 为主 线 ， 以 行驶证 为 主要 管理 内容 ， 涉及 车辆 入户 、 年检 、 变更 、 改装 、 停驶 、 过户 、 报废 、 转出 等 各个环节 。 驾驶员 档案管理 内容 包括 准考证 、 学习 证 、 正式 驾驶证 、 出租车 准驾证 、 临时 驾驶证 等 ， 各种 证件 的 管理 均 以 证号 为主 线 ， 涉及 证件 的 申请 、 变更 、 审验 、 吊扣 、 注销 、 转出 等 各个环节 。 
 　 　 由于 要 记录 的 信息 比较 多 ， 故 " 黑匣子 " 的 设计 原则 是 尽可能 简洁 ， 以 减少 空间 和 时间 占用 ， 尽可能 一 " 匣 " 多用 。 
 　 　 根据 以上 设计 原则 ， 在 整个 系统 中 只 设置 了 一个 " 黑匣子 " ， 这个 " 黑匣子 "   融 驾驶员 档案管理 和 机动车 档案管理 两 部分 于 一体 ， 既 保存 网络 和 操作系统 相关 信息 ， 又 保存 业务 相关 信息 。 " 黑匣子 " 表 结构 如下 ： 
 　 　 Record _ type   (   证件 种类 ) ： 数据类型 tinyint ， 1 - 7 代表 7 个 不同 车类 的 行驶证 ， 8 - 12 分别 代表 准考证 、 学习 证 、 正式 驾驶证 、 出租车 准驾证 、 临时 驾驶证 。 
 　 　 Record _ number ( 证件号码 ) ： 数据类型 char   ( 6 ) ， 存放 5 位 车牌号码 或 6 位 其它 证件号码 。 
 　 　 Operate _ type   ( 操作 种类 ) ： 数据类型 tinyint ， 1 - 16 分别 代表 机动车 档案管理 的 子 功能 项 ， 17 - 31   分别 代表 驾驶员 档案管理 的 子 功能 项 。 
 　 　 Operate _ add _ info ( 附加 信息 ) ： 数据类型 varchar   ( 40 ) ， 记录 某些 操作 的 附加 信息 ， 如 转出 操作 的 转往 地 等 。   
 　 　 Operate _ person ( 操作员 ) ： 数据类型 tinyint 。   
 　 　 Operate _ time ( 操作 时间 ) ： 数据类型 datetime 。   
 　 　 Login _ name ( 入网 用户名 ) ： 数据类型 tinyint   
 　 　 Login   _ computer ( 入网 计算机 名 ) ： 数据类型 tinyint 。 
 　 　 其中 证件 种类 、 操作 种类 、 操作员 、 入网 用户名 、 入网 计算机 名 的 详细信息 分别 对应 不同 的 数据 字典 ， 由 系统管理员 维护 。 每个 操作员 均 有 自己 的 入网 用户名 、 入网 口令 及 进入 本 系统 的 口令 ， 口令 由 操作员 自己 保管 并 随时 可以 修改 。 
 2   " 黑匣子 " 的 实现 
 　 　 要 实现 " 黑匣子 " 功能 ， 关键问题 是 获取 并 记录 所 需要 的 信息 。 由于 " 黑匣子 " 中 要求 的 网络 和 操作系统 相关 信息 均 保存 在 Windows   3.1 / 3.2 或 Windows   95 / 98 的 系统 注册表 中 ， 利用 Powerbuilder 中 的 有关 操作系统 注册表 的 函数 获取 这些 信息 ， 如 ： 
 　 　 RegistryGet ( " HKEY _ LOCAL _ MACHINE \ System \ CurrentControlSet   &   control \ ComputerName " ，   " ComputerName " ,   RegString ! ,   Login _ Computer ) 
 　 　 可以 获得 入网 的 Windows   95 / 98 客户 的 计算机 名 ， 注意 Windows   3.1 / 3.2 系统 注册表 与 Windows   95 / 98 略有不同 ， 实现 过程 中先 通过 GetEnvironment   ( env ) 函数 判断 操作系统 种类 ， 再 选取 不同 的 注册表 键值 ， 以 正确 地 获取 所要 的 信息 。 
 　 　 " 黑匣子 " 中 与 具体 业务 相关 的 信息 由 各个 子 功能模块 产生 并 由 它们 自动 获取 ， 这部分 信息 产生 频率 很 高 ， 因此 对 整个 系统 的 效率 影响 很大 ， 为了 节省 保存信息 的 时间 ， 使用 了 Sybase 中 的 存储 过程 。 
 　 　 首先 在 Sybase   Server 中 增加 存储 过程 ： 
 　 　 create   procedure   insertblackbox   ( @ Record _ type   tinyint ,   @ Record _ number   char ( 6 ) ,   @ Operate _ type   tinyint ,   @ Operate _ add _ info   varchar ( 40 ) ,   @ Operate _ person   tinyint , @ Operate _ time   datetime , @ Login _ computer   tinyint   ) as 
 　 　 insert   into   blackbox 
 　 　 values 
 ( @ Record _ type ,   @ Record _ number ,   @ Operate _ type ,   @ Operate _ add _ info ,   @ Operate _ person , getdate ( ) , @ Login _ computer   ) 
 　 　 其中 getdate ( ) 函数 返回 当前 的 操作 时间 。 
 　 　 然后 在 Powerbuilder 中 建立 一 全局 用户 对象 并 在 该 对象 中 声明 存储 过程 insertblackbox ， 这样 就 可以 在 程序 中 各个 子 功能模块 中 使用 它 了 。 采用 存储 过程 保存 " 黑匣子 " 信息 既 提高 了 运行 效率 ， 又 降低 了 程序 复杂性 ， 可谓 一举两得 。 实际 应用 中 ， 完整 的 " 黑匣子 " 功能 还 包括 信息 查询 、 转储 等 。 
 3   结束语 
 　 　 车管 业务 网络 管理信息系统 由于 设置 了 " 黑匣子 " 功能 ， 不但 保证 了 系统 安全性 和 数据 可靠性 、 完整性 及 权威性 ， 而且 从技术上 减少 了 操作失误 ， 杜绝 了 操作 人员 的 徇私舞弊 现象 ， 收到 了 良好 的 效果 。 
 作者 单位 ： 西安交通大学 电脑 信息技术 研究 中心 ， 西安 710049 
 参考文献 
 1   邵佩英 ， 杨孝如 .   Sybase 数据库系统 基础知识 .   北京 ： 中国 水利   水电 出版社 ， 1998 
 2   郑 人杰 .   实用 软件工程 .   第二 版 ， 北京 ： 清华大学出版社 ， 19973   何军 .   PowerBuilder   5.0 原理 与 应用 开发 指南 .   北京 ： 电子 工业 出   版社 ， 1997 
