计算机 应用 研究 
 APPLICATION   RESEARCH   OF   COMPUTERS 
 2000   Vol.17   No.3   P.85 - 86 
 
 
 
 
 基于 LONWORKS 技术 的 面向 医院 诊室 的 网络系统 
 王健琪 　 葛剑徽 　 杨波 
 摘 　 要 ： 医院 网络 延伸 至 诊室 一层 ， 是 提高 网络 使用 价值 的 关键因素 之一 ， 讨论 了 基于 LONWORKS 技术 的 面向 诊室 网络系统 的 设计 思想 ， 给出 了 现场 终端 及 电子 处方 系统 的 设计方案 。 
 关键词 ： LONWORKS   医院 诊室   网络 单片机   电子 处方 
 1 　 引言 
 　 　 网络 技术 在 我国 的 医院 中 正在 以 一种 前所未有 的 速度 普及 与 应用 ， 国内 有 一些 较 大规模 医院 组建 了 信息 科及 相关 科室 ， 开始 了 建立 局域网 ( LAN ) ， 开展 了 远程 医疗 网络系统 的 研究 ， 以期 综合利用 各类 卫生 资源 、 提高 医疗 效率 ， 但 随着 对 信息 的 准确性 与 及时性 要求 的 提高 ， 目前 已 建成 的 医院 网络 已 逐步 暴露出 一些 问题 。 目前 各 医院 网络 主要 覆盖 各 主要 医疗 科室 和 职能 管理 部门 ， 基于 条件 和 资金 的 限制 ， 很少 延伸 到 诊室 一层 。 而 诊室 一层 是 医疗 信息 的 原始 来源 层 ， 目前 许多 信息 是 各 诊室 在 相隔 一段时间 后 收集 、 整理 并 统一 人工录入 的 ， 尤其 是 有关 药品 使用 和 病人 病历 的 信息 ， 不是 在 第一 时间 内 从 诊室 采集 得来 ， 从而 导致 信息 上 的 滞后 。 例如 门诊 医生 给 病人 开 处方 ， 如果 信息 及时 进入 网络 ， 用药 信息 就 能 实时 与 药房 药物 库存 信息 对照 ， 判断 药房 内 是否 有 某 类药物 ； 与 病人 病历 资料库 相对 照 ， 判断 病人 对 这些 药 是否 有 既往 过敏史 ； 与 药物 配合 资料库 相对 照 ， 判断 这些 药物 是否 能够 混用 。 在 进行 一系列 的 对照 判断 后 及时 向 医生 处 反馈 信息 。 如果 处方 信息 不能 及时 进入 网络 ， 就 会 造成 药物 的 误用 ， 还 可能 开出 不 适宜 的 药 ( 造成 过敏 等 反应 ) ， 同时 ， 药房 缺 某类 药 而 让 病人 在 医生 与 药 房间 来回 奔跑 ， 使 效率 降低 。 再 如 ， 医生 给 病人 开 某项 检查 申请单 ， 如果 不能 通过 网络 即时 得到 在 相应 时间段 内 做 此项 检查 的 人数 的 有关 信息 ， 就 会 造成 单位 时间段 内 单子 总数 过多 ， 使 病人 等待 检查 的 时间 过长 。 
 　 　 在 当前 医院 网络系统 结构 下 ， 因为 实时 采集 信息 的 能力 的 欠缺 ， 使得 许多 信息 不 具备 时效性 ， 不能 直接 、 迅速 、 准确 和 及时 地 反应 诊室 病人 的 医疗 信息 ， 以供 诊断 、 检查 等 参考 。 好比 神经末梢 不 发达 ， 不能 及时 感受 外界 信息 并 立即 作出反应 一样 。 因而 本文 提出 建立 面向 诊室 的 网络系统 。 
 2 　 面向 诊室 的 网络系统 
 　 　 医院 的 网络系统 平台 使用 一个 扩展 的 局域网 ( Extented   LAN ) 规模 ， 使用 以太 ( Ethernet ) 协议 网络体系结构 ， 网络体系 可 采用 Netware 、 TCP / IP 等 ， 根据 各 院 实际 情况 选用 。 医院 可设 一 服务器 或 加上 几个 二级 服务器 ， 在 每个 科室 至少 设立 一个 主 站 站点 ， 属于 医院 局域网 的 一级 节点 ， 它 负责 接收 有关 医疗 信息 ， 自动 分类 ， 将 其 存入 相关 数据库 。 另外 将 本科 室 日常 诊断 治疗 方法 、 常用 药品 等 一系列 信息 按 一定 的 规范 存入 标准 资料 数据库 ， 以供 查询 、 比较 、 帮助 及 进行 其它 处理 。 
 　 　 在 每个 诊室 中 建立 多个 小型 终端 ( 如图 1 所示 ) 。 门诊 医生 在 工作 过程 中 实时 录入 有关 病历 、 处方 等 基本 医疗 信息 ， 由 诊室 终端 进行 初步 处理 。 初步 处理 包括 ： ① 显示 ； ② 打印 ； ③ 将 相关 信息 传送 到 科室 主 站 ； ④ 接收 处理 反馈 信息 ； ⑤ 将 一些 消息 经由 本科 室主站 传送 至 诸如 药房 和 CT 室 等 检查 单位 的 主站 节点 ， 并 接收 其 反馈 信息 。 
 
 图 1 　 面向 诊室 的 网络系统 结构 
 　 　 在 主站 中 可 将 接收 的 有关 信息 ， 与 医院 各类 资料库 ， 如 病历 数据库 、 疾病 处理 分类 数据库 、 药品 配合 疗效 数据库 等 一系列 标准 数据库 ， 以及 检验 中心 和 放射科 的 就诊 预约 病人 登记 库中 的 对应 信息 相 比较 ， 再 将 结果 ， 如 病人 是否 对 处方 药物 有 既往 过敏史 、 当前 某项 检查 的 预约 是否 已满 等 信息 数据 反馈 传送 至 诊室 终端 ， 帮助 医生 作出 正确 判断 。 
 　 　 在 相关 病历 、 处方 等 医疗 信息 传送 至主站 时 ， 可 自动 将 其 按规定 的 标准 格式 转换 为 数据库 的 记录 ， 并 向 医院 的 同类 的 总 数据库 中 添加 。 在 科室 主站 中 还 可 对 本科 各 诊室 汇集 来 的 信息 进行 统计 、 报表 、 分析 等 处理 。 
 　 　 上述 的 一系列 数据库 需要 各 医院 根据 自己 的 实际 情况 分类 建立 、 规定 统一 的 标准 与 格式 ， 以利于 信息 的 传输 及 转换 。 
 　 　 诊室 的 小型 终端 只 要求 实现 数据录入 、 显示 、 打印 及 一些 并 不 复杂 的 计算 处理 等 功能 ， 强调 的 是 造价 低廉 ， 不 要求 硬件 高 配置 。 使用 PC机 成本 高 ， 资源 浪费 ， 采用 网络 单片机 ( 网络 芯片 ) 进行 开发 是 一举两得 的 选择 。 
 3 　 LONWORKS 网络 型 单片机 ( 芯片 ) 
 　 　 美国 ECHELON 公司 的 LONWORKS 神经元网络 单片机 ， 其 Neuron 芯片 是 LONWORKS 网络 硬件 应用 当中 的 核心 ， 而 LONTALK 协议 是 其 网络通讯 的 关键 。 
 　 　 网络 型 单片机 Neuron   3150 以 单一 芯片 完成 通讯 和 控制 ， 并 在 芯片 内部 固化 了 通讯 协议 ， 极大 地 简化 了 计算机控制 网络 的 硬件 结构 ， 多种 通讯 介质 ， 方便 的 I / O 形式 ， 灵活 的 拓扑 结构 ， 本身 具有 运算 处理 和 输入输出 能力 ， 能 完成 现场 的 计算 处理 工作 ， 不需 将 信号 完全 传送 给 主机 ， 直接 完成 现场 控制 过程 。 其 主要 特性 如下 ： 
 　 　 ( 1 ) 内部 集成 了 三个 CPU ， 两个 用于 网络 处理 中 ， 另 一个 用于 用户程序 处理 ， 突出 了 网络通讯 的 功能 。 
 　 　 ( 2 ) 十一个 可编程 输入输出 管脚 、 两个 16 位 定时器 / 计数器 、 十五个 软件 定时器 ， 可 直接 使用 软件 定时器 而 不用 考虑 其 具体操作 。 
 　 　 ( 3 ) 片内 设有 ROM 、 EPROM 、 RAM 、 多个 外部 扩展 存储器 接口 、 64K 存储空间 。 
 　 　 ( 4 ) 五个 网络通讯 口线 ， 三种 网络通讯 方式 ： 单端 、 差分 和 特殊 应用 模式 ， 最 简便 的 方法 为 双绞线 介质 中 的 差分 模式 了 。 可 达到 1.25 Mbps 的 通讯 速率 。 
 　 　 ( 5 ) LONTALK 协议 ， Neuron 芯片 间 的 数据通讯 ， 依靠 固化 在 芯片 内部 的 网络通讯 协议 。 该 网络通讯 协议 符合 国际标准化组织 ( ISO ) 的 开放系统 互联 协议 ( OSI ) ， 即 物理层 、 链接 层 、 网络层 、 传送 层 、 会议 层 、 表示层 和 应用层 这 七层 参考模型 ， 在 其 最高层 应用层 上用 了 LONTALK 协议 提供 的 标准 网络 变量 的 功能 。 一般 情况 下 ， 我们 只 需 通过 向 标准 网络 变量 赋值 就 可以 完成 网络通讯 。 依照 不同 的 需要 ， 网络 变量 的 发送 可以 有 四种 方式 ， 即 确认 、 无 确认 、 无 确认 重复 和 请求 响应 方式 ， 权衡 网络 占用 时间 最少 和 信息 收发 的 可靠性 最高 这 一对 矛盾 来 设立 和 选择 这 四种 方式 。   网络通讯 协议 以 发送 地址 和 接收 地址 为 标识 ， LONTALK 协议 提供 的 标识 节点 方法 有 ： 域 、 子网 、 组 、 Neuron － ID 四种 。 LONWORKS 网络 可 有 多种 拓扑 结构 ， 如 总线 型 、 星型 等 。 
 4 　 诊室 终端 及 电子 处方 
 　 　 基于 Neuron   CPU   开发 的 诊室 终端 不仅 完成 网络 终端 的 功能 ， 而且 可 实现 电子 处方 的 功能 。 各类 处方 是 医生 和 病人 进行 信息 交换 的 最 基本 的 医疗 文件 ， 也 是 医院 最 原始 的 医疗 信息 ， 这部分 信息 实现 电子化 ， 并 进入 网络 ， 不仅 能 极大 地 发挥 医院 信息网 的 作用 ， 而且 减少 了 医生 的 劳动强度 。 
 
 图 2 　 Neuron 芯片 应用 示意图 
 　 　 终端 系统结构 如图 3 ， 本 系统 以 Neuron   CPU 为 核心 ， 由 键盘 、 液晶 显示器 、 微型 打印机 、 网络通信 管理 、 程序 数据 存储器 等 模块 构成 ， 它 不但 作为 网络 现场 终端 ， 而且 作为 电子 处方 生成器 完成 病人 数据 采集 、 显示 、 通用 处方 打印 、 自动 划价 、 网络通信 等 功能 ， 医生 通过 终端 ( 电子 处方 ) 的 中文 界面 生成 处方 ， 自动 划价 后 打印 ， 减少 了 病人 划价 的 中间环节 。 终端 通过 双绞线 接入 医院 信息网 ， 全 数字 量 传输 ， 节约 经费 ， 可靠性 高 。 经 试用 效果 良好 。 
 
 图 3 　 诊室 终端 系统结构 框图 
 王健琪 ( 第四军医大学 生物医学 工程系   西安   710032 ) 
 葛剑徽 ( 第四军医大学 生物医学 工程系   西安   710032 ) 
 杨波 ( 第四军医大学 生物医学 工程系   西安   710032 ) 
 参考文献 
 1   张维勇 ,   陆   阳 .   基于 LONWORKS 技术 的 智能 控制器 及其 应用 .   微型机 与 应用 ,   1998.1 
 2   莫 卫东 ,   王   静 ,   孟 大庆 .   NOVELL 实用 网络工程 方法 .   西安 ： 西安电子科技大学 出版社 ,   1997 
 收稿 日期 ： 1999 年 10 月 25 日 
