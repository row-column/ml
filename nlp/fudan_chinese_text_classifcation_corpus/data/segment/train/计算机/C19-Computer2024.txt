微型机 与 应用 
 MICROCOMPUTER   &   ITS   APPLICATIONS 
 1999 年   第 18 卷   第 4 期   Vol.18   No.4   1999 
 
 
 
 单片机 在 灯光 自动 控制系统 中 的 应用 
 李树华 　 郭改枝 
 　 　 摘 　 要 ： 介绍 了 单片机 实现 多路 灯光 自动 控制系统 的 软 、 硬件 设计 。 
 　 　 关键词 ： 单片机 　 自动控制 　 可控硅 　 抗干扰 
 　 　 利用 单片机 丰富 的 软硬件 资源 实现 对 各种 广告牌 多路 灯光 自动控制 ， 与 传统 的 电子线路 控制器 相比 ， 具有 可编程 、 体积小 、 控制 灵活 、 操作 方便 、 控制 时间 可变 可调 等 优点 。 
 　 　 我们 为 呼市 邮政局 设计 并 安装 了 上述 单片机 多路 灯光 自动 控制系统 。 下面 就 该 系统 的 软 、 硬件 设计 作 介绍 。 
 1 　 系统结构 及 工作 原理 
 　 　 系统 整体 结构 如图 1 。 
 
 
 图 1 　 系统结构 
 　 　 8031 单片机 是 该 系统 的 核心部件 ， 其 主要 功能 ： （ 1 ） 灯光 控制 的 软件 编程 ； （ 2 ） 干扰信号 的 处理 及 复位 ； （ 3 ） 光强 及 时间 定时 的 检测 及 控制 。 
 　 　 单片机 的 控制程序 通过 对 光强 或 时间 的 检测 ， 自动 开启 （ 夜间 ） 或 关闭 （ 白天 ） 灯光 系统 ， 每 1 路 灯光设备 与 8031 内存 控制 位 相对 应 ， 单片机 通过 P3.0 ( RXD ) 和 P3.1 ( TXD ) 多功能 口 ， 利用 串行 通信 方式 0 实现 不同 控制代码 的 输出 ， 从而 完成 了 多路 灯光设备 各种 变化 的 自动 循环 显示 。 
 2 　 8031 单片机 控制系统 功能分析 
 2 ． 1 　 光强 或 时间 定时 的 检测 及 控制 
 　 　 如图 2 所示 ， 当 8031 单片机 P1.4 的 控制 开关 拨 到 ＋ 5V 时 ， 系统 的 开启 或 关闭 由 光强 控制 。 这时 ， 当 光线 较 强时 （ 白天 ） ， 光 耦 二极管 电阻 变小 ， 三极管 Q1 导通 ， P1.7 为 低电平 ； 当 光线 暗时 （ 夜间 ） 光 耦 二极管 变 大 ， 三极管 Q1 截止 ， P1.7 为 高电平 。 8031 单片机 控制程序 每隔 一定 时间 （ 约 5ms ） 采样 P1.7 端的 状态 ， 然后 根据 其高 低电平 选择 开启 或 关闭 相应 的 灯光 控制代码 发送 。 图 2 中 与 光 耦 二极管 并联 的 可调 电位器 可以 调整 三极管 Q1 的 截止 导通 状态 ， 从而 实现 对 光控 的 微调 。 
 
 
 图 2 　 光 耦 电路 
 　 　 当 P1.4 拨至 接地 状态 时 ， 8031 单片机 程序 进入 时间 控制 子程序 ， 8031 单片机 把 内部 定时器 0 设置 成 日历 时钟 计数 （ 其 初值 可以 用 按钮 设置 ） ， 当 程序 查询 到 表格 内 的 开启 或 关闭 初值 （ 表格 的 初值 可 通过 按钮 及 数码管 显示 来 输入 或 修改 ） 与 单片机 时钟 当前 值 相同 时 ， 则 自动 发送 相应 的 开启 或 关闭 输出 控制代码 。 
 2 ． 2 　 双向 可控硅 控制电路 
 　 　 由于 负载 一般 为 大功率 器件 （ 电压 从 几百 伏 至上 千伏 ， 电流 从 几 安培 至 几十 安培 ） ， 因此 ， 8031 单片机 工作 部分 与 可控硅 触发 部分 采用 MOC3021 双向 可控硅 输出 型 光电 耦合 器 ， 图 3 为 1 路 可控硅 触发 控制电路 。 
 
 
 
 图 3 　 可控硅 触发 电路 
 　 　 可控硅 TR 的 门 极 触发 电流 为 50mA ， 触发 电压 为 2V ， 则 最小 触发 电压 为 ： 
 　 　 VT ＝ R1 ， IGT ＋ VGT ＋ VTM ＝ 300 × 0.05 ＋ 2 ＋ 3 ＝ 20V 
 　 　 对应 的 最小 控制 角 α 为 ： 
 　 　 
 　 　 其中 ： IGT 为 可控硅 TR 的 最小 触发 电流 ， VGT 为 可控硅 TR 的 最小 触发 电压 ， VTM 为 MOC3021 输出 压降 ( 3V ) ， Vp 为 交流 工作电压 的 峰值 。 
 在 使用 中 发现 ， 当 感性 负载 时 ， 有时 会 引起 可控硅 误 触发 。 经 分析 发现 ， 当 感性 负载 时 ， 由于 电压 上升率 dv / dt 较大 ， 在 阻断 状态 下 ， 可控硅 的 PN 结 相当于 1 个 电容 ， 当 突然 受到 正向 电压 、 充电电流 过门 极 PN 结时 ， 起到 了 触发 电流 的 作用 ， 造成 MOC3021 的 输出 回路 可控硅 误导 通 。 为此 ， 我们 对 上述 电路 进行 了 修正 ， 如图 4 所示 。 在 输出 回路 中 加入 R2 和 C1 组成 RC 回路 ， 降低 dv / dt 。 按照 MOC3021 的 技术指标 ， 允许 最大 的 电压 上升率 dv / dt = 10V / s ， 结温 上升时 d υ / dt 下降 ， 在 极端 的 工作 条件 下 ， dv / dt = 0.8 V / s 。 
 
 
 图 4 　 修改 后 的 触发 电路 
 　 　 
 　 　 R2 、 R1 之 和 与 最小 触发 电压 与 可控硅 门 极 电流 的 关系 为 ： 
 　 　 C1 取 0.2 μ F 。 
 　 　 同理 ， 在 TR 输出 端 加上 RC 滤波 网络 ， 从而 使 TR 输出 电压 上升率 下降 。 
 2 ． 3 　 单片机 工作 回路 的 干扰 及 解决 措施 
 　 　 由图 1 可知 ， 光 耦 电路 利用 MOC4021 将 输入 弱 信号 与 输出 强 信号 进行 隔离 ， 但 在 实际 运行 时 ， 单片机 系统 仍 有 较 强 的 干扰信号 存在 ， 常常 出现 死机 或 程序 飞跑 现象 。 分析 认为 ， 由于 输出 的 大 电流 及 电压 均 工作 在 开关 状态 ， 输出 高次 谐波 通过 电源 回路 对 8031 单片机 产生 了 较大 的 影响 ， 因此 ， 我们 设计 了 电源 滤波 电路 及 硬件 复位 电路 ， 对 电路 的 干扰 进行 了 有效 的 控制 。 其中 ， 硬件 复位 电路 如图 5 所示 。 图 5 中 74LS123 为 双路 可 再 触发 单稳态 多谐 振荡器 ， 通过 外接 阻容 参数 ， 可 产生 不同 宽度 的 正负 脉冲 ， 其 真值表 如表 1 。 
 
 
 图 5 　 复位 电路 
 表 1 　 74LS123 真值表 
 输 　 入输 　 出 
 delete 　 A 　 BQ 　 Q 
 　 L 　 X 　 XL 　 H 
 　 X 　 H 　 XL 　 H 
 　 X 　 X 　 LL 　 H 
 　 H 　 L 　 ^ 　 
 　 H 　 I 　 H 　 
 　 　 　 L 　 H 　 
 
 　 　 由表 1 及图 5 电路 可知 ： 由于 1 脚 A 接地 ， 2 脚 B 接 8031 单片机 P1.0 ， 正常 运行 时 ， 循环 程序 不断 从 P1.0 发送 代码 信号 ， 使 2 脚 不断 有 上升 沿 出现 ， 因此 ， 13 脚 保持 高电平 ， 则 5 脚 输出 低电平 ， 保持 8031RESET 脚 低电平 的 需要 。 当 程序 飞跑 或 死机 时 ， 2 脚 电位 不再 变化 ， 使 5 脚 产生 一 高电平 脉冲 ， 促使 8031 复位 ， 重新启动 。   
 3 　 系统结构 特点 及 应用 范围 
 　 　 该 系统 软硬件 均 采用 模块化 结构 ， 1 块 控制板 能 控制 16 路 输出 ， 输出 信号 通过 8031 串行口 RXD 及 TXD 端经 74LS164 串入 并 出 移位 寄存器 输出 ， 因此 ， 软件 输出 代码 高 达 上千 路 信号 ， 硬件 控制板 根据 需要 可以 任意 扩充 ， 只要 电源 变压 功率 相应 增大 即可 。 该 系统 可 广泛应用 于 霓红灯 ， 多路 塑料管 灯及 多路 色灯 的 控制 。 
 　 　 另外 ， 系统 具有 与 微机 串行口 RS － 232 的 通信接口 ， 必要 时 可以 与 微机 连接 ， 这样 ， 多路 灯光 控制参数 及 时间 控制参数 在 微机 上 可 随时 修改 ， 使 控制 变得 更加 灵活 。 
 作者 单位 ： 呼和浩特 内蒙古大学 电子 工程系 （ 010021 ） 
 参考文献 
 　 1 　 余永权 . 单片机 应用 系统 的 功率 接口技术 . 北京 ： 北京航空航天大学 出版社 ， 1992 ； 104 ～ 108 
 　 2 　 李树华 . IBM － PC 微机 与 发光管 显示屏 的 连网 通讯 . 内蒙古大学 学报 （ 自然科学 版 ） ， 1993 ； （ 4 ） ： 441 ～ 443 
 　 3 　 Xicor   Inc . New   Product   and   Applications   Information   for   Design   engineers ． EDN ， 1994 ; 39 ( 25 ) : 159 ～ 160 
 收稿 日期 ： 1998 - 12 - 15 
