微型机 与 应用 
 MICROCOMPUTER   &   ITS   APPLICATIONS 
 1999 年   第 18 卷   第 1 期   Vol.18   No.1   1999 
 
 
 
 通用 外接式 MXI 接口 适配器 的 设计 与 实现 
 支超 有 　 郑保 
 　 　 摘 　 要 ： 介绍 一种 外接 于 计算机 增强 并行接口 EPP 的 MXI 接口 适配器 ， 说明 了 EPP 接口 与 多 系统 扩展 接口 MXI 功能 和 通信协议 的 转换方法 。 
 　 　 关键词 ： MXI 接口 适配器 　 增强 并行接口 　 多 系统 扩展 接口 　 功能 转换 
 　 　 基于 VXI 总线 的 虚拟仪器 测试 系统 中 ， MXI ( Multisystem   Extersion   Interface ) 接口 常常 用于 实现 外接 计算机 与 VXI 机箱 的 连接 通信 ， 或者 用于 多台 VXI 机箱 的 扩展 互连 ［ 1 ］ 。 在 与 VXI 测试 系统 的 外部 控制器 连接 中 ， 由于 MXI 总线 接口 具有 很 高 的 数据 传输速率 ， 并 能 实现 多 系统 的 互连 ， 愈来愈多 地 受到 生产厂家 和 用户 的 欢迎 ［ 2 ］ 。 使用 该 接口 连接 外部 计算机 与 VXI 机箱 时 ， 要求 外部 计算机 必须 配置 有 MXI 接口 ， 但 实际 使用 中 ， 很多 用户 希望 利用 自己 已有 的 计算机 资源 ， 作为 VXI 测试 系统 的 外接 控制 计算机 。 
 　 　 针对 上述 问题 ， 本文 提出 利用 目前 计算机 上 通常 配置 的 增强 并行接口 EPP ( Enhenced   Parallel   Port ) ， 通过 MXI 接口 适配器 实现 用户 通用 计算机 与 VXI 机箱 的 连接 通信 。 
 1 　 接口 适配器 的 功能 
 　 　 MXI 总线 是 NI 公司 于 1989 年 提出 的 一种 总线 标准 ， MXI 总线 信号 包括 带 奇偶 位 的 32 条 地址 / 数据 复用 线 ， 可 实现 多 地址 空间 的 地址变换 、 单级 多 控者 优先 总线 仲裁 、 1 条 中断 信号线 、 1 条 超时限 挂 死 或 死锁 的 总线 错误 信号 及 异步 操作 的 挂钩 线 。 可 传送 8 位 、 16 位 、 32 位 数据 ， 也 能 完成 独立 的 读 / 写 操作 与 数据传输 。 有关 MXI 总线 详细 介绍 可 参阅 文献 ［ 2 ］ 。 
 　 　 EPP 协议 是 由 Intel 、 Xicom 和 Zenith   3 家 公司 发起 制定 的 。 EPP 接口 具有 与 标准 并行接口 兼容 且 能 完成 数据 / 地址 双向 传输 的 功能 ， 极大 地 改善 了 PC机 并行口 的 数据传输 能力 ， 类似 于 一个 总线 。 EPP 接口 信号 包括 8 位 数据 / 地址 复用 线 ， 1 条读 / 写线 ， 地址 、 数据 选通线 ， 1 条中 断线 和 1 条 握手 控制线 。 与 外设 通信 中 ， 该 接口 提供 了 4 种 控制 操作 周期 ： 数据 读 / 写 周期 和 地址 读 / 写 周期 。 数据 周期 用于 主机 与 外设 间 的 数据 传送 ， 地址 周期 用于 地址 、 命令 和 控制 信息 的 传送 。 EPP 接口 细节 可 参阅 文献 ［ 3 ］ 。 
 　 　 基于 上述 分析 ， 可 设计 出 完成 MXI 和 EPP 通信协议 功能 转换 的 接口 适配器 ， 面向 MXI 总线 一面 ， 与 MXI 总线 上 设备 通信 ； 面向 EPP 接口 一面 ， 与 计算机 通信 ， 完成 计算机 与 MXI 总线 设备 的 数据 信息 传送 。 接口 适配器 与 计算机 通信 时 ， 可 依照 EPP 接口 特点 ， 完成 8 位 数据 信息 的 传送 。 而 实现 MXI 总线 功能 时 ， 将 接口 适配器 设计 为 只 具有 系统 主 模块 功能 ， 不 允许 被 系统 中 其它 主 模块 寻址 ， 保证 外接 控制 计算机 作为 MXI 总线 上 一主 模块 ， 主动 地 和 系统 中 其它 模块 进行 数据通信 。 该 接口 适配器 还 具有 MXI 系统 控制器 功能 ， 完成 总线 仲裁 、 菊花链 驱动 和 总线 定时 等 功能 ； 在 寻址 和 数据传输 方面 ， 设计 为 支持 A24 寻址 及 D8 数传 功能 ， 其 数据传输 时 ， 根据 AD0 # 、 AD1 # 和 SIZE # 的 状态 ， 轮流 在 AD0 ～ AD7 、 AD8 ～ AD15 信号线 上 传送数据 ； 执行 中断 管理 的 功能 时 ， 管理 它 所 监视 的 中 断线 、 请求 线 ， 实现 中断 的 响应 。 
 2 　 硬件 原理 及 接口 功能 转换 
 　 　 在 MXI 接口 适配器 设计 中 ， 使用 Motorola   MC68HC05L11 单片机 完成 MXI 硬件 总线 操作 与 EPP 总线 操作 的 功能 转换 。 图 1 是 该 接口 适配器 硬件 原理图 。 
 
 
 图 1 　 MXI 接口 适配器 原理图 
 　 　 MC68HC05L11 单片机 具有 多个 I / O 端口 ， 提供 38 根 双向 I / O 线 ， 通过 存储管理 部件 MMU 可 实现 16 ～ 32 位 地址总线 扩展 等 特点 ［ 5 ］ 。 图 1 中 使用 MC68HC05L11 的 C 口 和 E 口 的 I / O 线 与 EPP 接口 的 地址 / 数据 复用 线 、 控制 操作 、 握手 和 中断 信号线 连接 。 其中 C 口 8 根 I / O 线 对应 EPP 接口 中 AD0 ～ AD7   8 根 地址 / 数据线 ， 用于 计算机 与 接口 适配器 的 数据 、 地址 和 其他 命令 信息 的 传送 。 EPP 接口 中 的 读 / 写 WRITE 、 数据 选通 DATASTB 、 地址 选通 ADRSTB 等 输出 控制 信号 ， 分别 接 E 口 的 PE0 、 PE1 和 PE2   3 根 I / O 。 EPP 接口 中断 输入 INTR 和 握手 信号 WAIT 则 接 E 口中 PE3 和 PE4   2 根 I / O 线 。 
 　 　 在 计算机 与 接口 适配器 的 通信 中 ， PE0 ～ PE2 设置 为 输入 方式 ， PE3 、 PE4 设置 为 输出 方式 。 在 数据传输 时 ， 由 主机 执行 对 EPP 接口 “ 基址 + 4 ” 寄存器 的 读写操作 ， EPP 控制器 就 会 产生 所 需 的 握手 和 选 通信 号 ， 完成 1 个 联锁 的 数据 读写周期 ； 而 在 地址 、 命令 信息 的 传送 中 ， 主机 执行 对 EPP 接口 “ 基址 + 3 ” 寄存器 的 读写操作 ， EPP 控制器 同样 产生 所 需选 通信 号 并 检测 握手 信号 ， 完成 1 个 联锁 的 地址 读写周期 。 单片机 是 通过 监测 与 EPP 接口 中 读写 、 数据 和 地址 选通线 的 状态 ， 对 主机 读写 数据 或 地址 信息 给予 响应 ； 通过 握手 信号 向 主机 反馈 当前 状态 ， 通过 中 断线 向 主机 申请 中断 。 
 　 　 接口 适配器 与 MXI 总线 的 通信 是 通过 单片机 的 数据 口 、 地址 口 、 A 口 、 B 口 实现 的 ， 其中 A 口 、 B 口中 I / O 线 分别 接 MXI 总线 的 控制 信号 、 仲裁 信号 ， MX1 总线 的 总线 请求 线 BREQ # 和 中断请求 线 IRQ # 分别 接 单片机 的 中断 申请 线 IRQ1 和 IRQ2 。 
 　 　 MXI 总线 操作 中 ， 使用 AD31 # ～ AD00 #   32 条 数据 / 地址 复用 信号线 ， 而 MC68HC05L11 单片机 地址 线 和 数据线 是 分离 的 ， 且 只 提供 8 位 数据 传输线 ， 因此 专门 设计 了 MXI 地址 数据总线 变换 与 驱动 电路 ， 在 面向 MXI 总线 操作 中 ， 实现 接口 适配器 与 单片机 地址 、 数据线 连接 时 ， 该 电路 在 读写 信号 WR # 、 地址 选 通信 号 AS # 、 数据 选 通信 号 DS ＃ 和 传输 宽度 信号 SIZE # 的 控制 下 ， 将 单片机 的 地址 信号 和 数据信号 分 时 发送到 MXI 总线 ， 或者 从 MXI 总线 读取数据 信息 ； 在 8 位 数据 信息 的 传送 中 ， 由 AD0 # 、 AD1 # 和 SIZE # 信号 控制 ， 轮流 在 AD0 # ～ AD7 # 和 AD8 # ～ AD15 # 信号线 上 传送数据 。 此外 ， 在 该 总线 变换 与 驱动 电路 中 包括 有 对 地址 、 数据信号 奇偶 检错 功能 ， 用于 产生 和 检测 地址 、 数据信号 的 奇偶校验 信号 PAR # 。 MXI 总线 从 模块 接收 到 有效 地址 信息 后 ， 产生 相应 的 奇偶校验 码 并 与 所 收到 的 奇偶校验 信息 比较 ， 相同 则 表明 是 主 模块 对 该 模块 的 寻址 ， 并 参与 随后 的 数据 传送 过程 ， 否则 对 寻址 操作 不 响应 。 进行 读写 数据 操作 时 ， 发送数据 模块 在 发出 数据 信息 后 ， 仍 按 奇偶校验 规则 驱动 PAR # 信号 ， 接收数据 模块 在 接收 到 数据 信息 后 ， 根据 所 接收 到 的 数据 产生 奇偶校验 信号 并 与 接收 的 PAR # 信息 比较 ， 二者 相同 ， 则 认为 所 接收 的 数据 信息 是 正确 的 ， 并 驱动 DTACK # 信号 以 确认 ； 否则 ， 驱动 BERR # 线为 低 通知 数据源 模块 ， 数据 传送 失效 。 
 　 　 MXI 总线 的 控制 信号 、 仲裁 信号 和 状态 信号 分别 与 单片机 的 A 口 与 B 口 的 I / O 线 连接 ， 通过 对 单片机 上述 2 个 I / O 端口 I / O 线 的 操作 ， 模拟 MXI 总线 控制 或 仲裁 信号 在 数据 传送 过程 中 的 状态 变化 ， 检测 仲裁 信号 和 状态 信号 的 状态 ， 实现 单片机 与 MXI 总线 上 设备 的 通信 ， 完成 MXI 功能 。 
 　 　 MXI 总线 申请 仲裁 和 菊花链 驱动 功能 用于 对 MXI 总线 控制权 进行 管理 ， 保证 每次 只有 1 个主 模块 拥有 总线 控制权 ， 并且 实现 各个 主 模块 之间 的 总线 控制权 的 转移 。 图 1 接口 适配器 中 ， 总线 申请 仲裁 和 菊花链 驱动 功能 由 软件 模拟 方法 实现 。 单片机 IRQ1 中断 信号 接 MXI 的 总线 申请 信号 BREQ # ， 通过 响应 IRQ1 中断 ， 处理 MXI 总线 其它 模块 对 总线 权 的 申请 。 菊花链 输入 / 输出 信号 GIN # 、 GOUT # 接 单片机 PA4 、 PA5   2 个 I / O 线 ， 软件程序 根据 GIN # 信号 状态 和 单片机 当前 状态 ， 设置 GOUT # 信号 状态 ， 实现 硬件 菊花链 驱动 电路 的 功能 。 当 接口 适配器 要求 拥有 MXI 总线 控制权 、 申请 总线 请求 时 ， 同样 由 单片机 软件 驱动 与 BREQ # 信号 相连 的 PB5   I / O 位 ， 请求 总线 控制权 。 
 　 　 MXI 总线 包含 1 条 中断 信号线 IRQ # ， 接口 适配器 中 ， 借用 了 单片机 另 1 条 中断请求 信号线 IRQ2 。 单片机 对 IRQ2 的 中断 响应 时 ， 提供 MXI 总线 设备 要求 的 中断 服务 ， 对于 简单 的 中断 处理 ， 由 单片机 负责 完成 ， 而 对于 复杂 的 中断 处理 ， 则 由 单片机 通过 EPP 接口 再 向 主机 申请 中断 ， 由 主机 负责 对 复杂 中断 的 处理 。 对 MXI 总线 定时器 的 要求 ， 借用 了 单片机 的 计时 功能 ， 以 防止 总线 死锁 ， 使 系统 瘫痪 。 
 3 　 结 　 论 
 　 　 VXI 总线 自动测试 系统 中 ， 计算机 是 整个 测试 系统 的 核心 ， 而 利用 用户 已有 的 计算机 做 为 VXI 外部 控制器 ， 是 大多数 用户 所 关心 并 希望 的 。 本文 介绍 的 MXI 接口 适配器 ， 有效 地 解决 了 用户 通用 计算机 与 VXI 机箱 的 互连 问题 ， 大大降低 用户 组建 VXI 测试 系统 的 费用 。 在 接口 适配器 的 设计 中 ， 使用 多 端口 的 MC68HC05L11 单片机 ， 同时 MXI 地址 数据总线 变换 与 驱动 电路 采用 FPGA ( Field   Programmable   Gate   array ) 技术 ， 简化 了 电路 的 设计 、 并 降低 了 接口 适配器 的 成本 。 
 作者 单位 ： 航空工业总公司 西安 第六 零三 所 ( 710089 ) 
 参考文献 
 　 1 　 杨安禄 ， 陈长龄 . 电子仪器 接口技术 . 成都 ： 电子科技 大学 出版社 ， 1994 
 　 2 　 陈光福 . VXI 总线 测试 平台 技术 . 成都 ： 电子科技 大学 出版社 ， 1996 
 　 3 　 伍丁红 . 增强 并行口 EPP 协议 及 高速 并行口 A / D 适配器 的 设计 . 电子 技术 应用 ， 1998 ； ( 2 ) ： 47 ～ 48 
 　 4 　 李海欧 ， 刘启鸿 ， 曲春波 . PC — MXI 接口卡 设计 . 测控 技术 ， 1997 ； ( 6 ) 
 　 5 　 Motorola 公司 亚太区 总部 . Motorola 单片机 应用 指南 . 上海 ： 复旦大学 出版社 ， 1994 
 ( 收稿 日期 ： 1998 - 07 - 03 ) 
