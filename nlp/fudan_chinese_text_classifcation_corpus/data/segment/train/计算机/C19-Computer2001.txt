微型机 与 应用 
 WEIXINGJI   YU   YINGYONG 
 1999 年 3 月   第 18 卷   第 3 期   vol.18   No.3 
 
 
 
 基于 Client / Server 模式 的 安全 体系 方案 
 刘玉莎 　 张晔 
 　 　 摘 　 要 ： 通过 开发 同舟 生命 卡 网上 服务 系统 的 实际 经验 ， 提出 了 在 C / S 模式 下 ， 针对 系统 安全性 所 采取 的 若干 方法 与 技术 ， 包括 内核 级 透明 代理 、 用户 授权 机制 、 智能型 日志 和 备份 恢复 机制 。 
 　 　 关键词 ： C / S 　 B / S 　 DML 　 网络安全 
 　 　 同舟 生命 卡 网上 服务 系统 是 基于 Internet / Intranet 发展趋势 ， 采用 现今 最为 先进 的 开发工具 ， 集结 了 C / S 及 B / S   2 种 体系结构 ， 开发 出 的 1 套 网上 寻医问药 智能型 系统 。 拥有 同舟 生命 卡 的 用户 ( 分为 贵宾 和 一般 会员 ) ， 除了 可以 浏览 各种 医疗 、 保健 、 养生 等 信息 之外 ， 还 实现 了 网上 预约 挂号 、 网上 专家 会诊 、 电子 语音 邮件 等 一系列 服务 。 并 计划 在 系统 开发 的 二期工程 中 ， 充分 结合 多媒体 信息技术 ， 进一步 拓宽 网上 医疗 的 服务 范围 ， 真正 实现 “ 足不出户 ， 寻遍 天下 医 ” 的 远程 医疗 。 
 1 　 系统 平台 
 　 　 图 1 为 系统结构 。 
 
 　 　 1 . 网络 环境 平台 ： 内部 网络 采用 快速 交换 以太网 技术 ， 并 使用 路由器 和 专用 DDN 线路 与 本地 ISP 相连 。 
 　 　 2 . 服务器 系统 平台 ： 采用 IBM   330 作为 数据库 服务器 和 Web 服务器 ， 内置 256MB 内存 ， 双 CPU 结构 ， 并 采用 双 SCSI 硬盘 构成 Raid1 磁盘 容错 阵列 实现 系统 热 备份 ， 以 保证系统 运行 的 高效 、 安全 及 可靠 。 
 　 　 3 . 主机 系统 平台 ： 采用 联想 P Ⅱ 266 作为 工作站 ， 内置 32MB 内存 ， 2.3 GB 硬盘 。 
 　 　 4 . 系统软件 平台 ： 服务器 操作系统 ： WinNT   4.0 ； 工作站 操作系统 ： Win95 、 Win98 ; 数据库 服务器软件 ： Oracle   7.3 . 2 ； Web 服务器软件 ： IIS   2.0 ； 开发工具 软件 ： Developer / 2000   2.0 , Backstage 。 
 2 　 系统 特点 
 　 　 1 . C / S 与 B / S 的 完美 结合 。 与 C / S 相比 ， B / S 体系结构 在 多方面 占有 更大 的 优势 ( B / S 结构 的 特点 ， 请参阅 其它 资料 ) 。 然而 ， 由于 目前 B / S 开发工具 的 不 成熟性 ， 其 在 灵活性 、 安全性 、 效率 等 方面 仍 存在 诸多 问题 。 基于 上述 原因 ， 系统 被 划分 为 支持 会员 使用 的 B / S 系统 ( 利用 其高 可维护性 、 跨平台 性 的 特点 ) ， 及 内部 ( 包括 各 医院 ) 使用 的 C / S 系统 ( 利用 其 稳定性 、 安全性 及 高效率 的 特点 ) 。 通过 2 种 体系结构 的 有效 集成 ， 最大 程度 地 发挥 二者 各自 的 优势 。 
 　 　 2 . 与 大型 数据库 Oracle 的 完美 结合 。 尽可能 地 使用 Oracle 的 完整性 约束 、 触发 子及 存储 过程 ， 从而 一方面 提高 了 开发人员 的 工作效率 ， 另一方面 也 大大减少 了 可能 的 网络 I / O ， 增强 了 C / S 系统 的 性能 。 
 　 　 3 . 与 多媒体技术 的 完美 结合 。 由于 会员 / 贵宾 的 照片 及 有些 医疗 资料 ( 如 X光 片 ) 须 以 图像 形式 入库 保存 ， 我们 在 系统 的 开发 中 充分利用 Oracle 所 提供 的 非 结构化 数据类型 “ Long   Raw ” ， 为 信息 的 多媒体 化 提供 了 必要 的 基础 。 此外 ， 由于 系统 支持 语音 邮件 ， 并 将要 支持 一定 的 视频 信息 ， 客户机 端 配备 了 必要 的 话筒 、 耳机 及 摄像头 等 外设 ， 力图 以 最快 、 最 直接 、 最 准确 的 方式 将 客户 的 现场 状况 ， 传递 给 医院 、 专家 ， 从而 真正 发挥 网上 服务 系统 的 潜在 优势 。 
 3 　 系统安全 
 　 　 由于 这套 系统 涉及 客户 的 各类 医疗 信息 ， 而 医疗 信息 在 保密性 、 准确性 及防 篡改 等 安全 方面 较之 一般 信息 ， 有着 更 高层次 上 的 需求 。 因此 ， 系统 着重 设计 了 一套 严密 的 安全 体系 ， 并 取得 了 卓有成效 的 成果 。 
 3.1 　 内部 系统安全 ( C / S 系统 的 安全 ) 
 　 　 ( 1 ) 内核 级 透明 代理 
 　 　 2 层 C / S 模式 下 的 安全 管理 向来 是 一个 众人 关注 的 焦点 。 而 其 通常 的 做法 是 ， 直接 为 每 一个 系统管理 人员 或 操作 人员 建立 数据库 帐号 ， 并 为 其 授权 。 然而 ， 我们 认为 这种 安全 体系 有着 潜在 的 问题 ， 尤其 是 在 一个 复杂 系统 中 ， 由于 存在 着 大量 的 数据库 实体 及 拥有 不同 操作 权限 的 用户 ， 而 每个 用户 对 数据库 实体 的 操作 可以 是 增 、 删 、 改 、 查 的 任意 组合 ， 因此 即使 使用 角色 或 工作组 的 方式 为 其 授权 ， 也 会 显得 相当 复杂 ， 甚至 存在 着 潜在 的 安全漏洞 。 而 一旦 用户 绕过 应用逻辑 ， 直接 利用 自己 的 帐号 操作 数据库 ， 那么 这些 潜在 的 漏洞 将 进一步 暴露 出来 ， 直接 威胁 系统 的 安全 。 
 　 　 针对 这些 问题 ， 我们 所 采取 的 解决方案 是 ： 每个 数据库 应用 只 建立 一个 真正 的 数据库 帐号 ( 本 系统 为 root ) ， 它 具有 对系统 应用 所 涉及 的 所有 数据库 实体 进行 操作 的 全部 权限 。 与此同时 ， 为 每 一位 系统 操作 人员 分别 创建 了 1 个 “ 应用 系统 帐号 ” ， 实际上 只是 数据库 中 创建 的 名为 USERS 用户 表里 的 1 条 记录 。 这样 ， 每次 应用程序 在 客户端 执行 时 ， 首先 会以 root 登录 数据库 ， 然后 执行 自行 编写 的 登录 程序 ， 与 USERS 表 结合 ， 实现 应用 系统 登录 。 
 　 　 这种 安全 体系 使得 应用 系统 成为 数据库 的 直接 用户 ， 而 应用 系统 的 所有 操作 人员 ( 包括 系统管理员 ) 则 是 数据库 的 间接 用户 ； 换言之 ， 应用 系统 除了 完成 其 应用逻辑 之外 ， 还 将 系统 用户 和 数据库 彻底 隔离 开来 ， 成为 数据库 的 一道 坚固 的 “ 防火墙 ” 。 由于 在 这种 安全 体系 中 ， 真正 的 数据库 帐号 泄露 及 扩散 的 可能性 几乎 为 零 ， 所有 的 用户 必须 通过 应用 系统 这一 “ 单点 ” 访问 数据库 ， 所以 可以 得出结论 ： “ 只要 应用程序 是 安全 、 可靠 的 ， 则 整个 系统 是 安全 、 可靠 的 ” 。 这样 ， 系统 开发人员 的 精力 可以 高度集中 到 应用程序 安全性 的 编写 上 。 
 　 　 然而 ， 正是 由于 应用 系统 接管 了 原来 数据库 管理系统 的 一部分 工作 ， 因此 也 增加 了 一部分 工作量 。 比如 为了 保护 用户 口令 ， USERS 表中 的 口令 字 段 需要 加密 保存 。 为了 保证 口令 在 网络 上 的 安全 传输 ， 编写 应用程序 时 必须 遵守 “ 先 加密 、 后 传输 ” 的 基本准则 。 
 　 　 ( 2 ) 增强 的 用户 授权 机制 
 　 　 由于 在 这种 安全 体系 中 ， 应用 系统 成为 隔离 用户 和 数据库 的 “ 防火墙 ” ， 其 本身 就 必须 具备 相当 的 安全 特性 。 尤其 是 用户 授权 管理机制 ， 其 严密性 将 直接 影响 整个 系统 的 安全 。 
 　 　 基于 此 ， 我们 从 功能 出发 将 整个 系统 细分 为 若干个 可 分配 的 最小 权限 单元 ， 这些 权限 具体表现 在 对 数据库 中 所 涉及 的 表 、 视图 的 数据 操纵 ( DML ： 插入 、 修改 、 删除 、 查询 等 ) 的 划分 上 。 然后 再 运用 角色 或 工作组 的 概念 ， 结合 各种 系统 使用 人员 的 工作 性质 ， 为 系统 创建 了 4 类 基本 等级 ： 系统管理员 、 高级 操作员 、 一般 操作员 、 及 医院 操作员 ， 并 为 每个 等级 相应 地 赋予 了 不同 的 权限 ， 以此 来 简化 权限 管理工作 。 此外 ， 为了 增加 系统安全 管理 的 灵活性 ， 授权 管理 模块 还 可以 对 属于 某一 等级 用户 的 权限 作 进一步 定制 ， 达到 所有 权限 均 可任意 组合 的 效果 。 
 　 　 同时 ， 为了 进一步提高 系统管理员 的 工作效率 ， 系统 为 系统 权限 、 用户 等级 及 每种 等级 所 对应 的 默认 权限 组合 都 建立 了 数据 字典 ， 以便 在 不同 的 应用环境 下 ， 管理员 都 能 方便 地 增加 等级 ， 或 改变 某种 等级 的 默认 权限 。 此外 ， 为了 能 暂时 封锁 某一 帐号 的 使用 ， 安全 系统 还 提供 了 帐号 冻结 及 解冻 的 功能 。 
 　 　 通过 这种 方式 ， 在 统一 管理 之下 ， 又 具有 相当 的 灵活性 ， 有助于 系统管理员 更为 方便 、 更为 严密 地 控制 整个 系统 的 安全 。 
 　 　 ( 3 ) 智能型 日志 
 　 　 日志 系统 具有 综合性 数据 记录 功能 和 自动 分类 检索 能力 。 在 本 系统 中 ， 日志 将 记录 ： 自某 用户 登录 时起 ， 到 其 退出 系统 时止 ， 这 段时间 中 所 执行 的 所有 操作 ， 包括 登录 失败 操作 、 对 数据库 的 操作 、 及 系统 功能 的 使用 。 日志 所 记录 的 内容 有 执行 某 操作 的 用户名 、 执行 操作 的 机器 IP地址 、 操作 类型 、 操作 对象 及 操作 执行 时间 等 ， 以备 日后 审计 、 核查 之用 。 
 　 　 在 这个 系统 中较 有 特色 的 是 ， 不仅 可以 分类 检索 日志 内容 ， 系统 还 能 根据 已 记录 的 日志 内容 ， 通过 智能型 推理 ， 自动 找出 系统 中 可能 存在 的 不 安全 因素 ， 并 实时 触发 相应 的 警告 信息 ， 以及 时 通知 系统管理员 及 用户 。 以下 为 几种 智能性 检查 ： 
 　 　 ① 潜在 “ 黑客 ” 攻击 检查 
 　 　 对于 那些 企图 登录 系统 的 “ 黑客 ” ， 在 其 3 次 登录 失败 后 ， 系统 便会 自行 关闭 。 由于 使用 了 智能型 日志 系统 ， 系统管理员 便会 及时 得知 有 “ 黑客 ” 攻击 ， 尤其 是 针对 同一 帐号 的 攻击 ， 在 若干次 尝试 失败 以后 ， 系统 将会 自动 冻结 该 帐号 。 在 与 帐号 持有人 取得联系 后 ， 管理员 便 可以 根据 日志 文件 的 具体内容 ， 如 攻击点 的 确切 位置 、 攻击 时间 等 ， 采取相应 措施 ， 如 更改 帐号 口令 、 封锁 工作站 等 ， 以 确保 系统 的 安全性 。 
 　 　 ② 单 帐号 多用户 检查 
 　 　 在 同一 时段 ， 如 有 若干个 以 同一 帐号 登录 系统 的 用户 出现 ， 则 说明 某一 帐号 可能 已 被 泄露 ， 这 在 一定 程度 上将 对 系统安全 构成威胁 。 为此 系统 将 自动 监视 、 统计 这种 情况 ， 并 及时 通知 系统管理员 ， 以 杜绝 帐号 扩散 的 可能 ， 防患于未然 。 
 　 　 ③ 非 工作 时间 操作 检查 
 　 　 对于 8 小时 工作 时间 之外 的 任何 操作 或是 被 管理员 定义 成非 工作 时所 执行 的 任何 操作 ， 智能型 日志 也 会 视之为 可疑 现象 而 警告 系统管理员 。 
 　 　 ④ 完善 的 备份 及 恢复 机制 
 　 　 日志 虽能 记录 任何 的 非法操作 ， 然而 要 真正 使 系统 从 灾难 中 恢复 出来 ， 还 需要 1 套 完善 的 备   份 及 恢复 机制 。 
 　 　 为了 防止 存储设备 的 异常 损坏 ， 采用 了 可 热插拔 的 SCSI 硬盘 所 组成 的 磁盘 容错 阵列 ， 以 RAID   1 的 镜像 方式 进行 系统 的 实时 热 备份 。 
 　 　 为了 防止 人为 的 失误 或 破坏 ， 还 建立 了 强大 的 数据库 触发器 以 备份 重要 数据 的 删除 操作 ， 甚   至 更新 操作 ， 保证 在 任何 情况 下 ， 重要 数据 均 能 有效 地 得以 恢复 。 具体 而言 ， 对于 删除 操作   ， 我们 将 被 操作 的 记录 全部 存储 在 备份 库中 。 而 对于 更新 操作 ， 考虑 到 信息量 过于 庞大 ，   仅仅 备份 了 所 执行 的 SQL 语句 。 这样 ， 既 能 查看 到 被 更新 的 内容 ， 又 能 相当程度 地 减小 备份   库 的 存储容量 。 
 　 　 而 在 需要 跟踪 、 追溯 数据 丢失 或 破坏 事件 的 全部 信息 时 ， 则 将 系统日志 与 备份 数据 有机 地结   合在一起 ， 真正 实现 系统安全 的 “ 万无一失 ” 。 
 3.2 　 外部 系统安全 ( B / S 系统 的 安全 ) 
 　 　 由于 本 系统 是 C / S 和 B / S 的 结合 。 因此 ， 除了 在 C / S 内部 系统 上 设置 了 各种 安全 屏障 外 ， 在 B / S   上 也 应当 进行 相应 的 安全 防范措施 。 
 　 　 为了 防止 应用 系统 遭受 外部 攻击 ， 设置 了 Proxy   Server ， 以 提供 代理服务器 及 防火墙 的 功能   。 此外 ， 考虑 到 使用 网上 服务 系统 的 互联网 用户 在 身份 认证 、 数据传输 时 的 安全 问题 ， 我们   运用 了 “ 一次性 身份 认证 ” 的 概念 ， 自行 开发 了 1 套 广域网 身份 认证 系统 。 其 基本 构架 如下   ： 由 Oracle 数据库 服务器 产生 随机数 ； 再 由 客户端 Java 用 随机数 对 用户 PIN 进行 加密 运算 ；   最后 再 将 加密 后 的 PIN 及 随机数 作为 参数传递 给 Oracle 数据库 中 负责 身份验证 的 存储 过程 进   行 校验 。 这样 ， 用户 认证 信息 无论 在 内部网 ， 还是 在 外部 网上 都 是 以 密文 的 形式 存在 ， 而且   具有 1 次性 的 特点 ， 具有 极高 的 安全性 。 
 　 　 在 系统 的 二期工程 中 ， 我们 将 进一步 增强 B / S 结构 的 安全性 ， 设立 系统 认证 中心 ， 由 其 产生   并 分发 传输 密钥 和 数字证书 ， 以 实现 数据 的 加密 存储 、 加密传输 与 数字签名 技术 ， 防止 邮件   、 医疗 信息 等 被 篡改 或 伪造 。 
 　 　 同舟 生命 卡 网上 服务 系统 ， 是 集结 了 目前 最 流行 的 C / S 及 B / S 体系结构 ， 并 利用 了 国内外 最先   进 的 技术 和 产品 所 建立 起来 的 信息 服务 应用 。 随着 用户 在 系统 实际 应用 中 需求 的 不断 提高 ，   如何 提供 更为 完善 和 安全 的 网上 服务 ， 将 是 我们 开发者 不懈 追求 的 目标 。   
 作者 单位 : 上海 同济大学 计算中心 ( 200092 ) 
 参考文献 
 　 1 　 Tanenbaum   A   S . Computer   Networks ( Third   Edition ) . Prent   ice - Hall   International , Inc . , 1997 
 　 2 　 Strom   D . Creating   Private   Intranets : Challenges   and   Prospects   for   IS . http   : 　 　 　 / / www . strom . com / pubwork / intranetp . html , 1995 
 　 3 　 北方交通大学 自动化 系统 研究所 . Oracle   7 使用 技巧 . 北京 ： 科学出版社 ， 1996 
 　 4 　 刘清玉 . 计算机网络 规划设计 及 实施方案 . 计算机 与 通信 ， 1998 ； ( 3 ) 
 ( 收稿 日期 ： 1998 - 09 - 28 ) 
