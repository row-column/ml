计算机 工程 
 COMPUTER   ENGINEERING 
 1999 年   第 25 卷   第 8 期   Vol.25   No.8   1999 
 
 
 
 肺癌 早期 诊断系统 中 形态学 识别 的 研究 与 实现 
 冒宇清 ， 李宁 ， 陆新泉 ， 陈世福 ， 叶玉坤 ， 汪栋 
 摘要 ： 讨论 了 通过 利用 细胞 图象 中 的 形态学 信息 对 肺癌 细胞 进行 识别 和 检测 的 方法 。 该 方法 采用 基于 区域 边界 的 链码 方法 提取 形态学 特征 ， 再 根据 形态学 识别 算法 ， 对 细胞 自动 进行 分类 ， 从而 识别 出 图象 中 的 肺癌 细胞 。 
 关键词 ： 形态学 ； 链码 ； 特征向量 ； 分类 
 The   Pesearching   and   Implementation   of   Morphological   Recognition   in   the   System   of   Diagnosing   the   Early   Stage   Lung   Cancers 
 Mao   Yuqing , Li   Ning , Lu   Xinquan , Chen   Shifu , Wang   Dong 
 ( State   Key   Laboratory   for   Novel   Software   Technology , Nanjing   University , Nanjing   210093 ; 
 Bayi   Hospital , PLA , Nanjing   210002 ) 
 【 Abstract 】 This   paper   discusses   a   method   of   recogniaing   the   lung   cancer   cells   by   utilizing   the   information   in   the   Cytological   image . This   method   uses   the   chain   code   based   on   the   edge   of   the   region   to   extract   the   morphological   feature . Then   the   cells   are   classified   automatically   according   to   the   arithmetic   of   morphological   recognition ,   so   that   all   cancer   cells   in   the   image   can   be   recognized . 
 【 Key   words 】 Morphological   reconition ;   Chain   code ; Feature   vector ; Classification 
 　 　 南京大学 与 八一 医院 联合 研制 了 肺癌 早期 诊断系统 。 该 系统 通过 一系列 的 图象处理 和 识别 过程 ， 能 判断 肺癌 穿刺 标本 的 彩色 显微图 象中 是否 存在 癌细胞 ， 识别 诊断 出 患者 是否 有 肺癌 。 为了 提高 识别 肺癌 细胞 的 准确性 ， 系统 采用 了 形态学 特征 与 色度学 特征 并举 的 多层次 处理 结构 ； 同时 ， 在 系统 中 还 运用 了 专家系统 和 神经网络 技术 进行 识别 和 判断 。 该 系统 经 试用 ， 已 实现 了 肺癌 细胞 的 自动识别 和 分类 ， 同时 还 有效 地 弥补 了 人工 识别 的 缺陷 和 不足 ， 提高 了 识别 的 准确性 和 效率 。   
 1   系统 概况   
 1.1   系统 硬件 配置 
 　 　 系统 的 硬件 配置 如图   1   所示 ， 主要 有 显微镜 、 摄影机 、 图象 采集卡 和 计算机系统 等 。   
 
 图   1   系统 硬件 配置   
 　 　 彩色 摄影机 与 显微镜 观察 平台 相连接 ， 它 实时 地 获取 肺癌 穿刺 标本 涂片 的 视频信号 ， 该 信号 经 图象 采集卡 处理 后 转化 为   RGB   真 彩图 象 ， 供 计算机系统 进行 处理 。 系统 所 使用 的 涂片 均 采用   HE   染色法 进行 染色 处理 。   
 1.2   系统 处理 流程   
 　 　 系统 的 处理 流程 如 以下   ( 1 ) - ( 7 )   顺序 ， 并 对 各 模块 的 功能 作 简要 叙述 。 
 　 　 ( 1 )   初始化 模块   定义 系统 中 使用 的 各种 数据结构   ,   对 所有 全局变量 进行 说明   ,   并 分配 图象 存储 区 等 。   
 　 　 ( 2 )   图象 获取 模块   通过 图象 采集   ,   得到 一幅 优质 的 细胞 图象 。   
 　 　 ( 3 )   图象 预处理 模块   对 原始 图象 进行 去 噪 、 平滑 和 锐化 等 一系列 的 预处理 ， 提高 图象 的 质量 ， 并 清除 显微图 象中 的 过滤 效应 和 电子光学 中 的 “ 假象 ” 问题 。   
 　 　 ( 4 )   图象 分割 模块   主要 功能 是 将 细胞 逐一 从 背景 中 分离出来 。 通过 双重 自 适应 阈值 选取 算法 ， 求 出 一幅 标示 细胞 所在位置 和 形状 的 二值 图象 ， 再 经 多次 筛选 后 ， 得到 感兴趣 的 区域 。   
 　 　 ( 5 )   形态学 识别 模块   对 划分 出来 的 区域   ,   利用 形态学 的 有关 特征 对 其 进行 再 识别   ,   标示出 可疑 区域 。   
 　 　 ( 6 )   色度学 识别 模块   对 可疑 区域   ,   利用 色度学 技术 对 其 相关 的 色度 特征 进行 分析判断   ,   标示出 有 癌细胞 的 区域 。   
 　 　 ( 7 )   专家系统   ( ES )   和 神经 网络系统   ( NNS )   主要 是 进一步 完成 检测 、 分类 和 判决 等 工作 。 根据上述 模块 得出 的 各种 特征参数 以及 经过 人机交互 输入 的 现象 和 特征 ， 经 专家系统 和 神经网络 算法 处理 后 ， 得出 最终 的 分析 结果 ， 并 硬拷贝 输出 。   
 　 　 以上 介绍 了 系统 中 各 模块 的 主要 功能 。 为了 保证系统 的 正确 运行 和 分析 结果 的 准确性 ， 在 系统 的 若干 模块 中 还 设计 了 人机交互 功能 。 使用者 可以 通过 数字化仪 、 键盘 或 光笔 监控 系统对 误差 进行 校对 ， 以 弥补 算法 上 的 某些 不足 并 充分发挥 技术人员 的 作用 ， 从而 提高 系统 的 性能 和 准确率 。   
 2   形态学 识别 与 判断   
 　 　 一个 完整 的 识别 过程 由 模式 采集 、 特征提取   /   选择 和 分类 判决 组成 ， 如图   2   所示 。   
 
 图   2   识别 过程 方框图   
 　 　 在 本 系统 中 ， 图象 获取 模块 采集 到 的 是 彩色 细胞 图象 。 在 进行 形态学 识别 时 ， 由于 只 关心 它们 的 形状 特征 ， 其 色度 信息 让位 为 次要 地位 ， 因此 首先 将 彩色 图象 转化 为二值化 图象 ， 使 目标 与 背景 区分 开来 。 通常 对 目标 进行 形状 分析 ， 提取 形态 特征 有   3   种 方法 ： 基于 区域 本身 、 基于 区域 的 边界 以及 基于 区域 的 骨架 。 为了 提高 系统 的 处理速度 ， 我们 采用 了 基于 区域 边界 的 链码 表示 来 提取 形态 特征 ， 这种 链码 表示 既 有利于 有关 形态 特征 的 计算 ， 也 有利于 节省 存储空间 。 在 进行 分类 判断 时 ， 我们 采用 了 最小 距离 分类器   ( MDC ) ,   并且 在 学习 阶段 ， 通过 训练 求出 聚类 中心 。 下面 分别 介绍 我们 采用 的 链码 技术 、 分类器 和 形态学 识别 算法 。   
 2.1   链码   
 　 　 对于 显微图 象中 的 象点 而言   ,   均 有   8   个 方向 的 邻域   ,   如图   3   所示 。 对 每种 方向 赋以 一种 代码 表示   ,   如图   3 ( a )   中   8   个 方向 分别 对应   0 , 1 , 2 , 3 , 4 , 5 , 6 , 7 ,   这些 代码 称为 方向 码 。 一条 曲线 最终 可以 由下式 表示 ：   
 An =   α 1 α 2 … α n ， α i ∈ { 0 , 1 , 2 ,   …   , 7 }   ， i = 1 , 　 　 ( 1 )   
 　 　 An 称为 曲线 的 链码 。 如图   4 ( b )   中 曲线 的 链码 为   : A = 1 , 0 , 1 , 0 , 1 , 2 , 2 , 4 , 3 , 4   。 设 分辨 单元 边长 为   1 ,   那么 链 的 每 一码 段 的 长度 是   1 (   当   i =   偶数   )   或 (   当   i =   奇数   )   。   
 
 图   3   八链 码 原理图   
 　 　 从 链码 可以 得到 一系列 的 细胞 的 几何 形状 特征 ， 其 周长 、 面积 、 宽度 和 高度 等 所 采用 的 计算公式 如下 : 
 　 　 ( 1 )   链码 所围 细胞 区域 的 周长 ， 即链 的 长度   
 
 　 　 其中   ne 表示 链码 中偶 数码 的 数目 ，   no 表示 链码 中奇 数码 的 数目 。   
 　 　 ( 2 )   细胞 区域 的 宽度 和 高度   
 　 　 定义 ai 在 X 轴上 的 分量 为 aix ， 在 X 轴上 的 分量 为 aiy ， aix 与 aiy 的 取值 如表 1 所示 ：   
 表   1   aix   与   aiy   的 取值   
 ajaixaiy 
 010 
 111 
 201 
 3 - 11 
 4 - 10 
 5 - 1 - 1 
 60 - 1 
 71 - 1 
 
 　 　 设   x0   与   y0   是 起始 点 的 坐标 ， 则 
 　 　 宽度   
 　 　 高度   
 　 　 ( 3 )   细胞 区域 的 面积   
   ( 1 )   其中 ，   yi   = yi - 1   + aiy 
 　 　 ( 4 )   细胞 区域 的 圆度 　 　 ( 2 )   
 　 　 圆度 用于 描述 细胞 区域 与 圆形 的 偏离 程度 。 在 相同 面积 的 条件 下 ， 细胞 区域 边界 光滑 且 为 圆形 ， 则 周长 最短 ， 其圆度 为   C = 1   。 细胞 区域 的 形状 越 偏离 圆形 ， 则   C   值越 小 。   
 　 　 ( 5 )   细胞 区域 的 矩形 度   
 　 　 ( 3 )   
 　 　 矩形 度 用于 描述 细胞 区域 与 矩形 的 偏离 程度 ， 当 细胞 区域 为 矩形 时 ，   R   取 最大值   1   。   
 　 　 ( 6 )   细胞 区域 的 伸 长度   
 　 　 ( 4 )   
 　 　 细胞 区域 越 呈 细长 形 ， E 越小 ， 当 细胞 区域 为 圆形 时 ，   E = 1   。   
 2.2   分类器   
 　 　 假定   n   维 特征 空间 中有 两个 模式 向量   x   和   y   分别 为 ：   
 　 　 x = ( x1   , x2   ,   …   , xn   ) T   , y = ( y1   , y2   ,   …   , yn   ) T 
 　 　 x   与   y   之间 的 距离 定义 为 ：   
   　 　 ( 5 )   
 　 　 显然 ， 若   x   和   y   位于 同一个 类型 区域 里 ， 距离   D ( X , Y )   较 小 ， 距离 的 远近 反映 了 模式 向量 所属 类型 有无 差异 ， 最小 距离 分类器 就是 根据 这一 性质 进行 分类 的 。   
 　 　 为了 有效 地 分类 ， 希望 类间 距离 大而类 内 距离 小 ， 所 选择 的 特征 应 尽可能 满足 这样 的 要求 。 在 本 系统 中 ， 选取 的 形态学 特征 为 ： 面积   S   、 圆度   C   、 矩形 度   R   和 伸 长度   E   ， 在 四维 特征 空间 进行 分类 。 特征 的 选择 是 基于 癌细胞 与 正常 细胞 形态 上 的 主要 差异 ， 即 ：   ( 1 )   癌细胞 核比 正常 细胞 大 ， 一倍 至 三四倍 不 等 ；   ( 2 )   癌细胞 核 异型 明显 ， 正常 细胞 的 细胞核 一般 呈圆形 或 卵圆形   ,   而 癌细胞 的 细胞核 则 还 会 出现 各种 不规则 型 或 分 叶状 等 。   
 　 　 由   ( 5 )   式 可见 ， 每个 特征 在   D ( X , Y )   中 的 权重 与其 数量级 有关 ， 由于 圆度   C   、 矩形 度   R   和 伸 长度   E   都 在 区间   ( 0   ，   1 ]   中 取值 ， 为了 使 面积   S   对 距离 的 影响 与   C   、   R   、   E   相当 ， 用   A = S / S0   取代   S   ， 其中   S0   为 通过 实验所 获得 的 癌细胞 面积 最大 极限值 。 另一方面 ， 通过   S0   与 癌细胞 圆度 最小 极限值   C0   相结合 ， 可以 排除 细胞 图象 中 的 杂质 和 无法 分割 的 聚堆 细胞 ， 使 特征向量 能够 收敛 于 聚类 中心 。   
 　 　 在 学习 阶段 ， 通过 对 大量 训练样本 进行 统计分析 ， 针对 肺癌 的   3   种 类型 ： 鳞癌 、 腺癌 、 小 细胞 未 分化 癌 ， 分别 确定   3   种 肺癌 细胞 的 聚类 中心   M1   = ( A1   , C1   , R1   , E1   ) , M2   = ( A2   , C2   , R2   , E2   )   ，   M3   = ( A3   , C3   , R3   , E3   )   ， 及 非 癌细胞 的 聚类 中心 M ' = ( A ' , C ' , R ' , E ' )   ； 在 判断 阶段 ， 分类器 根据 通过 计算 目标 区域 的 特征向量   T   与 聚类 中心   M1   、   M2   、   M3   和   M '   的 距离 ， 判断 该 区域 是 癌细胞 还 是非 癌细胞 。   
 　 　 为了 提高 系统 的 自 适应能力 ， 在 处理 完 一定量 的 穿刺 涂片 后 ， 系统 可以 通过 人机交互 ， 针对 可能 出现 的 误 分类 ， 进行 误差 校对 ， 对 聚类 中心 进行 修正 ， 从而 提高 识别 的 精度 。   
 2.3   形态学 识别 算法   
 　 　 所 采集 的 彩色 细胞 图象 经过 预处理 之后 ， 根据 如下 算法 进行 特征提取 和 识别 分类 。   
 　 　 ( 1 )   对 图象 中 的 每个 象素   Pi   计算 其 灰度 值   Hi   ， 根据 灰度 直方图 统计 自动 选取 分割 阈值   Hth   。   
 　 　 ( 2 )   对于 每个 象素   Pi   ， 其   Hi   的 取值 ：   
 
 　 　 ( 3 )   对二值化 图象 进行 扫描 ， 以 边界 上 的 点 作为 起始 点 ， 按照 图   3 ( a )   的 次序 搜索 ： 先 向   “ 0 ”   方向 搜索 邻点 ， 如果 遇到 目标 象素 ， 则 标记 为 链码 上 的 点 ， 否则 向   “ 1 ”   方向 搜索 ， 如此 不断 向前 搜索 ， 直至 回到 起始 点 为止 ， 这样 得到 图象 中 每个 目标 区域 的 链码 表示 。   
 　 　 ( 4 )   对于 每个 目标 区域   X   ， 根据 其 链码 表示 由   ( 1 )   ～   ( 4 )   式 求取 其 特征值 ， 得到 特征向量   T = ( A , C , R , E )   ； 若 ： X   满足   S > S0   或   C < C0   ( S0   、 C0 分别 为 癌细胞 面积 和 圆度 极限值 ) ， 则 该 区域 标记 为 非 癌细胞 区域 ， 算法 结束 ， 否则 ：   
 　 　 ( 5 )   对 每个 目标 区域   X ,   分别 计算 T 与 聚类 中心   M1   、 M2 、 M3   和   M '   的 距离   D1 、 D2 、 D3 、 D ' ， 若 ：   D ' < min { D1 , D2 , D3 } ， 则 该 区域 标记 为 非 癌细胞 区域 ， 否则 标记 为 可疑 的 癌细胞 区域 。 
 　 　 由该 算法 可以 识别 出 绝大多数 癌细胞 ， 对于 标记 为 可疑 癌细胞 的 区域 ， 再 经过 下 一步 色度学 识别 ， 得出 系统 的 初步 诊断 结果 。 该 结果 包括 癌细胞 个数 、 位置 以及 相关 特征 量值 等 信息 。 根据 这些 参数 以及 人机交互 输入 的 参数 ， 再 由 肺癌 病理 专家系统 和 神经网络 识别系统 进行 最终 的 判断 和 分类 ， 可 使 整个 系统 识别 癌细胞 的 正确率 达到   95%   以上 。   
 3   结束语 
 　 　 在 医学 图象识别 系统 中 ， 往往 由于 对 识别 目标 缺乏 全面 清晰 的 描述 而 使得 识别 工作 效果 很差 。 在 本 系统 中 ， 我们 采用 图象处理 、 模式识别 以及 人工智能 等 技术 对 肺癌 细胞 进行 了 全面 、 多层次 的 基于 特征 量 的 描述 ， 从而 较 好 地 克服 了 这 一 难题 。 其中 ， 在 形态学 识别 部分 ， 通过 合理 地 选择 特征向量 ， 并且 采用 链码 方法 提取 形态 特征 ， 提高 了 系统 的 运行 效率 ； 最小 距离 分类法 的 应用 使 分类 识别 有 了 客观 定量 尺度 ， 大量 的 实验 分析 和 学习 过程 以及 在 专家 指导 下 的 再 学习 功能 ， 使 系统 的 诊断 更为 科学 ， 识别 准确性 得到 进一步提高 。   
 　 　 本 系统 在   Windows   95   环境 下用   V C++   语言 编程 实现 。 试运行 结果表明 ， 特征 的 提取 和 识别 技术 的 应用 是 成功 的 。 本 系统 已 于   1998   年   5   月 顺利 通过 了 国家 “ 九五 ” 攻关 课题 中期 考核 ， 并 经 中国人民解放军 八一 医院 试用 ， 运行 效果 很 好 。   
 作者 单位 ： 南京大学 软件 新 技术 国家 重点 实验室 ， 南京   210093 ； 
 　 　 　 　 　 中国人民解放军 八一 医院 ， 南京   210002 
 参考文献 
 1   徐 建华   .   图象处理 与 分析   .   北京 ： 科学出版社   , 1992   
 2   夏德深   ,   傅德胜   .   现代 图象处理 技术 与 应用   .   南京 ： 东南大学 出版社   ,   1997   
 3   Zhou   P , Pycock   D . Robust   Statistical   Models   for   Cell   Image   Interpretation . Image   and   Vision   Computing , 1997 ( 15 )   ：   307   
