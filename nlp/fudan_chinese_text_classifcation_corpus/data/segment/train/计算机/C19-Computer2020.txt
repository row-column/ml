微型机 与 应用 
 MICROCOMPUTER   &   ITS   APPLICATIONS 
 1999 年   第 18 卷   第 4 期   Vol.18   No.4   1999 
 
 
 
 基于 PIC 单片机 的 温度 湿度 控制系统 的 设计 
 陆 　 英 
 　 　 摘 　 要 ： 用 PIC16C73 单片机 实现 的 4 路 温度 、 湿度 控制系统 ， 包括 系统 硬件 和 软件设计 ， 给出 了 详细 的 电路 原理图 。 
 　 　 关键词 ： PIC 单片机 　 温度 湿度 控制 　 A / D 转换 　 串行接口 
 　 　 温度 、 湿度 控制 在 工农业 生产 中 应用 很多 。 对于 一个 比较 大 的 系统 ， 人们 往往 采用 微机 进行 控制 ， 小 一些 的 系统 较 多 采用 51 或 96 等 系列 的 单片机 。 然而 ， 不管 是 用 哪 一种 ， 总 要 对系统 进行 扩展 ： 扩展 程序 存储器 、 扩展 并行口 做 键盘 ， 还要 有 A / D 转换 ， 如果 数据 较 多 的话 ， 还 必须 扩展 数据 存储器 等 。 这 对 许多 控制器 来讲 ， 成本 太高 ， 系统资源 没有 得到 充分利用 。 为此 ， 我们 利用 PIC16C73 型 单片机 设计 了 1 个 4 路 温度 、 湿度 控制系统 。 
 1 　 PIC16C73 单片机 简介 
 　 　 PIC16C73 单片机 是 由 美国 Microchip 公司 生产 的 8 位 单片微 机 ， 采用 Harvard 结构 ， 这种 结构 使 指令 执行 和 取指 操作 重叠 进行 ， 因而 可以 达到 很 高 的 执行 速度 。 它 只有 35 条 单字节 指令 ， 且 除了 跳转 指令 是 2 周期 外 ， 其它 指令 都 是 单 周期 指令 。 这些 特点 使 它 相对 于 别的 8 位 单片机 节省 了 1 / 2 的 程序 空间 ， 并 具有 4 : 1 的 速度 优势 。 
 　 　 PIC16C73 在 1 个 芯片 上 集成 了 1 个 8 位 算术 逻辑 单元 和 工作 寄存器 ， 4KB 程序 存储器 ， 192 个 数据 寄存器 ， 22 个 I / O 口 ， 3 个 定时 / 计数器 及 2 个 捕捉 / 比较 / PWM 模块 ， 2 个 串行口 ， A / D 转换器 具有 5 路 模拟量 输入 端 ， 还有 时钟 、 复位 、 看门狗 定时器 等 。 其中 5 路 模拟量 输入 通道 共同 复用 1 个 采样 / 保持 和 A / D 转换器 。 管脚 分配 如图 1 ， 其中 标了 2 种 以上 功能 的 是 复用 端口 。 
 
 
 2 　 控制系统 的 硬件 设计 
 　 　 控制系统 原理图 如图 2 所示 。 
 
 
 图 2 　 控制系统 原理图 
 2 ． 1 　 硬件 构成 原理 
 　 　 以 PIC16C73 单片机 为 运算 和 控制中心 ， 扩展 1 片 E2PROM 作为 数据 寄存器 IC2 ， 使 数据 在 掉电 后 不 丢失 ， IC3 为 8 位 串行 输入 并行 输出 移位 寄存器 ， IC4 为 8 位 数据 锁 存器 。 
 　 　 单片机 PIC16C73 的 RA0 ～ RA3 为 4 路 模拟量 输入 端 ， RB0 ～ RB7 构成 4 × 4 键盘 及 显示器 数码管 的 位选 ， RC6 用于 8 位段 码 输出 ， RC3 、 RC4 用于 与 E2PROM 接口 ， RC0 ～ RC2 、 RC5 是 4 路 开关 量 输出 ， RC7 用于 报警 。 
 2 ． 2 　 测温 、 测湿 电路 
 　 　 采用 玻璃封装 的 开关 二极管 1N4148 作 温度传感器 ， 电路 如图 3 。 R1 、 R2 、 D1 （ 1N4148 ） 、 W1 组成 测量 电桥 ， 其 输出 信号 接 差动 放大器 A1 ， 经 放大 后 的 信号 送 A / D 转换 。 电路 的 调整 过程 是 ： 以 冰水 混合物 作为 0 ℃ 的 标准 ， 以 沸水 作为 100 ℃ 的 标准 （ 用 0 ～ 100 ℃ 的 水银 温度计 校准 ） 。 将 传感器 插入 冰水 中 ， 调 W1 使 A1 输出 电压 为 0V ， 将 传感器 插入 沸水 中 ， 调 W2 使 A1 输出 电压 为 设计 值 （ 如 2.5 V ） ， 再 将 传感器 插入 冰水 中 ， 看 输出 是否 仍为 0V ， 若 不是 ， 则 调整 W1 使 之 为 0V ， 然后 再 插入 沸水 中 ， 看 输出 是否 为 2.5 V ， 如此 反复 调整 几次 即可 。 
 
 
 图 3 　 温度 变送 电路 
 　 　 湿度 传感器 采用 电容式 湿敏 元件 ， 变送 电路 如图 4 。 
 
 
 图 4 　 湿度 变送 电路 
 2 ． 3 　 扩展 E2PROM 
 　 　 PIC16C73 内部 具有 同步 串行口 （ SSP ） 模块 ， 用于 与 其它 外设 或 微处理器 通信 的 接口 ， 具有 SPI 总线 和 I2C 总线 2 种 操作 方式 。 这里 选用 I2C 总线 工作 方式 与 E2PROM 通信 。 PIC16C73 有 2 个 脚 可 用作 数据传输 。 RC3 用作 时钟 信号 ， RC4 用作 数据信号 ， 见图 2 。 
 2 ． 4 　 控制系统 的 功能 
 　 　 1 ． 控制键 的 设置 。 控制系统 设有 16 个键 ： 0 ～ 9 为 10 个 数字键 ； A 键 显示 各 通道 测量 值 ； B 键 显示 、 设定 各 通道 上 限值 ； C 键 显示 、 设定 各 通道 下 限值 ； D 键为 通道 号加 1 功能键 ； E 为 显示 、 查看 、 修改 结束 键 ； F 键为 小数点 。 
 　 　 2 ． 实测值 的 显示 。 控制器 平时 只 显示 0 号 通道 的 温度 测量 值 ， 当 工作人员 需要 查看 其它 通道 测量 值时 ， 按下 A 键 ， 再 按 通道 号 即可 。 若 继续 查看 下 一 通道 ， 就 按 D 键 ， 查看 完后 按 E 键 返回 。 
 　 　 3 ． 上 、 下 限值 的 设定 。 按下 B （ C ） 键 ， 再 按 通道 号 ， 显示 该 通道 的 上 （ 下 ） 限值 ， 此时 若 按 数字键 即 认为 是 修改 设定值 ； 按下 D 键 进行 下 一 通道 的 显示 和 设定 ， 过程 同 上 ； 按 E 键 返回 。 设定值 和 实测值 存入 E2PROM 。 
 3 　 控制系统 的 软件设计 
 3 ． 1 　 主程序 流程图 
 　 　 由于 篇幅 限制 ， 主程序 只 给出 图 5 所示 的 流程图 。 
 
 
 
 3 ． 2 　 A / D 转换 
 　 　 由于 PIC16C73 单片机 内含 A / D 转换器 ， 因此 模拟 参考 电压 可 由 软件 设置 为 器件 的 正 电源 电压 或 RA3 引脚 的 电压 ， 这里 采用 电源 电压 作为 参考 电压 。 A / D 模块 有 3 个 寄存器 ： A / D 转换 结果 寄存器 （ ADRES ） ， A / D 控制 寄存器 0 （ ADCON0 ） 和 A / D 控制 寄存器 1 （ ADCON1 ） 。 
 　 　 A / D 控制 寄存器 0 （ ADCON0 ） ： 控制 A / D 模块 的 工作 ， 寄存器 的 上 电 复位 值 是 00H ， 未用位 执行 读 操作 时为 0 ， 不能 执行 写 操作 ， 其他 位均 可 读写 。 
 　 　 A / D 控制 寄存器 1 （ ADCON1 ） ： 只用 了 0 ～ 2 位 ， 这 3 位是 A / D 转换 口 配置 位 ， 这些 位 将 模拟 口 配置 成 不同 的 工作 方式 ， 包括 模拟量 输入输出 、 数字 量 输入输出 以及 参考 电压 （ RA3 ） 。 
 　 　 以 RA0 通道 为例 ， 可 写出 A / D 转换 程序 如下 ： 
 　 　 BSF 　 　 　 STATUS ， RP0 　 　 ； 选择 页面 1 
 　 　 CLRFADCON1 ； 配置 A / D 输入 
 　 　 BSFPIE1 ， ADIE ； 使能 A / D 中断 
 　 　 BCFSTATUS ， RP0 ； 选择 页面 0 
 　 　 MOVLW0XC1 ； 时钟 、 A / D 接通 
 　 　 MOVWFADCON0 ； 
 　 　 BCFPIR1 ， ADIF ； 清除 A / D 中断 标志 
 　 　 BCFINTCON ， PEIE ； 使能 外围 功能 
 　 　 BCFINCON ， GIE ； 使能 所有 中断   
 4 　 结束语 
 　 　 本 系统 是 为 种植 与 养禽 两用 大棚 而 设计 的 ， 能 控制 3 路 温度 和 1 路 湿度 。 其中 ， 1 路 控制 孵化机 的 温度 ， 1 路 控制 出稚机 的 温度 ， 另 2 路 用于 大棚 的 温度 和 湿度 控制 。 控制 温度 为 0 ～ 100 ℃ ， 精度 为 ± 1 ℃ ； 控制 湿度 为 5 ％ ～ 95 ％ RH 。 完全 能够 满足 生产 要求 。 
 作者 单位 ； 广东 韶关 大学 机电 系 （ 512003 ） 
 参考文献 
 　 1 　 方佩敏 . 新编 传感器 原理 、 应用 、 电路 详解 . 北京 ： 电子 工业 出版社 ， 1994 
 收稿 日期 ： 1998 - 10 - 24 
