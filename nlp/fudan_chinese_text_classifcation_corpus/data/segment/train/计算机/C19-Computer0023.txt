计算机 应用 
 COMPUTER   APPLICATIONS 
 1999 年   第 19 卷   第 6 期   Vol.19   No.6   1999 
 
 
 
 PowerBuilder5.0   安装盘 制作 的 关键技术 
 石建勋 　 杜戈 　 孙景琪 
 　 　 摘 　 要 　 本文 在 介绍 利用 Install   Builder 制作 PowerBuilder 安装盘 过程 的 基础 上 ， 着重 阐述 了 制作 安装盘 中 配置 ODBC 、 注册 、 生成 可 重复使用 部件 等 关键技术 。 
 　 　 关键词 　 安装盘 ， ODBC ， 注册 ， 可 重复使用 部件 
 1 　 引言 
 　 　 PowerBuilder 是 PowerSoft 公司 推出 的 数据库 应用 系统 的 开发工具 。 由于 它 基于 客户 / 服务器 体系结构 ， 集成 强大 并 易于 使用 的 第四代 编程语言 （ 4GL ） ， 具有 面向对象 的 应用 程序开发 方法 以及 可视化 的 开发 环境 ， 适用 于 各种 不同 的 数据库 管理系统 ， 现已 成为 当今 最 流行 的 数据库 前端 开发工具 之一 。 
 　 　 我们 从 实际 应用 需要 出发 ， 结合 制作 安装盘 的 亲身 体会 , 讲述 PowerBuilder 安装盘 的 制作方法 与 关键技术 , 使 大家 对 PowerBuilder 在 制作 安装盘 方面 的 强大 功能 有 进一步 的 认识 ， 以 推广 Install   Builder 安装盘 制作 工具 和 PowerBuilder 开发工具 的 应用 。 同时 也 谈一谈 安装盘 英文 界面 的 汉化 技术 ， 帮 您 制作 具有 中文 界面 的 安装盘 。 
 2 　 安装盘 的 制作 过程 
 　 　 PowerBuilder 提供 了 专门 制作 安装盘 的 工具 Install   Builder . 它 的 界面 看起来 比较复杂 ， 选项 也 很 繁多 ， 但 只要 掌握 安装盘 的 制作 过程 和 必要 步骤 ， 还是 能够 简便 快捷 的 制作 出 应用程序 安装盘 的 。 
 
 
 3 　 生成 工程 文件 
 　 　 制作 安装盘 的 前提条件 是 : 将 应用程序 编译成 可执行文件 （ . exe ） 及 PowerBuilder 的 动态链接库 文件 （ . pbd ） 。 这 只 需要 在 PowerBuilder 应用 画笔 中 创建 工程 文件 （ . prj ） 即可 。 其 具体步骤 在 很多 PowerBuilder 的 工具书 中 都 有 详细 介绍 ， 这里 就 不再 赘述 ， 但 要 强调 一点 ： 为了 减少 程序代码 长度 ， 在 “ 代码生成 选项 ” （ Code   generation   options ） 中 ， 选择 “ 机器码 ” （ Machine   Code ） 。 
 4 　 生成 配置文件 （ . cfg ） 
 　 　 生成 工程 文件 后 ， 进入 安装盘 制作 工具 Install   Builder 的 集成 环境 中 ， 为 要 作 的 安装盘 建立 一个 配置 信息 文件 ( . cfg ) 。 这一 步骤 包含 的 内容 较 多 ， 涉及 安装盘 界面 设置 、 初始化 文件 设置 、 程序 注册 等 重要 操作 ， 是 制作 安装盘 的 关键所在 。 
 4.1 　 安装盘 界面 设置 
 　 　 点击 主 窗口 工具栏 中 New 按钮 ， 建立 一新 的 CFG 文件 。 在 弹出 的 子 窗口 中 , 设置 应用 程序运行 时 的 窗口 标题 、 安装程序 的 图标 、 安装程序 运行 时 的 背景 图案 、 文字 及 背景 的 颜色 、 要 安装 到 的 目标 操作系统 类型 （ 16 位 或 32 位 ） 等 项目 。 也 可以 缺省 不填 这些 项目 或者 稍后 在 主 菜单 中 Options 选项 中补 填 。 
 4.2 　 部件 及 属性 设置 
 　 　 在 主 窗口 的 工作 区中 填加 应用程序 的 主要 部件 （ component ） 以及 相应 的 子 部件 （ subcomponent ） （ 点击 工具栏 中 Add   Comp   和 Add   Sub 按钮 进行 操作 ） 。 一个 部件 包含 了 某 一 类型 文件 ， 如 ： 应用程序 文件 、 自定义 INI 文件 、 帮助文件 、 数据库 文件 、 系统 隐含 文件 等等 。 一个 部件 也 可以 细分 为 几个 子 部件 。 在 各 部件 下 的 Files 属性 （ 标签 页 的 第一项 ） 中 ， 利用 工具栏 中 Select   Files 按钮 ， 填加本 部件 所 需 的 文件 。 每个 部件 以及 相关 子 部件 共用 一个 安装 目标 路径 （ Default   Destination   Path ） , 即此 部件 下 的 文件 会 按 指定 的 路径 安装 到 目标 系统 中 。 
 　 　 其中 有 几个 缺省 路径 ， 含义 分别 是 ： 
 　 　 @ ( base ) — — 数据库 文件 所在 路径 
 　 　 @ ( windows ) — — windows 的 路径 
 　 　 @ ( system ) — — windows \ system 的 路径 
 　 　 @ ( componentname ) — — 已 定义 过 的 部件 所指 的 路径 。 
 　 　 若想 在 安装程序 时 ， 将 某 一 部件 的 路径 加 到 系统启动 批处理 文件 Autoexec . bat 中去 ， 选中 Add   to   Path 选项 ； 若想 将 本 部件 下 的 文件 隐含 ， 使 用户 不 可见 ， 则 选中 Hide   from   User 选项 ； 若想 在 安装盘 运行 时 ， 安装 不同 的 部件 显示 不同 的 背景 画面 （ PowerBuilder 的 安装 过程 就是 如此 ） ， 则 在 相应 部件 下 的 BillBoards 属性 中 （ 标签 页 的 最后 一项 ） 加入 希望 显示 的 位图 （ . bmp ） ; 若 部件 需要 使用 超过 8 位 的 长 路径名 ， 则 在 部件 的 Additional   Options 属性 中 设置 。 
 4.3 　 初始化 文件 设置 
 　 　 在 部件 下 的 INI   Setting 属性 中 ， 可以 为 应用程序 配置 诸如 ： 用户 ID 号 、 应用程序 版本号 、 缺省 打印机 、 windows 路径 等 信息 。 如果 数据库 使用 的 是 通过 ODBC ( 开放 数据库 接口 ) 连接 的 数据源 ， 则 还 需要 在 此 配置 ODBC 信息 （ 包括 ： 数据源 类型 、 ODBC 数据源 驱动程序 、 数据库 名 、 启动 程序 等等 ） 。 安装盘 制作 工具 Install   Builder 为此 提供 了 非常 简便 快捷 的 方法 ： 点击 工具栏 中 InI   Files 按钮 ， 从中 选中 你 使用 ODBC 作为 接口 得 数据源 ， 则 有关 此 数据源 的 ODBC 配置 信息 将 自动 拷贝到 部件 的 INI   Setting 属性 中 。 
 4.4 　 程序 及 数据库 注册 
 　 　 作为 一个 标准 的 windows 应用程序 ， 需要 将 本 应用程序 的 一些 信息 通知 windows 操作系统 ， 以便 系统管理 和 操作 。 这 就 涉及 到 windows 注册 （ registry ） 问题 。 尤其 对于 数据库 应用程序 ， 注册 程序 和 数据库 关系 到 能否 正确 连接 应用程序 与 数据库 。 因此 ， 注册 问题 是 关系 到 安装盘 制作 成败 的 关键技术 之一 。 应用程序 的 注册 信息 可以 手工 配置 ， 但 大多数 编程 者 对 注册 的 项目 、 格式 不是 很 熟悉 ， 而且 其 过程 也 很 繁琐 。 Install   Builder 工具包 同样 提供 了 简捷 的 注册 方法 ： 在 工具栏 中 点击 Registry 按钮 ， 从 ODBC 数据源 中 （ ODBC   Date   Sources ） 选取 HKEY — CURRENT — USER \ ODBC \ OD   BC . INI 中所 需 的 数据源 名 ， 按 确定 后 ， 有关 所 选 数据源 的 数据库 名 、 库 文件 、 驱动 文件 、 用户 ID 号 、 密码 、 启动 程序 等 一系列 信息 会 自动 填加 到 包含 数据库 文件 部件 下 的 Registry   Entries 属性 中 。 需要 注意 的 是 ， 仅仅 注册 自己 配置 的 数据源 是 不够 的 ， 若 使用 的 是非 ODBC 接口 的 数据库 ， 则 需 注册 此 类型 数据库 的 驱动 信息 。 选取 HKEY - — CURRENT — USER \ ODBC \ ODBC . INI 中此 类型 数据库 进行 数据库 驱动 注册 。 若 使用 的 是 通过 ODBC 连接 的 数据库 ， 除 注册 此 类型 数据库 驱动 之外 ， 还 需 注册 ODBC 数据源 （ ODBC   Data   Sources ） 的 驱动 信息 。 下面 举个 例子 ： 假设 用户 使用 了 PowerBuilder 自带 的 本地 数据库 Sybas   SQL   Anywhere   5.0 （ 这是 一种 通过 ODBC 连接 的 数据库 ） ， 并 创建 了 名为 example 的 数据库 。 在 注册 时 不仅 要 选择 HKEY — CURRENT — USER \ ODBC \ ODBC . INI 下 的 example 数据库 ， 还要 选择 Sybase   SQL   Anywhere   5.0   数据库 驱动 及 ODBC   Data   Sources   （ ODBC 数据源 ） 驱动 一同 注册 。 至此 ， 关于 应用程序 及 数据库 的 注册 操作 已 全部 完成 ， 在 程序安装 时 ， windows 会 根据 这些 注册 信息 正确 的 配置 应用程序 及 数据库 。 
 5 　 生成 压缩文件 及 制作 磁盘 
 　 　 从 安装盘 制作 工具 Install   Builder 的 主 窗口 菜单 上 找到 Actions 选项 ， 其下 共有 五个 操作 子 选项 ， 接下来 按照 这 五个 子 选项 依次 操作 。 
 5.1 　 定义 可 重复使用 部件 
 　 　 可 重复使用 部件 是 一些 经过 压缩 的 功能 独立 的 程序模块 。 这些 程序模块 通常 包含 PowerBuilder 环境 配置 、 接口 驱动 等 动态链接库 ， 可 被 所有 安装盘 配置文件 ( . cfg ） 共享 。 当 定义 并 压缩 可 重复使用 部件 后 ， 制作 其他 应用程序 安装盘 时 ， 就 无须 重新 定义 和 压缩 这些 可 重复使用 部件 ， 而 直接 从中 选取 应用程序 所 需 模块 即可 。 
 　 　 定义 可 重复使用 部件 的 过程 包括 文件 选择 、 初始化 文件 以及 程序 驱动 配置 等 ， 而此 过程 已 在 Install   Builder 当前目录 下 的 instbldr . ini 文件 中 设置 完毕 。 当 点击 Actions 中 Define   Reusable   Components 选项 时 ， Install   Builder 会 自动 按照 instbldr . ini 中 的 设置 ， 将 缺省 的 可 重复使用 的 各 部件 及 相关 文件 显示 到 新 打开 的 定义 可 重复使用 部件 的 窗口 界面 中 。 在 此 窗口 下 ， 可 根据 程序 需要 增减 部件 及 相关 文件 。 其 操作 类似 于 定义 部件 及子 部件 时 的 操作 。 有 经验 的 编程人员 还 可 直接 对 instbldr . ini 配置文件 进行 编辑 ， 效果 是 相同 的 。 定义 可 重复使用 部件 是 制作 安装盘 中 必要 的 也 是 关键 的 一个 步骤 。 为了 尽量减少 安装盘 自身 的 程序代码 长度 ， 以 方便 用户 安装 ， 应 精简 每 一个 部件 的 内容 ， 将 与 本 应用程序 无关 项 剔除 （ 建议 在 更改 可 重复使用 部件 内容 或 编辑 instbldr . ini 配置文件 之前 ， 应 备份 instbldr . ini 文件 ， 以备 后 用 ） 。 而且 ， 系统 缺省 配置 instbldr . ini 中 有些 部件 中 与 数据库 接口 的 动态链接库 文件 和 帮助文件 需要 其 相应 的 数据库 来 提供 ， 若 没有 将 这些 与 本 应用程序 无关 的 部件 及 文件 剔除 而 又 没有 相应 数据库 来 提供 这些 文件 ， 则 在 压缩 可 重复使用 部件 时 ， 会 出现 “ 无法 找到 指定 的 文件 ” 的 错误 ， 从而 导致 压缩 失败 ， 无法 继续 制作 安装盘 。 当 根据 自己 的 应用程序 精简 可 重复使用 部件 后 ， 点击 本 窗口 工具栏 中 compress 按钮 ， 将 所 包含 的 文件 进行 压缩 。 当 压缩 成功 后 ， 系统 回到 原来 的 主 窗口 界面 。 
 5.2 　 定义 程序 组 
 　 　 标准 的 windows 应用程序 都 有 自己 的 程序 组 ， 同一 程序 组下 包含 各个 应用 及 图标 。 下面 就 为 自己 的 应用 程序定义 程序 组 。 点击 主 菜单 Action 中 Define   Program   Group 选项 ， 在 弹出 的 子 窗口 中 ， 可 根据 提示 逐一 填写 ： 程序 组 名称 、 程序 组中 各 应用 的 名称 及 相应 路径 和 执行 文件 等 。 此外 ， 可以 在 Create   Uninstall   Icon 选项 旁 打勾 ， 即可 自动 生成 反 安装程序 （ 或 叫 卸载 程序 ） 。 
 5.3 　 读取 工程 文件 
 　 　 首先 选中 一个 部件 （ component ） , 然后 点击 主 菜单 Action 中 Read   Project   Object 选项 ， 在 弹出 的 子 窗口 中 的 应用 （ Application ） 中 选取 先前 已 生成 好 的 应用程序 的 工程 文件 ( . prj ) ， 则 构成 此 工程 文件 的 exe 、 pbd 、 dll 文件 会填 加到 所选 部件 的 Files 属性 中 。 
 5.4 　 生成 磁盘 映象 
 　 　 这 一步 将 生成 整个 安装盘 的 压缩文件 ， 并 临时 存放 在 本地 硬盘 中 。 此类 压缩文件 称为 磁盘 映象 。 点击 Action 中 Create   Diskette   Images 选项 。 在 弹出 的 子 窗口 中为 磁盘 映象 选择 一个 路径 。 窗口 中 罗列 出 已 压缩 过 的 可 重复使用 部件 ， 可 根据 需要 ， 选取 其中 有用 的 部件 。 安装盘 的 容量 大小 也 可 方便 选择 。 其中 Unlimited 选项 是 不限 磁盘 容量 大小 ， 这为 制作 光盘 安装盘 以及 程序 的 网络 安装 提供 了 方便 。 最后 按 Create 键 开始 生成 安装盘 的 磁盘 映象 。 
 5.5 　 制作 磁盘 
 　 　 磁盘 映象 生成 后 ， 可以 随时 将 磁盘 映象 拷贝到 磁盘 中 。 点取 Action 中 Create   Diskette 选项 ， 子 窗口 中 会 显示 出 拷贝 完整 的 一套 安装盘 所 需 的 磁盘 数 ( Number   of   disks   in   set ) 。 选择 好 拷贝 份数 及 驱动器 号 （ A : 或 B : ） , 确定 后 ， Install   Builder 将 磁盘 映象 拷贝到 磁盘 中 。 至此 ， 我们 成功 的 利用 Install   Builder 工具包 制作 出 了 PowerBuilder 应用程序 的 安装盘 。 
 6 　 安装盘 英文 界面 的 汉化 
 　 　 Install   Builder 是 制作 英文 界面 安装盘 的 工具包 。 对 广大 中国 用户 来说 ， 英文 界面 不够 友好 ， 也 不 直观 。 如能 在 已 做好 的 英文 界面 安装盘 的 基础 上 ， 将 安装盘 转换成 中文 界面 ， 会 更 方便 中国 用户 的 使用 。 这 就 涉及 到 安装盘 的 汉化 。 目前 常用 的 程序 汉化 技术 有 两种 ： 一种 是 首先 安装 并 运行 一个 汉化 平台 ， 提供 动态 的 汉化 环境 ， 再 运行 需 汉化 的 应用程序 ， 此时 可 动态 汉化 英文 界面 。 如 四通利方 、 东方快车 等 软件 ； 另 一种 汉化 软件 能 从 需 汉化 的 应用程序 中 提取 出 英文 词句 并用 汉字 代替 ， 汉化 过程 是 永久 的 ， 汉化 完毕 再 运行 程序 应用 时 ， 只要 在 中文 windows 平台 上 就 可 显示 出 中文 界面 。 
 7 　 结束语 
 　 　 随着 PowerBuilder 的 强大 功能 不断 被 人们 所 认识 ， 越来越 多 的 软件 开发人员 使用 PowerBuilder 来 完成 各种 数据库 前台 的 开发 工作 。 我们 希望 本文 对于 广大 开发人员 在 制作 PowerBuilder 程序 安装盘 方面 能 有所 启发 和 帮助 ， 以 更好 的 完成 开发 工作 。 
 作者简介 ： 石建勋 　 硕士 研究生 。 参与 某 大型 信息管理系统 的 数据库 策划 与 开发 工作 。 
 杜戈 　 硕士 研究生 。 参与 某 大型 信息管理系统 的 数据库 设计 与 开发 工作 。 
 孙景琪 　 教授 。 中国 电子 学会 教育 委员会 委员 。 
 作者 单位 ： 北京工业大学 电子 工程学系 　 北京 （ 100022 ） 
 收稿 日期 : 1998 - 12 - 29 ( 修改稿 ) 
