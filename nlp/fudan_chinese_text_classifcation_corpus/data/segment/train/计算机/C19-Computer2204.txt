计算机 应用 研究 
 APPLICATION   RESEARCH   OF   COMPUTERS 
 2000 　 Vol.17 　 No.2 　 P.90 - 92 
 
 
 
 基于 知识 的 肺癌 早期 细胞 诊断系统 
 花蕾 　 杨育彬 　 李宁 　 叶玉坤 
 摘   要   介绍 了 一个 基于 知识 的 肺癌 早期 细胞 病理 诊断系统 ， 着重 讨论 了 该 系统 中 的 知识 表示 形式 及 与 之 相配合 的 基于 确定性 理论 模型 的 不确定性 推理方法 。 该 系统 能 自动 从 细胞 图象 中 提取 出 必需 的 特征 事实 ， 并 模仿 病理 专家 的 诊断 逻辑 ， 自动 推理 出 最终 诊断 结果 。 
 关键词   知识 表示   不确定性 推理   专家系统   图象处理 
 1   引言 
 　 　 近 20 多年 来 ， 人工智能 和 知识 工程技术 在 医学 诊断 领域 得到 了 广泛 的 应用 ， 从 1974 年 问世 的 诊断 专家系统 MYCIN ， 到 现在 被 广泛 使用 的 各种 医疗 诊断 专家系统 ， 成果 层出不穷 。 专家系统 在 医疗 领域 的 应用 日趋 广泛 ， 迄今为止 ， 已经 有 越来越 多 的 医疗 诊断 专家系统 投入 了 实际 使用 ， 效果 很 好 。 
 　 　 国内外 资料 表明 ， 肺癌 正在 快速 上升 为 人体 各 部位 恶性肿瘤 疾病 之 首 ， 中国 的 肺癌 发病率 增长速度 及 肺癌 病人 绝对数 均 为 全世界 的 第一位 ， 患病 人数 每年 达 130 万 。 一般 情况 下 ， 肺癌 患者 在 确诊 后 ， 80% 左右 已属 晚期 ， 失去 手术 治疗 的 机会 ， 因此 ， 肺癌 的 早期 诊断 已 成为 攻克 这一 难关 的 关键性 课题 。 日前 ， 对 肺癌 细胞 的 诊断 一般 由 病理 专家 实施 。 专家 在 显微镜 下 观察 患者 的 病理切片 ， 运用 自己 在 长期实践 中 积累 的 专门 经验 和 知识 做出 诊断 结论 ， 这 不仅 费时 又 费力 ， 而且 识别 癌细胞 的 病理 专家 也 非常 缺乏 。 
 　 　 基于 上述 的 情况 ， 南京大学 计算机系 与 中国人民解放军 八一 医院 肺癌 研究 中心 联合 研制开发 了 基于 知识 的 肺癌 早期 细胞 诊断系统 。 该 系统 通过 一系列 的 图象处理 过程 ， 自动 从 肺癌 穿刺 标本 的 彩色 显微图 象中 提取 出 有 意义 的 特征 事实 ， 交给 带有 诊断 知识库 的 专家系统 进行 推理 ， 自动 准确 地 诊断 出 患者 是否 染 有 肺癌 。 该 系统 经 试用 ， 已能 实现 肺癌 细胞 的 自动 诊断 和 分类 ， 有效 地 弥补 了 人工 识别 的 缺陷 和 不足 ， 具有 较 高 的 准确性 和 效率 。 本文 主要 介绍 系统 的 知识 表示 方法 、 推理 策略 和 图象处理 技术 。 
 2   系统 总体 结构 和 功能 
 2.1   系统 总体 结构 
 　 　 肺癌 早期 细胞 诊断系统 主要 组成部分 有 ： 诊断 知识库 、 推理机 、 综合 数据库 、 知识 获取 、 图象处理 、 解释器 和 人机接口 等 模块 。 系统 采用 模块化 结构设计 ， 便于 系统 的 扩充 和 修改 ， 系统 具有 很 好 的 灵活性 和 易用性 。 
 　 　 系统 的 总体 结构 如图 1 所示 ， 各 模块 的 功能 简述 如下 。 
 
 图 1 　 系统 总体 结构 
 2.2   模块 功能 
 　 　 ● 知识库 
 　 　 本 系统 的 知识库 用于 存取 和 管理所 获取 的 有关 肺癌 细胞 诊断 及 分类 的 专家 经验 和 知识 ， 存储 有 产生 式 规则 200 多条 ， 供 推理机 使用 。 
 　 　 ● 推理机 
 　 　 推理机 是 专家系统 的 核心 部分 ， 系统 的 推理机 采用 默认 的 数据 驱动 、 宽度 优先 的 正向 推理 策略 ， 将 系统 由 图象处理 获取 的 特征 事实 与 知识库 中 规则 的 条件 进行 匹配 ， 综合 各条 匹配 规则 的 结论 后 推理 出 诊断 结果 。 
 　 　 ● 综合 数据库 
 　 　 综合 ( 全局 ) 数据库 用来 存放 与 当前 系统 推理 过程 密切相关 的 各种 事实 和 数据 ， 主要 包括 ： 系统 或 用户 给出 的 有关 肺癌 切片 图象 的 特征 事实 ， 诊断 推理 过程 中 生成 的 中间 结论 ， 最终 诊断 结论 以及 推理 路径 等 。 
 　 　 ● 知识 获取 模块 
 　 　 知识 获取 器是 知识 工程师 与 肺癌 专家 之间 的 交互 界面 。 通过 知识 工程师 与 病理 专家 的 交流 ， 建立 知识库 ， 并 具有 对 知识库 的 增 、 删 、 改等 功能 。 
 　 　 ● 解释 模块 
 　 　 解释 模块 负责 向 用户 解释 系统 的 行为 ， 推理 结论 进行 解释 ， 向 用户 输出 推理 的 结论 ， 系统 作出 结论 的 理由 以及 在 推理 过程 中 所 匹配 的 规则 的 内容 等 。 
 　 　 ● 图象处理 模块 
 　 　 图象处理 部分 的 彩色 摄影机 与 显微镜 观察 平台 相连接 ， 它 实时 地 获取 肺癌 穿刺 标本 涂片 的 视频信号 ， 该 信号 经 图象 采集卡 处理 后 转化 为 RGB 真 彩图 象 ， 经 图象 预处理 和 图象 分割 处理 后 ， 得到 细胞 的 各种 特征参数 。 
 3   图象 特征 集 的 获取 
 　 　 系统 在 进行 诊断 推理 之前 ， 首先 通过 对 肺癌 细胞 原始 图象 进行 处理 和 分割 ， 提取 肺癌 细胞 的 各种 有效 的 特征值 ， 其 处理 步骤 如下 。 
 　 　 1 ) 图象 获取   通过 图象 采集 ， 得到 肺 穿刺 标本 在 显微镜 下 若干个 不同 视野 中 的 图象 ； 
 　 　 2 ) 图象 预处理   对 采集 来 的 原始 图象 进行 去 噪 、 增强 、 平滑 和 锐化 等 一系列 的 预处理 ， 清除 中间环节 对 图象 造成 的 不良影响 ， 提高 图象 的 质量 ； 
 　 　 3 ) 图象 分割   先 通过 双重 自 适应 的 阈值 选取 算法 ， 将 细胞核 与 图象 背景 分开 ； 再 通过 基于 区域 边界 的 八 链码 表示 提取 出 细胞核 的 形态学 特征 ， 通过 提取 处理 得到 细胞核 的 色度学 特征 。 
 　 　 系统 通过 上述 处理 将 获得 细胞 图象 有 意义 的 特征 ， 并 将 其 作为 事实 存入 专家系统 的 综合 数据库 中 ， 供 推理机 使用 。 
 　 　 通过 对 专家 总结 的 原始 诊断 知识 的 分析 ， 我们 主要 进行 了 与 诊断 推理 密切相关 的 形态学 和 色度学 两大类 特征参数 集 ， 其 具体 的 处理 技术 ， 因 篇幅 所 限 ， 这里 不再 赘述 。 
 　 　 ( 1 ) 形态学 特征 集 
 　 　 1 ) 细胞 区域 的 周长 ( 即八链 码所围 区域 的 长度 ) 
 　 　 2 ) 细胞 区域 的 高度 、 宽度 和 面积 
 　 　 3 ) 细胞 区域 的 圆度 ： 
 　 　 
 　 　 圆度 用于 描述 细胞 区域 与 圆形 的 偏离 程度 。 在 相同 面积 的 条件 下 ， 细胞 区域 边界 光滑 且 为 圆形 ， 则 周长 最短 ， 其圆度 为 C = 1 。 细胞 区域 的 形状 越 偏离 圆形 ， 则 C 值越 小 。 圆度 对 细胞 异形 性 的 判断 尤为重要 。 
 　 　 4 ) 细胞 区域 的 伸 长度 ： 
 　 　 
 　 　 细胞 区域 越 呈 细长 形 ， E 越小 ， 当 细胞 区域 为 圆形 时 ， E = 1 。 
 　 　 ( 2 ) 色度学 特征 集 
 　 　 通过 对 常用 的 彩色 空间 的 仔细 比较 和 分 所 ， 系统 采用 了 { R ， G ， B } 和 { H ， S ， I } 彩色 空间 中 的 色彩 分量 作为 色度学 的 特征参数 。 
 　 　 1 ) { R ， G ， B } 彩色 空间 中 的 红色 分量 R 
 　 　 2 ) { R ， G ， B } 彩色 空间 中 的 绿色 分量 G 
 　 　 3 ) { R ， G ， B } 彩色 空间 中 的 蓝色 分量 B 
 　 　 4 ) { H ， S ， I } 彩色 空间 中 的 饱和度 分量 S 
 　 　 
 　 　 5 ) { H ， S ， I } 彩色 空间 中 的 照明 度 分量 I 
 　 　 
 　 　 6 ) { R ， G ， B } 彩色 空间 中 的 蓝色 分量 的 比重 RB 
 　 　 
 　 　 RB 这个 分量 是 结合 本 系统 的 实际 情况 引入 的 。 由 专家 的 经验 知识 我们 可以 归纳 出 ， 偏 蓝紫色 是 肺癌 细胞 的 一般 特性 之一 ， 其中 的 蓝色 分量 B 是 应该 加倍 重视 的 ； 同时 ， 由于 RB 分量 本身 是 一个 归一化 的 值 ， 既 便于 系统 的 处理 ， 也 有利于 知识 的 修改 和 维护 。 
 　 　 通过 上述 处理 得到 的 肺癌 细胞 特征 集 存入 综合 数据库 中 ， 供 推理机 使用 。 
 4   知识 表示 
 　 　 根据 肺癌 知识 的 特点 ， 我们 利用 了 产生 式 规则 来 表示 肺癌 知识 。 本 系统 的 诊断 知识库 就是 一个 由 许多 产生 式 规则 组成 的 集合 。 
 　 　 系统 中 的 每条 规则 都 可 抽象 描述 为 规则 前提 及其 相应 结论 的 对偶 。 每条 规则 的 形式 为 ： 
 IF   < Precondition >   THEN   < Conclusion >   with   Confidence   < CF > 
 其中 ： 
 
 　 　 N 为 每条 规则 的 前提 数 ， P = { P1 ,   P2 ,   ... ,   PN } 为 每条 规则 的 前提 集 ， CF 为 每条 规则 的 可信度 。 
 　 　 在 本 系统 中 ， 根据 所处 的 推理 层次 和 条件 的 不同 ， 将 规则 分为 以下 两类 ： 
 　 　 1 ) 间接 规则 
 　 　 间接 规则 是 指 用于 “ 图象 特征参数 → 原始 知识 的 条件 ( 中间 结果 ) ” 这一 层次 上 的 规则 , 推理机 利用 它 从 数值 化 的 事实 推理 出 描述性 的 事实 
 　 　 前提 
 　 　 在 这类 规则 中 ： Vi 为 图象 特征参数 ， [ Th1 ,   Th2 ] 为 该 特征参数 的 阈值 区间 。 
 　 　 间接 规则 的 实例 如下 ： 
 Rule   013 ： 
 IF   ( 绿色 分量 < 90 )   AND   ( 蓝色 分量 比重 > 0.55 )   AND   ( 0.4 < 饱和度 < 0.65 ) 
 THEN   细胞 染色 偏蓝   with   cf = 0.3   ( 0.3 ) 
 　 　 2 ) 直接 规则 
 　 　 直接 规则 是 指 用于 “ 原始 知识 的 条件 → 结论 ” 这一 层次 上 的 规则 , 它 来源于 病理 专家 知识 , 推理机 利用 它 从 描述性 的 事实 揄 出 最终 的 诊断 结论 。 
 在 这类 规则 中 ： 
 　 　 前提 
 其中 ， Si 为 描述性 条件 ， [ Af1 ,   Af2 ] 为 该 条件 的 模糊 隶属 度 函数 的 取值 区间 。 
 　 　 直接 规则 的 实例 如下 ： 
 Rule   022 ： 
 IF   0.4 < = 细胞核 面积 < 0.6   
 THEN   该 细胞 是 癌细胞   with   cf = 0.5   ( 0.5 ) 
 　 　 本 系统 的 知识库 是 一个 包含 以上 形式 具有 200 多条 规则 的 规则 库 ， 是 知识 工程师 通过 系统 灵活 的 知识 获取 界面 ， 建立 的 知识库 。 
 5   推理机 
 5.1   推理 控制策略 
 　 　 本 系统 主要 采用 数据 驱动 的 正向 推理 策略 。 经过 图象处理 和 分割 后 ， 系统 自动 将 分割 出来 的 细胞 区域 的 相应 图象 特征 保存 到 专家系统 的 综合 ( 全局 ) 数据库 中 ， 作为 输入 的 事实 供 推理机 使用 。 如果 用户 认为 系统 自动 分割 图象 的 效果 不够 理想 ， 还 可以 利用 系统 的 交互 输入 模块 ， 使用 数字化仪 或 鼠标 手工 分割 出 若干 细胞 区域 ， 系统 会 立即 计算 出 这些 区域 的 图象 特征参数 ， 并 存入 综合 ( 全局 ) 数据库 中 。 
 　 　 系统 推理机 的 推理 策略 及其 步骤 如下 ： 
 　 　 1 ) 读入 当前 细胞 区域 的 特征 事实 ， 首先 用 这些 事实 与 知识库 中 的 间接 规则 的 前提 进行 匹配 ， 将 匹配 成功 的 规则 的 结论 存入 综合 数据库 ； 
 　 　 2 ) 将 上 一步 生成 的 中间 结论 作为 新 的 事实 ， 与 知识库 中 的 直接 规则 的 前提 进行 匹配 ； 
 　 　 3 ) 如果 综合 数据库 中 的 事实 达到 一种 稳定 状态 ， 即 再 无 新 的 事实 生成 时 ， 结束 推理 过程 ， 输出 最终 诊断 结论 。 
 　 　 除了 上述 的 正向 推理 外 ， 系统 在 响应 用户 的 交互式 提问 时 还 同时 采用 了 目标 驱动 的 反向 推理 策略 。 用户 的 回答 将 被 保存 在 综合 数据库 中 ， 推理 时 将 其 与 知识库 中 规则 的 结论 部分 进行 匹配 ， 直到 得出 最终 的 结果 。 
 5.2   规则 可信度 计算 
 　 　 为了 表达 知识 的 模糊性 和 不确定性 ， 系统 采用 类 MYCIN 系统 的 确定性 理论 模型 ， 对 每条 规则 引入 可信度 CF ( Certainty   Factor ) 的 概念 ， 用来 估计 规则 的 精确 程度 。 本 系统 中 定义 可信度 CF 的 取值 范围 为 [ - 1 ， 1 ] 。 对于 每条 规则 的 可信度 值 的 大小 ， 都 由 肺癌 专家 给出 一个 合适 的 初值 ， 以后 随着 系统 的 不断 调试 和 实验 ， 逐步 稳定 在 一个 理想 的 范围 内 。 
 　 　 推理 过程 中 可信度 的 计算公式 如下 ： 
 　 　 ● 当 前提 之间 是 “ 与 ” ( AND ) 关系 时 ： 
 　 　 
 　 　 ● 当 前提 之间 是 摶 驍 ( OR ) 关系 时 ： 
 　 　 
 其中 ， cf   为 当 规则 所有 前提 都 成立 时 规则 的 可信度 ， cfvi 为 该 规则 中 每个 前提 的 可信度 。 
 　 　 ● 如果 有 多条 规则 同时 可 推出 同 一条 结论 时 ， 例如 ： 规则 R1   with   CF1 ， R2   with   CF2 ,   ... ,   Rn   with   CFn 的 结论 都 为 Ci 时 ， 则 ： 
 　 　 1 ) 如果 Ci 为 中间 结论 ( 原始 知识 的 条件 部分 ) ， 其 可信度 CFCi 为 ： 
 　 　 
 　 　 2 ) 如果 Ci 为 最终 结论 ( 原始 知识 的 结论 部分 ) ， 其 可信度 CFCi 为 ： 
 　 　 
 　 　 在 不确定性 推理 开始 前 ， 系统 将 所有 结论 命题 的 可信度 值 都 置 为 0 。 推理机 开始运行 后 ， 系统 根据 得到 的 原始 事实 ， 沿着 规则 库 开始 进行 匹配 推理 ， 同时 按照 可信度 传播 和 更新 算法 将 原始 事实 的 可信度 向下 传播 给 中间 结论 ， 直到 求 出 最终 结论 的 可信度 。 如果 最终 结论 的 可信度 大于 指定 的 阈值 ， 则 判定 结论 成立 。 采用 了 上述 可信度 更新 和 传播 算法 后 ， 系统 的 诊断 准确度 大有 提高 。 
 6   结束语 
 　 　 本 系统 在 Windows   95 操作系统 下用 V C++ 5.0 编程 实现 。 试运行 结果表明 ， 系统 所 采用 的 图象处理 技术 、 知识 表示 方法 和 不确定性 推理模型 是 成功 的 。 本 系统 已于 1998 年 5 月 顺利 通过 了 国家 “ 九五 ” 攻关 课题 中期 考核 。 在 中国人民解放军 八一 医院 试用 后 ， 反映 良好 。 
 该 项目 获 国家 摼 盼 鍞 攻关 课题 ( 96 - 906 - 01 - 18 ) 的 资助 
 花蕾 （ 南京大学 计算机科学 与 技术 系   南京   210093 ） 
 杨育彬 （ 南京大学 计算机科学 与 技术 系   南京   210093 ） 
 李宁 （ 南京大学 计算机科学 与 技术 系   南京   210093 ） 
 叶玉坤 （ 中国人民解放军 八一 医院   南京   210002 ） 
 参考文献 
 1 ， 陈世福 ,   陈兆乾 .   人工智能 与 知识 工程 .   南京 ： 南京大学 出版社 ,   1997 
 2 ， 刘有 才 ,   刘增良 .   模糊 专家系统 原理 与 设计 .   北京 ： 北京航空航天大学 出版社 ,   1995 
 3 ， 杨 叔子 ,   丁   洪 .   基于 知识 的 诊断 推理 .   北京 ： 清华大学出版社 ,   1992 
 4 ， 陈兆乾 ,   潘金贵 .   NCFW 系统 的 设计 与 实现 .   计算机 研究 与 发展 ,   1991 , l :   29 ～ 34 
 收稿 日期 ： 1999 年 8 月 30 日 
