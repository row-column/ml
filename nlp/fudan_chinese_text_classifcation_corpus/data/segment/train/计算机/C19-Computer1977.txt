微型机 与 应用 
 MICROCOMPUTER   &   ITS   APPLICATIONS 
 1999 年   第 18 卷   第 2 期   Vol.18   No.2   1999 
 
 
 
 Internet 的 安全 机制 
 李建萍 　 郭 学理 　 吕宏辉 
 　 　 摘 　 要 ： 从 访问控制 和 通信安全 二 方面 论述 了 Internet 的 安全 机制 ， 介绍 了 防火墙 的 2 种 实现 方法 和 3 种 体系结构 ， 并 分析 了 各种 体系结构 的 优缺点 。 
 　 　 关键词 ： Internet 网 　 安全 机制 　 访问控制 　 通信安全 　 屏蔽 路由器 　 代理服务器 　 IPSP 　 ESP 
 　 　 随着 网上 各种各样 网民 的 出现 ， 入侵 主机 、 网络 的 事件 也 越来越 多 。 近年来 ， Internet 上 的 安全 问题 日益 引起 人们 的 重视 ， 提供 一个 安全 的 网络 环境 也 变得 日益 重要 。 一般说来 ， 可以 从 以下 二 方面 实现 Internet 安全 服务 ： 
 　 　 ( 1 ) 访问控制 。 用来 保护计算机 和 网络资源 ， 使 之 不能 被 未 授权 的 人 访问 。 
 　 　 ( 2 ) 通信安全 。 用来 提供 认证 服务 、 数据 保密性 、 完整性 及 通信 双方 的 防 抵赖 服务 等 。 
 1 　 访问控制 安全 服务 
 　 　 访问控制 是 保护 网络 的 第一道 防线 ， 目前 一般 由 防火墙 ( firewall ) 来 实现 。 
 1.1 　 防火墙 
 　 　 一个 网络 与 Internet 连接 后 ， 内部 用户 可以 方便 地 访问 Internet 、 与 外部 用户 交流 ； 但 外部 用户 也 可以 访问 内部 网络 ， 与 内部 用户 交流 ， 这 就 存在 着 许多 不可 预知 的 危险 。 比如 ， 对 一个 银行 ， 外部 用户 能 读取 帐户 信息 ， 甚至 修改 它 。 这时 ， 仅靠 最初 的 主机 安全 是 远远不够 的 。 将 1 个 中间 系统 插入 到 网络 与 Internet 之间 ， 控制 它们 之间 的 访问 和 交流 ， 保护 内部 网络 不 受到 来自 Internet 的 威胁 与 攻击 ， 并 提供 安全 和 检查 机制 。 这种 中间 系统 就 称之为 防火墙 。 
 　 　 构筑 防火墙 一般 用 以下 2 种 方法 实现 ： 
 　 　 ( 1 ) 屏蔽 路由器 ( Screening   Router ) ; 
 　 　 ( 2 ) 代理服务器 ( Proxy   Server ) 。 
 1.1 . 1 　 屏蔽 路由器 
 　 　 屏蔽 路由器 一般 是 1 个 多口 IP 路由器 ， 用于 在 内部 的 和 外部 的 主机 之间 发送 数据包 。 它 不但 对 数据包 进行 路由 发送 ， 还 依据 一定 的 安全 规则 检查 数据包 ， 决定 是否 应该 发送 。 它 所 依据 的 规则 由 站点 的 安全策略 决定 ， 这些 规则 可以 根据 IP 包中 信息 ： IP 源地址 、 IP 目的 地址 、 协议 、 TCP 或 UDP 源 端口 、 目标 端口 、 ICMP 消息 类型 等 进行 设置 ， 也 可以 根据 路由器 知道 的 信息 如 数据包 到达 端口 、 出去 端口 进行 设置 。 这些 规则 由 屏蔽 路由器 强制 设置 ， 也 称 它 为 包 过滤 规则 。 
 1.1 . 2 　 代理服务器 
 　 　 代理服务器 是 运行 在 防火墙 主机 上 的 专门 应用程序 或 服务器程序 。 这些 程序 接受 用户 对 Internet 服务 的 请求 ， 并 按照 相应 的 安全策略 将 这些 请求 转发 到 实际 的 服务 。 代理服务器 为 一个 特定 的 服务 提供 替代 连接 ， 充当 服务 的 网关 ， 因此 又称 它 为 应用 级 网关 。 
 1.1 . 3 　 二者 的 比较 
 　 　 屏蔽 路由器 设置 简单 ， 1 个 路由器 可 保证 整个 网络 的 安全 ， 价格 也 较 低 。 但 包 过滤 规则 配置 较难 ， 一些 协议 如 UNIX 的 r 命令 不 很 适合 用包 过滤 来 保护 安全 。 另外 ， 包 过滤 规则 缺少 用户 级 认证 ， 用户 无法 使用 诸如 限制 什么 用户 、 什么 应用程序 等 规则 ， 它 只 针对 主机 和 端口 。 
 　 　 代理服务器 提供 了 用户 级 认证 、 登录 及 记帐 。 但 对 每 1 个 应用程序 ( 服务 ) 都 需设 1 个 代理 ， 当 出现 新 服务 时 ， 必须 编写 一新 的 代理 程序 方可 共享 此 服务 ， 这 大大 地 限制 了 新 服务 的 应用 。 近来 ， 出现 了 1 种 all - in - one 代理 构造 工具包 Socks ， 用于 设计 将 现存 的 C / S 应用程序 轻易 地 转化 为 同样 的 应用程序 代理 版本 ， 而 许多 标准 的 C / S 程序 ， 本身 就 配有 代理 能力 ， 或 支持 像 Socks 一样 的 一般 代理 系统 ， 这 无疑 更 增强 了 代理服务器 的 可用性 。 
 　 　 然而 ， 构筑 防火墙 的 “ 正确 解决方案 ” 很少 采用 单一 的 技术 ， 通常 是 将 多种 解决 不同 问题 的 技术 进行 组合 ， 使 防火墙 的 性能 更强 。 
 1.1 . 4 　 防火墙 体系结构 
 　 　 实际 构筑 防火墙 ， 一般 是 将 多个 不同 的 部件 放在 一起 ， 每个 部件 有 各自 解决问题 的 重点 。 下面 是 几种 防火墙 体系结构 ： 
 　 　 ( 1 ) 双重 宿主 主机 体系结构 
 　 　 如图 1 所示 的 体系结构 ， 提供 来自 与 多个 网络 相连 的 主机 的 服务 ( 但是 路由 关闭 ) ， 它 围绕 双重 宿主 主 计算机 构筑 。 该 计算机 至少 有 2 个 网络接口 ， 位于 因特网 与 内部网 之间 ， 并 被 连接 到 因特网 和 内部网 。 2 个 网络 都 可以 与 双重 宿主 主机 通信 ， 但 相互之间 不行 ， 它们 之间 的 IP 通信 被 完全 禁止 。 
 
 
 图 1 　 双重 宿主 主机 体系结构 
 　 　 双重 宿主 主机 仅能 通过 代理 或 用户 直接 登录 到 双重 宿主 主机 来 提供 服务 。 它 能 提供 级别 非常 高 的 控制 ， 并 保证 内部 网上 没有 外部 的 IP 包 。 
 　 　 但 这种 体系结构 中 用户 访问 因特网 的 速度 会 较慢 ， 也 会 因为 双重 宿主 主机 的 被 侵袭 而 失效 。 
 　 　 ( 2 ) 被 屏蔽 主机 体系结构 
 
 
 图 2 　 被 屏蔽 主机 体系结构 
 　 　 如图 2 的 体系结构 ， 使用 1 个 单独 的 路由器 提供 来自 仅仅 与 内部 网络 相连 的 主机 的 服务 。 屏蔽 路由器 位于 因特网 与 内部网 之间 ， 提供 数据包 过滤 功能 。 堡垒 主机 是 1 个 高度 安全 的 计算机系统 ， 通常 因为 它 暴露 于 因特网 之下 ， 作为 联结 内部 网络 用户 的 桥梁 ， 易 受到 侵袭 损害 。 这里 它 位于 内部 网上 ， 数据包 过滤 规则 设置 它 为 因特网 上 唯一 能 连接 到 内部 网络 上 的 主机 系统 。 它 也 可以 开放 一些 连接 ( 由 站点 安全策略 决定 ) 到 外部 世界 。 
 　 　 在 屏蔽 路由器 中 ， 数据包 过滤 配置 可以 按 下列 之一 执行 ： 
 　 　 ① 允许 其他 内部 主机 ， 为了 某些 服务 而 开放 到 因特网 上 的 主机 连接 ( 允许 那些 经由 数据包 过滤 的 服务 ) 。 
 　 　 ② 不 允许 来自 内部 主机 的 所有 连接 ( 强迫 这些 主机 经由 堡垒 主机 使用 代理服务 ) 。 
 　 　 这种 体系结构 通过 数据包 过滤 来 提供 安全 ， 而 保卫 路由器 比 保卫 主机 较易 实现 ， 因为 它 提供 了 非常 有限 的 服务组 ， 因此 这种 体系结构 提供 了 比 双重 宿主 主机 体系结构 更好 的 安全性 和 可用性 。 弊端 是 ， 若 是 侵袭 者 设法 入侵 堡垒 主机 ， 则 在 堡垒 主机 与 其他 内部 主机 之间 无 任何 保护 网络安全 的 东西 存在 ； 路由器 同样 可能 出现 单点 失效 ， 若 被 损害 ， 则 整个 网络 对 侵袭 者 开放 。 
 　 　 ( 3 ) 被 屏蔽 子网 体系结构 
 　 　 考虑 到 堡垒 主机 是 内部 网上 最易 被 侵袭 的 机器 ( 因为 它 可 被 因特网 上 用户 访问 ) ， 我们 添加 额外 的 安全 层到 被 屏蔽 主机 体系结构 中 ， 将 堡垒 主机 放在 额外 的 安全 层 ， 构成 了 这种 体系结构 。 这种 在 被 保护 的 网络 和 外部 网 之间 增加 的 网络 ， 为 系统 提供 了 安全 的 附加 层 ， 称之为 周边 网 。 
 　 　 如图 3 ， 这种 体系结构 有 2 个 屏蔽 路由器 ， 每 1 个 都 连接 到 周边 网 。 1 个 位于 周边 网 与 内部网 之间 ， 称为 内部 路由器 ， 另 1 个 位于 周边 网 与 外部 网 之间 ， 称之为 外部 路由器 。 堡垒 主机 位于 周边 网上 。 侵袭 者 若想 侵袭 内部 网络 ， 必须 通过 2 个 路由器 ， 即使 他 侵入 了 堡垒 主机 ， 仍 无法 进入 内部网 。 因此 这种 结构 没有 损害 内部 网络 的 单一 易受 侵袭 点 。 
 
 
 图 3 　 被 屏蔽 子网 体系结构 
 　 　 其 特点 是 ： 
 　 　 ① 周边 网 相对来说 ， 易 被 入侵 ， 因此 周边 网上 无 内部 通信 ， 只有 一些 不 重要 的 IP 信息 。 若 入侵 堡垒 主机 ， 至多 侵入 周边 网 ， 内部网 相对 安全 。 
 　 　 ② 外部 路由器 主要 用来 阻止 从 因特网 上来 的 伪造 源地址 的 包 ， 这 一点 内部 路由器 无法 完成 ， 因为 它 无法 分辨 此包 是 因特网 上 的 还是 周边 网上 的 。 外部 路由器 的 包 过滤 规则 在 周边 网上 保护 堡垒 主机 与 内部 路由器 ， 周边 网上 机器 还 通过 自身 主机 安全 来 保证 自己 ， 这样 的 安全 冗余 是 有 必要 的 。 对于 内部 机器 的 包 过滤 规则 与 内部 路由器 相同 ， 即 一些 包若能 从 内部 路由器 通过 ， 也 应该 能 从 外部 路由器 通过 。 
 　 　 ③ 内部 路由器 为 防火墙 执行 大部分 的 数据包 过滤 工作 ， 允许 从 内部网 到 因特网 的 有 选择 的 出 站 服务 。 另 一种 服务 是 在 堡垒 主机 与 内部网 之间 的 服务 ， 这种 服务 不同于 上 一种 ， 它 的 安全 是 由 代理服务 提供 的 。 由于 堡垒 主机 较易 被 入侵 ， 所以 应 将 这种 服务 限制 在 实际 所 需 的 程度 。 
 　 　 上述 为 一些 基本 的 体系结构 ， 还有 其他 的 体系结构 ， 每种 都 有 各自 的 益处 和 弊端 ， 这里 不 一一 叙述 了 。 
 　 　 防火墙 从 内部网 的 整体 上 保证 了 安全 ， 这 一点 靠 各 主机 的 安全 很难 做到 的 。 但是 ， 防火墙 并 不能 作为 安全 管理 的 代替 物 ， 它 并 不能 防止 内部 攻击 ， 也 不能 防病毒 ， 不恰当地 配置 同样 可能 置 网络 于 不 安全 之中 。 要 构成 一个 安全 的 网络 ， 必须 制定 一个 合理 的 安全策略 ， 这个 策略 包括 许多 方面 ， 也 包括 下面 介绍 的 通信安全 服务 。 
 2 　 通信安全 服务 
 　 　 构筑 一个 安全 的 网络 ， 不仅仅 要 构筑 防火墙 ， 而且 涉及 到 加密 和 认证 。 比如 在 网上 进行 电子商务 ， 就要 保证数据 在 传输 过程 中 的 安全 ， 防止 被 黑客 截取 获悉 甚至 修改 再 发出 ， 这会 给 商家 带来 很大 的 损失 。 而 对 数据 加密 和 认证 就 可 防止 这 类 攻击 。 
 　 　 通信安全 服务 提供 对 数据 加密 、 在 通信 对方 认证 、 双方 无法 抵赖 、 数据 在 传输 过程 中 的 完整性 等 服务 。 这种 安全 服务 可以 在 应用层 、 传输层 和 网络层 实现 。 在 不同 的 层 实现 安全 ， 往往 与 客户 实现 安全 的 重点 有关 ， 也 与 实现 网络 的 传统 方法 有关 。 
 2.1 　 网络层 安全 服务 
 　 　 在 TCP / IP 协议 中 ， 网络层 对应 的 是 IP 层 。 过去 10 年来 ， 人们 已经 提出 了 很多 IP 层 安全 协议 ， 如 NSA ( 美国 国家 安全 机构 ) 的 SP3 、 ISO 为 CLIP ( 无 连接 网络协议 ) 定义 的 标准 NLSP 等 。 这些 协议 的 本质 都 是 IP 封包 技术 ， 即 把 原 IP 包 加密 后 封包 ， 再 加上 新 的 IP 头 传送 出去 ， 在 对 等 系统 中 ， 去掉 IP 头 ， 将 IP 包 解密 ， 再 送 至 目的 地址 。 　 　 
 　 　 为了 使 IP 层 安全 服务 标准化 ， IETF 委托 IPSEC 工作组 指定 了 IPSP ( IP 层 安全 协议 ) 标准 和 IKMP ( 因特网 密钥 管理 协议 ) ， 用来 提供 IP 层 安全 。 目前 许多 产品 都 支持 IPSP 。 
 　 　 IPSP 实际上 是 一系列 为 IP 通信 认证 和 加密 的 协议 ， 一般 基于 2 种 加密 安全 机制 ： AH ( Authentication   Header ) 和 ESP ( Encapsulating   Security   Payload ) 。 
 　 　 ( 1 ) ESP 对 IP 包净荷 ( payload ) 加密 、 封包 。 IPSP 运行 的 系统 有 2 种 模式 ： 传输 模式 Transport   mode ( 在 端 到 端系统 的 主机 中 ) ， 通道 模式 Tunnel   mode ( 在 1 个 网络 互连 设备 中 ， 如 路由器 、 防火墙 ) 。 对于 传输 模式 ， ESP 只 将 IP 包 的 高层 协议 数据 加密 后 封装 入 ESP 中 ； 而 对 通道 模式 ， 则 将 整个 IP 包 加密 后 封装 入 ESP 中 。 封装 后 的 IP 包如图 4 。 
 　 　 图 4 中 ， ESP   authentication   trailer 是 一个 可选项 ， 用于 认证 目的 。   
 
 图 4     封装 后 的 IP 包 
 　 　 对 IP 包 的 加密 一般 采用 DES 或 Triple   DES 算法 ， 这种 算法 取决于 对 密钥 的 保密 ， 其 算法 是 公开 的 。 由于 已有 公司 用 硬件 实现 它 ， 因此 速度 还 较 快 。 
 　 　 ( 2 ) AH 是 一个 信息 认证 代码 。 在 发送 IP 包前 计算 好 ， 发者 用 一个 密钥 计算 ， 收者 用 同一个 或 另 一个 密钥 检验 。 若用 的 是 常规 密钥 密码 体制 ， 则 收 、 发者 的 密钥 相同 ； 而 对 公开密钥 密码 体制 ， 发者 用 自己 的 私钥 计算 ， 收者 用 发者 的 公钥 检验 。 这里 的 加密 一般 采用 MD5 或 SHA - 1 哈希 算法 。 
 　 　 ( 3 ) ISAKMP 用于 管理 、 安全 分发 密钥 。 由于 ESP 和 AH 中 都 用 了 加密算法 ， 密钥 管理 的 问题 就 显得 越来越 重要 了 。 IPSP 提出 了 这个 协议 专门 用于 管理 密钥 ， 它 是 基于 Diffie - Hellman 密钥 管理 算法 。 现在 网络安全 算法 有 很多 ， 有些 效果 也 不错 ， 但 密钥 的 管理 一直 是 安全 里 的 弱点 。 如何 对 密钥 进行 有效 的 管理 ， 一直 是 人们 关心 的 问题 。 
 　 　 IP 层 安全 服务 最大 的 优点 是 操作 的 透明性 ， 在 IP 层 加密 ， 上层 用户 根本 感觉 不到 ， 应用程序 和 其他 通信 层 都 无须 改变 。 但 IP 层 安全 服务 是 基于 主机 的 ， 即 若 A 主机 建立 了 到 B 主机 的 IP 安全 通道 ， 则 所有 从 A ～ B 的 数据包 都 被 加密 ， 用户 无法 选择 。 而 所有 的 数据包 都 加密 势必 影响 通信 的 速度 ， 这 也 是 IP 层 安全 服务 的 最大 缺点 。 　 　 
 2.2 　 传输层 安全 服务 
 　 　 在 传输层 之间 通信 时 都 要 用到 IPC 接口 ， 2 个 常用 的 接口 是 BSD 的 套 接口 和 UNIX 系统 5 中 的 TLI 。 要 提供 传输层 安全 服务 ， 人们 首先 想到 的 是 通过 增强 IPC 接口 ， 提供数据 认证 、 对 传输 的 数据流 加密 的 功能 。 事实上 ， 已 提出 的 SSL 和 微软 的 PCT 协议 都 是 这样 实现 的 。 
 　 　 1995 年 提出 的 SSL 版本 3 包括 2 个 协议 ： 
 　 　 ( 1 ) SSL 记录 协议 。 负责 对 信息 分片 、 压缩 、 认证 和 加密 。 认证 可 采用 MD5 和 SHA 算法 ， 加密 则 支持 RC4 和 DES 算法 。 认证 和 加密 所用 的 密钥 则 由 SSL 握手 协议 协商 分配 。 
 　 　 ( 2 ) SSL 握手 协议 。 负责 协议 版本号 的 交换 、 认证 和 密钥 的 分配 。 它 支持 基于 Diffie - Hellman 的 密钥 交换 算法 。 
 　 　 传输层 安全 服务 仅仅 保护 单一 网络 链路 ， 是 面向 过程 的 ， 这 一点 比 IP 层 安全 服务 灵活 ， 但 需要 改变 应用程序 和 IPC 接口 。 
 2.3 　 应用层 安全 服务 
 　 　 应用层 安全 服务 是 最 灵活 的 ， 它 面向 文档 一级 ， 用户 可以 针对 文档 的 不同 安全 要求 选择 安全 服务 。 比如 ， 对于 email 可以 只 加密 正文 ， 地址 仍 是 原样 。 应用层 安全 服务 的 协议 有 用于 email 安全 的 PGP 、 用于 WEB 安全 的 S - HTTP 等 。 但是 ， 在 应用层 提供 安全 最大 的 问题 是 对 每个 应用程序 都 要 修改 。 所以 尽管 应用层 安全 服务 很 灵活 ， 但 应用 的 并不多 。 一般 需要 单项 的 安全 应用 时 ， 用 它 比较 有效 。 
 3 　 结束语 
 　 　 随着 人们 对 因特网 安全 问题 的 研究 ， 出现 了 各种各样 的 安全 产品 ， 仅 防火墙 的 产品 就 多 不胜 数 。 但是 ， 要 构筑 一个 安全 的 网络 ， 仅靠 1 个 、 2 个 产品 不行 ， 关键 是 要 有 合理 的 安全策略 ， 网络管理员 要 有 安全意识 ， 这样 才 可能 有效 地 抵御 外来 的 侵袭 。   
 作者 单位 ： 李建萍 　 郭 学理 　 武汉大学 网络 中心 ( 430072 ) 
 　 　 　 　 　 吕宏辉 　 武汉 工业 大学 计算机系 ( 430072 ) 
 参考文献 
 1 　 Oppliger   R . Firewalls   and   Beyond . Comminication   of   the   ACM , 1997 ; ( 5 ) 
 2 　 Thayer   R . Bulletproof   of   IP . Data   Comm , 1997 ; ( 11 ) 
 3 　 Kerr   R . Barbarians   at   the   Firewall . Byte   Magazine , S   1996 ; ( 9 ) 
 4 　 Brent   D ， Chapman   E , Zwicky   D 著 . 舒若 平译 . 构筑 因特网 防火墙 . 北京 ： 电子 工业 出版社 
 ( 收稿 日期 ： 1998 - 07 - 19 ) 
