计算机 研究 与 发展 
 JOURNAL   OF   COMPUTER   RESEARCH   AND   DEVELOPMENT 
 1999 　 Vol.36 　 No.6 　 P.717 - 724 
 
 
 
 利用 共轭 梯度 法 重建 三维 物体 表面 算法 的 研究 
 王汝传 　 王绍 棣 　 胡岚 
 摘 　 要 ： 通过 立体 视觉 方法 能 得到 一些 分散 点处 表面 信息 ， 根据 这些 分散 点处 三维 表面 信息 ， 可 对 三维 表面 进行 重建 ， 文中 主要 讨论 利用 共轭 梯度 法 重建 三维 物体 表面 的 算法 . 
 关键词 ： 共轭 梯度 法 ， 三维 物体 ， 重建 三维 物体 表面 
 分类号 ： TP391 
 RESEARCH   ON   AN   ALGORITHM   OF   REBUILDING   3D 
 OBJECT   SURFACE   USING   CONJUGATE   GRADIENT   METHOD 
 WANG   Ru - Chuan ， WANG   Shao - Di ， HU   Lan 
 ( Department   of   Computer   science   and   Technology , Nanjing   Institute   of   Posts   and   Telecommunications   Nanjing   210003 ) 
 Abstract ： By   using   stereopsis   the   3D   object   surface   informations   of   some   dispersive   points   can   be   obtained . Based   on   these   informations , the   3D   object   surface   can   be   rebuilt .   In   the   paper   here , an   algorithm   of   rebuilding   the   3D   object   surface   using   the   conjugate   gradient   method   is   discussed . 
 Key   words ： conjugate   gradient   method   , 3D   object , rebuilding   3D   object   surface ▲ 
 　 　 在 汽车 、 飞机 、 模具 等 机械行业 的 CAD / CAM 中 经常 涉及 到 曲面 重建 的 问题 ， 曲面 重建 的 首要 问题 是 通过 立体 视觉 方法 得到 一些 分散 点处 的 三维 表面 信息 ， 为了 得到 一个 完整 的 三维 表面 距离 和 方向 信息 ， 就 需要 根据 分散 点 的 表面 信息 对 三维 表面 进行 重建 . 从 理论 上 讲 ， 通过 已知 分散 点 的 表面 可以 有 无穷 多个 ， 因此 ， 所 需要 重建 的 是 一个 与 图像 信息 相一致 最佳 拟合 表面 . 
 1 　 视差 测距 原理 
 　 　 立体 视觉 是 基于 三角测量 原理 ， 利用 两个 或 多个 摄像机 对 同一 景物 从 不同 位置 的 成像 结果 来 恢复 距离 数据 的 一种 方法 . 配准 是 在 不同 成像 面上 找出 对应点 关系 ， 通过 配准 得到 的 是 二维 视差 信息 ， 要 转换 为 主体 视觉 所 需 的 三维 深度 值则 需要 借助于 成像 模型 来 进行 视差 测距 ， 视差 测距 的 原理 如图 1 所示 . 
 
 
 图 1 　 视差 测距 原理图 
 　 　 在 图 1 中 ， Cl , Cr 分别 为 左 、 右 两个 相机 的 光学 中心 位置 ( 透镜 中心 ) ， Cl 与 Cr 之间 的 距离 为 b ， 相机 焦距 为 f . 设 物体 上 的 点 P 在 左 、 右 相机 图像 面上 的 投影 分别 为 Pl 、 Pr ， P 与 Cl 和 Cr 的 连线 间 的 距离 为 d ， 过 Cl 和 Cr 分别 向 图像 面作 垂线 ， 垂足 分别 为 Al ， Ar ， 过 P 向 图像 面作 垂线 ， 垂足 为 B . 令 | AlPl | = la , | ArPr | = lb , | PrB | = a ， 则 由 相似 三角形 可 得 ： 
 　 　 ( 1 ) 
 　 　 ( 2 ) 
 由式 ( 1 ) 和 式 ( 2 ) 可 得 ： 
 　 　 ( 3 ) 
 从而 有 
 　 　 ( 4 ) 
 代入 式 ( 1 ) 可 得 ： 
 　 　 ( 5 ) 
 　 　 由 上式 可以 看出 ， 距离 d 与 b ， f 和 la - lb 有关 . la - lb 称为 点 P 在 左右两个 图像 面 . 
 2 　 三维 表面 重建 的 算法 
 　 　 通过 立体 视觉 方法 仅能 得到 的 图像 特征 点处 的 稀疏 视差 值 ， 为了 得到 一个 完整 的 三维 表面 ， 就 需要 根据 分散 点处 的 信息 来 进行 三维 表面 的 重建 ， 我们 将 根据 计算机 图形学 的 相关 理论 及 数学 规划法 、 共轭 梯度 法来 细化 、 优化 一种 进行 三维 表面 重建 的 算法 . 
 　 　 从 理论 上 讲 ， 通过 已知 分散 点 的 表面 可以 有 无数 多个 ， 例如 通过 一个 已知 圆弧 上 的 点 的 表面 可以 是 平 的 圆盘 ， 也 可以 是 半球 或 由 辐射状 正弦 函数 形成 的 卷 曲面 等 . 因此 ， 三维 表面 的 恢复 是 要 重建 一个 与 图像 信息 一致 的 最佳 拟合 表面 . 这样 一个 最佳 拟合 表面 是 存在 的 ， 并且 这个 表面 使得 二次 变分 函数 
 　 　 ( 6 ) 
 达到 最小值 ， 其中 S 是 一个 表面 . 
 2.1 　 算法 的 细化 
 　 　 求式 ( 6 ) 的 二次 变分 函数 的 最小值 可 看成 一个 优化 问题 ， 而且 已知 的 是 分散 的 数据 ， 所以 应 采用 数学 规划法 来 进行 优化 . 
 　 　 ( 1 )   数学 规划法 
 　 　 利用 数学 规划法 的 简单 描述 如下 ： 首先 ， 将 表面 划分 成 m × m 的 网格 ， 所 要 计算 的 就是 每一 网格 点上 的 表面 信息 . 因此 ， 可以 将 每 一个 表面 看成 是 一个 m2 维 向量 空间 中 的 一个点 ， 其 每 一维 代表 网格 上 每 一点 的 值 . 将 这个 m2 维 的 向量 扩展 到 ( m2 + 1 ) 维 ， 使得 最后 一维 是 二次 变分 函数 Θ ( S ) 的 值 . 这样 ， 就 在 ( m2 + 1 ) 维空间 中 建立 一个 “ 超面 ” ， 称为 目标 面 . 求 ( 6 ) 式 的 最小值 也 就 等同于 在 这个 目标 面上 寻求 一个 最低点 ， 这 一点 所 代表 的 表面 即 为 所 要求 的 表面 . 
 　 　 数学 规划法 通过 迭代 过程 来 寻求 目标 面上 的 最低点 ： 
 　 　 ① 　 选择 目标 面上 的 一个点 作为 起始 点 . 
 　 　 ② 　 在 目标 面上 检测 该点 的 一个 局部 区域 ， 选取 这一 区域 中 的 最低点 . 
 　 　 ③ 　 以 最低点 作为 新 的 起始 点 ， 重复 上述 过程 直到 满足要求 为止 . 
 　 　 ( 2 )   目标 函数 的 确定 
 　 　 式 ( 6 ) 所 给出 的 二次 变分 函数 是 连续 的 ， 在 应用 数学 规划法 的 时候 ， 需将 它 转换成 离散 的 形式 . 由于 在 Θ ( S ) 中有 平方根 运算 ， 因此 求 Θ ( S ) 的 最小值 等同于 求 平方 项 的 最小值 . 
 　 　 对于 m × m 的 网格 ， 另 每 一 网格 点 的 坐标 为 ( i , j ) ， 表示 第 i 行 、 第 j 列 的 网格 点 ， 网格 点上 的 每 一点 用 S ( i , j ) 来 表示 . 按行 或 按列 的 次序 排列 S ( i , j ) ， 可 得 一个 m2 维 的 向量 S = { S ( 0 , 0 ) , S ( 0 , 1 ) ， … ， S ( m - 1 , m - 1 ) } . 在 离散 形式 下 ， 设 网格 间距 为 h ， 则 近似 的 有 ： 
 
 　 　 再 把 双重 积分 转化 为 等价 的 离散 形式 ， 由此 ， 得到 如下 的 目标 函数 ： 
 
 　 　 表面 重建 问题 等价 于 使 这 一 目标 函数 达到 最小 . 因为 表面 的 重建 基于 一些 离散 的 点集 ， 所以 该 目标 函数 的 约束条件 为 ： 
 　 　 令 　 Φ = { ( i , j ) | 网络 点 ( i , j ) 上 的 深度 已知 的 点集 } 
 　 　 则 对于 所有 在 Φ 的 点 ( i , j ) ， 都 有 
 S ( i , j ) - C ( i , j ) = 0 　 　 ( 11 ) 
 　 　 其中 C ( i , j ) 是 反映 立体 数据 的 一组 约束 . 
 2.2 　 共轭 梯度 法对 算法 进行 优化 
 　 　 从 前面 的 推导 可以 看出 ， 该 目标 函数 是 二次 的 ， 具有 “ 凸 ” 的 性质 ， 所以 在 目标 面上 得到 的 局部 最小 点 即 为 全局 的 最小 点 . 再者 ， 因为 目标 函数 的 约束 是 线性 的 ， 目标 函数 的 最小化 可以 采用 梯度 投影 法来 解决 ； 同时 ， 还 可以 把 约束 直接 合并 到 目标 函数 ， 这 就 等价 于 一个 无约束 的 目标 函数 优化 问题 ， 就 可以 采用 共轭 梯度 法来 解决 . 这里 用 的 就是 共轭 梯度 法 ， 目标 函数 转换 为 ： 
 
 β 是 一个 表示 拟合 程度 的 参数 . 
 2.2 . 1 　 共轭 方向 
 　 　 共轭 梯度 法 ( conjugate   gradient   methods ) 是 求解 无约束 最优化 问题 的 一种 有效 的 最优化 方法 ， 它 的 基本 思想 是 利用 目标 函数 在 已知 点处 的 梯度 构成 一组 共轭 方向 并 沿 这组 方向 进行 搜索 ， 求 出 目标 函数 的 极小值 点 . 
 　 　 设 A 为 n × n 的 对称 正定 矩阵 ， 如果 En 中 的 两个 方向 d ( 1 ) 和 d ( 2 ) 满足 
 ( d ( 1 ) ) TAd ( 2 ) = 0 　 　 ( 13 ) 
 则 称 这 两个 方向 关于 A 共轭 ， 或 称为 它们 为 A 的 两个 共轭 方向 . 
 　 　 设 二次 函数 为 
 　 　 ( 14 ) 
 式 中 ， A 为 n × n 的 对称 正定 矩阵 ， x = ［ x1 , x2 , … , xn ］ T , bT = ［ b1 , b2 , … , bn ］ . 
 　 　 ( 15 ) 
 　 　 对于 两个 变量 的 问题 ， 可以 直观 地用 图形 来 表示 ， 如图 2 所示 . 
 
 
 图 2 　 共轭 方向 的 性质 
 　 　 设 从 某 一点 x ( 0 ) 出发 沿 d ( 1 ) 方向 搜索 ， 使 f ( x ) 达到 极小值 点 x ( 1 ) ， 则 点 x ( 1 ) 必为 该处 等高线 的 节点 ， 此点 的 梯度方向 为 等高线 的 法线 方向 . 因此 ， 
 Tf ( x ( 1 ) ) d ( 1 ) = ( b + Ax ( 1 ) ) Td ( 1 ) = 0 　 　 ( 16 ) 
 如果 从 另 一点 x ( 0 ) 出发 沿 d ( 1 ) 方向 搜索 ， 可得 另 一 极小值 x ( 2 ) ， 同理 则 有 
 Tf ( x ( 2 ) ) d ( 1 ) = ( b + Ax ( 2 ) ) Td ( 1 ) = 0 　 　 ( 17 ) 
 式 ( 17 ) 与 式 ( 16 ) 的 差为 
 ( x ( 2 ) - x ( 1 ) ) T = Ad ( 1 ) = 0 　 　 ( 18 ) 
 令 
 d ( 2 ) = x ( 2 ) - x ( 1 ) 　 　 ( 19 ) 
 则 有 
 ( d ( 2 ) ) TAd ( 1 ) = 0 　 　 ( 20 ) 
 也 即 方向 d ( 2 ) 与 d ( 1 ) 为 A 的 两个 共轭 方向 . 由图 2 可见 ， d ( 2 ) 正是 x ( 1 ) 与 x ( 2 ) 两 切点 连线 的 方向 ， 此 方向 上 的 极小值 点 即 为 函数 f ( x ) 的 最 优点 x * . 
 　 　 由此可见 ， 对于 二元 二次 函数 ， 只要 依次 沿 方向 d ( 2 ) 与 d ( 1 ) 进行 一维 搜索 ， 则 经 两次 迭代 必然 达到 极小值 点 ； 而 对于 欧氏 空间 上非 负定 的 二次 函数 ， 可以 用 不 超过 n 次 的 搜索 达到 极小值 点 . 
 2.2 . 2 　 共轭 梯度 法 的 计算 步骤 
 　 　 共轭 梯度 法 迭代 计算 步骤 如下 ： 
 　 　 ( 1 ) 　 给定 初始 点 x ( 0 ) 和 允许 误差 ε ， 置 步数 k = 0 ； 
 　 　 ( 2 ) 　 计算 函数 f ( k ) 在 x ( k ) 处 的 梯度 向量 g ( k ) = f ( x ( k ) ) ， 检验 是否 满足 ‖ g ( k ) ‖ ≤ ε ， 若 满足 则 停止 计算 ， 所得 的 x ( k ) 即 为 近似 最优 解 x * ； 否则 ， 令 d ( k ) = - g ( k ) ； 
 　 　 ( 3 ) 　 从 x ( k ) 出发 ， 沿 方向 d ( k ) 作 一维 搜索 ， 满足 ， 令 x ( k + 1 ) = x ( k ) + λ kd ( k ) ； 
 　 　 ( 4 ) 　 计算 , 校验 ‖ g ( k + 1 ) ‖ ≤ ε ， 若 满足 则 停止 计算 ， x ( k + 1 ) = x * ； 否则 转步 ( 5 ) ； 
 　 　 ( 5 ) 　 判别 是否 k = n ， 若 是 ， 表示 迭代 了 n 次 ， 已用 完 n 个 共轭 方向 ， 令 x ( 0 ) = x ( k + 1 ) , k = 0 , 转步 ( 2 ) ； 否则 转步 ( 6 ) ； 
 　 　 ( 6 ) 　 计算 
 
 　 　 ( 7 ) 　 置 步数 k = k + 1 ， 返回 步 ( 3 ) . 
 2.2 . 3 　 目标 函数 梯度 的 求取 
 　 　 式 ( 12 ) 给出 了 目标 函数 的 形式 ， 在 对 其求 梯度 时 ， 根据 i ， j 的 取值 可 分成 以下 6 种 情况 . 为 方便 起 见 ， 先 考虑 目标 函数 中 双重 求和 的 前 3 项 ， 不 包括 约束 部分 ： 
 　 　 ( 1 ) 　 在 网格 中央 的 点 ， 即 ： ( i , j ) ∈ { ( i , j ) | 2 ≤ i ≤ m - 3 , 2 ≤ j ≤ m - 3 } ， 共 ( m - 4 ) 2 个点 ， 则 
 
 / * 把 式 ( 12 ) 第 1 项 、 第 2 项 和 第 3 项求 偏导 * / 
 
 为了 体现 出 其中 的 规律性 ， 令上 式 为 ： 表示 每一项 的 系数 ， 排列 如下 ： 
 
 其中 系数 40 所 对应 的 为 S ( i , j ) 项 ， 其余 可 类推 . 
 　 　 所以 在 S ( i , j ) 点处 的 梯度 为 t ( i , j ) 与 S ( i , j ) 逐项 相乘 的 和 ， 其 关键 是 求出 t ( i , j ) 的 值 ， 以下 就 不再 一一 推导 ， 直接 给出 各个 t ( i , j ) 的 值 . 
 　 　 ( 2 ) 　 网格 的 4 个 项点 ， 即 ： ( i , j ) ∈ { ( 0 , 0 ) , ( 0 , m - 1 ) , ( m - 1 , 0 ) , ( m - 1 , m - 1 ) } ， 相应 的 4 组 系数 以点 ( 0 ， 0 ) 为例 推导 可 得 ： 
 
 　 　 根据 4 组 系数 整理 得 ： 
 
 　 　 从 上 可以 看出 ， 系数 的 值 是 基于 所求 梯度 点 的 位置 而 排列 的 ， 可 通过 其中 之一 的 “ 旋转 ” 得到 ． 在 后续 的 几种 情况 中 ， 就 给出 系数 的 一个 排列 作为 “ 模板 ” ． 
 （ 3 ） 在 网格 的 边上 并且 距离 顶点 一个 单位 长度 的 8 个点 ， 即 ： ( i , j ) ∈ { ( 0 , 1 ) , ( 0 , m - 2 ) , ( m - 1 , 1 ) ( m - 1 , m - 2 ) , ( 1 , 0 ) , ( m - 2 , 0 ) , ( 1 , m - 1 ) , ( m - 2 , m - 1 ) } ， 以点 S ( m - 1 , m - 2 ) 为例 计算 梯度 ： 
 
 由此 可得 其 系数 的 计算 “ 模板 ” 为 ： 
 
 　 　 ( 4 ) 　 在 网格 的 边上 ， 去掉 ( 2 ) ( 3 ) 两种 情况 中 列出 的 点 ， 即 ： ( i , j ) ∈ { ( i , j ) | ( ( j = 0 或 j = m - 1 ) , ( 2 ≤ i ≤ m - 3 ) ) ∪ ( ( i = 0 或 i = m - 1 ) , ( 2 ≤ j ≤ m - 3 ) ) } ， 共 4 ( m - 4 ) 个点 . 以点 ( i , j ) ∈ { ( i , j ) | ( ( i = m - 1 ) , ( 2 ≤ j ≤ m - 3 ) ) } 为 例来 计算 梯度 ： 
 
 由此 可得 其 系数 的 计算 “ 模板 ” 为 ： 
 
 　 　 ( 5 ) 　 距离 每 边 一个 单位 长度 的 4 个点 ， 即 : ( i , j ) ∈ { ( 1 , 1 ) , ( m - 2 , 1 ) ( 1 , m - 2 ) , ( m - 2 , m - 2 ) } ， 以点 S ( m - 2 , 1 ) 为 例来 计算 梯度 ： 
 
 由此 可得 其 系数 计算 “ 模板 ” 为 ： 
 
 　 　 ( 6 ) 　 在 距离 网格 边缘 一个 单位 长度 的 4 条 边上 ， 去掉 ( 3 ) ( 5 ) 两种 情况 列出 的 点 ， 即 ： ( i , j ) ∈ { ( i , j ) | ( ( i = 1 或 i = m - 2 ) , ( 2 ≤ j ≤ m - 3 ) ) ∪ ( ( j = 1 或 j = m - 2 ) , ( 2 ≤ j ≤ m - 3 ) ) } ， 其 4 ( m - 4 ) 个点 . 以点 ( i , j ) ∈ { ( i , j ) | ( ( j = m - 2 ) , ( 2 ≤ i ≤ m - 3 ) ) } 为 例来 计算 梯度 ： 
 
 由此 可得 其 系数 计算 “ 模板 ” 为 ： 
 
 　 　 计算 目标 函数 的 梯度 时 ， 在 应用 上述 6 种 计算 “ 模板 ” 计算 出式 ( 12 ) 前 三项 梯度 的 基础 上 ， 再 加 约束条件 部分 的 梯度 即可 求得 目标 函数 的 梯度 . 求得 梯度 后 ， 根据 前面 所 给出 共轭 梯度 法 的 计算 步骤 ， 就 可以 求 出 目标 函数 的 最小值 ， 也 求得 所 需 的 表面 . 
 　 　 以下 所附 的 图 ( 图 3 和 图 4 ) 是 采用 上述 算法 重建 的 表面 . 图中 重建 表面 所 基于 的 点 是 根据 Marr - Poggio 立体 算法 计算 所得 的 ， 这些 点 包含 了 图像 的 深度 信息 . 
 
 
 图 3 　 盘旋 状 楼梯 的 重建 表面 之一 ( β = 1 ) 
 
 
 图 4 　 盘旋 状 楼梯 的 重建 表面 之二 ( β = 0.1 ) 
 　 　 由图 可得 ： 拟合 程度 参数 β 表示 了 所 重建 表面 的 “ 光滑 ” 程度 ， 太大 或 太小 都 不能 很 好 地 重建 表面 . 为 求得 最优 的 β 值 ， 可 采用 下述 的 方法 ： 取 在 图像 配 准时 匹配 有误 的 点 进行 β 值 的 测试 ， 如果 β 所取 的 值 在 重建 表面 时能 使 这些 匹配 有误 的 点 影响 表面 的 形状 ， 那么 这个 β 值 就 被 采用 . 
 　 　 从 两幅 图中 可以 看出 ： 在 图像 配准 求得 的 特征 点 的 基础 上 ， 通过 应用 共轭 梯度 法求 二次 变分 函数 的 最小值 来 进行 物体 三维 表面 的 重建 是 一个 可行 的 方法 ， 它 的 算法 思路清晰 ， 计算 量 小 ， 是 利用计算机 视觉 理论 解决 高级 虚拟环境 中 视觉 问题 的 一个 有效 方法 . 
 3 　 结 　 　 语 
 　 　 立体 视觉 是 基于 三角测量 原理 ， 利用 两个 或 多个 摄像机 对 同一 景物 从 不同 位置 的 成像 结果 来 恢复 距离 数据 的 一种 方法 ， 为了 最终 恢复 空间 物体 的 三维 形状 ， 立体 视觉 中 一般 需要 解决 以下 3 方面 的 问题 ： 图像 面上 视差 计算 ， 由 视差 恢复 某些 点 的 三维 坐标 以及 由 稀疏 的 三维 数据恢复 表面 . ■ 
 作者简介 ： 王汝传 ， 男 ， 1943 年 8 月生 ， 教授 ， 目前 主要 从事 计算机软件 、 计算机 图形 和 虚拟 　 　 　 　 　 　 技术 等 . 
 　 　 　 　 　 王绍 棣 ， 1942 年 11 月生 ， 教授 ， 目前 主要 从事 计算机 通信 、 图像处理 技术 等 . 
 　 　 　 　 　 胡岚 ， 女 ， 1973 年 8 月生 ， 硕士 研究生 ， 目前 主要 从事 计算机 通信 、 虚拟 技术 等 . 
 作者 单位 ： 王汝传 ( 南京 邮电学院 计算机科学 与 技术 系 　 南京 　 210003 ) 
 　 　 　 　 　 王绍 棣 ( 南京 邮电学院 计算机科学 与 技术 系 　 南京 　 210003 ) 
 　 　 　 　 　 胡岚 ( 南京 邮电学院 计算机科学 与 技术 系 　 南京 　 210003 ) 
 参考文献 ： 
 ［ 1 ］ Celni   G , Gossard   D . Deformable   curve   and   surface   finite   elements   for   free - form   shape   design .   ACM   SIGGRAP   Computer   Graphics , 1991 , 25 ( 4 ) : 257 ～ 266 
 ［ 2 ］ Choi   B   K , Lee   C   S . Sweep   surface   modelling   via   coordinate   transformations   and   blending . CAD , 1990 , 22 ( 2 ) : 87 ～ 96 
 ［ 3 ］ 唐荣锡 . CAD / CAM 技术 . 北京 ： 北京航空航天大学 出版社 ， 1994   
 ( Tang   Rongxi .   CAD / CAM   Technology ( in   Chinese ) . Beijing : Beijing   University   of   Aeronautics   and   Astronautics   Press ,   1994 ) 
 ［ 4 ］ 王汝传 . 计算机 图形 技术 原理 及其 应用 . 北京 ： 人民邮电出版社 ， 1997 
 ( Wang   Ruchuan .   Principle   and   Application   of   Computer   Graphics   Technology ( in   Chinese ) .   Beijing :   People ' s   Posts   &   Telecommunications   Publishing   House ,   1997 ) 
 ［ 5 ］ 卢章平 ， 谭建荣 ， 周广仁 . 曲面 重建 的 一种 实用 方法 的 研究 与 实现 . Chinagraph ' 96 论文集 . 1996.90 ～ 95 
 ( Lu   Zhangping ,   Tan   Jianrong ,   Zhou   Guangren .   Study   and   implementation   of   a   practical   method   for   camber   rebuilding . In   Chinagraph ' 96   Collected   Papers ( in   Chinese ) . 1996.90 ～ 95 ) 
 收稿 日期 ： 1998 - 07 - 16 
 修稿 日期 ： 1999 - 03 - 19 
