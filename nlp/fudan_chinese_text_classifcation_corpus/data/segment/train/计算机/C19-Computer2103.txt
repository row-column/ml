计算机 工程 
 COMPUTER   ENGINEERING 
 1999 年   第 25 卷   第 10 期   Vol.25   No.10   1999 
 
 
 
 通用 数据库 操作 模块 的 设计 与 实现 
 冯汉平 　 何 踊跃 　 吴琢琼 
 摘要 ： 在 分析 常用 SQL 数据 操作 语句 结构 的 基础 上 ， 介绍 了 一个 通用 数据库 操作 模块 的 设计 与 实现 。 该 模块 允许 助记 词 采用 填表 的 直观 形式 ， 实现 数据库 的 通用 查询 、 插入 、 删除 和 修改 ， 具有 功能 很大 、 操作 简单 等 优点 。 
 关键词 ： 数据库 ； SQL 语言 ； 数据 操作 
 The   Designing   and   Implementation   o   fa   General   Database   Manipulation   Module 
 Feng   Hanping   He   Yongyue   Wu   Zuoqiong 
 ( Systems   Engineering   Institute   of   Xi ' an   Jiaotong   University , Xi ' an   710049 ) 
 【 Abstract 】 Based   on   the   analysis   of   the   structure   of   common   SQL   data   manipulation   sentences , this   paper   inrtoduces   the   designing   and   implementation   of   a   general   database   manipulation   module . This   module   offers   the   users   a   visualized   way   of   filling   up   forms   which   executes   the   general   database   functions   of   query , insertion , deletion   and   update . It   is   highly   functional   and   easy   to   use 
 【 Key   words 】 Dataase ; SQL   language ; Data   manipulation 
 　 　 在 一个 较 复杂 的 管理信息系统 中 ， 查询 和 更新 数据库 都 是 常用 的 操作 。 通常 的 做法 是 按照 预先 设定 的 方式 提供 某些 数据库 操作 ， 如 数据录入 、 查询 、 统计 、 报表 输出 等 。 其 弊端 是 ： 1 ) 不能 适应 用户 需求 的 变化 ， 缺乏 灵活性 ； 2 ) 对 数据库 结构调整 的 适应能力 不 强 ； 3 ) 对 用户 不 常用 的 操作 也 需要 专门 编写 代码 ， 浪费 人力物力 。 因此 有 必要 开发 一个 通用 的 数据库 操作 模块 ， 以 一种 简单明了 的 方式 ， 向 用户 提供 灵活 安全 的 数据库 操作能力 ， 以 适应 用户 的 各种 要求 。 本文 介绍 的 通用 数据库 操作 模块 在 Delphi 环境 下 实现 , 其 思想 可以 很 容易 地 移植 到 其他 基于 Windows 的 开发 环境 上 。 
 1 　 基本思路 
 　 　 SQL 语言 是 关系数据库 的 标准 语言 ， 兼有 数据 定义 、 数据 操作 和 数据 控制 的 功能 。 它 不但 语义 功能强大 ， 而且 可以 为 Delphi 等 很多 编程 软件 直接 执行 ， 用 它 来 表示 用户 访问 数据库 的 要求 是 个 很 好 的 选择 。 但是 不能 让 用户 直接 使用 SQL 语言 ， 因为 ： 1 ) 需要 输入 大量 的 英文 文本 ， 可操作性 差 ， 界面 不够 友好 ； 2 ) 无法 保证 数据安全 。 受到 域 运算 语言 QBE 的 启发 [ 1 ] ， 本 模块 采用 填表 的 方式 ， 在 全中文 图形界面 下 ， 由 程序 把 用户 的 要求 解释 成 SQL 语句 ， 从而 把 面向 专业 人员 的 SQL 语言 以 一种 简便 直观 的 方式 提供 给 普通 的 中文 用户 。 在 解释 过程 中 进行 的 权限 检查 ， 可以 确保 数据 的 安全 。 
 1.1   SQL 数据 操作 语句 的 分析 
 　 　 SQL 语言 的 数据 定义 和 数据 控制 语句 一般 不 需要 也 不 允许 终端用户 使用 ， 用户 通常 只用 到 查询 、 插入 、 删除 和 更新 等 4 种 数据库 操作 ， 表现 在 SQL 语句 上 是 4 种 常用 的 句型 ： 
 　 　 Select 〈 字 段 列表 〉 from 〈 表名 〉 [ , 〈 表名 〉 … 〈 [ where 〈 条件 〉 ] 
 　 　 Insert   into 〈 表名 〉 [ ( 〈 字 段 列表 〉 ) ] values ( 〈 值 列表 〉 ) 
 　 　 Delete   from 〈 表名 〉 [ where 〈 条件 〉 ] 
 　 　 Update 〈 表名 〉 set 〈 修 正式 列表 〉 [ where 〈 条件 〉 ] 
 　 　 进一步 的 语法分析 表明 ， 这些 操作 可以 归结为 ： 对 目标 〈 数据表 〉 中 满足 特定 〈 条件 〉 的 记录 中 某些 〈 字 段 〉 ， 进行 某种 〈 操作 〉 ( 查询 、 插入 、 删除 、 修改 ) 。 因此 ， 数据表 、 字 段 列表 、 条件 表达式 、 操作 类型 就 构成 了 SQL 语句 的 4 个 要素 。 〈 值 列表 〉 和 〈 修 正式 列表 〉 也 是 针对 各字 段 的 插入 值 或 修改 值 ， 可以 归结到 字 段 列表 要素 中 去 。 从而 ， 确定 SQL 语句 的 过程 就 转化 为 确定 这 4 个 要素 的 过程 。 
 　 　 允许 使用 复杂 的 条件 是 SQL 语言 最 强大 的 功能 之一 ， 条件 表达式 是 一个 逻辑 表达式 ， 可以 归结为 ： 
 　 　 〈 条件 〉 : = 〈 子 条件 〉 or | and 〈 子 条件 〉 [ or | and 〈 子 条件 〉 … ] 
 　 　 〈 子 条件 〉 : = 〈 字 段 〉 〈 操作符 〉 〈 表达式 〉 
 　 　 〈 操作符 〉 : = > | < | = | > = | < = | < > 
 　 　 在 〈 子 条件 〉 中 ， 〈 操作符 〉 左边 虽 不 一定 是 字 段 ， 但 经过 变换 ， 都 可以 归结为 其 左边 是 字 段 的 形式 。 〈 操作符 〉 右边 的 〈 表达式 〉 可以 引用 其它 的 字 段 。 为了 直观 地 表达 〈 子 条件 〉 之间 的 “ 与 ” 和 “ 或 ” 的 关系 ， 使用 了 一种 如表 1 所示 的 表格 输入 方式 。 当 两个 〈 子 条件 〉 之间 是 “ 或 ” 的 逻辑关系 时 ， 在 不同 的 条件 行 输入 ； 是 “ 与 ” 的 关系 且 涉及 不同 的 〈 字 段 〉 时 ， 在 同一个 条件 行 的 不同 列内 输入 ； 若 涉及 同一 〈 字 段 〉 ， 且 相互之间 是 “ 与 ” 的 关系 ， 可 在 表中 同一 格内 输入 ， 并用 逗号 隔开 。 在 生成 条件 表达式 时 ， 先 执行 同一 条件 行内 的 “ 与 ” 关系 ， 再 执行 条件 行间 的 “ 或 ” 关系 ， 这样 可以 表达 任意 复杂 的 条件 。 在 表中 输入 〈 子 条件 〉 ， 只 需 在 条件 行 相应 于 〈 字 段 〉 的 列 填写 〈 操作符 〉 和 〈 表达式 〉 即可 ， 参看 图 2 。 
 表 1 　 表格 输入 方式 
 数据表 名字 段   1 字段   2 字段   3 
 字 段 列表 　 　 　 
 条件 　 　 　 
 条件 　 　 　 
 
 图 2   主 界面 
 　 　 在 具体 实现 时 ， 确定 操作 类型 和 数据表 名 的 过程 是 独立 进行 的 ， 模块 分别 把 前述 4 种 操作 类型 和 系统 可 操作 的 表名 以 按钮 和 列表 的 形式 ， 提供 给 用户 选择 。 确定 字 段 列表 和 条件 表达式 的 过程 同时 进行 ： 用户 根据 实际 需要 将 数据库 操作 的 要求 填入 如表 1 所示 的 表格 中 ， 模块 根据 表格 中字段 列表 行 的 内容 ， 可以 确定 各项 操作 的 目标 字 段 ； 根据 表中 条件 行 的 内容 ， 可以 确定 条件 表达式 。 确定 这 4 个 要素 后 ， 系统 只 需要 按照 SQL 的 句法 规律 就 可以 合成 正确 的 SQL 指令 了 。 
 1.2   多表 的 连接 
 　 　 若 用户 选择 了 多个 数据表 ， 程序 将 自动 搜索 这些 数据表 之间 共有 的 字 段 ， 生成 连接 条件 。 默认 的 连接 条件 具有 Table1 . C1 = Table2 . C1 [ and … ] 的 形式 ， 其中 Table1 和 Table2 是 要 进行 连接 的 数据表 名 ， C1 是 公共 字 段 。 用户 也 可以 自己 输入 连接 条件 。 若 用户 在 进行 多表 连接 时 仍 想 实现 更新 ， 模块 可 在 这些 表上 建立 一个 视图 ， 这时 用户 就 可以 像 在 单表上 操作 一样 插入 、 删除 和 修改 了 ， 不过 这 需要 在 支持 视图 的 后台 数据库 上 才能 实现 。 
 1.3   中文 的 处理 
 　 　 由于 大部分 桌面 和 后台 数据库系统 都 使用 英文 作 字段名 ， 为了 引入 中文 描述 ， 模块 中 使用 了 如下 类 记录 字段 的 信息 ： 
 　 　 TFieldInf = class 
 　 　 　 Name : string ; 　 　 　 / / 字段名 
 　 　 　 Description : string ; 　 / / 字段 的 中文 描述 
 　 　 　 AllowUpdate : boolean ; 　 / / 标识 是否 允许 修改 
 　 　 end ; 
 　 　 模块 中有 专门 的 程序 把 字符串 中表名 或 字 段 的 中文 描述 转换成 对应 的 英文 。 这样 ， 用户 可以 直接 在 中文 环境 下 进行 各种 操作 ， 程序 的 其它 部分 也 可以 直接 使用 中文 描述 ， 只 需 在 最后 调用 一下 转换 程序 。 对于 常用 的 中文 描述 ， 模块 提供 了 快捷 菜单 ， 以 方便 用户 的 输入 。 下文 在 不 引起 歧义 的 情况 下 ， 对表名 ( 字段名 ) 及其 中文 描述 不 作 严格 区分 。 
 1.4   数据 的 安全性 
 　 　 模块 设置 了 标志 是否 允许 更新 的 权限 参数 ， 并 在 解释 过程 中 进行 权限 检查 ， 对 数据 的 控制 可以 精确 到 字 段 ， 确保 数据 的 安全 。 
 2 　 系统 的 实现 
 　 　 本 模块 实现 了 查询 、 插入 、 删除 、 修改 等   4   种 通用 的 数据库 操作 ， 其 各个 功能模块 之间 的 调用 关系 如图 1 。 
 
 图 1   系统 调用 关系 
 2.1   主控 模块 
 　 　 主控 模块 是 主要 的 人机接口 ， 其 功能 是 接受 用户 的 输入 ， 并 传递 给 相应 的 功能模块 ， 同时 将 系统 信息 返回 给 用户 。 主控 模块 首先 要求 用户 选择 要 处理 的 数据表 ， 然后 从 其中 取出 各个 字段名 ， 并 在 窗口 中以表 1 所示 的 形式 显示 出来 ， 接受 用户 的 输入 。 
 2.2   条件 生成 模块 
 　 　 条件 生成 模块 根据 用户 在 条件 行中 填入 的 信息 生成 条件 表达式 。 如图 2 中 所示 的 为 查询 所有 欠费 的 住户 信息 。 程序 生成 的 条件 表达式 为 “ 电费 应收 金额 > 电费 实收 金额 or   水费 应收 金额 < 水费 实收 金额 ” ( 对于 多表 连接 查询 ， 生成 的 条件 表达式 中 各字 段 前 将 带上 所在 的 表名 ， 并 与 数据表 的 连接 条件 作 “ 与 ” 运算 。 ) 
 2.3   查询 模块 
 　 　 查询 模块 除了 可 进行 复杂 的 条件 查询 外 ， 还 能 实现 一些 统计 功能 。 例如 ， 用户 想求 总 电费 应收 金额 ， 只 需 在 第二行 中 “ 电费 应收 金额 ” 下 输入 “ sum ” 或 “ 总和 ” ， 并 清除 其它 字段 的 查询 状态 即可 。 模块 支持 的 统计 函数 如表 2 所示 。 查询 的 结果 在 窗口 的 底部 显示 。 若 权限 允许 ， 用户 可 直接 在 查询 结果 上 修改 数据 。 
 表 2   常用 统计 函数 及其 中文 描述 
 统计 函数 中文 描述 
 Count 数目 
 Sum 总和 
 Avg 平均值 
 Max 最大值 
 Min 最小值 
 2.4   其它 功能模块 
 　 　 系统 中 的 插入 、 删除 、 修改 等 模块 ， 主要 完成 对 指定 的 数据表 进行 插入 、 条件 删除 或 条件 修改 等 功能 ， 其 操作过程 与 查询 子 模块 相似 。 在 这些 子 模块 中 ， 需要 生成 〈 字 段 列表 〉 、 〈 值 列表 〉 、 〈 修 正式 列表 〉 等 关键部件 ， 它们 的 生成 方式 类似 于 条件 表达式 。 以 〈 修 正式 列表 〉 为例 ， 假设 用户 需要 修改 “ 电费 应收 金额 ” 的 值 ， 可 在 此 字 段 下面 填写 修改 的 目标值 ， 如表 3 所示 。 用户 可以 同时 修改 多个 字 段 。 这些 模块 可以 帮助 用户 完成 很多 不 常用 的 操作 ， 例如 “ 把 月 用电量 超过 100 度 的 住户 的 电费 打 9 折以 鼓励 用电 ” 等 操作 。   
 表 3   修改 操作 的 目标值 
 目标值 示例 生成 的 〈 修 正式 列表 〉 
 + 1 电费 应收 金额 = 电费 应收 金额 + 1 
 = 1 电费 应收 金额 = 1 
 电费 实收 金额 电费 应收 金额 = 电费 实收 金额 
 ( $ + 1 ) * 2 电费 应收 金额 = ( 电费 应收 金额 + 1 ) * 2 
 3 　 面向 Delphi 的 另 一种 实现 
 　 　 在 Delphi 中 ， TTable 和 TQuery 是 常用 的 两种 数据库 处理 控件 ， 它们 都 是 TBDEDataSet 的 子类 。 本 模块 也 可以 用 TBDEDataSet 的 对象 作为 调用 接口 。 这样 实现 主要 有 3 个 优点 ： 1 ) 可以 使用 Delphi 数据库 处理 控件 强大 的 计算 字段 和 LookUp 字段 功能 ； 2 ) 表中 字段名 及其 中文 描述 ， 以及 是否 允许 修改 的 标志 都 可以 直接 从 TBDEDataSet 对象 的 属性 中 得到 ； 3 ) 多表 的 操作 可以 用 Query 实现 ， 不需 另外 处理 。 不过 ， 这样 实现 就 不能 使用 SQL 语句 表示 处理 要求 了 ， 而 需用 TBDEDataSet 的 Filter 等 属性 ( 生成 方式 类似 于 SQL 语句 ) 以及 插入 删除 等 方法 ， 效率 比用 SQL 语句 低 一些 。   
 4 　 结束语 
 　 　 本文 介绍 的 通用 数据库 操作 模块 ， 实现 了 在 各种 表上 进行 复杂 的 查询 、 插入 、 删除 和 更新 ， 并 提供 了 安全 限制 和 一定 的 模糊 处理 能力 ， 用户 只 需 填表 便 可以 完成 各种 操作 ， 非常容易 掌握 。 作为 西安市 某 物业管理 公司 收费 信息管理系统 的 一个 功能模块 ， 已经 交付 用户 使用 ， 在 基于 以太网 的 InterBase 数据库系统 中 运行 良好 ， 深得 用户 好评 。 
 作者简介 ： 冯汉平 （ 1979 ～ ） ， 男 ， 硕士 ， 主攻 方向 ： 电力 调度 与 电力 市场化 
 作者 单位 ： 西安交通大学 系统工程 研究所 ， 西安 710049 
 参考文献 
 1   陈学 佺 , 陈 洪亮 . 数据库 原理 与 工程 应用 . 合肥 ： 中国 科学技术 大学 出版社 , 1996 
 2   萨师煊 , 王珊 . 数据库系统 概论 . 北京 ： 高等教育出版社 , 1994 
 3   薛 华成 . 管理信息系统 . 北京 ： 清华大学出版社 , 1993 
 收稿 日期 ： 1999 - 03 - 15 
