计算机 应用 研究 
 APPLICATION   RESEARCH   OF   COMPUTERS 
 2000 　 Vol.17 　 No.2 　 P.95 - 96 
 
 
 
 轴承 压装 及 跑 合 试验 微机 数据 采集 处理 系统 
 郝宗潮 　 唐建湘 
 摘   要   介绍 了 基于 集散 式 结构 的 微机 数据 采集 处理 系统 在 铁道 车辆 轴承 压装 及 跑 合 试验 台上 的 应用 ， 阐述 了 系统 检测 原理 、 硬件 结构 及 系统软件 的 编制 方法 。 
 关键词   微型 计算机   集散 式 检测   数据 采集 处理   串行 通信 
 1   前言 
 　 　 为 保证 行车 安全 ， 车辆 生产 检修 部门 必须 进行 车辆 滚动轴承 的 压装 压力 检测 以及 轮 对 跑 合 试验 ， 对于 这 两个 过程 的 检测 部分 可以 根据 采用 分级 分布式 检测 原理 ， 将 两者 合二为一 ， 以 达到 减少 投资 ， 方便管理 的 目的 。 该 微机 数据 采集 处理 系统 作为 轴承 的 压装 及 跑 合 试验 综合性 能 检测 的 配套 设备 ， 能 对 多路 压力 、 温度传感器 进行 巡回 检测 、 实时处理 ， 而且 预留 了 接口 ， 以便 为 以后 进一步 开发 的 轮 对 和 轴承 检修 流水线 上 其它 状态参数 的 检测 并网 ， 从而 实现 整个 流水线 微机 系统 的 科学管理 。 
 2   系统 检测 原理 
 　 　 该 系统 采用 分级 分布式 检测 原理 ， 系统 框图 如图 １ 所示 。 基于 微处理器 的 前端 数据 采集器 放置 在 传感器 附近 完成 A / D 转换 ， 经 环形 数据 通信子网 ， 将 传感 信号 送入 主 控制器 ， 进行 初步 数据处理 后 ， 将 相应 的 温度 、 压力 等 参数 经 RS - 232 串行口 传送 到 上位 管理 微机 ， 由 微机 进行 较为 复杂 的 模式识别 及 轴承 压装力 和 轴承 温升 极限值 的 判别 ， 并 打印输出 结果 。 
 
 图 1 　 检测 系统 框图 
 3   系统 硬件 结构 
 　 　 系统 硬件 主要 包括 主 控制器 、 环形 数据通讯 子网 、 前端 数据 采集器 及 压力 和 温度传感器 。 
 3.1   主 控制器 
 　 　 主 控制器 主要 由以 89C51   CPU 为 核心 的 最小 系统 、 RS - 232 串行接口 、 RS - 485 通讯 接口 等 部分 组成 。 其 框图 如图 2 所示 。 
 
 图 2 　 主 控制器 框图 
 　 　 在 8031 最小 系统 中 使用 看门狗 专用 芯片 MAX813 作 复位 控制 ， 与 管理 微机 通讯 的 RS - 232 接口 芯片 采用 MAX202 。 通讯 子网 采用 RS - 485 工业 级 通讯 总线 ， 这样 可以 增强 系统 的 抗干扰能力 ， 控制 芯片 采用 的 是 MAX1487 。 
 3.2   环形 数据 通信子网 
 　 　 本 系统 采用 RS - 485 总线 作为 分布式系统 的 通信子网 。 该 总线 一般 设计 成 多个 测试点 挂 在 同 一根 线上 ， MAX1487 最多 可 驱动 128 个点 ， 最长 传输 距离 可达 1 , 200 米 ， 其 基本 接线图 如图 3 所示 。 总线 接成 环形 冗余 形式 ， 并 采用 局域网 的 广播式 收发 制 ， 确保 线路 上 出现 了 一个 断点 后 数据 仍 能够 准确无误 地 传送 。 同时 将 直流电源 与 RS - 485 信号 同时 用 一根 四芯 屏蔽 电缆 传送 给 环行 数据通讯 子网 ， 让 屏蔽 层 与 电源线 同时 构成 多层 屏蔽 ， 以 保证 传输 可靠 。 
 
 图 3 　 MAX1487 基本 接 法 
 3.3   前端 数据 采集器 
 　 　 采集器 是 基于 89C2051 的 单片机 系统 ， 需要 测量 多点 温度 与 压力 ， 其 结构 框图 如图 4 所示 。 其中 温度传感器 选用 的 是 数字式 温度计 DS1820 ， 从 CPU 到 DS1820 只 需要 一根 数据线 ， 读写 和 完成 温度 转换 所 需 的 电源 可以 直接 由 数据线 本身 提供 ， 而 无需 外 接电源 。 同时 由于 每 一片 DS1820 都 有 一个 序列号 以示 区分 ， 可以 使 多个 DS1820 并存 于 一根 数据线 上 ， 以 减少 大量 传输线 。 压力 传感器 我们 采用 的 是 ZQY - 1 型 电阻 应变 式 压力 传感器 ， 量程 10Mpa 输出 40mV 。 模数转换 采用 内带 可编程 增益 放大器 的 ( - ( A / D 转换器 AD7710 ， 能够 达到 较 高精度 要求 。 
 
 图 4 　 前端 数据 采集器 
 4   系统软件 的 编制 
 　 　 本 系统 的 软件 编制工作 主要 包括 主 控制器 、 前端 数据 采集器 以及 上位 管理 微机 的 软件 编程 。 主 控制器 及 数据 采集器 的 程序 采用 MCS - 51 系统 汇编语言 编写 ， 管理 微机 软件 用 Visual   Basic   5 开发 。 下面 详细 介绍 一下 有关 通讯 部分 的 编程 。 
 4.1   通讯 总线 程序设计 
 　 　 约定 RS - 485 通讯 总线 上 每 一 模块 均 设定 唯一 地址 ， 且 都 能 作为 接收器 和 发送器 使用 。 首先 各 前端 机开 中断 等待 ( SM2 = 1 ) ， 主 控制器 发 地址 帧 ， 所有 前端 机对 地址 帧 产生 串口 中断 ， 将 地址 与 本机 地址 比较 ， 被 寻址 前端 机将 SM2 清 0 、 TB8 置 1 ， 把 本机 地址码 发回 供主 控制器 核对 ， 核对 正确 后 ， 被 选 前端 机将 采到 的 数据 以 数据 帧 发送给 主 控制器 ， 发送 完后 SM2 置 1 、 TB8 清 0 ； 未 被 寻址 前端 机 保持 SM2 为 1 ， 开 中断 等待 。 整个 通讯 总线 的 程序 包括 主 控制器 主程序 、 主 控制器 通信 子程序 、 前端 机主 程序 、 前端 机 中断 服务 子程序 。 
 4.2   RS - 232 串行接口 编程 
 　 　 主 控制器 与 上位 管理 微机 的 通信 采用 的 是 RS - 232 串行 通信 。 主 控制器 将 前端 数据 采集器 送来 的 数据 经 初步 处理 后 ， 按照 一定 的 格式 组装 成帧 ， 分组 发送给 上位 管理 微机 。 通信 波特率 设为 4 , 800   bps , 采用 奇 校验 。 由于 篇幅 所 限 ， 仅 给出 上位 机 的 部分 源程序 ( 采用 VB5 编写 ) 。 
 　 　 串行口 通讯 可用 VB 控件 MSComm 进行 编程 。 首先 在 窗体 ( Form1 ) 上 设置 一 MSComm 控件 ( MSComm1 ) , 根据 通迅 协议 ， 对 其 编程 如下 ： 
 Private   Sub   Form _ Load (   ) 
 　 MSComm1 . Parity = " 4800 , 8 , 0 , 1 "   ' 串口 参数 
 　 MSComm1 . ComPort = 2   ' Com2 为通 迅口 
 　 MSComm1 . InputLen   =   162   ' 读入 数据 长度 
 　 MSComm1 . InBufferCount   =   0   ' 清 输入 缓冲区 
 　 MSComm1 . RThreshold   = 162   ' 设置 响应 ' oncomm 函数 数据 个数 
 　 MSComm1 . OpenPort   ' 打开 通讯 口 
 End   Sub 
 　 　 上 段程序 将 串口 协议 参数设置 为 ： 波特率 4 , 800 、 8 位 数据位 、 奇 校验 、 1 位 停止 位 ， 同主 控制器 串口 参数 保持一致 。 读入 数据 的 长度 设为 162 ( 即 一个 数据 块 的 长度 ) ， 同时 将 MSComm1 的 RTHreshold 属性 设为 162 , 当 输入 缓冲区 接收 到 162 个 数据 时 ， 会 响应 oncomm 函数 的 comEvReceive 事件 ， 可 在 响应 此 事件 后 进行 数据处理 。 编程 如下 ： 
 Private   Static   Sub   MSComm1 _ OnComm   (   ) 
 　 Select   Case   MSComm1 . CommEvent 
 　 　 Case   comEvReceive 
 　 　 Dim   Buf1   As   Variant 
 　 　 Buf1 = MSComm1 . Input   ' 将 数据 块 读入 Buf1 中 
 　 　 MSComm1 . InBufferCount   =   0   ' 清 输入 缓冲区 
 　 　 　 　 …   ' 数据处理 部分 
 　 　 　 　 Case   ...   ' 其它 事件 时 的 处理 
 　 　 　 　 ... 
 　 End   Select 
 End   Sub 
 4.3   管理 微机 软件 
 　 　 这部分 软件 是 用户 直接 接触 和 使用 的 部分 ， 采用 VB5.0 编写 ， 运行 于 32 位 Windows 平台 ， 这些 平台 具有 强大 的 连网 和 数据共享 功能 ， 为本 系统 与 流水线 上 其它 的 检测 系统 联网 打下 了 基础 。 软件 界面 全部 采用 Windows 风格 的 图形界面 方式 ， 简单 易学 。 
 郝宗潮 （ 长沙 铁道 学院 机电 工程学院   信息 工程学院   长沙   410075 ） 
 唐建湘 （ 长沙 铁道 学院 机电 工程学院   信息 工程学院   长沙   410075 ） 
 参考文献 
 1 ， 邱公伟 等 .   多 微机 系统 的 通讯 技术 .   北京 ： 清华大学出版社 ,   1996 , 7 
 2 ， 李   华等 .   MCS - 51 系列 单片机 实用 接口技术 .   北京 ： 北京航空航天大学 出版社 ,   1993 , 8 
 3 ， 黄达胜 ,   李克明 .   197726 型 轴承 压装力 与 压装力 曲线 的 探讨 .   铁道 车辆 ,   1996 ,   ( 1 ) :   16 
 4 ， 中华人民共和国 铁道部 . 铁路 段修 规程 .   北京 ： 中国 铁道 出版社 .   1992 年 
 5 ， [ 美 ]   Eangelos   Petroutsos .   Visual   Basic5 从 入门 到 精通 .   北京 :   电子 工业 出版社 ,   1997 
 收稿 日期 ： 1999 年 7 月 16 日 
