计算机 应用 研究 
 APPLICATION   RESEARCH   OF   COMPUTERS 
 2000 　 Vol.17 　 No.5 　 P.31 - 32 
 
 
 
 一种 ATM 网络 服务质量 控制 的 软件 模拟 方法 
 刘 向东 　 耿江涛 　 杨 永田 　 俞瑛 
 摘     要     文章 提出 了 一种 对 ATM 网络 中 服务质量 控制算法 的 软件 模拟 方法 。 通过 这种 方法 ， 可以 对 控制算法 的 优劣 给出 一种 定量 的 评价 ， 从而 对 ATM 网络 中 的 服务质量 控制算法 的 改进 具有 一定 的 参考价值 。 
 关键词     ATM 网络     漏桶 算法     服务质量 保证       软件 模拟 
 1     引言 
 　 　 ATM 技术 是 一种 面向 连接 的 技术 ， 并且 可以 为 不同 的 连接 提供 不同 的 QoS ( Quality   of   Service ) 保证 。 另外 ， ATM 网络 具有 很 高 的 传输速率 ， 这 使得 它 适合 于 传输 从 一般 数据服务 到 实时性 要求 很 高 的 语音 、 视频 、 图象 等 多媒体业务 。 CCITT 已 在 1987 年 将 其 选为 将来 的 传输方式 ， 可以 说 ， ATM 是 未来 宽带 综合 业务 数字网 ( B _ ISDN ) 的 核心技术 [ 1 ] 。 ATM 技术 对于 QoS 的 控制 是 通过 各 方面 的 协调 来 完成 的 ， 但 它 主要 包括 两 方面 内容 ： 一是 接入 允许 控制 ( CAC ) ； 二是 业务 监控 ( Policing ) [ ２ ] 。 在 接入 允许 控制 过程 中 ， 网络 与 用户 间 就 业务 参数 达成协议 ； 业务 监控 的 任务 则 是 确保 信源 的 行为 遵守 CAC 协议 。 对于 QoS 的 保证 来说 ， 这 两者 是 同样 重要 的 ， 因此 它们 是 本 模拟 对象 中 最 主要 的 两个 部分 。 
 2     接入 允许 控制 及 业务 监控 
 　 　 接入 允许 控制 及 业务 监控 是 本 模拟系统 的 核心 部分 ， 对于 它们 的 模拟 是 建立 在 严格 的 数学分析 基础 之上 的 。 下面 分别 介绍 这 两 部分 。 
 　 　 假定 输出 链路 容量 CL ( Mb / s ) 已知 ， 它 能够 处理 N 个 具有 特定 的 QoS 请求 的 呼叫 ， 现在 的 任务 是 求出 CL 与 N 之间 的 制约 关系 。 无论是 语音 源 还是 视频 源 ， 在 经过 适当 的 转化 后 ， 都 可以 用 开关 模型 来 表示 [ ３ ] 。 假定 一个 信源 处于 活动状态 的 概率 为 p ， 峰值 速率 为 Rp 。 为了 简化 表示 ， 定义 m ( ≡ p ( N ) 为 平均 活动 信源 数 ， 显然 ， CL ≥ m ( Rp ， 不妨 设 CL = ( m + K × σ ) × Rp ， 这里 σ × Rp 是 标准偏差 ， K 为 常数 因子 。 文献 [ 4 ] 中 给出 了 K 和 σ 的 值 ： K = ( - ln ( 2 π ) - 2ln ε ) 1 / 2 , σ = ( N ( p ( ( 1 - p ) ) 1 / 2 ， 这里 的 ε 表示 信元 丢失 率 ， 它 由 流量 源 的 QoS 参数 指定 。 根据 以上 关系 ， 接入 允许 模块 就 可以 作出 是否 接纳 一个 呼叫 的 判断 了 。 
 　 　 ATM 网络 中 常用 的 流量 控制算法 是 漏桶 控制算法 [ 3 ] ， 它 实际上 是 一种 许可证 流控 方式 ， 通过 令牌 发放 速率 限制 入网 信元 长期 平均 速率 ， 而 漏桶 容量 决定 了 入网 业务 流 的 突发 程度 。 本 系统 采用 的 缓冲 漏桶 算法 是 对 基本 漏桶 算法 的 一种 改进 。 由于 增加 了 一个 信元 缓冲器 ， 突发 到达 而 暂时 得不到 令牌 的 信元 在 缓冲器 中 排队 等待 ， 因而 在 相同 漏桶 容量 下 这种 算法 可以 降低 信元 丢失 率 。 文献 [ 3 ] 中 提供 了 对 漏桶 控制算法 性能 的 详细分析 。 
 3     模拟系统 的 软件结构 
 　 　 本 模拟系统 当前 版本 是 使用 Microsoft   Visual   C++   6.0 结合 MFC   ( Microsoft   Foundation   Class ) 来 实现 的 ， 运行 于 Windows   NTTM 环境 下 ， 主要 由 四大 模块 组成 ， 即 流量 产生 模块 、 接入 允许 控制 模块 、 流量 控制 模块 和 网络资源 模块 ， 其 核心 为 接入 允许 控制 模块 和 流量 控制 模块 。 系统 为 流量 产生 模块 、 接入 允许 控制 模块 和 网络资源 模块 各 维护 一个 队列 。 在 流量 控制 模块 中为 每 一个 流量 源 维护 一个 漏桶 缓冲区 队列 。 各 模块 之间 的 逻辑关系 如图 1 所示 。 
 
 图 1 模拟系统 软件结构 示意图 
 　 　 下面 是 对 各个 功能模块 的 简要 说明 ： 
 　 　 ( 1 ) 流量 产生 模块 ， 本 模块 用来 模拟 实际 网络 中 的 各种 流量 源 。 我们 用 随机数 ( Visual   C++ 提供 服从 某种 统计 规律 的 随机 函数 ) 来 模拟 信源 的 产生 。 为了 尽可能 提高 模拟 的 真实度 ， 我们 采用 了 经过 统计 处理 之后 的 实际 的 语音 及 视频文件 来 作为 模拟 信源 ， 这样 做 的 原因 有 两个 ： 一是 实际 语音 及 视频文件 的 信息 真实性 是 任何人 为 模拟 都 无法比拟 的 ； 二是 有 大量 现存 的 语音 及 视频文件 可以 利用 。 这 大大 减轻 了 样本 收集 的 工作量 ， 大 的 样本空间 是 提高 模拟 可信度 的 一个 重要 条件 。 
 　 　 ( 2 ) 接入 允许 控制 模块 ， 本 模块 的 功能 是 实现 接入 允许 控制 ( CAC ) 。 每当 系统 产生 一个 模拟 流量 源 的 时候 ， 这个 模拟 流量 源 首先 要 向 CAC 模块 发出 一个 接入 请求 消息 ， 并 在 消息 中 携带 QoS 参数 。 CAC 模块 在 收到 这个 消息 后 ， 就 向 网络资源 模块 发送 查询 消息 ， 查询 可 利用 的 网络资源 。 在 得到 应答 后 ， CAC 模块 就 根据 一定 的 规则 来 判断 是否 接纳 此 呼叫 。 如果 接纳 ， 就 向 请求 信源 发送 一个 应答 信号 ， 表示 此 呼叫 已经 被 接收 ， 同时 将 流量 合同 ( 根据 QoS 参数 形成 ) 交给 流量 控制 模块 ， 以便 进行 相应 的 流量 控制 ， 否则 返回 一个 拒绝 信号 。 
 　 　 ( 3 ) 流量 控制 模块 ， 本 模拟系统 采用 带 缓冲 的 漏桶 算法 来 进行 流量 控制 。 系统 为 每 一个 模拟 信源 维护 一个 带 缓冲 的 漏桶 。 这种 算法 可以 控制 信元 的 平均 速率 和 突发 程度 ， 并且 可以 降低 信元 丢失 率 。 当然 ， 由于 缓冲 将 带来 一定 的 时延 ， 通过 改变 缓冲区 的 大小 ， 可以 改变 时延 ， 这 一点 对于 传输 声音 及 视频 信息 来说 无疑 是 十分 重要 的 。 
 　 　 ( 4 ) 网络资源 模块 ， 由于 分析 复杂度 的 限制 以及 在 这方面 已有 研究 结果 的 极其 缺乏 ， 本文 对 网络资源 问题 的 讨论 范围 进行 了 严格 的 限制 ， 仅限于 讨论 一个 节点 的 资源 情况 ， 即 网络 接入点 的 输出 链路 宽度 和 缓冲区 的 大小 及 占有 情况 。 
 4     流量 源 的 预处理 
 　 　 为了 提高 模拟 的 真实度 ， 本 模拟系统 采用 实际 的 语音 文件 及 视频文件 作为 流量 源 [ ４ ] 。 但是 ， 这 两种 文件 都 需要 占用 大量 的 磁盘空间 ， 且 在 处理过程 中 需要 进行 很多 具有 较大 延迟 的 磁盘操作 。 对于 在 单机 上面 模拟 多个 信源 来说 ， 这 无疑 是 十分 不利 的 。 本 模拟系统 采用 了 一种 预处理 技术 来 实现 了 信息量 的 压缩 。 从而 消除 了 模拟 过程 进行 时 的 磁盘操作 。 具体来说 就是 事先 对 源文件 中 的 有效 信息 进行 统计 ， 用 有效 信息 的 数量 来 代替 具体 的 信息内容 ， 例如 用 数字 100 来 表示 100 个 字节 ， 而 不管 这些 字节 的 具体内容 。 采用 这种 方法 压缩率 达到 几百 甚至 上千 是 完全 有 可能 的 。 这样 就 有 可能 将 这些 统计 信息 一次性 装入 内存 ， 从而 消除 了 因 磁盘操作 而 引入 的 不 确定 因素 。 
 5     逻辑 时间 与 物理 时间 相 分离 
 　 　 本 模拟系统 依靠 Visual   C++ 提供 的 Timer 事件 来 完成 定时 操作 ， 所以 大部分 操作 都 要 在 Timer 事件 中 完成 。 而 这些 操作 本身 要 耗费 一定 的 时间 ， 因此 ， 当 Timer 事件 本身 的 执行 时间 超过 了 规定 的 Timer 事件 的 时间 间隔 时 ， 系统 就 会 出现 紊乱 。 并且 ， 如果 完全 按照 计算机 的 主 时钟 来 完成 定时 的话 ， 那么 ， 同一个 程序 在 不同 的 计算机 上 运行 ， 即使 运行 过程 完全相同 ， 也 极 可能 得出 完全 不同 的 结果 。 为了 解决 这个 问题 ， 我们 使 模拟 的 逻辑 时间 与 物理 时间 相 分离 ， 逻辑 时间 由 计算 获得 ， 而 物理 时间 由 实测 获得 ， 方法 如下 ： 
 　 　 每次 启动 系统 时 ， 先 按 最大 可能 的 时间 复杂度 来 执行 Timer 事件 中 的 所有 操作 ， 并 记录 耗费 的 时间 ， 以 其 作为 系统 的 物理 时间 单位 ( 据此 来 对 Timer 事件 定时 ) ， 它 对应 于 一个 逻辑 时间 单位 。 
 逻辑 时间 单位 就是 为了 分析 系统 所 需 的 最小 时间 单位 ， 它 应该 小到 能够 模拟系统 中 传输速率 最高 的 那 一部分 的 变化 情况 。 本 模拟系统 中 ， 输出 链路 处 速率 最高 ， 假定 为 CL ( Mb / s ) ， 如果 逻辑 时间 单位 小到 能够 模拟输出 链路 处 的 信元 变化 ， 那么 ， 它 就 可以 以 足够 高 的 精度 来 模拟 各个 信源 处 的 各种 变化 情况 。 计算方法 如 ： 
 6     统计 信息 的 记录 与 保存 
 　 　 为了 便于 事后 分析 ， 我们 将 把 模拟 过程 中 的 一些 重要 信息 以 文件 的 形式 保存 到 磁盘 上 。 由于 磁盘 读写操作 是 一个 很慢 的 过程 ， 而本 模拟系统 对 时间 精度 要求 比较 高 ， 所以 我们 采用 零散 收集 ， 集中 存盘 的 方法 来 解决 这个 问题 。 具体来说 ， 就是 需 存盘 信息 先 缓存 于 内存 的 一块 缓冲区 中 ， 待 缓冲区 填满 时 再 集中 写入 磁盘 ， 并 清空 缓冲区 。 即使 这样 ， 写 磁盘 时 仍 难免会 影响 模拟 的 精度 。 为了 彻底消除 这种 影响 ， 我们 采用 了 现场 保护 与 恢复 的 技术 。 在 存盘 之前 ， 将 一些 关键性 信息 保存起来 ， 例如 模拟 的 当前 时间 序列号 、 当前 各 队列 的 指针 等 。 之后 进行 磁盘操作 ， 磁盘操作 完毕 后 ， 清空 缓冲区 ， 然后 恢复 关键 信息 ， 继续 模拟 过程 。 这种 技术 对于 提高 模拟 的 精度 无疑 是 很 有 帮助 的 。 
 7     统计 信息 的 利用 
 　 　 本 模拟系统 中 模拟 过程 与 统计 过程 是 独立 的 。 这样 做 的 目的 一是 为了 减少 模拟 过程 中 的 干扰 ， 提高 模拟 的 精确度 ； 二是 为了 实现 统计 的 多样性 与 全面性 。 整个 模拟 过程 中 用 一个 唯一 的 时间 标识 来 标志 系统 的 进程 ， 这个 时间 标识 包含 两个 long 型 的 变量 ， 如果 按 最小 时间段 1ms ( Visual   C++ 能够 提供 的 最小 时间 单位 ) 来算 ， 它 可以 持续 109 年 而 不 重复 ， 由此可见 用 它 来 标识 系统 进程 是 恰当 的 。 有用 信息 都 以 文件 的 形式 存放 在 磁盘 上 ， 这些 信息 有 很 多种 ( 但 都 含有 时间 标识 ) ， 包括 任一 时刻 缓冲区 的 占有量 、 正在 发送 的 信源 数目 、 正在 进行 呼叫 的 信源 数 、 任一 漏桶 处 丢弃 的 信源 、 缓冲区 处 丢弃 的 信源 、 任一 信源 在 当前 时刻 传送 的 信息量 等 。 根据 这些 信息 可以 获取 我们 所 感兴趣 的 任何 统计数据 ， 但是 具体 数据 的 获取 可以 根据 需要 对 这些 数据文件 编制 独立 的 统计 程序 来 实现 ， 与 模拟 过程 并 没有 直接 的 联系 。 
 8     结束语 
 　 　 本文 提出 的 ATM 网络 中 服务质量 控制算法 的 软件 模拟 方法 ， 对 ATM 网络 中 的 流量 控制算法 的 改进 和 ATM 网络 服务质量 的 提高 具有 一定 的 实际意义 。 通过 改变 模拟 参数 ， 可以 寻求 更好 的 控制 方法 。 它 采用 语音 文件 和 视频文件 为 模拟 信源 ， 对于 诸如 IP电话 、 视频点播 等 应用 具有 直接 的 参考价值 。 通过 改变 模拟 环境 ( 甚至 将 某些 模块 运行 在 实 系统 上 ) 可以 提高 模拟 的 真实度 ， 这 是 本 系统 有待 改进 的 地方 。 
 刘 向东 ( 哈尔滨工程大学 计算机系       哈尔滨   150001 ) 
 耿江涛 ( 哈尔滨工程大学 计算机系     哈尔滨   150001 ) 
 杨 永田 ( 哈尔滨工程大学 计算机系     哈尔滨   150001 ) 
 俞瑛 ( 哈尔滨工程大学 计算机系     哈尔滨   150001 ) 
 参考文献 
 1 ， 张宏科 ,   裘 正定 .   ATM 网络 互连 原理 与 工程 .   北京 :   清华大学出版社 ,   1997.4 
 2 ， 鲁士文 .   数据通信 与 ATM 网络 .   北京 :   清华大学出版社 ,   1998.7 
 3 ， Mischa   Schwartz .   宽带 网络 性能 分析 ( 影印版 ) .   北京 :   清华大学出版社 ,   1998.4 
 4 ， 黄贤武 ,   赵 鹤鸣 .   多媒体计算机 基础 与 数据压缩 .   北京 :   北京理工大学 出版社 ,   1996.1 
 收稿 日期 ： 1999 - 12 - 16 
