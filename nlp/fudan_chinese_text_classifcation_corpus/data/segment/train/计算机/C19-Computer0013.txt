计算机 应用 
 COMPUTER   APPLICATIONS 
 1999 年   第 19 卷   第 6 期   Vol.19   No.6   1999 
 
 
 
 Domino 环境 中 的 数据 加密技术 
 李俊 海 　 耿继秀 　 钱丽瑾 　 刘彦丽 　 张德壮 
 　 　 摘 　 要 　 在 企业 网络 实践 的 基础 上 ， 讨论 了 数据 加密技术 在 企业 网络 中 的 应用 。 为了 防止 对非 授权 的 数据库 和 文档 的 存取 ， 可以 对 数据库 进行 选择 算法 的 加密 和 使用 私钥 / 公钥 加密 机制 ， 对 数据库 文档 的 字 段 加密 。 
 　 　 关键词 　 数据库 文档 ， 数据 加密 ， 密钥 ， 存取 授权 
 1 　 引言 
 　 　 加密技术 可以 使 我们 在 不 安全 的 通道 上 建立 安全 的 连接 。 在 Domino 环境 中 ， 为了 防止 对非 授权 的 数据库 、 文档 或者 邮件 的 存取 ， 除 对 数据库 进行 不同 级别 的 授权 外 （ 七种 级别 ） ， 我们 能够 对 数据库 、 对 某个 库中 的 一个 文档 、 多个 文档 或者 全部 文档 进行 加密 。 通过 加密 的 办法 ， 使得 系统 中 的 各种 数据 的 安全 在 三个 面上 得到 保障 。 加密 的 办法 有 多种多样 的 ， 但是 总 离不开 加密 用 的 密钥 。 Domino 提供 了 对称 和 非对称 的 两种 加密 机制 。 在 对称 的 加密 机制 中 ， 用户 需要 在 阅读 加密 文档 时 具备 密钥 。 我们 着重 讨论 对 数据库 中 的 一般 文档 、 对 使用 指定 表单 产生 的 所有 文档 、 文档 中 的 全部 字段 或 部分 字 段 使用 指定 密钥 进行 加密 、 对 数据库 进行 选择 算法 的 加密 以及 指定 用户 解密 的 方法 和 技术 。 
 2 　 数据库 文档 加密 
 　 　 在 Domino 环境 中 ， 数据库 是 文档 的 集合 。 一个 数据库 可以 包含 最多 不 超过 4GB 大小 的 数据 文档 。 对 一个 文档 加密 的 含义 是 ，   使用 公钥 或 某个 密钥 应用 到 一个 或 多个 的 域 （ 字 段 ） 上 进行 加密 。 如果 密钥 是 特选 的 ， 就 需要 将 该 密钥 发送给 所 指定 的 用户 。 拥有 一个 文档 密钥 的 任何 用户 都 可以 读该 文档 加密 域 。 没有 密钥 的 用户 则 只 可以 读 在 该 文档 中 没有 被 加密 的 域 。 对 一个 文档 进行 加密 保护 ， 它 的 表单 必须 具备 一个 或 多个 系统 开发者 定义 的 可 加密 的 域 。 实际上 ， 为了 醒目 起 见 ， 在 填写 一个 文档 时 就 可以 看到 加密 域用 红色 的 标记 来 识记 。 我们 在 对域 加密 时 ， 可以 使用 系统 为 用户 生成 的 公钥 或者 创建 一个 新 的 密钥 。 在 一个 文档 中 ， 对 可 加密 的 域 都 可 使用 所 选定 的 密钥 进行 加密 ； 用户 不 允许 为 某个 文档 的 可 加密 域 选择 不同 的 密钥 。 除了 对 数据库 中 的 某个 文档 进行 加密 外 ， 我们 还 可以 对 数据库 中 使用 特定 的 表单 创建 的 全部 文档 加密 。 
 　 　 数据库 的 拥有者 可以 对 特定 的 表单 创建 的 所有 文档 进行 加密 。 用户 可 通过 将 密钥 加入 到 表单 中 或者 把 相关 密钥 的 关键字 加入 到 该 表单 来 达到 目的 。 数据库 的 “ 设计者 ” 有权 决定 该 表单 将 使用 何种 类型 和 哪些 密钥 。 如果 将 密钥 加入 到 某个 表单 中 ， 那么 通过 该 表单 构造 的 所有 文档 都 用 这个 密钥 加密 。 这里 我们 给出 一个 对 数据库 中 全部 文档 使用 给定 密钥 进行 加密 的 例子 。 加密 是 通过 LotosScript （ 一种 类似 VisualBasic 面向对象 的 语言 , 功能 上 更 强于 该 语言 ） 来 实现 的 。   以下 的 程序 用 密钥 “ 绝密 ”   和 “ Top   Secret ” 加密 文档 中 的 每 一域 。 
 　 Dim   doc   As   NotesDocument 
 ′ 定义 doc 为 Notes 文档 变量 对象 
 　 Dim   item   As   NotesItem 
 ′ 定义 item 为 Notes 文档 域 （ 或 字 段 ） 变量 对象 
 　 Dim   keys (   1   To   2   )   As   String 
 ′ 定义 keys ( 1 ) 和 keys ( 2 ) 为 字符串 数组 
 　 Forall   i   In   doc . Items 
 ′ 对 该 文档 中 的 所有 字 段 对象 进行 初始化 设置 ， 
 　 i . IsEncrypted   =   True 
 ′ 把 字 段 对象 加密 属性 设置 为 真 
 　 End   Forall 
 　 keys (   1   )   =   " 绝密 " 
 ′ 分别 对 keys ( 1 ) 和 keys ( 2 ) 赋值 
 　 keys (   2   )   =   " Top   Secret "   
 　 doc . EncryptionKeys   =   keys 
 　 Call   doc . Encrypt 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ′ 进行 加密 处理 
 　 Call   doc . Save (   True ,   True   ) 
 ′ 把 经过 加密 处理 的 文档 保存起来 并 结束 加密 
 　 　 我们 可以 看到 ， 程序 在 最后 调用 Save 函数 时才 把 加密 文档 保存 好 。 到此为止 ， 所有   IsEncrypted   属性 为 真 （ True ） 的 域 被 加密 。 而 那些 IsEncrypted 属性 为 假 （ False ） 的 项 对 任何 用户 都 是 可见 的 ， 即使 该 用户 没有 正确 的 密钥 。 若用 一个 或 多个 密钥 设置   EncryptionKeys   属性 ， 则 这些 密钥 被 用来 加密 该 文档 。 任何 具有 这些 密钥 中 的 一个 的 用户 都 可 对 该 文档 解密 。 若 没有 指定 密钥 ， 则 使用 用户 的 公钥 加密 该 文档 。 
 　 　 下面 我们 还 给出 一个 对 选定 文档 的 字 段 进行 加密 的 例子 。 加密 也 是 用 LotusScript 语言 来 完成 的 。 该 程序 在 文档 中 加密 每一域 。 因为 没有 显示 地 给出 密钥 ， 说明 使用 的 是 公钥 ， 所以 解密 时 就要 用到 用户 自己 的 私钥 。 
 　 Dim   doc   As   NotesDocument 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ′ 定义 doc 为 文档 对象 
 　 Forall   i   In   doc . Items 
 ′ 对 该 文档 中 的 所有 域 对象 进行 初始化 设置 
 　 i . IsEncrypted   =   True 
 ′ 即 加密 属性 设置 为 真 
 　 End   Forall 
 　 Call   doc . Encrypt 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ′ 进行 加密 处理 
 　 Call   doc . Save (   True ,   True   ) 
 ′ 把 经过 加密 处理 的 文档 保存 并 结束 加密 。 
 　 　 这个 加密 示例 与 前 一个 的 不同 就是 在 用户 没有 给定 特定 的 密钥 。 下面 我们 再 给出 另外 一个 对字段 加密 的 例子 。 在 该 例子 中 ， 专门 对 指定 的 两个 字 段 ： Subject 字段 和 Body 字段 使用 “ 绝密 ” 密钥 进行 加密 。 
 　 Dim   doc   As   NotesDocument 
 Dim   itemA   As   NotesItem 
 ′ 分别 定义 两个 域 对象 变量 itemA 和 ItemB 
 Dim   itemB   As   NotesItem 
 Set   itemA   =   doc . GetFirstItem (   " Subject "   ) 
 ′ 对 定义 的 两个 变量 赋字 段值 
 Set   itemB   =   doc . GetFirstItem (   " Body "   ) 
 itemA . IsEncrypted   =   True   
 ′ itemA 和 ItemB 加密 属性 分别 设置 为 真 
 itemB . IsEncrypted   =   True 
 doc . EncryptionKeys   = " 绝密 " 
 Call   doc . Encrypt 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ′ 进行 加密 处理 
 Call   doc . Save (   True ,   True   ) 
 ′ 把 经过 加密 处理 的 文档 保存起来 并 结束 加密 。 
 　 　 如果 某个 用户 希望 对 数据库 中 选定 的 文档 进行 加密 ， 就 需要 具备 “ 作者 ” 或者 更高 存取 权限 。 如果 某个 用户 具有 “ 编辑者 ” ， 就 可以 加密 别人 创建 的 文档 。 用户 可以 用 私密 来 加密 ， 也 可以 用 公用 通讯录 中 各个 用户 都 有 的 公钥 加密 。 具体 操作步骤 为 ： 第一 、 选取 要 加密 的 文档 。 第二 、 选择 “ 文件 ” 、 “ 文档 属性 ” 。 第三 、 可以 指定 有权 打开 阅读 该 文档 的 全部 人员名单 ， 如图 1 所示 。 第四 、 单击 带 钥匙 标记 的 卡 即可 。 第六 、 此时 ， 指定 可以 阅读 加密 文档 的 全部 “ 读者 ” 或者 具备 更高 权限 的 人 ； 也 可选 一个 或 多个 私钥 ： 从 “ 个人 密钥 ” 列表 中 选取 。 并 将 该 密钥 邮寄 给 需要 阅读 加密 文档 的 用户 ， 参见 本文 给出 的 程序 例 所示 。 第七 、 如果 选用 公钥 ， 就 选择 想 使用 其公钥 的 人员名单 即可 ， 如图 2 所示 。 同时 ， 我们 能够 通过 列表 的 办法 来 限定 允许 阅读 加密 文档 的 用户 。 
 
 图 1 
 
 图 2 
 3 　 阅读 加密 文档 
 　 　 如果 在 用户 的 标识符 里 ， 即 公用 通讯录 中 用户 的 “ 个人 ” 文档 里 有 正确 的 密钥 ， 他们 就 可以 阅读 加密 信息 。 无 正确 密钥 的 用户 可以 读 文档 未 加密 部分 ， 但 加密 部分 为 空白 。 例如 ， 李四 使用 密钥 对 某个 文档 中 的 数据 进行 加密 后 。 如果 张三要 阅读 这个 已经 加密 的 文档 就 必须 具备 该 密钥 。 李四 使用 张三 的 公钥 对 某个 文档 中 的 数据 加密 后 。 如果 张三要 阅读 这个 已经 加密 的 文档 只 需要 使用 自己 的 私钥 即可 解密 ， 也 就 有权 编辑 加密 文档 。 如果 张三 的 用户 标识符 里 没有 含有 相匹配 的 密钥 ， 加密 域 就 被 显示 为 空白 。 当有 多个 密钥 和 一个 表单 或 文档 关联 的 时候 ， 用户 只 需要 指定 密钥 之一 就 能 读 加密 信息 。 在 把 一个 文档 或 一个 表单 和 多个 密钥 关联 时 ， 用户 需要 所有 指定 的 密钥 以 使用 原有 的 密钥 编辑 和 保存 加密 信息 。 应该 注意 ： 一个 数据库 的 存取 权限 有 七种 。 分别 为 ： “ 不能 存放 者 ” 、 “ 存放 者 ” 、 “ 读者 ” 、 “ 作者 ” 、 “ 编辑者 ” 、 “ 设计者 ” 、 “ 管理者 ” 。 只有 具备 有 “ 作者 ” 或者 更高 存取 权限 的 用户 才 可以 去掉 为 自己 文档 的 加密 或 改变 相关联 的 密钥 （ 如果 他们 被 允许 编辑文档 且 有 相关联 密钥 ） 。 具备 “ 编辑者 ”   存取 权限 的 用户 可以 从 任何人 的 文档 删除 加密 的 信息 或者 改变 相关联 密钥 。 因此 ， 我们 必须 把 数据库 、 库中 与 表单 相关 文档 的 授权 与 加密 统一 来 考虑 。 
 4 　 数据库 安全性 以及 数据库 的 授权 
 　 　 如果 用户 通过 操作系统 级 命令 ， 例如 dos / windows 或 Unix 环境 中 的 复制 命令 ， 拷贝 数据库 时 ， 数据 仍然 保持 加密 。 加密 数据 对 应用 编程 接口 （ API ） 程序 的 存取 也 是 安全 的 。 当然 有 一点 例外 ， 就是 带有 选项 “ 索引 加密 域 ” 的 全文 搜索 能够 加密 数据 显示 给 能 存取 数据库 的 任何 用户 。 此外 ， 全文索引 文件 可以 作为 服务器 上 的 一个 ASCII 文本文件 读取 。 
 　 　 当 用户 为 选定 的 数据库 提供 本地 安全 时 ， Notes 使用 一个 指定 的 标识符 公钥 加密 数据库 。 只有 用户 使用 相应 的 密钥 才 可 解密 数据库 。 可 选择 三种 级别 的 加密 ， 既 强度 加密 、 普通 加密 和 中等 加密 。 
 　 　 如图 3 所示 ， 在 Domino 环境 中 ， 系统 提供 了 强度 、 普通 和 中等 加密 三种 不同 算法 的 。 强度 加密 提供 的 安全 级 最高 。 但是 ， 打开文档 的 时间 比 普通 、 中等 加密 的 时间 要长 。 普通 加密 提供 有限 的 数据 安全性 、 能够 快速 打开文档 并且 我们 还 可以 用 磁盘 压缩工具 对 经过 普通 加密算法 处理 的 数据库 进行 压缩 。 然而 ， 我们 不能 压缩 经过 高度 加密 或 中等 加密算法 处理 的 数据库 。 
 
 图 3 
 5 　 结束语 
 　 　 防止 对非 授权 的 数据库 和 文档 的 存取 ， 我们 可 对 数据库 选择 高强度 、 中等 强度 和 普通 强度 的 加密算法 对 数据库 进行 处理 。 利用 面向对象 的 技术 ， 采取 设计 程序 来 完成 对 数据库 对象 中 的 一些 文档 对象 或者 对 使用 指定 表单 产生 的 所有 文档 以及 文档 中 的 字 段 使用 指定 密钥 或公钥 进行 加密 。 只有 把 数据库 、 库中 与 表单 相关 的 文档 的 授权 和 加密 统一 考虑 时 ， 加密技术 才 能够 真正 起 作用 从而 达到 保障 信息安全 的 目的 。 
 作者简介 ： 李俊 海 　 副教授 。 研究 方向 ： 网络 与 通信 。 
 耿继秀 　 副教授 。 研究 方向 ： 算法 分析 与 设计 。 
 钱丽瑾 　 工程师 。 
 刘 艳丽 　 张德壮 　 硕士 研究生 。 
 作者 单位 ： 中国科技大学 研究生院 计算机 教学部 　 北京 （ 100039 ） 
 参考文献 
 ［ 1 ］ 　 C . P .   Pfleeger . Security   in   Computing . Prentice - Hall   International ,   Inc . ， 1997 
 ［ 2 ］ 　 IBM .   Lotus   Notes   release   4.6 :   A   Developer ′ s   Handbook .   International   Technical   Support   Organization , 1998 
 收稿 日期 : 1998 - 12 - 10 
