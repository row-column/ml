计算机 应用 
 Computer   Applications 
 1999 年   第 19 卷   第 7 期     Vol.19   No.7   1999 
 
 
 
 电子商务 中 在线 支付 的 安全 保障 
 刘卫宁 　 宋 　 伟 
 
 　 　 摘 　 要 　 本文 详细分析 和 比较 了 保障 在线 支付 安全 的 主流 协议 ：   SSL 协议 和 SET 协议 。 
 　 　 关键词 　 在线 支付 ， 安全 ，   SSL ， SET 
 　 　 
 SECURE   FACILITIES   FOR   ONLINE   PAYMENT 
 IN   ELECTRONIC   COMMERCE 
 
 Liu   Weining 　 Song   Wei   
 Computer   Science   &   Engineering   College ,   Chongqing   University ,   Chonqging   400044 
 　 　 Abstract 　 This   paper   analyzes   and   compares   the   popular   protocols   which   ensure   the   security   of   online   payment   system :   SSL   and   SET . 
 　 　 Keywords 　 Online   payment ,   Security ,   SSL ,   SET 
 
 　 　 实现 电子商务 的 关键 是 要 保证 商务活动 过程 中 系统 的 安全性 ， 即应 保证 在 向 基于 Internet 的 电子 交易 转变 的 过程 中 与 传统 交易 的 方式 一样 安全可靠 。 
 　 　 虽然 Internet 以 开放性 著称 ， 在 安全 方面 具有 脆弱性 。 但是 ， 随着 Internet 的 发展 和 电子商务 时代 的 到来 ， 人们 在 Internet 安全 上 所 进行 的 努力 已 改变 了 这种 情况 。 今天 电子商务 中 采用 的 安全 技术 已 成为 一种 成熟 的 、 实用 的 安全 技术 。 
 　 　 电子商务 的 主要 特征 是 在线 支付 。 为了 保证 在线 支付 的 安全 ， 需要 采用 数据 加密 和 身份 认证 技术 ， 以便 营造 一种 可信赖 的 电子 交易 环境 。 在线 交易 首先 要 验证 或 识别 参与 交易 活动 的 各个 主体 ， 如 持卡 消费者 、 商家 、 受卡 银行 和 支付 网关 的 身份 （ 身份 用 数字证书 表示 ） ， 以及 保证 持卡人 的 信用卡 号 不会 被盗 用 ， 这样 客户 才 可以 放心 地 在 网上 购物 。 
 　 　 目前 有 两种 安全 在线 支付 协议 被 广泛 采用 ， 即 安全套 接层 SSL （ Secure   Sockets   Layer ） 协议 和 安全 电子 交易 SET （ Secure   Electronic   Transaction ） 协议 。 　 　 
 1 　 SSL 协议 
 　 　 SSL 协议 是 Netscape 公司 在 网络 传输层 之上 提供 的 一种 基于 RSA 和 保密 密钥 的 用于 浏览器 和 Web 服务器之间 的 安全 连接 技术 。 众所周知 ， Socket 只是 一个 编程 界面 ， 并 不 提供 任何 安全措施 。 SSL 则 不仅 提供 编程 界面 ， 而且 还 向 上层 应用 提供 安全 服务 。 SSL3.0 通过 数字签名 和 数字证书 可 实现 浏览器 和 Web 服务器 双方 的 身份验证 。 在 用 数字证书 对 双方 的 身份验证 后 ， 双方 就 可以 用 保密 密钥 进行 安全 的 会 话 了 。 
 　 　 这种 简单 加密 模式 的 特点 是 ： 
 　 　 *   部分 或 全部 信息 加密 ； 
 　 　 *   采用 对称 的 和 非对称 的 加密技术 ； 
 　 　 *   通过 数字证书 验证 身份 ； 
 　 　 *   采用 防止 伪造 的 数字签名 。 
 　 　 SSL 协议 在 应用层 收发 数据 前 ， 协商 加密算法 、 连接 密钥 并 认证 通信 双方 ， 从而 为 应用层 提供 了 安全 的 传输 通道 ； 在 该 通道 上 可 透明 加载 任何 高层 应用 协议 （ 如 HTTP 、 FTP 、 TELNET 等 ） 以 保证 应用层 数据传输 的 安全性 。 SSL 协议 实现 简单 ， 并且 独立 于 应用层 协议 ， 因此 ， 在 电子 交易 中 被 用来 安全 传送 信用卡 号码 。 
 　 　 SSL 协议 握手 流程 由 两个 阶段 组成 ： 服务器 认证 和 用户 认证 （ 可 选 ） 。 
 　 　 服务器 认证 阶段 
 　 　 *   客户端 向 服务器发送 一个 “ Hello ” 信息 ， 以便 开始 一个 新 的 会 话 连接 ； 
 　 　 *   服务器 根据 客户 的 信息 确定 是否 需要 生成 新 的 主 密钥 ， 如 需要 则 服务器 在 响应 客户 的 “ Hello ” 信息 时 将 包含 生成 主 密钥 所 需 的 信息 ； 
 　 　 *   客户 根据 收到 的 服务器 响应 信息 ， 产生 一个 主 密钥 ， 并用 服务器 的 公开密钥 加密 后 传给 服务器 ； 
 　 　 *   服务器 恢复 该主 密钥 ， 并 返回 给 客户 一个 用主 密钥 认证 的 信息 ， 以此 让 客户 认证 服务器 。 
 　 　 这样 通过 主 密钥 引出 的 密钥 对 一系列 数据 进行 加密 来 认证 服务器 ， 从而 建立 安全 的 通信 通道 。 
 　 　 用户 认证 阶段 （ 可 选 ） 
 　 　 在此之前 ， 服务器 已经 过 了 客户 认证 ， 这一 阶段 主要 完成 对 客户 的 认证 。 
 　 　 经 认证 的 服务器发送 一个 提问 给 客户 ， 客户 则 返回 （ 数字 ） 签名 后 的 提问 和 其 公开密钥 ， 从而 向 服务器 提供 认证 。 
 　 　 SSL 支持 各种 加密算法 。 在 “ 握手 ” 过程 中 ， 使用 RSA 公开密钥 系统 。 密钥 交换 后 ， 使用 一系列 密码 ， 包括 RC2 、 RC4 、 IDEA 、 DES 、 triple - DES 及 MD5   信息 摘要 算法 。 公开密钥 认证 遵循 X.509 标准 。 
 　 　 SSL 协议 实现 简单 ， 独立 于 应用层 协议 ， 且 被 大部分 的 浏览器 和 Web 服务器 所 内置 ， 便于 在 电子 交易 中 应用 ， 国际 著名 的 CyberCash 信用卡 支付 系统 就 支持 这种 简单 加密 模式 ， IBM 等 公司 也 提供 这种 简单 加密 模式 的 支付 系统 。 但是 ， SSL 是 一个 面向 连接 的 协议 ， 只能 提供 交易 中 客户 与 服务器 间 的 双方 认证 ， 在 涉及 多方 的 电子 交易 中 ， SSL 协议 并 不能 协调 各方 间 的 安全 传输 和 信任 关系 ， 因此 ， 为了 实现 更加 完善 的 电子 交易 ， MasterCard 和 Visa 以及 其它 一些 业界 厂商 制订 并 发布 了 SET 协议 。 　 　 
 2 　 SET 协议 
 　 　 SET 协议 是 针对 开放 网络 上 安全 、 有效 的 银行卡 交易 ， 由 Visa 和 Mastercard 联合 研制 的 ， 为 Internet 上卡 支付 交易 提供 高层 的 安全 和 反 欺诈 保证 。 现在 SET 已 作为 开放 的 工业 标准 发布 ， 软件 厂家 可用 来 研制 自己 的 应用软件 。 
 2.1 　 SET 协议 为 电子 交易 提供 的 安全措施 
 　 　 SET 协议 保证 了 电子 交易 的 机密性 、 数据完整性 、 身份 的 合法性 和 防 抵赖 性 。 
 　 　 *   机密性 （ Confidentiality ） 
 　 　 SET 协议 采用 先进 的 公开密钥 算法 来 保证 传输 信息 的 机密性 ， 以 避免 Internet 上 任何 无关 方 的 窥探 。 公开密钥 算法 容许 任何人 使用 公开 的 密钥 将 加密 信息 发送给 指定 的 接收者 ， 接收者 收到 密文 后 ， 用 私人 密钥 对 这个 信息 解密 ， 因此 ， 只有 指定 的 接收者 才能 读 这个 信息 ， 从而 保证 信息 的 机密性 。 
 　 　 SET 协议 也 可 通过 双重 签名 的 方法 将 信用卡 信息 直接 从 客户 方 透过 商家 发送到 商家 的 开户行 ， 而 不容许 商家 访问 客户 的 帐号 信息 ， 这样 客户 在 消费 时 可以 确信 其 信用卡 号 没有 在 传输 过程 中 被 窥探 ， 而 接收 SET 交易 的 商家 因为 没有 访问 信用卡 信息 ， 故 免去 了 在 其 数据库 中 保存 信用卡 号 的 责任 。 
 　 　 *   数据完整性 （ Data   Integrity ） 
 　 　 通过 SET 协议 发送 的 所有 报文 加密 后 ， 将 为 之 产生 一个 唯一 的 报文 摘要 值 （ message   digest ） ， 一旦 有人 企图 篡改 报文 中 包含 的 数据 ， 该 数值 就 会 改变 ， 从而 被 检测 到 ， 这 就 保证 了 信息 的 完整性 。 
 　 　 *   身份验证 （ Verification   of   Identity ） 
 　 　 SET 协议 可 使用 数字证书 来 确认 交易 涉及 的 各方 （ 包括 商家 、 持卡 客户 、 受卡行 和 支付 网关 ） 的 身份 ， 为 在线 交易 提供 一个 完整 的 可信赖 的 环境 。 
 　 　 *   防 抵赖 性 （ Non - repudiation   of   Disputed   Charges ） 
 　 　 SET 交易 中 数字证书 的 发布 过程 也 包含 了 商家 和 客户 在 交易 中 存在 的 信息 。 因此 ， 如果 客户 用 SET 发出 一个 商品 的 订单 ， 在 收到 货物 后 他 （ 她 ） 不能 否认 发出 过 这个 订单 ； 同样 ， 商家 以后 也 不能 否认 收到 过 这个 订单 。 
 2.2 　 电子 交易 的 主体 对象 
 　 　 电子 交易 涉及 的 主要 主体 对象 有 ： 
 　 　 客户 或 持卡人 （ Cardholder ） ：   电子 交易 中 的 持卡 消费者 ； 
 　 　 发卡 机构 （ Issuer ） ：   信用卡 的 发卡 金融机构 ， 它 将 为 客户 建立 帐号 ， 发出 信用卡 ， 它 必须 保证 该 信用卡 组织 的 有关 规定 （ 包括 安全 、 支付 授权 等 ） ； 
 　 　 商家 （ Merchant ） ：   服务提供者 ； 
 　 　 受卡行 （ Acquirer ） ：   商家 的 开户银行 ， 处理 信用卡 的 授权 和 支付 ； 
 　 　 支付 网关 （ Payment   gateway ） ：   是 一个 由受 卡行 （ 或 指定 的 第三方 机构 ） 操作 的 设备 ， 是 金融网 与 Internet 的 接口 ， 用来 处理 商家 的 支付 信息 （ 包括 客户 的 支付 命令 等 ） 。 
 2.3 　 基于 SET 的 电子 交易 流程 
 　 　 基于 SET 的 标准 电子 交易 流程 如图 1 所示 。 
 
 
 图 1 　 SET 交易 流程图 
 
 2.3 . 1 　 浏览 
 　 　 客户 通过 浏览器 从 商家 的 商品目录 寻找 所 需 商品 。 
 2.3 . 2 　 发送 购买 请求 
 　 　 a ）   客户 （ cardholder ） 初始化 请求 
 　 　 客户 发送 初始化 请求 给 商家 （ 在 发送 SET 报文 之前 ， 客户 需 拥有 支付 网关 交换 密钥 的 私人 密钥 ） 。 
 　 　 b ）   商家 发送 证书 
 　 　 商家 收到 客户 的 初始化 请求 后 ， 为 请求 报文 分配 一个 唯一 的 交易 标识号 ， 并用 商家 的 私人 密钥 进行 数字签名 ， 然后 将 初始化 响应 报文 与 商家 和 支付 网关 的 证书 一起 传给 客户 。 
 　 　 c )   客户 接收 初始化 响应 并 发送 请求 
 　 　 客户 收到 初始化 响应 后 ， 遍历 信任 链 ， 验证 商家 和 支付 网关 的 证书 ， 确认 商家 和 支付 网关 的 身份 ， 再 根据 商家 的 公开密钥 确认 初始化 响应 上 商家 的 签名 ； 
 　 　 客户 产生 订单 信息 （ Ordering   Information ） 和 支付 命令 （ Payment   Instruction ） ； 
 　 　 客户 用 私人 密钥 对 订单 信息 和 支付 命令 进行 双重 签名 ； 
 　 　 客户 产生 一个 随机 的 对称 密钥 ， 并用 它 对 双重 签名 后 的 支付 命令 加密 ， 然后 再用 支付 网关 交换 密钥 的 公开密钥 （ public   key - exchange   key ） 对 客户 帐号 和 对称 密钥 加密 ； 
 　 　 客户 将 加密 后 的 订单 信息 和 支付 命令 发给 商家 。 
 　 　 d ）   商家 处理 请求 报文 
 　 　 商家 遍历 信任 链以 确认 客户 证书 ； 
 　 　 商家 用 客户 的 公开密钥 对 订单 信息 上 的 双重 签名 解密 ， 以 确保 订单 在 传输 过程 中未 被 篡改 ， 其上 的 签名 是 客户 的 ； 
 　 　 商家 处理 订单 信息 请求 ， 同时 将 支付 命令 传给 支付 网关 并 请求 授权 ； 
 　 　 商家 产生 一个 购买 响应 报文 （ 其中 包括 商家 的 签名 证书 ， 指明 客户 的 订单 已 被 接收 ） ， 并 对 该报 文 数字签名 后 发给 客户 ； 
 　 　 如果 交易 被 授权 ， 商家 将 执行 订单 上 规定 的 送货 等 服务 。 
 　 　 e ）   客户 接收 购买 响应 
 　 　 客户 遍历 信任 链 确认 商家 的 签名 证书 ； 
 　 　 客户 用 商家 的 公开密钥 来 证实 购买 响应 上 的 签名 是 商家 的 ； 
 　 　 客户 保存 收到 的 购买 响应 。 
 2.3 . 3 　 支付 认证 
 　 　 a ）   商家 请求 授权 
 　 　 商家 产生 授权 请求 ， 并 对 它 进行 数字签名 ； 
 　 　 商家 用 随机 产生 的 对称 密钥 对 授权 请求 加密 ， 然后 再用 支付 网关 交换 密钥 的 私人 密钥 对 该 对称 密钥 加密 ； 
 　 　 商家 将 加密 的 授权 请求 和 来自 客户 的 加密 支付 命令 一起 送 支付 网关 。 
 　 　 b ）   支付 网关 处理 授权 请求 
 　 　 网关 遍历 信任 链 确认 商家 的 证书 ； 
 　 　 网关 用 其 交换 密钥 的 私人 密钥 对 对称 密钥 解密 ， 然后 用 对称 密钥 对 授权 请求 解密 ； 
 　 　 网关 用 商家 的 公开密钥 验证 授权 请求 上 商家 的 签名 ； 
 　 　 网关 遍历 信任 链 确认 客户 的 证书 ； 
 　 　 网关 用 其 交换 密钥 的 私人 密钥 对 对称 密钥 和 客户 帐号 解密 ， 再用 对称 密钥 对 支付 命令 解密 ； 
 　 　 网关 用 客户 的 公开密钥 确认 支付 命令 上 客户 的 签名 ； 
 　 　 网关 确认 商家 授权 请求 中 的 交易 号 与 客户 支付 命令 中 一致 ； 
 　 　 网关 通过 金融 网络 向 客户 的 金融机构 （ 发卡 机构 ） 发 授权 请求 ； 
 　 　 网关 产生 一个 授权 响应 报文 ， 并用 网关 的 私人 密钥 签名 ； 
 　 　 网关 用 新 产生 的 随机 对称 密钥 对 授权 响应 加密 ， 然后 再用 商家 交换 密钥 的 公开密钥 对 对称 密钥 加密 ； 
 　 　 网关 产生 一个 付款 标志 （ capture   token ） ， 并用 网关 的 私人 密钥 签名 ； 
 　 　 网关 将 加密 后 的 授权 响应 送 商家 。 
 　 　 c )   商家 处理 授权 响应 
 　 　 商家 遍历 信任 链 确认 支付 网关 的 证书 ； 
 　 　 商家 用 商家 交换 密钥 的 私人 密钥 对 对称 密钥 解密 ， 然后 再用 对称 密钥 对 授权 响应 解密 ； 
 　 　 商家 用 支付 网关 的 公开密钥 确认 授权 响应 上 支付 网关 的 签名 ； 
 　 　 商家 保存 加密 后 的 付款 标志 和 授权 响应 ， 以便 付款 处理 用 ； 
 　 　 商家 完成 购买 请求 后 ， 执行 订单 。 
 2.3 . 4 　 付款 
 　 　 a ）   商家 请求 付款 
 　 　 商家 产生 付款 请求 ； 
 　 　 商家 将 其 证书 嵌入 付款 请求 中 ， 并用 商家 的 私人 密钥 对 付款 请求 签名 ； 
 　 　 商家 用 对称 密钥 对 请求 加密 ， 并用 支付 网关 交换 密钥 的 公开密钥 对 该 密钥 加密 ； 
 　 　 商家 将 加密 后 的 付款 请求 和 以前 保存 的 来自 授权 响应 的 加密 付款 标志 送给 支付 网关 。 
 　 　 b ）   支付 网关 处理 付款 请求 
 　 　 网关 遍历 信任 链 确认 商家 证书 ； 
 　 　 网关 用 网关 交换 密钥 的 私人 密钥 对 对称 密钥 解密 ， 然后 用该 对称 密钥 对 付款 请求 解密 ； 
 　 　 网关 用 商家 的 公开密钥 确认 付款 请求 上 商家 的 签名 ； 
 　 　 网关 用 网关 交换 密钥 的 私人 密钥 对 对称 密钥 解密 ， 然后 再用 对称 密钥 对 付款 标志 解密 ； 
 　 　 网关 确认 商家 的 付款 请求 与 付款 标志 一致 ； 
 　 　 网关 通过 金融 网络 向 客户 金融机构 发 付款 请求 ； 
 　 　 网关 产生 付款 响应 报文 （ 包括 网关 签名 证书 ） ， 并用 网关 的 私人 密钥 加密 ； 
 　 　 网关 用 随机 产生 的 对称 密钥 对 付款 响应 加密 ， 再用 商家 交换 密钥 的 公开密钥 对 该 对称 密钥 加密 ； 
 　 　 网关 将 加密 后 的 付款 响应 送 商家 。 
 　 　 c ）   商家 接收 付款 响应 
 　 　 商家 遍历 信任 链 确认 支付 网关 证书 ； 
 　 　 商家 用 商家 交换 密钥 的 私人 密钥 对 对称 密钥 解密 ， 然后 再用 该 对称 密钥 对 付款 响应 解密 ； 
 　 　 商家 用 支付 网关 的 公开密钥 确认 付款 响应 上 支付 网关 的 签名 ； 
 　 　 商家 保存 付款 响应 ， 以便 今后 与 来自 受卡 机构 支付 对 帐 。 
 2.4 　 小结 
 　 　 通过 上面 的 分析 可以 看到 ， SET 定义 了 一个 完备 的 电子 交易 流程 ， 它 较 好地解决 了 电子 交易 中 各方 间 复杂 的 信任 关系 和 安全 连接 ， 确保 了 电子 交易 中 信息 的 真实性 、 保密性 、 防 抵赖 性 和 不可 更改 性 。 与此同时 ， SET 协议 庞大 而 又 复杂 ， 银行 、 商家 和 客户 均 需要 改造 系统 才能 实现 互操作 ， 因此 ， SET 协议 被 普遍 使用 尚有 一个 过程 。 但是 ， 与 SSL 相比 ， SET 协议 具有 许多 优点 ： 
 　 　 *   SET 对 商家 提供 了 保护 自己 的 手段 ， 使 商家 免受 欺诈 的 困扰 ， 并 使 商家 的 运营 成本 降低 ； 
 　 　 *   对 消费者 而言 ， SET 保证 了 商家 的 合法性 ， 并且 用户 的 信用卡 号 不会 被 窃取 ， SET 替 消费者 保守 了 更 多 的 秘密 使 其 在线 购物 更加 轻松 ； 
 　 　 *   银行 和 发卡 机构 以及 各种 信用卡 组织 非常 喜爱 SET 协议 ， 因为 SET 帮助 它们 将 业务 扩展 到 Internet 这个 广阔 的 空间 中 ， 从而 使得 信用卡 网上支付 具有 更 低 的 欺诈 概率 ， 这 使得 它 比 其它 支付 方式 具有 更大 的 竞争力 ； 
 　 　 *   SET 对于 参与 交易 的 各方 定义 了 互操作 接口 ， 一个 系统 可以 由 不同 厂商 的 产品 构筑 。 
 　 　 将来 ， 由于 SET 交易 的 低 风险性 以及 各 信用卡 组织 的 支持 ， SET 将 在 基于 Internet 的 卡 支付 交易 中 占据 主导地位 。 　 　 
 3 　 结束语 
 　 　 本文 详细分析 了 目前 电子 交易 中 的 主流 协议 SSL 协议 和 SET 协议 。 二者 均 是 非常 成熟 和 实用化 的 协议 ， 能为 电子商务 提供 有力 的 安全 保障 。 只是 两 协议 所处 的 网络 层次 不同 ， 出发点 不同 ， 为 电子 交易 提供 的 安全级别 和 手段 也 不同 ， 在 实际 应用 中 可 根据 需求 单独 使用 一个 协议 或 组合 使用 两个 协议 。 
 　 　 刘卫宁 　 博士 ， 副教授 。 主要 研究 方向 ： 计算机网络 及 通信 、 智能 交通系统 。 
 　 　 宋 　 伟 　 硕士 ， 讲师 。 主要 研究 方向 ： 电子商务 、 数据库 技术 、 智能 交通系统 。 
 　 　 作者 单位 ： 刘卫宁 　 宋 　 伟 （ 重庆大学 计算机科学 与 工程学院 　 重庆   400044 ） 
 参考文献 
 ［ 1 ］ SET   Secure   Electronic   Transaction   Specification   ， http : / / www . setco . org / set — specifications . html 
 ［ 2 ］ The   SSL   Protocol ,   http : / / www . netscape . com 
 ［ 3 ］ David   Kosiur , 著 . 电子 贸易 . 陈曙辉 , 译 . 北京 ： 清华大学出版社 ,   1998 ， 8 
 ［ 4 ］ Peter   Loshin , 著 . Extranet 设计 与 实现 . 付 　 筱 ， 乔一林 , 译 . 北京 ： 电子 工业 出版社 ,   1998 , 2 
 　 　 收稿 日期 : 1999 - 04 - 14 
