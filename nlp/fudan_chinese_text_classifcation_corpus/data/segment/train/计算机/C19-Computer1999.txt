微型机 与 应用 
 WEIXINGJI   YU   YINGYONG 
 1999 年 3 月   第 18 卷   第 3 期   vol.18   No.3 
 
 
 
 Internet 电话 网关 技术 及 实现 策略 
 黄永峰 　 冯丹 　 张江陵 
 　 　 摘 　 要 ： 阐述 了 Internet 电话 连接 方式 以及 Internet 电话 网关 的 关键技术 问题 。 最后 介绍 了 Internet 电话 网关 的 实现 策略 。 
 　 　 关键词 ： Internet 电话 网关 　 G723.1 　 H.323 　 回声 消除 
 　 　 Internet 电话 就是 在 Internet 上 可 通过 TCP / IP 协议 实现 实时 传送 语音 的 一种 新型 电信业务 ， 是 近年来 人们 研究 的 热点 。 据 国际数据公司 分析 ， Internet 电话 的 市场 业务量 将 从 1995 年 的 350 万元 上升 到 1999 年 的 56 ? 000 万元 。 人们 之所以 对 Internet 电话 抱 着 如此 大 的 兴趣 和 保持 如此 乐观 的 态度 ， 有 2 个 关键 的 原因 ： ( 1 ) Internet 电话 在 很大 程度 减少 长途 ( 国际 、 国内 ) 电话 费用 ； ( 2 ) Internet 电话 的 使用 ， 标志 着 一种 全新 的 功能 更强 的 通信 方式 的 产生 ， 从而 可以 打破 电话公司 的 垄断市场 。 
 　 　 目前 ， Internet 电话 的 实现 策略 有 如下 3 种 方式 ： ( 1 ) PC机 to   PC机 方式 ， 该 方案 是 在 通信 双方 用户 联网 的 PC机 上 配置 1 个 声卡 、 话筒 、 扬声器 和 IP电话 软件 ( 如 Netmeeting ) ， 就 可 进行 通话 。 IBM 、 微软 、 网景 等 公司 都 相继 推出 这种 IP电话 软件产品 。 ( 2 ) 是 Phone   to   Phone ， 即 网关 方式 。 该 方案 是 在 通信 双方 的 局端 设立 所谓 Internet 电话 网关 ， 而 在 用户端 ， 只 需 使用 普通 电话机 ， 可 通过 Internet 进行 语音 通信 。 随着 技术 的 发展 ， 网关 方式 是 Internet 电话 的 主要 组成 方式 。 连接 方式 如图 1 所示 。 ( 3 ) 是 PC机 TO   Phone 方式 。 该 方案 是 上述 二种 方式 的 混合 方式 ， 即 通信 双方 一方 采用 PC机 方式 ， 另一方 采用 网关 方式 。 下面 主要 介绍 Internet 电话 网关 的 相关 技术 及 实现 策略 。 
 
 图 1     Interret 电话 网关 的 连接 方式 
 1   Internet 电话 网关 的 关键技术 
 1.1 　 Internet 电话 与 传统 电话 主要 差异 及 Internet 电话 网关 实现 的 功能 
 　 　 传统 电话 ( PSTN ) 采用 的 是 线路 交换 方式 ， 通话 的 双方 通过 呼叫 方式 建立 1 条 64kb / s 带宽 的 物理 链路 ， 因此 ， 能 确保 语音 的 实时 传输 和 通信 的 同步 。 但是 PSTN 的 线路 交换 链路 一旦 建立 ， 无论 双方 是否 通话 ， 其 链路 始终保持 ， 直至 链路 被 拆除 。 Internet 采取 的 是 分组 交换 方式 ， 其 分组 以 存储器 转发 的 机理 在 Internet 节点 间 传输 ， 分组 在 路由 上 传输 的 延迟 是 不 确定 的 ， 它 受 Internet 当前 可用 的 传输 带宽 等 因素 的 影响 ， 因此 不能 提供 可靠 的 实时 传输 。 IP电话 网关 就是 用来 实现 语音 在 这 二种 传输方式 不同 网络 上 的 协议 的 转换 ， 并 确保 语音 数据 在 Internet 实时 传输 。 
 　 　 IP电话 网关 是 网络 互联 设备 中 的 一种 新型 网关 ， 它 的 一边 连 着 传统 的 电话网 ， 如 公共 交换 电话网 ( PSTN ) ， 通过 交换机 ( PBX ) 可 与 外部 的 任意 一部 电话 通信 ， 网关 的 另一边 连着 Internet 或 Intranet 。 用户 拔 打 长途电话 时 ， 网关 接收 电话 语音 信号 ， 经 数字化 ， 形成 A 律 / μ 律 的 PCM 码 。 再 按 H.323 规定 的 压缩 标准 ， 如 ( G723.1 、 G729 ) 进行 数据压缩 ， 再 根据 电话 区 号 数据库 资料 确定 相应 网关 的 IP地址 ， 然后 使用 IP 协议 和 RTP 协议 将 语音 数据 组装 成分 组 、 送到 Internet ， 通过 Internet 传到 对端 网关 ； 对端 网关 接到 Internet 传来 的 IP 分组 经 解码 处理 ， 并 还原 为 模拟 语音 信号 转送 PSTN 系统 。 图 2 显示 了 语音 数据 在 Internet 电话网 关中 的 转换 过程 。 
 
 图 2     Interret 电话网 关中 语音 数据 转换 过程 
 1.2 　 Internet 电话 网关 的 关键技术 
 　 　 如何 保证 语音 在 Internet 上 的 实时 传输 ， 以及 如何 提高 Internet 电话 的 服务 品质 ( QoS ) ， 是 Internet 电话 网关 必须 解决 的 关键问题 。 为了 实现 这 一点 ， Internet 电话 网关 必须 实现 下列 3 个 关键技术 。 
 　 　 ( 1 ) 语音 延时 的 处理 和 回声 消除 技术 
 　 　 在 Internet 电话 中 ， 产生 延迟 的 延迟 源有 3 种 ， 分别 是 语音 压缩 延迟 、 分组 传输 延迟 和 各种 处理 延迟 。 其中 语音 压缩 延迟 ， 可 通过 “ 回声 消除 ” 来 解决 ， 以 防止 产生 回 铃声 和 回响 。 回声 消除 的 好坏 在 很大 程度 影响 语音 质量 ， 因此 ， 在 Internet 电话网 关中 ， 回声 消除 是 一 关键技术 问题 。 目前 ， 主要 采用 DSP 处理器 来 实现 AEC 回声 消除 技术 。 传输 延迟 是 光 / 电子 的 传输速度 极限 所致 ， 这 不是 影响 语音 传输 质量 的 主要 因素 。 作为 Internet 电话 最大 的 延迟 是 处理 延迟 ， 特别 是 网络 发生 堵塞 时 ， 数据 在 Internet 上 的 处理 延迟 是 相当可观 的 。 据 测试表明 在 INTERNET 国际 线路 上 的 端 到 端的 延迟 甚至 可达 1s 之多 ， 因此 处理 延迟 是 影响 Internet 电话 的 关键因素 。 尤其 严重 的 是 处理 延迟 是 产生 抖动 延迟 的 关键 原因 ， 抖动 延迟 将 在 发音 之间 产生 随机 中断 。 解决 抖动 延迟 可以 采取 抑制 缓冲 技术 ， 该 技术 是 在 每 一个 语音 分组 提供 一个 时间 标记 ， 以 确保 该 分组 发送到 目标 地址 时 ， 同 其他 语音 元素 的 相对 间隔 与 输入 语音 信号 的 间隔 一致 。 例如 在 IP 网络 中 传输 语音 时 ， 该 时间 标记 是 由 实时 传输 协议 ( RTP ) 提供 的 ； 另外 也 可以 采用 损耗 ( Loss ) 算法 来 处理 延迟 以 保证 语音 质量 。 这种 算法 的 基本原理 是 ： 一个 模拟 语音 在 发送 端 采用 8 位 的 2 进制 数 进行 模 / 数 转换 ， 在 接收端 再 将 二进制 数 转换 为 模拟 波形 。 在 还原 原始 波形 时 ， 这个 2 进制 数中 的 8 位数 并非 同等 重要 ， 例如 ： D7 比 D6 重要 ， D6 比 D5 重要 ， D0 最 不 重要 。 因此 在 数据传输 时 ， 只要 D7 ～ D4 按时 到达 ， 而 对 D3 ～ D0 则 提供 一定 的 等待时间 ， 如能 在 规定 时间 内 到达 ， 则 接收 ； 否则 丢掉 。 
 　 　 ( 2 ) 带宽 限定 的 解决 技术 
 　 　 如 前面 所述 ， Internet 电话 的 语音 传输 机制 是 采用 分组 交换 ， 当 分组 到达 某个 节点 时 ， 分组 根据 当前 的 路由 的 拥挤 情况 来 决定 是 及时 被 转发 还是 被 存储 。 因此 ， 要 实现 Internet 电话 的 语音 实时 传输 ， 就 必须 满足 一定 的 带宽 要求 ， 对于 不同 的 语音 压缩 标准 ， 所 要求 的 带宽 也 不 一样 ， 例如 ： 对于 G.729 压缩 标准 ， 需 8kb / s 的 带宽 ， 而 如果 采用 G.723 . 1 的 标准 进行 语音 压缩 ， 只 需 5.3 kb / s 的 带宽 。 尽管 所 需 带宽 相对 于 普通 电话 的 带宽 64kb / s 来说 要 小得多 ， 但 Internet 网络 并 不是 总能 满足 。 因为 Internet 网络 的 带宽 本身 就 很窄 ， 加上 数据 流量 特别 大 ， 产生 堵塞 的 情况 经常 发生 。 解决 这个 问题 ， 一个 较 好 的 策略 是 制定 一个 协议 ， 在 连接 Internet 网络 的 路由 中 ， 通过 对 不同 的 数据类型 设置 不同 的 优先级 来 控制 带宽 的 分配 ， 可以 将 语音 数据 的 优先级 设 为 最高 ， 使 Internet 网络 的 有限 带宽 最先 满足 语音 传输 的 要求 ， 从而 实现 Internet 电话 实时性 。 根据 资料 报道 ， CISCO 公司 生产 的 路由器 就 率先 支持 该 功能 。 
 　 　 ( 3 ) H.323 协议 栈 的 实现 技术 
 　 　 实现 Internet 电话 ， 必须 考虑 的 1 个 重要 因素 是 Internet 电话 的 产品 所 遵循 的 标准 问题 ， 如果 开发 出来 的 Internet 电话 产品 没有 统一 的 标准 ， 就 无法 实现 互连 。 Internet 电话 的 一个 重要 标准 是 H.323 ， 该 标准 定义 了 通过 Internet 建立 呼叫 的 过程 和 定义 一系列 的 、 用于 Internet 电话 语音 的 压缩 与 解压缩 的 编码 算法 。 H.323 标准 是 由 H.245 、 H.225 、 G723.1 、 G711 、 G729 、 G728 、 RTP 、 RTCP 等 协议 组成 。 现今 大多数 厂商 都 支持 该 标准 ， 如 ： Microsoft 、 Intel 等 。 
 　 　 当然 ， 实现 Internet 电话 网关 ， 还 需 涉及 其它 一些 技术 ， 如 DTMF 的 检测 和 生成 、 静音 的 检测 和 舒适 躁声 的 生成 等 。 
 2 　 Internet 电话 网关 的 实现 策略 
 　 　 根据 目前 市场 上 Internet 电话 产品 情况 分析 ， 实现 Internet 电话 有 下列 3 种 策略 ： 专用 的 DSP 处理 卡 方案 、 独立 的 箱级 设备 方案 、 PBX 集成 模块 方案 。 这 3 种 方案 的 选择 ， 主要 依赖于 3 个 因素 ： 即 同时 支持 的 呼叫 数 、 所 使用 的 压缩 和 解压 标准 以及 功能 需求 。 
 2.1 　 专用 的 DSP 资源 卡 方案 
 　 　 该 方案 是 采用 一个 特定 的 DSP 资源 卡来 实现 Internet 电话 网关 ， 实时 语音 压缩 、 解压缩 和 回声 消除 是 一个 加强 的 计算 任务 ， 可以 用 专用 卡上 的 DSP 芯片 来 完成 ， 而 不是 由 主机 上 的 CPU 来 完成 。 这样 就 减少 了 延迟 ， 可 扩展 的话 路 更 多 ， 在 1 台 高档 PC机 ( 如 ： Pentium   PRO 微机 ) 插上 1 块 或 多块 这种 特定 的 DSP 资源 卡 ， 和 网卡 一起 就 可以 构建 1 台 Internet 电话 网关 。 通过 该 网关 可 将 PBX 和 Internet 或 计算机 局域网 连接起来 。 
 　 　 这 类产品 目前 市场 上 也 较 多 。 例如 ： 作为 该 领域 的 先驱者 之一 Quicknet   Technologies 公司 生产 出 一种 单口 卡 Internet   phone   TACK ( tm ) 。 该卡 可以 与 已 存在 的 Internet 电话 软件 ， 如 Netmeeting 、 Internet   phone 一起 运行 ， 可以 在 1 台 PC机 同时 安装 有 多达 4 个 这样 的 DSP 卡 。 Internet   phone   TACK ( tm ) 利用 其上 的 DSP ， 来 实现 H.323 协议 的 压缩 和 解压缩 以及 自 适应 的 回声 消除 等 功能 。 
 　 　 Micom 是 采用 该 方案 的 另一家 公司 ， 它 已 生产 名为 VIP ( for   Voice   over   IP   networks ) 多口 卡 。 该卡 能 将 一个 企业 WAN 与 公司 的 PBX 合二为一 、 该卡 能 在 各种 操作系统 下 工作 、 能 和 模拟 和 数字 中继线 相连 ， 采用 ITU - G.729 标准 进行 语音 压缩 ， 能 在 IP 协议 网络 上 传输 接近 于 电话 线路 质量 的 语音 。 
 　 　 另外 ， DIALOGIC 公司 的 DM3   Mediastream 高密度 语音卡 是 采用 该 方案 的 典型 产品 ， DM3 高密度 语音卡 是 采用 Motorola 公司 DSP56301 ( 数据处理 速度 为 100Mb / s ， 最多 可 带动 18 个 ) ， 具体 结构 如图 3 。   
 
 2.2 　 建立 PBX 集成 模块 方案 
 　 　 随着 Internet 电话 标准 的 出现 ， 通过 IP 传递 语音 是 交谈 的 一种 重要 工具 ， PBX 生产商 努力实现 通过 在 原有 PBX 的 基础 上 ， 加上 附加 模块 来 实现 IP 网络 传递 语音 的 方案 。 
 　 　 该 方案 的 基本 思想 是 建立 一个 卡 或 模块 ， 该 模块 一方面 与 PBX 背板 或 交换 开关 部件 ( 如 SCSA 总线 ) 相连 ； 另一方面 ， 提供 以太 网络接口 ， 通过 该 接口 与 计算机网络 相连 。 来自 PBX 的 呼叫 经 数字化 、 压缩 ， 形成 IP 包后 ， 由 IP 网络 进行 传输 。 该 方案 与 在 PBX 上接 一个 外部 网关 相比 ， 采用 PBX 集成化 模块 有 如下 优点 ： ( 1 ) 构建 超级 系统 ， 能 将 多个 远程 的 PBX 桥 接到 一个 单一 的 超级 系统 中 ， 用户 能 拨入 用户名 或 扩展名 就 能 完成 一个 办公室 内部 或 外部 的 呼叫 ； ( 2 ) 公共 Internet 拨号 ， 可 采用 和 WEB 相同 的 URL 方式 进行 拨号 。 
 　 　 现在 ， 不同 的 PBX 生产商 使用 不同 的 方法 来 实现 这 一点 ， 但 不管怎样 ， 都 是 在 PBX 中 构建 了 一个 附加 模块 。 所有 信号 的 发出 与 接收 、 包 压缩 与 解压缩 等 处理 都 是 在 该 模块 内 完成 的 。 如果 用户 的 所有 交谈 希望 在 普通 POTS 网上 进行 ， 用户 只 需拨 9 + 普通 电话号码 ； 若 使用 Internet 电话 进行 交谈 ， 就 可以 用 常规 的 电话 拨 9 + IP地址 就 可以 使用 Internet 。 
 　 　 该 方案 与 电话 系统 的 无缝 集成 ， 可以 使 多个 系统 与 1 个 超级 系统 同时 工作 ， 因此 比 基于 PC机 的 Internet 电话 网关 的 扩展性 更好 。 
 2.3 　 建立 独立 的 箱级 网关 设备 方案 
 该 方案 的 基本 思想 是 构造 一个 完全 独立 于 电话 系统 的 封闭 设备 ， 不 需要 专门 的 PC机 。 但 和 大多数 计算 设备 一样 ， 它 内部 也 是 由 DSP 或 CPU 、 模拟 中继线 接口 、 IOBUS 、 以太网 发收 器 、 闪烁 RAM 和 RAM 缓冲区 组成 ， 如图 4 所示 。 该 设备 的 数据处理 过程 是 ： 首先 对 来自 PSTN 的 语音 进行 数字化 ， 然后 进行 压缩 / 解压缩 ， 再用 TCP / IP 协议 通过 以太 网络接口 进行 传输 。 
 
 
 3 　 小结 
 　 　 有关 Internet 电话 技术 的 研究成果 和 产品 日新月异 、 层出不穷 。 前 几年 采用 的 PC机 TO   PC机 的 连接 方式 已 渐渐 地被 网关 方式 所 替代 。 因此 ， Internet 电话 网关 是 近 2 年来 研究 的 主要 方向 。 技术 日趋 成熟 ， 相应 的 标准 也 日益完善 ， Internet 电话 网关 产品 更是 五花八门 ， 形形色色 。 但 纵观 各类 产品 的 体系结构 和 实现 的 方法 ， 并 没有 超出 上述 的 3 种 实现 策略 。 另外 ， Internet 电话 的 下 一个 研究 的 热点 将 是 Gatekeeper 及其 系统结构 。   
 作者 单位 ： 武汉 华中理工大学 计算机 学院 外 存储 国家 实验室 ( 430074 ) 
 参考文献 
 　 1 　 叶敏 . 程控 数字 交换机 与 交换网 . 北京 ： 北京邮电大学 出版社 
 　 2 　 张 延平 ， 林 博文 . 计算机 语音 集成 原理 ， 技术 和 应用 . 北京 ： 人民邮电出版社 
 　 3 　 Cox   R   V ， Kroon   P . Low   Bit - Rate   Speech   Coders   for   Multimedia   Communication . IEEE   Communication   Magazine , 1996 ; ( 12 ) 
 　 4 　 Thom   G   A . H.323 : The   Multimedia   Communcations   Standard   for   Local   Area   Networks . IEEE   Communications   Magazine , 1996 ; ( 12 ) 
 ( 收稿 日期 ： 1998 - 09 - 11 ) 
