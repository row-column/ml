计算机 应用 研究 
 APPLICATION   RESERCH   OF   COMPUTERS 
 2000     Vol.17 　 No.1 　 P.16 - 17 
 
 
 
 
 微软 密码 应用 编程 接口 在 网络化 柔性 加工 单元 中 的 应用 研究 
 周杰 韩   吴波   杜润生   杨 叔子 
 摘   要   企业 网络 环境 为 企业 与 客户 交互 信息 建立 了 一条 快速通道 ， 同时 也 带来 了 网络 信息安全 问题 。 概述 了 密码学 的 基本概念 ， 研究 了 密码 应用 编程 接口 工作 模式 与 微软 信息 密码 系统结构 。 根据 密码 系统 的 基本 功能设计 了 密码 类 ， 讨论 了 柔性 加工 单元 网络 信息安全 内容 ， 并 实现 了 基于 密码 类 的 加密 应用程序 。 
 关键词   网络 制造   网络安全   信息 加密 
 1 　 密码学 的 基本概念 
 　 　 数据 加密 或称 数据编码 就是 给定 初始值 利用 某种 算法 把 明码 文本 转换成 一种 编码 文件 ， 编码 文件 只有 通过 解码 之后 才能 阅读 。 数据 加密 的 实现 手段 则 称为 加密技术 或 编码 技术 。 给定 的 初始值 也 称为 密钥 。 根据 密钥 的 特点 ， 密码 体制 分为 对称 和 非对称 密码 体制 。 
 　 　 对称 密码 体制 也 称 私钥 或 传统 密码 体制 ， 微软 密码 接口技术 中 也 称会话 密钥 ( Session   Key ) 。 该 体制 中 加密 密钥 和 解密 密钥 是 一样 的 ， 其 算法 快 ， 但 需要 找到 一种 安全 传送 密钥 的 通道 。 非对称 密钥 体制 也 称 双钥 或 公钥 密码 体制 ， 该 体制 中 加密 密钥 和 解密 密钥 是 不 一样 的 。 每个 用户 都 有 两把 密钥 ： 加密 密钥 和 解密 密钥 。 其中 加密 密钥 公开 ， 解密 密钥 由 自己 保存 。 用户 A 若要 向 B 发送 明文 ， 只要 利用 B 的 公开密钥 对 明文 加密 。 而 B 收到 密文 后 利用 只有 他 掌握 的 解密 密钥 解密 就 可 得到 明文 。 其中 私钥 密码 体制 根据 对 明文 加密 方式 的 不同 可 分为 流 密码 和 分组 密码 。 流 密码 算法 利用 密钥流 的 第 i 个 元素 对 明文 的 第 i 个字符 加密 。 分组 密码 算法 则 将 明文 分成 n 组有 m 个字符 的 数组 ， 每组 明文 在 同一个 密钥流 的 控制 下 变换 成 p 个字符 的 密文 组 。 由于 两种 体制 下 算法 复杂度 不同 ， 在 软件 实现 中 ， 私钥 流 密码 DES ( 数据 加密 标准 ) 大约 比公钥 RSA ( 1977 年 由 Rivest 、 Shamir 和 Adleman 提出 ) 算法 快 100 倍 。 
 　 　 数字签名 是 公钥 密码 体制 下 的 一个 重要 应用 。 数字签名 是 绑定 在 明码 上 的 一段 消息 串 ， 其 表现 手段 不同于 手写 签名 或 印签 ， 但 它们 的 作用 基本一致 。 即 都 能 保证 明码 发送 后 的 完整性 和 验证 签名者 。 应用 RSA 公钥 体制 进行 数字签名 时 ， 若 A 要 向 B 送去 信息 m ， A 可用 A 保密 的 解密 密钥 DA 对 m 进行 加密 得到 DA ( m ) ， 再用 B 的 公开密钥 EB 对 DA ( m ) 进行 加密 得 最终 密文 ， B 收到 密文 后 先用 他 自己 掌握 的 解密 密钥 DB 对 密文 进行 解密 得到 中间 密文 DA ( m ) ， 再用 A 的 公开密钥 EA 对 中间 密文 DA 解密 得到 明文 。 由于 最终 密文 只有 A 才能 产生 ， B 无法 伪造 或 修改 密文 ， 所以 A 不能 抵赖 ， 这样 达到 签名 认证 的 目的 。 
 2 　 密码 应用 编程 接口 编程 模式 与 微软 密码 系统 
 2.1 　 密码 应用 编程 接口 编程 模式 
 　 　 密码 应用 编程 接口 工作 模式 类似 于 Windows 图形 设备 接口 GDI 工作 模式 。 密码 应用 编程 接口 提供 了 一组 独立 于 密码 服务提供商 ( Cryptographic   Service   Provider ) 的 标准 密码 指令集 ， 在 应用程序 与 密码 服务提供商 之间 提供 一个 环境 外壳 ， 负责 应用程序 的 密码 服务 要求 与 执行 密码 应用程序 系统 中 的 密码 功能 之间 的 转换 。 所有 加密 操作 均 由 密码 服务提供商 来 完成 ， 包括 加密 数据 或 数字签名 和 用户 私钥 保护 等 。 密码 服务提供商 与 图形 设备 驱动程序 类似 ， 是 可 根据 需要 进行 增删 的 独立 模块 。 密码 应用 编程 接口 的 外壳 模式 将 应用程序 分隔 成 了 用户 态 与 核心 态 。 应用程序 在 用户 态下 禁止 直接 与 密码 服务提供商 通信 ， 而是 交给 作为 操作系统 部分 的 密码 应用 编程 接口 核来 完成 。 
 2.2 　 微软 信息 密码 系统 
 　 　 微软 信息 密码 系统结构 由 三 部分 组成 ， 它们 分别 是 密码 应用程序 、 操作系统 和 密码 服务提供商 ( CSP ) 。 如图 1 所示 。 
 
 图 1 　 微软 信息 密码 系统 体系结构 
 　 　 图中 密码 服务提供商 是 真正 完成 密码 工作 的 独立 模块 。 理想 的 CSP 应 完全 独立 于 具体 应用程序 ， 这样 任何 给定 应用 能 运行 在 多种 CSP 上 。 一种 CSP 最少 由 动态 连接 库 和 签名文件 组成 。 签名文件 保证 操作系统 识别 CSP 。 操作系统 定期 认证 签名 确保 CSP 没 被 篡改 过 。 而 动态 连接 库中 包含 了 一系列 密码 服务程序 的 具体 实现 。 例如 微软 RSA 基本 服务提供商 提供 的 动态 库 文件 为 RSABASE . DLL 和 一个 签名文件 ， 它 是 和 视窗 操作系统 绑定 在 一起 的 。 当 安装 新 的 CSP 时 ， 服务提供商 的 安装文件 将 自动 修改 系统 的 配置文件 ， 同时 该 CSP 的 密码 应用 编程 接口 的 配置 信息 将 存储 在 注册表 的 本地 机器 位置 。 每 一个 密码 服务提供商 都 负责管理 自己 的 密钥 库 ， 该 密钥 库 可 作为 CSP 为 每个 用户 创建 的 永久性 密钥 的 仓库 。 每个 密钥 库可有 一个 或 多个 存储 特定 用户 所有 密钥 对 的 密钥 容器 ( container ) 。 绝大多数 的 CSP 通常 为 用户 提供 两组 公钥 / 私钥 对 。 一组 密钥 对 又 叫 密钥 交换 对 ， 通常 用于 加密 会话 密钥 ， 这样 会话 密钥 可以 安全 存放 或 与 其它 用户 交换 。 另一组 又 叫 数字签名 密钥 对 ， 通常 用于 创建 数字签名 。 在 用户 与 服务提供商 建立联系 之前 ， 用户 必须 有 一个 密钥 库 ， 该 密钥 库 存储 在 注册表 的 当前 用户 位置 。 操作系统 成功 安装 某种 CSP 并 创建 密钥 库后 ， 就 可以 与 应用程序 取得 连接 。 应用程序 通过 CSP 名称 调用 CSP 联系 指令 。 一旦 连接 成功 ， 由 操作系统 将 CSP 装入 内存 ， 其 密码 服务 功能 将 成为 操作系统 核 部分 运行 。 
 3 　 信息 密码 面向对象编程 接口 设计 与 应用 
 3.1 　 信息 密码 面向对象编程 接口 设计 
 　 　 应用 面向对象 方法 ， 对 密码 编程 接口 功能 进行 分析 与 封装 设计 ， 将 有效 提高 编程 速度 。 信息 密码 功能 主要 包括 ： l ) 创建 密钥 。 该 功能 根据 提供 的 密钥 算法 产生 私钥 体制 下 的 会 话 密钥 或公钥 体制 下 的 公共 / 私钥 对 。 2 ) 交换 密钥 。 该 功能 包括 交换 公钥 和 交换 会话 密钥 。 交换 公钥 不 需要 加密 可 直接 输出 。 交换 会话 密钥 时 必须 通过 对方 的 公钥 进行 加密 输出 。 3 ) 数据 加密 和 数据 解密 。 由于 非对称 加密算法 速度慢 ， 信息 密码 面向对象编程 接口 中 的 所有 数据 加密 都 使用 对称 算法 。 而 公共 / 私人 密钥 算法 则 用以 较 少 位数 的 数据 加密 ， 如对会 话 密钥 或 数字签名 进行 加密 。 数据 解密 利用 会话 密钥 对 密文 解密 。 4 ) 数字签名 和 签名 认证 。 数字签名 可用 来 验证 数据 是否是 真正 由 签名 方 发送 来 的 或 数据 在 途中 是否 受到 损坏 。 创建 数字签名 的 第一步 是 计算 签名 数据 的 哈希 值 ， 然后 用 用户 的 私钥 加密 哈希 值得 到 数字签名 。 由于 私钥 是 秘密 的 ， 可以 确保 不 知道 密钥 的 人 无法 伪造 数字签名 。 签名 认证 第一步 用 用户 的 公共 密钥 解密 数字签名 并 计算 哈希 值 ， 将 收到 的 哈希 值 与 自己 计算 的 哈希 值相 比较 来 验证 数字签名 ， 由于 只有 真正 的 发送者 才能 创建 匹配 的 哈希 值 ， 所以 可以 认证 发送者 的 身份 。 在 信息 密码 面向对象编程 接口 实现 中 ， 创建 密码 类 ， 将 上述 四种 密码 功能 作为 该类 的 成员 函数 。 密码 类 既 可 作成 基类 与 应用程序 一起 进行 编译 ， 也 可 作为 窗口 类 的 派生类 ， 将 密码 类 作成 动态 库由 应用程序 调用 。 下面 是 采用 第二种 方法 列出 的 密码 类 C++ 语言 描述 ： 
 　 　 Class   CCryptography : : CWnd 
 　 　 { 
 　 　 public : 
 　 　 CString   strSourceFile , 
 　 　 CString   strDestFile , 
 　 　 CString   strDescription ; 
 　 　 public : 
 　 　 CCryptography : : CCryptgraphy ( Cstring 
 　 　 sourcefile ,   Cstring   destfile ) ; 
 　 　 BOOL   CreateKeyContainer (   ) ;   / / 创建 密钥 库 
 　 　 BOOL   EncryptFile (   ) ;   / / 密码文件 
 　 　 BOOL   DecryptFile (   ) ;   / / 解密 文件 
 　 　 BOOL   SignaturetFile (   ) ;   / / 创建 数字签名 
 　 　 BOOL   VerifyFile (   ) ;   / / 验证 数字签名 
 　 　 } 
 3.2 　 密码 类 在 柔性 加工 单元 信息安全 中 的 应用 
 　 　 柔性 加工 单元 是 有 多 品种 小 批量生产 特点 的 制造 系统 。 单元 通常 按照 客户 定单 组织 生产 。 单元 网络 环境 加快 了 单元 与 外界 交互 信息 的 速度 ， 同时 也 带来 了 网络 信息安全 问题 。 柔性 加工 单元 网络 信息安全 包括 ： 1 ) 交互 信息 加密 。 加工 单元 通过 网上 发布 服务 信息 和 表单 的 方式 与 客户 取得联系 。 双方 交互 具有 许多 不 希望 第三方 知道 的 敏感 信息 ， 如 客户 方 要求 的 定货 名称 、 数量 和 单位 等 信息 ， 加工 单元 回复 的 产品设计 、 成本 报价 等 信息 ； 2 ) 合同 数字签名 。 加工 单元 与 客户 双方 利用网络 签定 合同 时 ， 传统 的 手写 签名 或 印签 方法 是 不 适用 的 。 这时 需要 借助 数字签名 方法 达到 手写 签名 的 不可否认 、 无法 伪造 和 可 仲裁 的 目的 。 下面 是 应用 密码 类 密码 应用程序 的 部分 C++ 代码 ： 
 　 　 文件 加密 
 　 　 { / / 定义 密码 类 对象 ， 调用 密码 类 加密 成员 函数 
 　 　 ... 
 　 　 CCryptography *   m _ crypto ; 
 　 　 m _ crypto = new 
 　 　 CCryptography ( Sourcefile ,   Destfile ) ; 
 　 　 m _ crypto - > EncryptFile (   ) ; 
 　 　 ... 
 　 　 } 
 4 　 全文 总结 
 　 　 应用 密码 类 编写 密码 应用程序 明显提高 了 编程 效率 ， 而且 也 适应 渐趋 发展 的 面向对象编程 方向 。 应用 密码 类 动态 库 连接 方式 使 应用程序 与 密码 编程 接口 进一步 分离 ， 从而 使 增删 密码 类 功能 不 十分 影响 应用程序 。 应用 密码 类 的 密码 应用程序 的 密码 速度 虽比 封装 前 稍慢 ， 但 其 效果 还是 令人满意 的 。 倘若 密码 几十 兆 字节 的 产品设计 图纸 肯定 存在 速度 太慢 的 问题 ， 此时 可 考虑 将 图纸 分解 密码 。 当然 产品设计 图纸 的 网络 传输 本身 也 存在 速度 太慢 的 问题 。 
 国家教委 博士点 基金 资助 
 国家自然科学基金 重大项目 ( 59990470 ) 资助 
 周杰 韩 （ 华中理工大学 机械 科学 与 工程学院   武汉   430074 ） 
 吴波 （ 华中理工大学 机械 科学 与 工程学院   武汉   430074 ） 
 杜润生 （ 华中理工大学 机械 科学 与 工程学院   武汉   430074 ） 
 杨 叔子 （ 华中理工大学 机械 科学 与 工程学院   武汉   430074 ） 
 参考文献 
 1 ， Microsoft   Corporation .   Information :   Overview   of   Cryptography .   1996 
 2 ， 冯登国 ,   裴定 一 .   密码学 导引 .   北京 ： 科学出版社 ,   1999 ,   4 
 3 ， 胡道 元 .   Intranet 网络 技术 及 应用 .   清华大学出版社 ,   1998 ,   5 
 4 ｖ 周杰 韩 ,   张 金华 ,   吴   波 .   图形 动态 连接 库 的 设计 与 实现 .   电脑 编程 技巧 与 维护 ,   1999 , 6 ： 5 ～ 61 
 收稿 日期 ： 1999 年 8 月 8 日 
