微型机 与 应用 
 MICROCOMPUTER   &   ITS   APPLICATIONS 
 1999 年   第 18 卷   第 2 期   Vol.18   No.2   1999 
 
 
 
 计算机 与 PLC 集成 控制系统 在 石化 行业 的 应用 
 陈 　 勇 　 张华平 　 赵显 红 
 　 　 摘 　 要 ： 计算机 与 PLC 集成 控制系统 的 基本 组成 、 功能 、 系统 软硬件 设计 与 通信 技术 以及 该 系统 在 石化 行业 的 应用 。 
 　 　 关键词 ： 计算机 　 PLC 可 编程序 控制器 　 控制系统 　 通信 技术 
 　 　 近年来 ， 国际 市场 上 石化 产品 的 竞争 日趋激烈 。 与 国外同类 产品 相比 ， 我国 的 石化 产品 无论 在 生产工艺 上 ， 还是 产品质量 上 ， 都 存在 着 相当 大 的 差距 。 为 改变 我国 石化 产品 发展 严重 滞后 的 局面 ， 国内 石化 行业 的 许多 厂家 已 开始 向 产品 的 多样化 、 添加剂 材料 和 配方 的 高科技化 迈进 。 我们 应 有关 厂家 提出 的 技术 要求 ， 针对 石化 产品 生产工艺 复杂 、 添加剂 配比 要求 严格 、 品种 多样 、 互换性 差 的 特点 ， 开发 研制 了 计算机 与 PLC 集成 控制系统 。 该 系统控制 可靠 、 操作 简便 、 开放性 强 、 性能 价格比 高 ， 在 国内 石化 系统 的 数家 企业 推广应用 后 ， 受到好评 。 
 1 　 系统 组成 
 　 　 计算机 与 PLC 集成 控制系统 由 生产 系统 和 非生产 系统 二 部分 组成 ( 如图 1 ) 。 生产 系统 主要 由 微型机 、 适配器 、 PLC 、 执行机构 及 现场 仪表 等 部分 组成 。 非生产 系统 主要 由 工艺流程 模拟 显示屏 、 电视 监视 设备 、 现场 通话 设备 、 质量检查 系统 、 管理信息系统 等 部分 组成 。 中央 控制室 负责 处理 来自 生产 系统 和 非生产 系统 的 大量 信息 。 通过 计算机 与 PLC 集成 控制系统 ， 将 润滑油 厂 的 各 生产 车间 、 附属 部门 以及 总厂 厂部 联成 了 密不可分 的 整体 ， 从而 最大 限度 地 利用 了 信息 资源 。 
 
 图 1     计算机 集成 控制系统 的 组成 
 2 　 系统 功能 
 　 　 为 满足用户 提出 的 技术 要求 和 现场 的 工况 ， 此 控制系统 的 设计 具有 以下 功能 ： 
 　 　 1 . 根据 用户 提出 的 技术 要求 ， 按照 添加剂 配方 的 比例 精确 地 配制 生产 各种 型号 的 石化 产品 ， 并且 通过 微型机 和 现场 PLC 控制系统 实现 整个 生产 过程 的 自动化 。 
 　 　 2 . 通过 自行 开发 的 计算机软件 ， 实现 生产 现场 的 动态 监控 。 良好 的 人机界面 、 清晰 的 组态 图形 ， 使得 操作 人员 通过 计算机屏幕 ， 对于 现场 的 各种 工况 变化 一目了然 。 
 　 　 3 . 在 现场 生产 中 ， 为 提高 整个 控制系统 的 精确性 ， 在 搅拌器 、 电动机 、 电动阀 、 电磁阀 等 设备 上均 设计 了 局部 反馈 功能 ， 这些 相互 独立 系统 的 局部 反馈 功能 构成 了 对 总 系统 反馈 控制 的 有力 支持 。 
 　 　 4 . 当 系统 出现 压力 报警 或 油面 报警 时 ， 一方面 通过 PLC 程序实现 自动 停车 ， 另一方面 借助于 语音卡 ， 在 控制 间 的 操作 人员 可以 立即 听到 报警信号 ， 及时 采取相应 措施 。 
 　 　 5 . 考虑 到 生产 现场 某些 部位 属于 高温 、 有害 气体 残留 处 ， 技术人员 不宜 靠近 ， 在 现场 设置 了 电视 监视 设备 ， 让 技术人员 实现 远程 监控 。 为 便于管理 ， 还 安装 了 现场 通话 设备 。 
 　 　 6 . 在 中央 控制室 设置 了 1 个 大屏幕 模拟 显示屏 ， 在 屏幕 上 不仅 可以 显示 总厂 所有 管道 线路 ， 而且 能够 动态显示 油 的 液位 、 流向 ， 让 高层 管理人员 从 宏观 上 掌握 全厂 的 生产 状况 。 
 　 　 7 . 通过 微机 联网 ， 质量检查 部门 可以 直接 得到 工业 现场 的 信息 ， 各 管理 部门 之间 也 可以 实现 数据通信 与 数据共享 。 
 3 　 硬件 与 软件设计 
 3.1 　 硬件 设计 
 　 　 在 本 系统 中 ， 工业 现场 控制 是 核心 ， 而 工业 现场 控制 主要 由 PLC 系统 完成 ， 所以 如何 合理 有效 地 使用 PLC 技术 就 成 了 设计 的 关键 。 PLC 的 特点 是 控制 可靠 ， 编程 简单 ， 但 程序 内存 不 大 ， 不能 进行 复杂 的 编程 ； 而 石化 产品 的 特点 是 生产工艺 复杂 ， 产品型号 繁多 ， 往往 1 条 生产线 就 能够 生产 几十种 型号 的 产品 。 这 就 形成 了 一对 矛盾 。 如果 设计 时 采用 常规 的 PLC 控制系统 ， 那么 1 条 生产线 就 需要 20 几台 PLC 基本 模块 和 A / D 转换 模块 。 投资 巨大 ， 而且 按照 现代 控制 理论 ， 在 1 个 控制系统 中 配置 的 控制 模块 越 多 ， 控制 越 不 可靠 。 为了 减少 投资 和 增强 控制 的 可靠性 ， 在 PLC 控制系统 的 硬件 配置 上 进行 了 多项 创新 。 
 　 　 以 润滑油 生产线 为例 ， 在 润滑油 生产 车间 ， 有 搅拌 温度 、 添加剂 温度 、 输油泵 压力 、 油罐 的 液面 等 共计 32 路 模拟信号 需要 检测 。 如果 按 常规 设计 ， 需要 8 块 FX - 4AD 模块 。 为 减少 投资 ， 设计 了 多路 开关 切换 电路 ， 只用 2 块 FX - 4AD 模块 就 完成 了 全部 功能 。 图 2 为 FX - 4AD 模块 的 多路 开关 切换 示意图 。 
 
 
 图 2 　 FX - 4AD 模块 的 多路 开关 切换 示意图 
 　 　 图 2 中 ， FX - 4AD 模块 为 12 位 4 通道 模拟量 输入 模块 ， Y0 、 Y1 、 Y2 、 Y3 为 PLC 的 任意 输出 触点 。 FX - 4AD 模块 的 多路 开关 切换 电路 的 设计 实质 上 是 通过 1 个 多路 开关 控制 FX - 4AD 模块 分别 去 完成 搅拌 温度 检测 、 添加剂 温度 检测 、 输油泵 压力 检测 及 油罐 液面 检测 4 项 功能 ， 其中 多路 开关 的 4 个 转换 触点 接 PLC 的 输出 触点 ， 由 PLC 编程 控制 。 这个 多路 开关 切换 电路 简单 实用 ， 而且 节省 了 大量 投资 ， 实践证明 ， 该 电路 在 控制精度 上 完全 满足用户 的 需要 。 
 3.2 　 软件设计 
 　 　 在 计算机 与 PLC 集成 控制系统 的 软件设计 中 ， 也 采用 了 许多 新 的 设计 思想 。 
 　 　 仍 以 润滑油 生产 车间 为例 ， 按照 用户 提出 的 72 种 润滑油 的 生产工艺 和 技术 要求 ， 如果 用 常规 方法 编程 ， 需要 12 台 PLC 基本 模块 。 为 节约 投资 ， 我们 充分利用 PLC 的 文件 寄存器 ( 2000 点 ) ， 用 逐项 查表 的 方法 编写 了 1 个 72 种 润滑油 的 通用 程序 ， 用 1 台 PLC 基本 模块 带 2 台 PLC 扩展 模块 的 方式 完成 了 过去 需要 12 台 PLC 才能 实现 的 功能 。 
 　 　 我们 选用 了 三菱公司 生产 的 FX 系列 的 可 编程序 控制器 ， 文件 寄存器 共计 2   000 点 ( D1000 ～ D2999 ) 。 为 节约 程序 内存 ， 充分利用 PLC 本身 提供 的 指令 资源 ， 我们 选用 了 字 传送 方式 ， 用 1 个 16bit 的 字 来 控制 PLC 触点 的 16 个 输出 触点 ， 而 不必 像 过去 那样 ， 1 条 指令 只能 控制 1 个 输出 触点 。 例如 在 图 3 中 ， 首先 X0 导通 ， 十进制 数 K6 送入 数据 寄存器 D0 ， 接着 X1 导通 ， 数据 寄存器 D0 的 数值 K6 转化 为 二进制 数 “ 0000 　 0000 　 0000 　 0110 ” 送入 K4Y0 ， 控制 输出 Y0 ～ Y17 共计 16 个 触点 的 动作 ， 其 开关 动作 和 数据 寄存器 D0 的 数值 K6 一一对应 。 如图 4 所示 ， “ 1 ” 控制 输出 触点 导通 ， “ 0 ” 控制 输出 触点 关断 。 在 此例 中 ， Y1 、 Y2 触点 导通 ， 其余 输出 触点 关断 。   
 
 图 3     字 传送 方式 控制 输出 触点 示意图 
 
 图 4     数据 寄存器 DO 的 值 与 16 个 触点 的 对应 关系 
 　 　 通过 字 传送 方式 ， 我们 用 1 条 指令 就 可 控制 16 个 电动阀 及 输油泵 的 动作 ， 大大 节省 了 程序 空间 。 在 这种 设计 思想 下 ， 我们 把 72 种 润滑油 的 工艺流程 全部 用字 方式 编写 ， 然后 输入 文件 寄存器 ， 并 在 此基础 上 ， 编制 了 72 种 润滑油 的 通用 程序 。 在 通用 程序运行 时 ， 根据 某一 润滑油 的 型号 ， 通过 查表 的 方式 ， 在 文件 寄存器 中 调出 对应 的 数据 段 ( 这些 数据 段 也 就是 该种 润滑油 的 工艺流程 ) ， 然后 该 数据 自动 输入 PLC 的 控制程序 ， 使得 PLC 按照 规定 的 工艺流程 控制 整个 执行机构 工作 。 如图 5 所示 之例 ， 润滑油 品种 LSO - 1 的 工艺 状态字 存于 文件 寄存器 D1050 ～ D1060   10 个 字节 中 。 程序运行 时 ， 首先 根据 润滑油 型号 在 文件 寄存器 中 寻址 ， 查 到 正确 的 地址 后 ， 调出 D1050 ～ D1060   10 个 字节 的 数据 ， 然后 输入 到 通用 程序 的 相应 寄存器 ， 参与 工业 控制 。 
 
 图 5     文件 寄存器 示意图 
 4 　 计算机 与 PLC 的 通信 技术 
 　 　 在 计算机 与 PLC 集成 控制系统 中 ， 一个 关键 的 技术 问题 是 计算机 与 PLC 的 通信 。 若 在 整个 系统 设计 中 全部 采用 进口 器件 ， 软件 也 选用 相应 的 进口产品 ， 那么 ， 整个 工程造价 惊人 。 针对 这种 情况 ， 我们 自行 开发 了 计算机 与 PLC 的 串行 通信 技术 。 该 技术 设计 思想 先进 ， 软硬件 简单 实用 ， 可靠性 高 ， 性能 价格比 好 ， 兼容性 强 ， 可 适用 于 市场 上 多种 型号 的 计算机 与 PLC 。 
 　 　 从 硬件 上 讲 ， 现在 中国 市场 上 使用 的 PLC ， 在 通信接口 上 多 采用 RS422 接口 或 RS485 接口 ； 而 微型机 多 采用 RS232 接口 。 这样 在 计算机 与 PLC 通信 时 就 不可避免 地要 选用 RS422 - RS232 转换 模块 ， 同时 考虑 到 恶劣 工况 下 的 抗干扰 要求 ， 这个 转换 模块 必须 具有 良好 的 隔离 功能 和 放大 功能 ， 而 选用 高性能 进口 模块 ， 必定 提高 工程造价 。 
 　 　 针对 这种 情况 ， 为 降低 工程造价 ， 我们 在 硬件 上用 1 根 普通 的 通信 电缆 代替 进口 的 通信 模块 ， 在 电缆 的 接口处 采用 先进 的 电路设计 技术 和 单片机 技术 ， 以 完成 信号 的 隔离 和 放大 功能 。 实践证明 ， 通信 的 可靠性 完全 可以 和 国外 的 进口 模块 媲美 ， 而且 造价 极低 。 
 　 　 从 软件 上 讲 ， 计算机 和 PLC 的 通信 技术 属于 保密 技术 ， 长期 为 国外 公司 垄断 。 这 就 使得 我们 只要 选用 了 该 厂家 生产 的 PLC ， 就 必须 选用 它 开发 的 工控 软件 ， 提高 工程造价 。 针对 这种 情况 ， 我们 开发 了 自己 的 工控 软件 。 下面 以 三菱公司 生产 的 FX 系列 可 编程序 控制器 为例 ， 介绍 我们 的 软件设计 。 FX 系列 可 编程序 控制器 命令 格式 如表 1 所示 。 
 表 1 　 FX 系列 可 编程序 控制器 的 命令 格式 
 
 命令 命令 号 日标 设备 功 　 　 　 能 
 设备 读 命令 ‘ 0 ’ X / Y / M / S / T / C / D 读位 设备 或 字 设备 状态 
 设备 写 命令 ‘ 1 ’ X / Y / M / S / T / C / D 写位 设备 或 字 设备 
 强制 开 命令 ‘ 7 ’ X / Y / M / S / T / C 打开 位 设备 
 强制 关 命令 ‘ 8 ’ X / Y / M / S / T / C 关闭 位 设备 
 
 　 　 每 一个 字符 都 以 ASCII 码 形式 串行 传输 ， 传输 格式 如图 6 。   
 
 图 6     字符 传输 格式 
 　 　 例如 ， 字符 ‘ F ’ ( ASCII 码是 46H ) 的 传输 格式 如图 7 。 
 
 图 7     字符 “ F ” 的 传输 格式 
 　 　 一般 文本 数据 的 传输 格式 如图 8 。 
 
 图 8     文件 数据传输 格式 
 　 　 图 8 中 ， STX 为 文本 的 开始 ， 其 ASCII 码 定为 02H ； ETX 为 文本 的 结束 ， 其 ASCII 码 定为 03H ； CMD 为 命令 字符 ， 取 ‘ 0 ’ 、 ‘ 1 ’ 、 ‘ 7 ’ 、 ‘ 8 ’ 。 
 　 　 在 STX 之后 ， 被 传送数据 的 ASCII 之 和 ， 也 被 作为 2 个字符 码 发送 。 
 　 　 例如 ， 实现 从 地址 10F6 ( 10F6 为 寄存器 D123 的 地址 ) 处 读取 4 个 字节 数据 ， 执行 传输 格式 如图 9 。 
 　 　 求和 ： 
 　 　 30H + 31H + 30H + 46H + 36H + 30H + 34H + 03H 
 　 　 ＝ 74H 
 
 图 9     传输 格式 之例 
 　 　 通过 改变 命令 号 和 地址 号 ， 就 可以 实现 计算机 与 PLC 之间 的 读 、 写 、 强制 开关 等 基本功能 ， 用户 可以 使用 我们 研制 的 通信软件 ， 也 可以 在 该软件 基础 上 ， 根据 实际 情况 灵活 地用 C语言 开发 自己 的 通信 程序 ， 这正 体现 了 该软件 的 开放性 特点 。 
 5 　 结束语 
 　 　 计算机 集成 控制系统 采用 了 先进 的 系统集成 的 设计 思想 ， 投入 运行 后 ， 为 企业 带来 了 可观 的 经济效益 和 社会效益 。 该 系统 在 工业 现场 控制 方面 ， 尤其 在 PLC 控制 方面 ， 独树一帜 ， 以 其 卓越 的 控制 功能 和 良好 的 性能 价格比 ， 赢得 了 用户 的 广泛 赞誉 。 
 作者 单位 ： 机械部 洛阳 拖拉机 研究所 计算机 室 ( 471039 ) 
 参考文献 
 1 　 赵海 . 现场 总线 网络 控制系统 与 领域 自动化 . 微 计算机信息 ， 1996 ； 15 ( 1 ) 
 2 　 李瑜 详 . 微机 数据通信 技术 . 上海 ： 上海 科学技术 文献 出版社 ， 1992 
 ( 收稿 日期 ： 1998 - 07 - 10 ) 
