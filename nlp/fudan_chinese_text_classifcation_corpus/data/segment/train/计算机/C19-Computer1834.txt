微型机 与 应用 
 MICROCOMPUTER   &   ITS   APPLICATIONS 
 2000   Vol.19   No.2   P.27 - 29 
 
 
 
 
 Internet 地址 拥塞 问题 及其 解决 方法 
 赵洁 
 摘   要 ：   探讨 了 Internet 地址 拥塞 问题 出现 的 背景 ， 在 此基础 上 ， 着重 探讨 了 解决 该 问题 的 4 种 不同 的 技术 及 相关 的 问题 。 
 关键词 ：   IP地址   ROADS 透明 路由器   委托 ARP   子网 编址   IPv6 协议 
 　 　 Internet 是 基于 TCP ／ IP 的 最大 的 互连 网络 。 随着 连入 Internet 的 网络 与 主机 数量 的 高速 增长 ， Internet 地址 空间 将 面临 耗尽 的 问题  ROADS ， Running   Of   ADdress   Space  。 解决 这一 问题 的 最 直接 的 方法 是 扩大 IP 的 编址 空间 ， 但 这 需要 大量 的 工作 。 在 目前 的 情况 下 ， 透明 路由器 、 委托 ARP 和 子网 编址 这 3 种 技术 对 解决 Internet 地址 拥塞 问题 有 很大 的 作用 。 首先 介绍 Internet 地址  即 IP地址  的 几种 格式 。 
 　 　 如图 1 所示 ， A 、 B 、 C 三类 地址 可以 分配 给 1 个 网络 ， 其中 加 阴影 的 为 地址 的 网络 前缀 部分 。 网络 前缀 代表 了 一类 地址 可以 分配 的 网络 数目 。 由图 1 可以 看出 ： A 类 地址 共 可以 分配 给 128 （ 27 ） 个 网络 ， 每个 网络 最多 可 有 224 个 主机 ； B 类 地址 可 容纳 214 个 网络 ， 每个 网络 最多 可 有 216 个 主机 ； C 类 地址 共可有 221 个 网络 ， 每个 网络 最多 可 有 28 个 主机 。 32 位 的 IP地址 格式 在 当初 设计 时 确实 是 绰绰有余 的 ， 但是 随着 Internet 的 高速 增长 ， 这一 编址 方法 已经 不能 容纳 连入 Internet 的 全部 网络 数量 了  即 第 129 个 申请 A 类 地址 的 网络 不 可能 得到 满足 。 
 　 　 实践 表明 ， 在 几类 IP地址 中 ， B 类 地址 尤为 紧张 ， C 类 地址 的 可 分配 网络 号 虽然 多 ， 但 1 个 C 类 网络 不能 满足 主机 超过 256 的 情况 。 B 类 地址 的 主机 数量 相对 较 多 ， 可以 满足 大多数 公司 的 需要 。 另一方面 ， 世界 上 真正 需要 A 类 地址 的 大型 公司 并 不 很多 ， 绝大多数 的 公司 都 是 中等 规模 的 ， 因此 它们 需要 B 类 地址 。 
 　 　 为了 解决 或 至少 缓和 ROADS 问题 ， 必须 采取 一些 适当 的 方法 。 最好 的 方法 是 延长 IP地址 的 位数 ， 但 这 涉及 到 许多 方面 的 工作 ， 包括 大 范围 地 改变 IP 协议 的 内容 。 除了 彻底 地 改变 IP地址 的 编址 方法 外 ， 目前 还有 一些 其它 的 技术 。 
 1   透明 路由器 
 　 　 透明 路由器 的 思想 来源于 对 A 类 地址 的 考查 。 由于 分配 了 A 类 地址 的 网络 最多 可 有 224 个 主机 ， 这么 多 的 主机 地址 一般来说 对于 1 个 网络 是 分配 不尽 的 。 因此 ， 可用 A 类 网络 的 富裕 主机 地址 ， 将 一部分 不用 的 主机 地址 分配 给 另 1 个 网络 。 这个 网络 并 不 占用 Internet 的 1 个 网络 号 ， 而是 与 先前 的 网络 共用 1 个 网络 号 ， 因此 节省 了 Internet 网络地址 的 使用 ， 有助于 ROADS 问题 的 缓和 。 图 2 为 1 个 透明 路由器 的 例子 。 
 　 　 如图 2 所示 ， 透明 路由器 TR 将 网络 N2 连入 了 1 个 A 类 网络 N1  12 ． 0 ． 0 ． 0  。 TR 通过 1 个 标准 路由器 R 与 N1 相连 并 占用 N1 的 1 个 端口 。 当有 数据 报要 流向 N2 时 ， 首先 R 将 此 数据 报 路由 给 TR ， 再 由 TR 决定 将 此 数据 报 发给 N2 上 的 哪个 主机 。 在 此例 中 ， N2 共用 了 1 个 伪 网络 前缀 12 ． 13 ． 14 ． 0  IP 编址 标准规定 了 当 IP地址 的 第 1 个 字节 在 0 ～ 127 之间 时为 A 类 地址 ， 所以 12 ． 13 ． 14 ． 0 虽然 形式 上似 1 个 C 类 网络 前缀 ， 但 在 IP 标准 中 却 只 可能 是 1 个 A 类 地址 ， 不 可能 是 1 个 网络 前缀  ， 这 主要 依赖于 TR 的 作用 。 这个 伪 网络 前缀 并 不 占用 实际 的 IP 网络地址 ， 从而 可以 有效 地 缓和 ROADS 问题 。 
 　 　 透明 路由器 的 思想 包含 了 复用 和 去 复用 的 思想 ， 即将 来自 N2 的 数据 报复 用到 R 的 1 个 端口 上 ， 而 将 来自 N1 的 数据 报 进行 去 复用 ， 将 它们 发送给 N2 的 适当 主机 。 在 图 2 中 ， 对 N1 的 A 类 地址 进行 了 适当 的 划分 ， 使 N2 复用 到 IP地址 的 最后 1 个 字节 上  对应 于 R 的 1 个 端口  。 但 这种 划分 不是 唯一 的 ， 例如 ARPANET  10 ． 0 ． 0 ． 0  就 以 PSN  Packet   Switching   Node ， 分组 交换 节点  地址 的 第 3 个 字节 来 进行 复用 和 去 复用 。 但 不管 那种 形式 ， 原理 都 是 一样 的 。 
 　 　 透明 路由器 的 主要 优点 是 减少 了 对 IP 网络地址 的 使用 ， 故 可以 在 一定 程度 上 缓和 ROADS 问题 。 它 的 另 一个 优点 是 支持 负载 均衡 ， 也就是说 ， 如果 有 2 个 透明 路由器 连到 同 1 个 网络 上 ， 那么 到 该 网络 的 流量 可以 在 这 2 个 透明 路由器 之间 分配 ， 而 传统 的 路由器 由于 选路 算法 的 唯一性 ， 所以 总是 会 选择 同一 路由 。 
 　 　 透明 路由器 的 缺点 也 很 明显 ， 即 必须 有 足够 的 主机 地址 才能 使用 透明 路由器 。 因此 ， 一般来讲 它 只能 应用 于 A 类 网络 。 透明 路由器 的 另 一个 缺点 是 它 虽然 名为 路由器 ， 但 不能 提供 传统 路由器 的 所有 服务 ， 尤其 是 它 不能 完全 参与 ICMP 和 SNMP 等 协议 的 处理 ， 使 其 不能 返回 对 请求 的 回答 。 这 意味着 不能 简单 地用 Ping   1 个 透明 路由器 来 决定 其 是否 正在 运行 。 
 2   委托 ARP 
 　 　 委托 ARP （ Proxy   ARP ） 也 是 一种 可以 减少 IP 网络地址 使用 的 方法 。 之所以 称其为 委托 ARP ， 是因为 这种 方法 必须 基于 ARP 技术 ， 即 ： IP 网络地址 尤其 是 B 类 网络 前缀 虽然 有限 ， 但 1 个 网络 的 主机 地址 往往 是 富裕 的 。 因此 ， 可 将 某个 网络 富裕 的 部分 主机 地址 赋予 另 一个 物理 网络 。 然后 用 1 个 运行 委托 ARP 的 路由器 将 这 2 个 网络连接 起来 ， 使得 这 2 个 网络 共用 1 个 IP 网络 前缀 。 图 3 为 委托 ARP 的 一个 例子 。 
 　 　 图 3 中 ， N1 为 1 个 B 类 网络 ， N2 占用 了 N1 的 部分 主机 地址 并 通过 委托 ARP 路由器 PR 与 N1 相连 ， N1 与 N2 共用 1 个 网络 前缀 130 ． 111 ． 0 ． 0 。 当 主机 H1 要 跟 H4 通信 时 ， 它 首先 运行 ARP ， 由于 PR 运行 委托 ARP 软件 ， 因此 PR 捕获 了 H1 的 ARP 请求 ， 并 判断 出 H4 在 其它 物理 网络 上 ， 于是 PR 用 它 自己 的 物理地址 响应 H1 的 请求 。 H1 收到 PR 的 ARP 响应 后 ， 把 地址映射 保存 到 自己 的 ARP 表中  如果 以前 没有 跟 H4 通信 过  ， 并用 这个 映射 发送 目的地 为 H4 的 数据 报 ， 这些 数据 报 实际上 都 发给 了 PR 。 当 PR 收到 1 个 数据 报时 ， 它 知道 哪个 主机 在 哪个 物理 网络 上 ， 因此 能够 决定 数据 报 的 正确 路由 。 对于 N1 来讲 ， 仿佛 只 存在 着 1 个 物理 网络 ， PR 隐藏 了 另 一个 网络 N2 的 位置 等 细节 ， 使得 N1 中 的 主机 与 N2 中 的 主机 可以 像 直接 连接 一样 进行 通信 。 
 　 　 委托 ARP 技术 的 主要 优点 是 可以 使 多个 物理 网络 共用 1 个 IP 网络地址 ， 因而 可以 减少 对 IP 网络地址 的 使用 ， 缓和 ROADS 问题 。 此外 ， 委托 ARP 软件 可以 在 不 干扰 网上 其它 主机 或 路由器 的 选路表 的 情况 下 ， 加 到 网上 的 某个 路由器 上 ， 因此 它 完全 隐藏 了 物理 连接 的 细节 。 
 　 　 委托 ARP 技术 也 同样 存在 着 ARP 协议 中 所 隐含 的 不 安全 因素 。 而且 ， 由于 委托 ARP 允许 多个 IP地址 映射 到 同一个 网络地址 上 ， 因此 要 防止 这种 不 安全 因素 就 更为 困难 了 。 反之 ， 如果 首先 考虑 防止 电子 欺骗 ， 那么 委托 ARP 的 实现 也 同样 增加 了 难度 。 委托 ARP 的 另 一个 缺点 是 不 支持 复杂 的 网络 拓朴 ， 也 不 支持 合理 的 路由 选择 形式 。 在 传统 的 路由 选择 中 ， 具有 同一 网络 前缀 的 2 个 主机 可以 直接 进行 通信 ， 而 在 委托 ARP 中 却 可能 要 进行 路由 选择 。 实际上 ， 委托 ARP 技术 只是 一种 可能 的 技术 ， 因为 配置 路由表 等 工作 的 工作量 非常 大 ， 而且 很 难用 软件 来 实现  因为 富裕 的 主机 地址 可能 并 无规律  。 事实上 ， 大多数 的 委托 ARP 的 实现 依赖于 管理员 手工 操纵 路由器 和 地址 表 ， 使得 它 既 费时 又 容易 出错 。 
 
 图 1   IP地址 格式 
 
 图 2   1 个 透明 路由器 的 例子 
 
 图 3   1 个 委托 ARP 的 例子 
 
 图 4   1 个子 网 编址 的 例子 
 3   子网 编址 
 　 　 子网 编址 技术 是 迄今为止 用于 解决 IP 网络地址 拥塞 的 最 成熟 的 技术 。 事实上 ， 它 已 是 IP 编址 必须 的 一部分 。 子网 编址 采用 的 是 一种 分级 编址 、 分级 选路 的 方法 。 考虑 1 个 B 类 网络 130 ． 10 ． 0 ． 0 。 使用 子网 编址 时 ， 可 将 第 3 个 字节 用来 标识 不同 的 物理 网络 ， 如 130 ． 10 ． 1 ． 0 为 一 物理 网络 ， 130 ． 10 ． 2 ． 0 为 另 一 物理 网络 。 通过 这一 技术 ， 使得 多个 物理 网络 可以 共用 1 个 网络 前缀 130 ． 10 ． 0 ． 0 ， 并且 在 该 网络 内部 可 根据 目的 IP地址 的 第 3 个 字节 进行 选路 ， 如 目的 地址 为 130 ． 10 ． 1 ． 1 的 分组 将 被 选路 到 子网 130 ． 10 ． 1 ． 0 ， 而 目的 地址 为 130 ． 10 ． 2 ． 1 的 分组 将 被 投递 到 子网 130 ． 10 ． 2 ． 0 。 子网 编址 技术 的 思想 如图 4 所示 。 
 　 　 图 4 中 ， 路由器 R 接受 所有 到 130 ． 10 ． 0 ． 0 的 通信量 ， 并 根据 IP地址 的 第 3 个 字节 选择 投递 到 哪个 物理 子网 。 
 　 　 在 使用 子网 编址 时 ， 必须 为 每 1 个 网络 选择 1 个 子网掩码 。 子网掩码 的 定义 如下 ： 若 网络 把 IP地址 中 的 相应 比特 视作 网络地址 的话 ， 则 子网掩码 的 相应 比特 就 置 为 1 ； 若 把 这些 比特 视为 主机 地址 ， 则 将 其置 为 0 。 根据 此 定义 ， 子网 130 ． 10 ． 1 ． 0 和 130 ． 10 ． 2 ． 0 的 子网掩码 都 为 255 ． 255 ． 255 ． 0 。 
 　 　 子网 编址 使用 1 个 IP地址 来 代表 多个 物理 网络 ， 因而 可以 减少 网络地址 的 使用 。 然而 正 因为 子网 编址 技术 的 出现 ， 使得 大多数 的 组织 都 愿意 申请 1 个 B 类 地址 而 非 1 个 C 类 地址 。 因为 1 个 B 类 地址 有 足够 的 比特 来 进行 子网 化 ， 而 对 C 类 地址 则 没有 实际意义 。 因此 ， 子网 编址 技术 的 应用 实际上 只 减少 了 对 C 类 地址 的 使用 ， 对 B 类 地址 的 使用 则 仍然 增加 得 很快 。 所以 说 ， 子网 技术 也 不能 最终 避免 B 类 地址 耗尽 的 结果 。 
 　 　 基于 以上 的 考虑 ， 从 子网 编址 技术 里 又 派 生出 另 一种 技术 - - 超网 寻址 。 超网 寻址 与 子网 编址 的 思想 正好 相反 ， 它用 多个 C 类 地址 来 模拟 1 个 B 类 地址 ， 从而 减少 对 B 类 地址 的 使用 。 超网 寻址 似乎 两全其美 ， 但 由于 采用 超网 寻址 时 ， 一个 组织 不是 由 1 个 IP 网络 组成 而是 由 多个 IP 网络 组成 了 ， 具体表现 就是 在 连接 组织 与 外界 的 路由器 上 存在 着 多个 到 该 组织 内部 的 表项 。 因此 ， 采用 超网 寻址 时 ， 需要 新 的 能够 在 超网 地址 范围 内 寻址 的 选路 软件 。 
 4   IPv6 
 　 　 IPv6 是 下一代 IP 协议 的 简称 。 现在 使用 的 IP 版本 一般 称为 IPv4 。 IPv6 保持 了 IPv4 的 许多 特点 ， 同时 也 增加 了 许多 变化 。 其中 很 重要 的 一点 变化 就是 将 原先 的 32 位 地址 增加 到 了 128 位 。 这样 巨大 的 地址 空间 可以 承受 任何 合理 的 地址 分配 策略 。 足够 大 的 地址 空间 是 解决 ROADS 问题 的 根本 方法 。 虽然 这种 实现 有 许多 要 做 的 工作 ， 但 它 是 技术 发展 的 必然趋势 。 
 　 　 IPv6 的 编址 保留 了 IPv4 的 地址 体系 。 设计者 们 为了 保证 IPv4 向 IPv6 的 过渡 ， 将 IPv6 地址 的 一小部分 用来 对 IPv4 地址 进行 编码 ， 具体地说 就是 ， 任何 IPv6 地址 ， 若 开始 的 80 位全 为 0 ， 接着 是 16 位 的 全 1 或全 0 ， 则 它 的 低 32 位 就是 1 个 IPv4 地址 。 
 　 　 除了 巨大 的 地址 空间 外 ， IPv6 还有 许多 其它 的 特点 。 由于 本文 主要 论述 ROADS 问题 ， 因此 对于 IPv6 的 其它 特点 在 此 不再 详述 。 有 兴趣 的 读者 可 参考 Douglas ． Comer 的 “ Internetworking   with   TCP ／ IP （ Vol ． 1 ） ” 。 
 5   结束语 
 　 　 从 前面 的 讨论 可以 看到 ， 透明 路由器 、 委托 ARP 、 子网 编址 这 3 种 技术 能 在 一定 程度 上 缓和 ROADS 问题 ， 但 不能 彻底 地 解决 它 。 相 比较而言 ， 由于 透明 路由器 和 委托 ARP 技术 都 需要 对 传统 的 路由器 作 一些 改进 ， 因此 使用 并 不 很多 ； 而 子网 编址 技术 由于 其 灵活性 和 实用性 而 被 广泛 使用 并 成为 了 标准 。 但 随着 连入 Internet 的 组织 和 主机 的 不断 增加 ， 子网 技术 在 解决 ROADS 问题 上 也 将 变得 捉襟见肘 。 IPv6 给出 了 最 彻底 的 解决 方法 。 但 作为 一种 全新 的 协议 标准 ， 它 的 实现 需要 一个 较长 的 过程 ， 也 需要 众多 的 组织 和 公司 的 共同努力 。 还有 一点 必须 指出 ， 即使 实现 了 IPv6 ， 前 3 种 技术 也 并 不会 立刻 消亡 ， 它们 的 一些 思想 可能 会 被 继续 采用 。 例如 子网 技术 不仅 可缓和 ROADS 问题 ， 而且 对于 一个 组织 内部 的 部门 划分 、 流量 控制 等 都 有 很大 的 作用 。 
 赵洁 （ 合肥 安徽大学 经济 学院 教工 53 信箱  230039 ） 
 收稿 日期 ： 1999 － 09 － 13 
