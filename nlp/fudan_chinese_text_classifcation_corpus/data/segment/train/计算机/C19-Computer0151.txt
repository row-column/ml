微型 电脑 应用 
 MICROCOMPUTER   APPLICATIONS 
 2000 　 Vol.16 　 No.1 　 P.48 - 50 
 
 
 
 信用卡 在线 安全 支付 的 分析 与 构建 
 蔡小虎 　 钱 世德 
 摘 　 要 ： 阐述 了 信用卡 在线 支付 原理 及 应用 手段 ， 指出 了 其中 存在 的 漏洞 ， 提出 了 一种 基于 安全 支付 协议 的 解决方案 ， 并 对 该 方案 进行 了 分析 。 
 关键词 ： 信用卡 在线 支付 　 SSL 　 SET 　 线程 
 Abstract ： This   paper   introduces   the   principles   and   impleme   ntation   of   online   credit   card   payment ,   and   points   out   leaks   in   them .   It   also   pro   poses   a   solution   based   on   secure   payment   protocols   and   makes   an   analysis   of   it .   
 Keywords ： online   credit   card   payment 　 SSL 　 SET 　 thread ▲ 
 一 、 引言 
 　 　 目前 ， 电子商务 交易 手段 已 逐步 多样化 ， 使用 信用卡 在 网上 进行 结算 是 其中 最 主要 的 一种 方式 。 有 必要 指出 ， 这里 的 信用卡 是 一个 广义 的 概念 ， 它 包括 了 信用卡 、 智能卡 、 ATM 卡 等 。 
 　 　 在 信用卡 网上支付 中 ， 最为 重要 的 特性 是 安全性 和 并发 性 。 其中 安全性 指 的 是 信息 在 网上 传输 时 的 机密性 ， 可 鉴别 性及 一致性 。 出于 安全性 考虑 ， 当前 网上 信用卡 支付 主要 基于 SSL ( 安全套 接层 协议 ) 和 SET ( 安全 电子 交易 协议 ) 这 两种 安全 交易 协议 。 采用 SSL 的 连接 可以 看成 在 TCP / IP 连接 的 基础 上 建立 一个 安全 通道 ， 在 这 一 通道 中 ， 所有 点对点 的 信息 都 将 加密 ， 并 提供 了 信息 摘要 功能 ， 从而 确保 信息 在 Internet 上 传输 时 ， 不会 被 第三方 窃取 或 篡改 。 当 基于 SSL 进行 信用卡 支付 时 ， SSL 主要 用于 持卡人 和 商家 之间 的 通信 ， 而 商家 和 银行 之间 的 则 通过 专线 等 方式 相连 。 而 SET 是 由 MasterCard 和 Visa 这 两家 全球 最大 的 信用卡 公司 创建 的 ， 它 是 一种 特定 于 电子商务 体系 的 框架 性 协议 ， 定义 了 客户 ， 商家 ， 认证 中心 ， 支付 网关 ， 信用卡 结算 中心 ( 结算 银行 ) 等 参与方 ， 并 为 各 参与方 之间 的 信息流 走向 、 必须 采用 的 加密 及 身份 认证 都 制定 了 严密 的 标准 。 目前 ， SSL 的 最新 版本 更名 为 TLS ( Transport   Layer   Security ) ， 由 IETF 负责 开发 ， 并 推出 了 相应 RFC ( RFC2246 ) ， 而 SET 也 逐步 被 确立 为 网上交易 的 工业 标准 。 系统 的 并发 性是 另 一 必须 考虑 的 特性 。 电子商务系统 必须 随时 准备 同时 应付 大量 访问 ， 一次 拒绝 访问 就 可能 丧失 大笔 商机 。 并发 性 一般 通过 多线程 机制 加以 实现 。 
 二 、 信用卡 支付 现状及 漏洞 
 　 　 对于 信用卡 在线 支付 应用环境 ， 基于 SSL 或 基于 SET 这 两种 方式 都 存在 优势 与 欠缺 。 
 　 　 SSL 相对 较为 简便 稳定 ， 目前 已有 较 多 开发工具 。 Dell 和 Amazon 就是 基于 SSL 的 典型 成功 案例 。 然而 作为 一种 针对 两方 通信 的 协议 ， SSL 不 完全 适合 需 多方 参与 的 电子商务 环境 ； 与 SSL 相比 ， SET 针对性 更强 。 以 信用卡 帐号 保密 问题 为例 ， 基于 SSL 的 环境 中 ， 顾客 信息 完全 对 商家 公开 ， 无法 保证 顾客 的 信用卡 帐号 不 被 恶意 商家 所 窃取 。 
 　 　 SET 协议 建立 在 认证 机制 基础 上 ， 它 提供 了 一条 称为 OPI 的 指令 ， 将 顾客 的 订单 信息 和 信用卡 帐号 信息 分别 用 商家 的 公共 密钥 和 结算 中心 的 公共 密钥 加密 ， 然后 将 这 两段 信息 打包 在 一起 ， 发给 商家 ， 商家 将 其中 信用卡 帐号 信息提取 出来 ， 发给 支付 网关 ， 交由 结算 中心 处理 。 这样 ， 虽然 信息 都 要 经过 商家 转发 ， 但 由于 它 没有 支付 网关 的 私人 密钥 ， 只能 看到 顾客 的 订单 信息 ， 而 信用卡 帐号 信息 只有 支付 网关 才能 获得 。 通过 这种 方式 ， SET 确保 了 信用卡 帐号 的 保密 。 SET 的 另 一个 优点 在于 完整 的 认证 体系 ： SET 为 各 参与方 都 创建 了 等级 不同 的 数字 凭证 ， 其中 包括 特卡人 凭证 ， 商家 凭证 及 支付 网关 凭证 等 三类 。 其中 商家 凭证 反映 了 一种 商家 与 经济 机构 的 关系 ， 使得 后者 能以 一种 信用卡 结算 方式 与 商家 结算 。 这里 必须 指出 一点 ： SET 中 商家 对于 每张 信用卡 都 需要 两张 数字 凭证 。 这是 出于 安全 考虑 ： 数据传输 过程 中 ， 最终 用于 数据 加密 的 是 对称 密钥 ， 因此 在 加密 前 ， 商家 首先 需要 用 一对 公钥 加密 对称 密钥 ， 发给 其 通信 的 另一方 ( 持卡人 或 支付 网关 ) 。 因此 商家 必须 具有 两套 公共 密钥 对 ， 一对 用于 数字签名 ， 另 一对 则 用于 加密 对称 密钥 。 然而 ， SET 的 严密 必 带来 了 一系列 的 问题 ： 在 当前 使用 的 1.0 版本 中 ， 存在 身份验证 复杂 ， 加密 环节 多 ， 处理 效率 低 ， 商家 服务器 负荷 重等 问题 ， 而 旨在 轻量化 ( Light - Weighted ) 的 2.0 版本 却 一拖再拖 ， 迟迟 未能 推出 。 此外 ， 由于 SET 整个 结算 规范 都 建立 在 EMV ( Europe   Master - Visa ) 卡 基础 上 ， 对于 其他 信用卡 缺乏 兼容性 ， 这 也 给 它 的 推广 带来 了 许多 问题 。 因此 ， 至今 都 鲜有 完全 基于 SET 的 成功 案例 。 
 　 　 在 并行性 方面 ， 目前 许多 电子商务 网站 常常 因为 前台 处理 、 后台 数据库 及 两者 接口 等 因素 的 处理 能力 不足 ， 导致 经常性 拒绝 访问 ， 由此 带来 的 损失 是 难以 估量 的 。 
 三 、 应用 方案 构建 
 　 　 基于 安全 电子 交易 协议 的 信息系统 是 上海大学 与 建设银行 上海 分行 的 一个 合作 课题 。 它 提出 了 一种 SSL 和 SET 优势互补 的 解决方案 ， 在 以 SET 规范 整个 系统 环境 的 同时 ， 采用 SSL 进行 点对点 加密 ， 并 通过 使用 Servlet 等 技术 ， 在 保证 交易 安全性 的 基础 上 ， 最大 程度 减少 了 操作 环节 。 持卡人 与 商家 之间 的 通信 是 完全 基于 SSL 协议 的 。 本 系统 中 商家 和 部分 支付 网关 功能 在 商家 方 实现 ， 认证 中心 和 信用卡 结算 中心 的 功能 交给 银行 方 完成 。 
 　 　 考虑 到 跨平台 性 和 安全性 ， 本 系统 选用 Java 作为 主要 开发 语言 。 Java 程序 根据 应用 场合 可 分为 Application 、 Applet 和 Servlet 三种 。 Application 是 Java 应用程序 ， 可 用于 服务器端 和 客户端 ， 而 Applet 和 Servlet 分别 用于 客户端 和 服务器端 。 Applet 与 Application 的 优点 已 是 众所周知 的 ， 而 Servlet 同样 也 具有 强大 的 功能 ： 它 是 用于 互联网 服务器 上 的 Java 程序 ， 具有 一种 多线程 机制 ， 便于 系统 的 维护 和 扩展 ， 每个 线程 可以 方便 地 处理 各自 的 异常情况 。 为 支持 Servlet 运作 ， 采用 了 Windows   NT   这一 强占 式 多任务处理 操作系统 。 Servlet 的 另 一 优势 在于 它 一经 载入 ， 就 一直 保持 这种 载入 状态 ， 而无须 为 每个 客户 重新起动 一次 ， 因此 处理速度 相当 快 。 眼下 大多数 Web 服务器 都 支持 Servlet 的 使用 。 Servlet 它 为 用户 发来 的 每次 http 请求 分配 一个 线程 ， 一旦 处理 结束 就 会 自动 终止 。 在 Servler 基础 上 ， 可 构架 一种 瘦 客户机 肥 服务器 模式 ， 从而 提供 了 分布式 信息处理 环境 ， 可 满足 网上交易 系统 的 并发 性需求 。 此外 。 Java 还 提供 了 与 数据库 的 良好 连接 ， 通过 JDBC 可以 方便 地 实时 存取 数据库 ， 这些 对于 建立 一种 先进 通用 的 网上交易 系统 极为 关键 。 本 系统 中 使用 了 Servlet 和 Application 。 在 数据库 存取 方面 也 采用 了 JDBC 。 而 与 银行 内部网 连接 的 基于 RS232 的 串行 通信 程序 是 在 Java   Communication 包 的 基础 上 开发 的 ， 它 采用 了 多线程 及 同步 ， 充分 实现 了 系统 并发 性 。 
 　 　 对于 SSL 开发 ， 主要 采用 了 J / SSL 作为 开发 平台 。 随着 硬件 速度 的 提高 和 黑客技术 的 发展 ， 有 必要 采用 强 加密 。 J / SSL 是 一种 完全 在 美国 之外 开发 的 工具 ， 不 受 出口 限制 ， 由此 带来 的 直接 好处 是 可以 在 它 提供 的 平台 基础 上 使用 强 加密 。 它 还 能 支持 约 50 个 同时 连接 ( Pending   Connection ) 。 并 能够 支持 多种 私钥 及 数字证书 安全 存放 标准 ， 包括 PKCS # 1 、 PKCS # 7 、 PKCS # 8 及 PKCS # 12 。 
 　 　 从 数据库 的 角度 来看 ， 眼下 JDBC 或 ODBC 都 提供 了 相当 强大 的 数据库 支持 能力 ， 在 本 方案 提供 的 交易 环境 中 ， 究竟 使用 哪 种 数据库 并 无 限制 。 
 　 　 对于 信用卡 在线 支付 ， 其中 最需 安全 传输 的 信息 是 持卡人 的 信用卡 信息 ， 即 卡号 和 密码 。 为 防止 商家 获取 该 信息 ， 本 系统 从 软件 上 实现 了 该 信息 的 自动 转发 ， 从而 避免 了 商家 恶意 盗用 的 可能 。 在 商家 与 很行 内部网 间 的 通信 采用 了 硬件 加密器 进行 基于 DES 加密 ， 从而 最大 程度 上 确保 了 客户 信息 的 安全性 。 
 　 　 我国 信用卡 在 支付 方面 与 国外 用卡 有所区别 。 我国 大多数 信用卡 ， 如 建设银行 的 龙卡 、 中国银行 的 长城卡 等 ， 在 发放 新卡时 ， 卡上 已有 卡号 及 原始 密码 。 卡号 是 直接 印 置于 信用卡 表面 的 ， 而 密码 则 是 存放 在 卡 的 磁条 上 的 。 这些 原始 信息 同时 也 存放 在 银行 的 后台 数据库 中 。 持卡人 改变 密码 时 ， 新密码 相应 与 原始 密码 的 偏移量 将 被 记录 在 磁条 上 ， 新密码 或 偏移量 都 不 在 银行 后台 数据库 中 存放 。 当 持卡人 刷卡 时 ， POS 机将 从 卡中 读取 密码 及 偏移量 ， 并 计算 出 原始 密码 。 通过 卡号 及 原始 密码 ， 可 在 后台 数据库 中 核对 并 处理 相应 持卡人 的 帐号 信息 。 由于 后台 数据库 不 存放 持卡人 新密码 ， 而 新密码 与 原始 密码 之间 的 转换 完全 在 硬件 上 实现 ， 而 转换 过程 是 完全 对外 保密 的 ， 由此 导致 无法 直接 对 持卡人 的 信息 进行 验证 。 
 　 　 本 系统 中 ， 持卡人 在 首次 网上 购物 前 ， 在 表格 ( Form ) 添入 信用卡 卡号 及其 它 个人信息 ， 如 身份证号 等 ， 通过 Servlet 发给 商家 服务器 。 而 商家 端 将 该 信息 转发给 结算 银行 ， 由 后者 与 后台 数据库 加以 比较 ， 对 合法 的 信用卡 用户 产生 一个 唯一 的 身份验证 密码 ， 并 放入 后台 数据库 中 。 结算 银行 将 密码 发给 商家 ， 由 商家 自动 发还 持卡人 ， 在 这 一 过程 中 ， 商家 仅仅 作为 转发 站 ， 所有 信息 都 不 对 它 公开 。 以后 ， 持卡人 就 能 凭借 卡号 及 身份验证 密码 进行 网上交易 了 。 
 　 　 此后 的 支付 的 流程 可用 下图 表示 ： 
 
 图 1 　 支付 流程 
 　 　 其中 ， 顾客 ( 持卡人 ) 与 商家 间 的 信息 交互 采用 了 SSL 加密 ， 而 商家 与 结算 银行 间 则 采用 了 DES 加密 。 由此 确保 了 系统 的 信息 保密性 ； 通过 SSL 对 商家 身份 进行 了 鉴别 ， 其中 采用 了 基于 X.509 数字证书 的 扩展 。 而 顾客 的 身份 鉴别 则 由 结算 银行 完成 ， 从而 满足 了 身份 可 鉴别 要求 ； 顾客 需 提供 其 个人信息 ， 由此 保证 了 信息 的 不可否认 性 ； SSL 提供 了 信息 摘要 功能 ， 防止 了 信息 被 篡改 的 情况 。 这样 ， 从 最大 限度 上 解决 了 系统 安全性 问题 。 系统 中 还 采用 了 多线程 机制 ， 可 同时 处理 多个 顾客 的 请求 ， 并 实现 了 信息 的 同步 处理 ， 保证 了 系统 的 并发 性 。 
 　 　 本 系统 于 今年 6 月 在 上海大学 Internet 招生 项目 中 进行 了 试用 。 由于 Internet 招生 登录 符合 电子商务 服务性 、 协调性 、 集成性 ， 并发 性及 安全性 等 基本 特性 ， 而 在 网上 缴费 登录 在 很大 程度 上 具有 商务 性 特色 ， 因此 都 具有 相当 现实意义 。 在 Internet 上 开放 的 短短 五天 中 ， 该 站点 共有 七千 人 次访问 ， 其中 千余 人 通过 身份验证 及 各类 登录 验证 ， 成功 地 通过 网上 进行 登录 。 
 四 、 结束语 
 　 　 信用卡 交易 主要 基于 SSL 和 SET 两种 协议 。 在 当前情况 下 ， 它们 各有 优势 和 缺陷 。 在 这 两者 相结合 并 相互 取长补短 的 基础 上 ， 本文 提出 了 一种 构建 方案 。 通过 在 上海大学 Internet 招生 项目 中 的 应用 ， 证明 这种 构架 在 肥 服务器 瘦 客户机 模式 基础 上 的 方案 能够 确保 网上交易 的 安全性 和 并发 性 。 随着 我国 认证 体系 的 完善 及 椭圆 加密算法 的 采用 ， 该 方案 将 具有 重大 现实意义 。 ■ 
 作者 单位 ： 蔡小虎 ( 上海大学 计算机科学 学院 272 #   上海大学 网络 中心   200072 ) 
 参考文献 ： 
 ［ 1 ］ Rob   Macgregor , Catherine   Ezvan . Secure   Electronic   Transactions : Credit   Card   Payment   on   the   Web   in   Theory   and   Practice . International   Technical   Support   Organization   Raleigh   Center.1997 
 ［ 2 ］ Marco   Pistoia , Kenji   Kojima , Narayan   Raghu . Internet   Security   in   the   Network   Computing   Framework   International   Technical   Support   Organization , 1998 
 ［ 3 ］ Paul   Philion . Build   Servlet - based   enterprise   Web   Applications . Java   World , December   1998 
 ［ 4 ］ Marvin   S . Credits   and   Debits   on   the   Internet . IEEE   Spectrum , 1997 , 34 ( 2 ) : 23 - 29 
 ［ 5 ］ 蔡小虎 　 钱 世德 　 关于 电子商务 两大 基本 协议 — — SSL 和 SET 的 对比 与 分析 　 第十四次 全国 计算机 安全 学术 交流会 
 ［ 6 ］ 劳 诚信 　 “ 上海 ， 迈向 卡 的 时代 ” 《 微型 电脑 应用 》 1999 年 第 10 期 P1 
 收稿 日期 ： 1999 - 10 - 29 
