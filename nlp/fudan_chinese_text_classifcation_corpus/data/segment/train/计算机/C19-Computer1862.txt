微型机 与 应用 
 MICROCOMPUTER   &   ITS   APPLICATIONS 
 2000   Vol.19   No.3   P.25 - 26 
 
 
 
 现场 总线 速度 和 现场 总线 效率 
 何平 　 李德 识 　 黄天 戍 　 任清珍 　 黎江 
 　 　 摘 　 要 ： 详细描述 了 现场 总线 速度 和 效率 及其 影响 因素 , 对 现场 总线 的 实际 速度 和 实际 效率 进行 了 定义 , 并 通过 应用 实例 对 串行 异步 通信 的 总线 问题 进行 了 具体 的 讨论 。 
 　 　 关键词 ： 现场 总线 速度   现场 总线 效率   DTE   DCE 
 　 　 无论 那 一种 现场 总线 产品 或 技术 , 不管 它 的 名气 有 多 大 、 牌子 有多响 , 如果 只谈 其 产品 的 速度 , 而 不谈 其 支持 总线 系统 的 效率 , 就 不能 算是 一种 好 的 产品 或者说 不是 一项 好 的 技术 。 
 1   现场 总线 的 速度 
 　 　 在 现场 总线 条件 下 （ 特别 是 在 恶劣 环境 时 ） , 大多数 现场 总线 介质 采用 双绞线 或 同轴电缆 , 而 这 2 种 传输媒体 的 频带宽度 、 分布 参数 和 传输速度 息息相关 , 无论 DTE （ Data   Terminal   Equipment ） 通信 速度 有 多 高 , 但 绝不 等于 DCE （ Data   CircuitTerminal   Equipment ） 就 一定 有 那样 高 。 通俗 地 讲 , DTE 速度 指 的 是 PC 到 MODEM 之间 的 速度 , DCE 速度 为 MODEM 到 MODEM 之间 的 传输速度 （ 在 无 MODEM 情况 下 , DTE 速度 是 PC 到 通信 口 之间 的 速度 , DCE 速度 为 通信 口到 通信 口 之间 的 传输速度 ） 。 由于 现场 总线 使用 媒体 的 限制 , DTE 速度 很 高时 , DCE 速度 有 可能 很 低 。 因此 , 现场 总线 的 速度 决不 是 某种 芯片 或 某种 通信 卡 或 设备 所 具有 的 速度 , 应为 其 形成 现场 总线 后 的 DCE 速度 。 
 　 　 例如 , 笔者 在 进行 AUTO - 300 分布式 大坝 自动化 安全 监测 系统 现场 总线 设计 时 就 遇到 此类 问题 。 按 设计 数据量 选择 通信 总线 产品 时 , 其 技术指标 ( 如 速度 指标 ) 达到 要求 的 产品 , 并不一定 能 做 系统 应用 。 这个 问题 在 下面 的 讨论 中将 会 明显 看到 。 
 　 　 当然 , 高 的 DTE 速度 是 较 高 的 现场 总线 速度 的 基础 。 而 高 的 现场 总线 速度 会 带来 较 高 的 现场 总线 效率 , 这 一点 毋庸置疑 。 
 　 　 通常 我们 定义 总线 速度 为 单位 时间 内 总线 所 传送 信息 或 数据 的 总量 。 
 2   现场 总线 的 效率 
 　 　 现场 总线 的 速度 和 效率 是 二个 不同 的 概念 。 
 　 　 定义 1 : 现场 总线 效率 等于 单位 时间 内 总线 所 传 有效 信息 或 数据 总量 占 单位 时间 内 总线 上 信息 或 数据 总 传输 量 的 比率 。 
 　 　 设 E 为 现场 总线 效率 , T 为 总 传送 时间 , Q1 为 T 内 传送 的 有效 信息 或 数据量 , Q 为 T 内 传送 的 信息 或 数据 总量 。 则 : 
 E = （ Q1 / T ） * （ Q / T ） = Q1 / Q 　 　 　 　 （ 1 ） 
 　 　 对于 定义 1 , 很 容易 理解 。 例如 , 在 串行 异步 通信 模式 下 , 异步 接收 是 靠 检测 传送数据 的 起始 位 和 终止 位来 确定 数据位 的 。 一般 情况 下 , 数据位 为 1 个 字节 8b , 起始 位 占 1b , 终止 位 占 2b , 校验位 1b 。 所以 串行 异步 通信 模式 传送 1 个 字节 的 有效 数据 , 有 4b 的 额外 信息 在内 。 可以 说 串行 异步 通信 的 传输 效率 很 低 。 由 串行 异步 通信 模式 形成 的 现场 总线 的 效率 也 将 很 低 , 通常 应用 于 速度 要求 不高 的 场合 。 
 　 　 再 如 , 使用 HDLC / SDLC 规程 模式 的 串行 同步 通信 , 由于 其帧 格式 中 信息 段 可以 是 任意 长度 （ 一般 定为 255B , 即 2040b ） , 虽然 它 的 信息 帧 中 也 有 起始 结束 标志 位 （ 8b + 8b ） 、 地址 段 （ 8b ） 、 控制 段 （ 8b ） 、 校验 段 （ 16b ） , 但 和 串行 异步 模式 相 比较 , 它 的 传送 效率 较 高 。 因此 , 由 串行 同步 通信 模式 形成 的 现场 总线 的 传输 效率 也 较 高 。 
 　 　 由 上述情况 可以 看出 , 现场 总线 的 效率 不仅 和 DCE 速度 有关 , 而且 还 受 其 使用 的 通信 规约 限制 。 
 3   现场 总线 的 实际 速度 和 实际 效率 
 　 　 一般 认为 , 现场 总线 的 速度 是 单位 时间 内 总线 数据 或 信息 的 传输 能力 , 我们 认为 这个 定义 不够 确切 。 这 也 是 许多 现场 总线 产品 （ 包括 某些 其它 产品 ） 最能 迷惑 用户 的 地方 。 严格 地 讲 , 这个 讲法 只能 称为 现场 总线 的 最高 速度 , 而 真正 现场 总线 的 速度 应 按 以下 定义 : 
 　 　 定义 2 : 对于 1 个 固定 的 现场 总线 系统 或 网络 , 它 的 现场 总线 速度 应为 系统 现场 总线 上 所有 终端 （ DTE ） 按 一定 信息 或 数据量 （ 设 定量 ） 通信 1 个 循环 后 , 其 平均 单位 时间 内 数据 的 传输 量 。 
 　 　 设 现场 总线 速度 为 V , 总线 负载 数 （ 终端 数 ） 为 N , N 个 终端 按 一定 信息 或 数据量 传输 1 个 循环 的 时间 为 T , T 内 数据传输 总量 为 Q , 则 : 
 V = Q / T 　 　 　 　 　 （ 2 ） 
 　 　 对于 定义 2 , 也 很 容易 理解 。 按 HDLC / SDLC 规程 进行 串行 同步 通信 、 当 信息 帧 有 多个 时 , 相邻 信息 帧 之间 需要 控制 帧 和 总线 复位 时间 （ 无 数据 信息 ） 衔接 , 因此 它 的 数据 传输速度 取 平均值 , 而 不 按 单帧 传输 能力 来 计算 是 切合实际 的 。 当 总线 负载 较多时 , 系统 又 有 应答 周期 和 发送 、 接收 准备 时间 , 故 定义 2 才能 真正 表达 现场 总线 的 实际 速度 。 
 　 　 很 显然 , 定义 1 定义 的 现场 总线 效率 也 只能 代表 现场 总线 的 最高 效率 （ 或 吞吐能力 ） , 而且 还有 它 的 不合理性 , 即 它 与 时间 无关 。 也就是说 , 无论 现场 总线 上 的 传送速度 有多慢 , 总线 效率 E 依然 有 可能 很 高 , 这 就 违背 了 效率 二字 的 本意 。 将 定义 1 根据 我们 的 实际 应用 情况 并 参考 国外 有关 文献 进行 修改 后 , 得出 了 比较 准确 的 描述 。 
 现场 总线 的 实际 效率 定义 : 
 　 　 定义 3 : 对于 1 个 固定 的 现场 总线 系统 或 网络 , 它 的 总线 效率 应为 系统 现场 总线 上 所有 终端 按 一定 信息 或 数据量 （ 设 定量 ） 和 给定 通信 速度 （ 波特率 ） 通信 1 个 循环 后 , 其 传输 有效 信息 或 数据 总量 和 实际 信息 或 数据传输 总量 之 比 乘以 （ 系统 完整 通信 周期 内 按 给定 通信 速度 ） 传输 总 有效 信息 或 数据 所 需 的 理论 计算 时间 和 实际 耗用 时间 之 比 。 
 　 　 这个 定义 可 解释 为 : 总线 的 信息 或 数据 效率 与 时间 效率 之积 。 
 　 　 设 总线 效率 为 E , B 为 通信 波特率 , Q1 为 1 个 传输 循环 内 有效 信息 或 数据 的 传输 量 , T1 为 按 B 传输 Q1 所 需 的 理论 时间 , Q 为 1 个 通信 循环 周期 内 传输 信息 或 数据 总量 , T 为 1 个 传输 循环 周期时间 , 则 
 E = （ Q1 / Q ） * （ T1 / T ） * 100% 　 　 　 　 （ 3 ） 
 E = （ Q1 / T ） * 1 / （ Q / T1 ） * 100% 　 　 　 （ 4 ） 
 　 　 理论 上 T1 = Q1 / B 　 　 　 　 　 　 　 　 （ 5 ） 
 　 　 由式 （ 3 ） 可以 看出 : 
 　 　 当 Q1 = Q 时 , E = T1 / T ＊ 100% 　 　 　 　 （ 6 ） 
 　 　 若 使 Q1 = Q 或 Q1 接近 Q , 必须 有 高效率 的 通信 规约 （ 合理 的 通信协议 ） 。 
 　 　 显然 , Q1 = Q 、 T1 = T 时 , E = 1 。 
 　 　 这 是 最 理想 的 状态 。 实际上 , Q1 < Q 、 T1 < T , 因此 , E < 1 。 
 　 　 设 Q1 ≈ Q , T1 ≈ Q / B 
 　 　 则 : E ≈ （ Q1 / T ） * B * 100% 　 　 （ 7 ） 
 　 　 式 （ 7 ） 说明 现场 总线 效率 和 总线 通信 速度 B 成正比 。 Q1 / T 解释 为 使用 通信 规约 的 合理性 , 当 使用 的 通信 规约 使得 Q1 = Q 时 , 总线 效率 E 约 为 100% , 这 显然 是 目前 很难 达到 的 。 
 　 　 由式 （ 7 ） 可以 得出 提高 现场 总线 效率 的 方法 : 
 　 　 1 . 提高 总 通信 速度 ; 
 　 　 2 . 增加 通信 规约 的 合理性 。 
 　 　 根据 上面 3 个 定义 , 再 来 衡量 任何 现场 总线 产品 是否 适合 使用 时 , 显然 不能 用 它 的 最大 指标 （ 最高 速度 和 最高 效率 ） 为 依据 , 要用 其 实际 总线 效率 和 总线 速度 来 评判 。 一种 好 的 现场 总线 产品 或 技术 应有 高 的 现场 总线 效率 , 否则 不能 称好 。 
 　 　 由 以上 讨论 可以 得出 以下 结论 : 具有 较 高速度 指标 的 现场 总线 产品 , 如 不 支持 合理 的 通信协议 , 就 不能 使 其 拥有 较 高 的 总线 效率 。 
 4   应用 举例 
 　 　 现在 用 定义 3 计算 RS - 485 总线 下 , 使用 DOS 功能 进行 串行 异步 通信 的 总线 效率 问题 。 
 　 　 假定 RS - 485 总线 （ 1km 双绞线 ） 上 有 6 个 终端 （ 486sx 兼容机 、 自制 INS8250 支持 的 485 通信 卡 、 以 C语言 自编 通信 程序 ） , 以 9600b / s 的 速率 进行 主从 通信 。 设定 传输数据 量 为 9600b / s （ 5 * 1920b ） , 通信 格式 按 每 1 个 字节 数据 有 1b 的 起始 位 、 2b 的 终止 位 、 1b 校验位 。 
 　 　 通信 应答 格式 （ 握手 信号 ） 为 : XXXXaaaa # 和 SSSSaaaa # , 即 : 2 * 72b 。 其中 , XXXX 、 SSSS 为 系统 代码 , aaaa 为 终端 号 。 
 　 　 则 T1 = 9600 / 9600 = 1s   Q1 = 9600b 
 　 　 Q = 9600 * （ 1 + 1 / 3 ） + 5 * 144 = 13520b 
 　 　 实际 通信 1 个 上位 机对 5 个 下位 机 通信 1 个 循环 所用 时间 为 2.95 s 。 
 　 　 则 实际 速度 V = Q / T = 13520 / 2.95 = 4583b / s 
 　 　 实际 效率 E = （ 9600 / 13520 ） * （ 1 / 2.95 ） * 100% = 24% 
 　 　 由此 可以 看出 , 这个 系统 的 有效 数据 传输速度 （ 实际 速度 ） 仅为 4583b / s , 不到 设定 通信 波特率 9600b / s 的 1 / 2 , 其 总线 效率 非常低 。 如用 它 做 现场 总线 系统 设计 时 , 至少 要 有 4 倍 以上 的 传输速度 冗余 才能 达到 9600b / s 有效 数据 的 传送 量 。 
 　 　 本文 较 具体 地 介绍 了 现场 总线 速度 和 现场 总线 效率 , 可 供 用户 参考 。 用户 可 在 按 要求 规划 自己 的 系统 时 , 以免 造成 不必要 的 经济 和 时间 的 浪费 。 
 何平 （ 武汉 水利电力 大学 计算机系 检测 教研室  430072 ） 
 李德 识 （ 武汉 水利电力 大学 计算机系 检测 教研室  430072 ） 
 黄天 戍 （ 武汉 水利电力 大学 计算机系 检测 教研室  430072 ） 
 任清珍 （ 武汉 水利电力 大学 计算机系 检测 教研室  430072 ） 
 黎江 （ 武汉 水利电力 大学 计算机系 检测 教研室  430072 ） 
 参考文献 
 1 ， 孙大高 . 计算机 通信 与 网络 . 武汉 : 武汉大学 出版社 , 1992 
 2 ， 谢 希仁 . 计算机网络 . 北京 : 电子 工业 出版社 , 1999 
 3 ， 马宏杰 . 微机 通讯 原理 与 实用技术 . 北京 : 清华大学出版社 , 1994 
 4 ， Hammand , l . j . Performance   Analysis   of   Local   Computer   Networks . Addison   Wesley , 1986 
 5 ， Hamedy   s . , Total   SNMP  Exploring   the   Simple   Network   management   protocol . Prentice   Hall , 1998 
 收稿 日期 ： 1999 - 10 - 10 
