计算机 应用 研究 
 APPLICATION   RESERCH   OF   COMPUTERS 
 2000     Vol.17 　 No.1 　 P.33 - 34 ， 52 
 
 
 
 
 TAPI3.0 的 体系结构 与 应用 
 黄 求根 　 吴宛萍 　 卢 强华 
 摘   要   在 阐述 TAPI 接口 背景 的 基础 上 ， 从 应用 的 角度 全面 地 分析 了 TAPI 与 WOSA 体系 的 关系 ， TAPI3.0 的 层次模型 ， TAPI3.0 的 对象 以及 与 TAPI3.0 有关 的 ActiveX 控件 。 
 关键词   TAPI   IP电话   WOSA   ActiveX 控件 
 1 　 引言 
 　 　 100 多年 前 ， 贝尔 发明 了 电话 。 在 即将 过去 的 一个 世纪 里 ， 电话 为 人类 的 文明 和 进步 作出 了 巨大 的 贡献 。 在 本世纪 的 下半叶 ， 电子计算机 在 军事 、 商业 等 因素 的 推动 下 ， 以 一种 超常 的 速度 向前 发展 。 由 单机 到 网络 ， 由 局域网 到 广域网 、 因特网 。 范围 越来越 大 ， 距离 越来越 远 的 网络 互连 ， 使 人们 很 自然 地 想到 ， 应该 利用 早已 遍及 世界 的 电话网 。 电话 和 计算机 ， 终于 殊途同归 ， 它们 的 结合 导致 了 IP电话 的 诞生 。 
 　 　 IP电话 是 将 语音 、 电视 和 数据 合为一体 ， 在 基于 IP 协议 ( Internet   Protocol ) 的 局域网 、 广域网 和 因特网 上 工作 的 新 技术 。 IP电话 应用 IETF 和 ITU 标准 使 多媒体信息 流能 在 任何 使用 IP 协议 的 网络 上 传输 ， 并 向 用户 提供 物理 媒体 和 物理 位置 连接 的 机动性 。 IP电话 通过 目前 已经 遍及 全世界 的 网络 ， 连接 到 世界各地 的 个人 、 公司 、 学校 以及 政府 机构 等 。 IP电话 的 使用 ， 不仅 使得 个人 和 团体 能够 降低 他们 利用 现有 的 语音 和 广播电视 服务 的 成本 ， 而且 能够 扩展 其 用途 ， 例如 电视会议 、 应用 共享 、 远程 交换 、 远程 办公 、 远程教育 、 人员培训 、 电视 邮件 、 实时 文件 协作 以及 电视 购物 等 。 
 　 　 当 一项 新 技术 即将 出现 时 ， 用户 看到 的 是 更 便捷 、 舒适 的 使用 ； 开发商 看到 的 则 是 潜在 的 巨大 商业机会 。 在 高科技 时代 ， 谁 掌握 了 某项 技术 的 标准 或 规范 ， 谁 就 掌握 了 这项 技术 的 今天 和 明天 。 英特尔 和 微软 合作开发 了 在 视窗 平台 下 应用 IP电话 的 微软 视窗 电话 应用 程序设计 接口 TAPI ( Telephony   Application   Programme   Interface ) 的 规范 。 随着 Windows 平台 从 16 位 发展 为 32 位 ， TAPI 也 逐步 升级 到 TAPI3.0 。 TAPI 帮助 用户 实现 电话网 与 计算机网 的 结合 ， 为 应用程序 提供 了 一套 支持 电话 通讯 的 方法 ， 它 是 视窗 电话 技术 的 核心 。 
 2 　 TAPI 与 WOSA 
 　 　 视窗 开放 服务 结构 WOSA ( Windows   Open   Services   Architecture ) 旨在 为 程序员 提供 一个 开发 环境 ， 使 他们 能 避开 各种 硬件 设备 和 软件 环境 的 复杂 的 内在 细节 ， 以 专注 于 自己 的 应用 。 
 　 　 全面 地 讲 ， TAPI 实际上 是 由 TAPI 和 TSPI   ( Telephony   Service   Provider   Interface ) 电话 服务提供者 接口 两个 部分 所 组成 的 。 TAPI 是 一个 为 程序员 提供 的 工具包 ， 使 他们 能够 为 微软 视窗 环境 下 的 用户 开发 提供 个人 电话 的 应用程序 。 TSPI 也 是 一个 为 程序员 提供 的 工具包 ， 使 他们 能够 进行 后 端 服务 的 开发 ， 以 操纵 来自 符合 TAPI 规范 的 应用 的 请求 ， 也就是说 ， 它 提供 了 一种 连接 到 某 一 特定 通信 设备 的 方法 。 正 因为 如此 ， 所以 ， TSPI 也 常常 是 由 那些 通信 设备 制造商 提供 的 。 
 　 　 视窗 电话 是 WOSA 的 组成部分 之一 。 微软 提供 一个 称为 TAPI . DLL 的 动态链接库 ， TAPI . DLL 处在 TAPI 和 TSPI 之间 ， TAPI 被 来自 用户 的 应用程序 所 调用 ， 而 TSPI 则 被 服务 单元 所 执行 。 TAPI . DLL 管理 那些 来自 用户 的 应用程序 对 TAPI 功能 的 调用 ， 并 将 其 发送到 适当 的 服务 单元 以 执行 这些 功能 。 由于 TAPI . DLL 具有 将 对 某 一 特定 通信 设备 的 形式 调用 转换 为 对 某 一 特定 通信 设备 的 实际 调用 的 功能 ， 所以 ， TAPI . DLL 也 被 称为 形实 替换 层 。 在 WOSA 体系 下 TAPI ， TAPI . DLL 以及 TSPI 之间 的 关系 如图 1 所示 。 
 
 图 1 　 TAPI 与 WOSA 
 3 　 TAPI3.0 的 层次模型 
 　 　 TAPI3.0 是 基于 COM ( Component   Object   Model ) 的 APIs ， 它 支持 传统 的 公共 交换 电话网 PSTN ( Public   Switch   Telephone   Network ) 与 IP电话 的 结合 。 
 　 　 TAPI3.0 在 视窗 平台 上 通过 提供 简单 的 方法 实现 机器 之间 的 连接 ， 从而 实现 IP电话 。 在 TAPI3.0 中 ， 服务提供者 接口 扩充 了 连接 到 IP电话 的 功能 。 也就是说 ， TAPI3.0 从 连接 层上 抽象 出来 ， 因此 开发 应用 时 无需 考虑 是否 连接 到 了 PSTN 、 ISDN 、 程控 交换机 还是 IP 网络 上 。 TAPI3.0 支持 基于 H.323 会议 系统 和 多点 传送 会议 系统 的 标准 ， 利用 Windows   NT5.0 的 ActiveX 目录 服务 以 简化 一个 机构 内部 的 配置 。 QoS ( Quality - of - service ) 支持 对 电视电话会议 性能 以及 网络 易管理性 的 改善 。 通过 DirectShow ( MS   DirectX 媒体 服务 之一 ) 过滤器 提供 对 媒体 流 的 访问 。 
 　 　 TAPI3.0 有关 PSTN 和 IP 的 功能 由 三个 主要 部分 提供 ： 电话 与 媒体 的 控制 、 媒体 流控制 和 目录 控制 。 图 2 显示 上述 控制 如何 与 PSTN 网 和 IP 网 之间 相互作用 。 
 
 图 2 　 TAPI3.0 的 层次结构 
 　 　 媒体 流控制 使用 实时 传输 协议 DirectShow 过滤器 ， 该 协议 要求 Windows   NT5.0 或 以上 版本 。 由于 DirectShow 过滤器 是 Windows   NT5.0 的 一部分 ， 因此 ， 不 需要 额外 地 安装 。 
 　 　 用于 IP 会议 的 目录 控制 ， 要求 至少 有 一个 ILS ( Internet   Locator   Service ) 或 NTDS ( NT   Directory   Service ) 服务器 处在 适当 的 位置 。 如果 没有 NTDS 服务器 ， 那么 终端用户 必须 知道 ILS 服务器 的 名字 ， 否则 ， 就 用 NTDS 服务器 自动 定位 ILS 服务器 。 
 　 　 电话 与 媒体 的 控制 是 一系列 简单 的 对象 、 接口 和 方法 ， 用于 实现 机器 之间 的 电话 连接 。 在 TAPI3.0 的 文本 中 ， 电话 是 一个 不仅 与 PSTN 电话 网上 的 语音 传送 有关 ， 而且 还 与 传送 内容 的 媒介 能力 有关 的 术语 。 
 　 　 TAPI3.0 对 电话 与 媒体 的 功能 进行 了 抽象 和 提炼 ， 以 使 那些 不同 的 ， 甚至 表面 上 矛盾 的 通信协议 能够 共存 于 一个 公共 的 应用 接口 之中 。 因为 TAPI3.0 是 基于 COM 的 ， 所以 TAPI3.0 的 应用程序 可以 采用 任何 一种 语言 来 写 。 但是 ， 某些 方法 对于 用 VB 等 写 的 自动 客户 应用程序 则 是 例外 。 
 　 　 通过 DirectShow ， TAPI3.0 实现 对 媒体 的 访问 。 DirectShow 是 一个 称之为 过滤器 的 可 插入 组件 的 标准 系统 ， 其 排列 结构 称之为 过滤器 图 。 过滤器 图 管理器 监视 过滤器 的 连接 ， 并 控制 媒体 流 的 数据 流程 。 
 4 　 TAPI3.0 的 对象 
 　 　 TAPI3.0 包含 有 4 个 主要 的 代码 单元 ： TAPI3.0   COM 对象 、 TAPI 服务器 、 电话 服务 提供 单元 ( TSPs ) 和 媒体 服务 提供 单元 ( MSPs ) 。 
 　 　 TAPI3.0 的 COM 对象 主要 有 以下 5 个 ： TAPI 、 地址 、 终端 、 电话 和 电话 集线器 ， 这些 对象 及其 相关 的 接口 如图 3 所示 。 
 
 图 3 　 TAPI 中 的 对象 
 4.1 　 TAPI 
 　 　 TAPI 对象 是 一个 应用 指向 TAPI3.0 的 入口 指针 。 一个 TAPI3.0 的 应用 必须 在 其 初始化 之前 产生 一个 TAPI 服务器 对象 的 实例 。 TAPI 对象 给出 本地 计算机 访问 的 所有 电话 资源 ， 从而 允许 应用程序 列举 所有 的 本地 和 远程 的 地址 。 当 系统 跨越 多层 服务器时 ， 远程 地址 可以 是 分布式 的 。 
 4.2 　 地址 
 　 　 地址 对象 是 一个 呼叫 对象 给出 的 源 指针 和 目标 指针 。 TAPI3.0 可以 从 地址 对象 获得 传输媒体 和 终端 的 支持 。 一个 应用 可以 在 一个 地址 对象 上 等待 一个 对内 的 呼叫 对象 ， 或者 从 一个 地址 对象 产生 一个 对外 的 呼叫 对象 。 
 4.3 　 终端 
 　 　 所谓 终端 对象 是 一个 连接 的 起点 的 交接 器 和 终点 的 接收器 。 终端 对象 既 可以 被 理解 为 人们 交往 所 使用 的 电话 或 麦克风 之类 的 硬件 ， 也 可以 是 一个 文件 或 接收 输入 ， 产生 输出 的 设备 能力 。 终端 对象 允许 用户 选择 自己 所用 的 设备 ， 如果 需要的话 ， 它 还 提供 一个 通用 的 方法 对 这些 设备 进行 控制 ， 例如 选择 音频 或 视频 控制 。 如果 某一 应用 不 要求 TAPI3.0 设置 这个 终端 ， 那么 它 可以 不 指定 终端 。 但是 ， 当 电话 设置 为 使用 DirectShow ， 而且 已经 有 一个 或 几个 媒体 流 ， 那么 这时 唯一 适当 的 选择 是 不 指定 终端 。 
 4.4 　 呼叫 
 　 　 所谓 呼叫 对象 是 一个 本地 地址 与 一个 或 几个 其它 地址 之间 的 地址 连接 。 图 4 表示 两位 个人 之间 的 通话 。 呼叫 对象 为 pCallA 和 pCallB ， 而 呼叫 集线器 对象 为 pCallHub 。 用户 为 A 和 B 。 
 
 图 4 　 用户 A 和 用户 B 的 通话 过程 
 　 　 应当 指出 ， 所有 的 呼叫 控制 都 是 通过 呼叫 对象 来 完成 的 。 我们 可以 将 呼叫 对象 视为 一次 通话 过程 中 出现 的 第一个 角色 。 利用 呼叫 集线器 对象 CallHub ， 一个 有 安全 要求 的 用户 可以 发现 并 潜在地 控制 通话 过程 中 的 其它 参与者 。 例如 ， 在 图 4 中 ， 用户 A 的 应用 利用 对象 pCallA 实现 全部 的 呼叫 控制 ， 而 用户 B 的 应用 则 利用 对象 pCallB 实现 全部 的 呼叫 控制 。 用户 A 的 应用 利用 呼叫 集线器 对象 pCallHub 到达 对象 pCallB ， 因此 ， 用户 A 的 应用 能够 利用 对象 pCallB 发现 有关 用户 B 的 信息 。 如果 用户 A 拥有 足够 的 授权 ， 用户 A 的 应用 也 能够 从 用户 B 的 视角 出发 ， 利用 对象 pCallB 执行 呼叫 控制 。 
 4.5 　 呼叫 集线器 
 　 　 如 我们 在 呼叫 对象 中 所述 ， 所谓 呼叫 集线器 对象 ， 即 相关 呼叫 的 集合 。 一个 呼叫 集线器 对象 不能 由 一个 应用 直接 产生 。 当 一个 进入 的 呼叫 通过 TAPI3.0 所 接收 时 ， 一个 呼叫 集线器 对象 就 间接 地 产生 了 。 当 TAPI3.0 的 应用 必须 对 呼叫 过程 进行 监视 时 ， 可以 通过 两种 途径 实现 ： 一是 呼叫 集线器 将 RegisterCallHubAddress 方法 注册 到 TAPI 服务器 ， 二是 通过 让 呼叫 对象 将 ITCallNotificationEven 接口 注册 到 地址 对象 。 
 5 　 与 TAPI3.0 有关 的 ActiveX 控件 
 　 　 TAPI 是 一个 比较复杂 的 体系 ， 程序员 直接 对 TAPI 进行 开发 不会 是 一件 轻松 的 工作 。 TAPI3.0 支持 ActiveX 控件 。 除了 微软 提供 的 1 , 000 多个 可 重用 ActiveX 控件 之外 ， 还有 许多 公司 在 开发 各种 专用 的 ActiveX 控件 ， 其中 当然 包括 与 TAPI3.0 有关 的 ActiveX 控件 ， 如 Excele   tel 的 Teletools 。 在 VB 、 V C++ 、 DELPHI 等 基于 组件 的 可视化 编程 环境 下 ， 程序员 可以 在 自己 的 程序 中 直接 利用 这些 ActiveX 控件 ， 避免 了 大量 重复 烦琐 的 编程 ， 以便 将 主要 精力 用于 特定 的 应用 ， 从而 大大缩短 了 应用程序 的 开发周期 。 
 6 　 结束语 
 　 　 IP电话 是 一项 有着 十分 广阔 的 应用 前景 的 新 技术 ， 在 微软 视窗 环境 下 ， 这项 技术 的 核心 是 TAPI 。 TAPI 在 IP电话 的 应用 过程 中 不断 地 得到 完善 和 发展 。 在 TAPI3.0 中为 开发人员 提供 了 建立 CTI 应用 所 需 的 所有 工具 。 TAPI3.0 对 ACD ( 自动 呼叫 分配 ) 、 代理 、 群组 和 路由 的 支持 使 它 完全 能够 胜任 呼叫 中心 应用 的 创建 。 
 　 　 此外 我们 还 看到 ， 就 IP电话 而言 ， 微软 提供 了 从 WOSA 到 TAPI ， 到 可 重用 的 ActiveX 控件 ， 即 从 操作系统 到 开发 平台 ， 到 应用 级 的 全面 的 支持 ， 这是 极具 战略眼光 的 考虑 。 当 我们 致力于 民族 信息产业 的 振兴 时 ， 微软 的 成功 给 我们 以 许多 启示 。 
 黄 求根 （ 武汉 纺织 工学院 计 科系   武汉   430074 ） 
 吴宛萍 （ 武汉 纺织 工学院 计 科系   武汉   430074 ） 
 卢 强华 （ 武汉 纺织 工学院 计 科系   武汉   430074 ） 
 参考文献 
 1Jim   Boyce 等 著 ,   王建华 等 译 .   WINDOWS   NT4.0 安装 与 配置 手册 .   北京 ： 机械 工业 出版社 ,   1998 
 2http : / / madras . npac . syr . edu / people / abba / Tapi . htm   IP   Telephony ,   1999 
 3http : / / www . wilco - telephony . co . uk / tapi . html ,   The   TAPI   Factor ,   1999 
 4http : / / technet . microsoft . com / cdonline / content / complete / boes / bo   / win2ksrv / technote / tapi30 . htm ,   IP   Telephony   with   TAPI   3.0   ( Windows   Operating   System ) ,   1999   
 5ExceleTel   Inc .   Windows   Telephony   Architecture ,   1998 
 收稿 日期 ： 1999 年 8 月 23 日 
