微型机 与 应用 
 MICROCOMPUTER   &   ITS   APPLICATIONS 
 2000 　 No.19 　 No.1 　 P.31 - 33 
 
 
 
 
 代理服务器 在 Internet ／ Intranet 中 的 应用 
 汪 新平 　 王   建 　 王 长庆 　 李 庆云 
 摘   要 ：   以 微软公司 代理 服务器软件 MS   Proxy   Server   2 ． 0 为例 ， 详细 阐述 了 代理服务器 的 功能 、 设计 安装 及 使用 。   
 关键词 ：   代理服务器   Internet   MS   Proxy   Server   2 ． 0 
 　 　 代理服务器 （ Proxy   Server ） 是 指 那些 自己 不能 执行 某种 操作 的 计算机 ， 通过 一台 服务器 来 执行 该 操作 ， 该 服务器 即 为 代理服务器 。 代理服务器 是 伴随 着 Internet 应运而生 的 网络服务 技术 ， 它 可以 实现 网络 的 安全 过滤 、 流量 控制 （ 减少 Internet 使用 费用 ） 、 用户 管理 等 功能 ， 因此 它 既 是 一种 网络 防火墙 技术 ， 同时 也 可以 解决 许多 单位 连接 Internet 引起 IP地址 不足 的 问题 。 
 1   代理服务器 的 功能 
 1.1   防火墙 
 　 　 许多 用户 使用 代理服务器 主要 用来 解决 本 单位 Internet 合法 IP地址 不足 的 问题 ， 也 有 的 用户 用 它 来 减少 单位 出口 流量 ， 但 从 安全 角度 考虑 用 它 作为 防火墙 （ Firewall ） 的 尚 不多见 。 防火墙 技术 是 近几年 开发 并 推广 使用 的 一项 网络安全 新 技术 ， 它 是 在 2 个 网络 之间 实施 访问 控制策略 的 一个 系统 ， 既 能 过滤网 间 非法 信息流 ， 又 能 允许 网间 的 合法 信息流 通过 。 
 　 　 代理服务器 的 防火墙 技术 与 以往 的 包 过滤 （ Packet   Filter ） 型 防火墙 有所不同 。 它 是 处在 网络 ISO ／ OSI 模型 中 的 最 顶层 ， 工作 在 TCP ／ IP 协议 栈 的 应用层 ， 因而 属于 应用层 防火墙 （ Application   Level   Firewall ） 。 应用层 防火墙 是 针对 不同 网络服务 提供 细致 而 又 安全 的 网络 保护 ， 它 对 每 一种 服务 分别 进行 安全 隔离 ， 内部 网络 不 直接 与 外部 网络连接 。 由此可见 ， 代理服务器 可以 大大降低 分组 过滤 的 复杂性 ， 因此 它 是 分组 过滤 技术 的 重要 补充 ， 在 使用 过程 中 即使 防火墙 发生 问题 ， 外部 网络 也 无法 获得 被 保护 网络 的 信息 。 
 　 　 此外 ， 还 可 将 代理服务器 设计 成 一个 高层 的 应用 路由器 ， 接受 外来 的 应用 连接 请求 ， 进行 安全检查 后 ， 再 与 被 保护 的 网络 应用服务器 连接 ， 让 外部 服务 用户 在 受 控制 的 前提 下 使用 内部 网络服务 ， 而 内部 网络 到 外部 网络 的 服务 连接 也 可以 通过 代理服务器 进行 访问 权限 控制 。 用户 的 每项 代理服务 请求 均 由 两 部分 组成 ： 一部分 是 通过 代理服务器 来 处理 客户 请求 ， 另 一部分 是 代理 客户 向 真实 服务器 发出 服务 请求 。 
 1.2   用户 管理 
 　 　 服务器 上 只要 安装 了 代理服务 软件 ， 这台 服务器 就 成为 一台 代理服务器 。 当 用户 通过 代理服务器 连入 Internet 时 ， 在 代理服务器 上 设置 一些 参数 ， 就 可 对 用户 进行 有效 管理 ， 可 针对 不同 用户 开放 不同 的 应用 功能 ， 设置 用户 使用 权限 ， 如 ： WWW 、 FTP 、 Telnet 、 Email 及 多媒体 等 ， 象 ICQ 这类 网络 应用软件 也 可 在 代理服务器 中 设置 用户 使用 权限 。 还 可以 对 Internet 上 的 一些 站点 进行 过滤 ， 使 用户 只能 访问 某一 IP地址 范围 或 某个 域 （ Domain ） 范围 的 信息 。 
 1.3   减少 出口 流量 
 　 　 代理服务器 通过 软件 与 硬件 技术 结合 ， 在 存储设备 上 为 用户 提供 较大 的 高速缓存 （ Cache ） ， 当 一个 客户机 访问 过 Internet 上 的 某些 资源 时 ， 它 就 会 将 这些 访问 过 的 资源 存入 Cache 中 ， 其它 客户机 需要 浏览 同样 信息 时 ， 代理服务器 会 自动 从 Cache 中 读取 。 因此 ， 所有 通过 代理服务器 的 用户 都 能 共享 这些 访问 过 的 资源 ， 这 就 可以 大大提高 客户机 访问速度 ， 减少 本地 节点 的 出口 负载 及 流量 ， 降低成本 ， 提高 经济效益 。 
 1.4   节省 连入 Internet 的 IP地址 
 　 　 在 连入 Internet 时 ， 所有 客户机 都 要 申请 1 个 IP地址 ， 但 IP地址 的 划分 已 不能 满足用户 对 连入 Internet 的 期望 ， 如果 使用 代理服务器 就 可以 解决 这一 矛盾 。 首先 将 需要 连入 Internet 的 计算机 连成 一个 局域网 ， 然后 通过 代理服务器 连入 Internet ， 这样 就 可以 使 多台计算机 共用 一个 Internet 上 的 IP地址 ， 即 共用 一个 出口 连入 Internet ， 从而 减少 用户 单位 申请 IP地址 的 费用 。 
 2   代理服务器 的 硬件 安装 与 设计 
 　 　 在 设计 和 规划 代理服务器 时 ， 一般 可以 根据 用户 需求 从 二 方面 考虑 ： 一 是从 安全 角度 考虑 将 代理服务器 用作 防火墙 ； 二是 在 一个 完全 开放 的 或 采用 其它 类型 防火墙 的 网络 中 ， 使用 代理服务器 来 加快 网络 访问速度 。 
 2.1   作为 防火墙 
 　 　 当 代理服务器 作为 防火墙 时 ， 要 将 防火墙 内部 的 局域网 与 外部 的 广域网 分别 放在 2 个 不同 的 网段 上 ， 让 代理服务器 作为 局域网 的 出口 （ 即 局域网 的 网关 Gateway ） ， 使 进出 局域网 信息 必须 经过 代理服务器 ， 这样 代理服务器 就 可 对 进出 局域网 的 信息 进行 有效 的 管理 和 过滤 ， 起到 防火墙 的 作用 ， 同时 还 可 对 局域网 内部 用户 进行 有效 管理 或 针对 不同 用户 设置 不同 权限 ， 开放 不同 功能 。 如 针对 不同 用户 开放 Email 、 FTP 、 Telnet 等 功能 ， 网络拓扑 结构 如图 1 所示 。 
 
 图 1   代理服务器 
 　 　 在 计算机硬件 设计 上 ， 可 在 作为 代理服务器 的 机器 上 安装 2 块 网卡 ， 设置 2 个 不同 网段 ， 使 这台 服务器 成为 一个 简单 的 路由器 ， 以 实现 不同 网段 数据 的 路由 转发 。 同时 在 2 块 网卡 上 设置 不同 的 IP地址 ： 1 块 卡 连入 Internet 网 ， 使用 Internet 合法 的 IP地址 （ 202 ． 188 ． 160 ． 100 ） ， 子网掩码 为 255 ． 255 ． 255 ． 0 ， 默认 网关 则 由 Internet   ISP 提供 ； 另 1 块 作为 连接 内部 局域网 的 网卡 ， 其 地址 可 根据 自己 的 需求 设置 成 内部 的 IP地址 （ 即 虚拟地址 ） ， 该 地址 仅 在 局域网 内部 可 被 识别 。 如 ： 10 ． 10 ． 10 ． 1 ， 子网掩码 为 255 ． 255 ． 255 ． 0 ， 默认 网关 为 202 ． 188 ． 160 ． 100 ， 即 指向 第 1 块 网卡 。 
 　 　 从图 1 可以 看出 ， 局域网 的 所有 用户 仅用 1 个 Internet   IP地址 就 可 通过 代理服务器 连入 Internet ， 其它 地址 则 由 用户 自己 定义 。 这样 就 拓宽 了 用户 连入 Internet 的 地址 范围 ， 同时 也 确定 了 可以 使用 代理服务器 用户 的 IP地址 范围 。 图 1 中 的 代理服务器 是 一个 简单 的 路由器 ， 局域网 内有 自成 系统 的 IP地址 ， 该 地址 对外 来 的 访问者 是 无法 识别 的 。 因此 ， 非法 用户 无法 侵入 内部 网络 ， 使 用户 内部 的 计算机 既 能 访问 Internet 上 的 资源 又 能 保证 自己 的 安全 ， 在 此 代理服务器 就 起到 了 防火墙 的 作用 。 如果 再 安装 相应 的 软件 ， 还 可以 实现 Web   Server 、 FTP   Server 等 功能 。 有些 代理服务 软件包 甚至 可以 统计 局域网 内部 用户 的 出口 流量 ， 并 计算 出 用户 的 流量 费用 。 
 2.2   加快 网络 访问速度 
 　 　 代理服务器 对 连入 方式 并 无 特殊要求 （ 可以 不用 双网卡 服务器 做 代理服务器 ） ， 只要 在 网络 中 的 服务器上安装 代理 服务器软件 即可 。 代理服务器 与 客户机 均 采用 Internet 合法 的 IP地址 ， 它们 之间 既 可 连接 在 同一 网段 上 ， 也 可 跨 网段 连接 。 但 代理服务器 并非 内部 网络 的 唯一 出口 ， 所有 用户 可以 不 受 代理服务器 的 限制 直接 连入 Internet ， 也 可 通过 代理服务器 连入 ， 只要 在 代理服务器 的 本地 地址 表中 加入 用户 的 IP地址 即可 。 因此 ， 设置 代理服务器 的 主要 目的 是 利用 其 缓存 功能 ， 用户 通过 访问 代理服务器 缓存 中 的 历史记录 来 提高 访问速度 ， 减少 局域网 连入 Internet 的 出口 流量 与 负载 。 用户 是否 连入 则 完全 取决于 自己 的 需求 。 
 　 　 从 上述 两种 网络 规划 可以 看出 ， 第一种 连接 方式 除了 可以 发挥 防火墙 作用 以外 ， 还 可 实现 加快 网络 访问速度 、 用户 管理 、 扩展 网络 IP地址 等 功能 ， 这种 连接 方式 可以 充分发挥 代理服务 的 所有 功能 ， 因此 这种 设计 常常 用于 对 网络安全 有 要求 或 Internet   IP地址 不足 的 情况 。 第二种 设计 只 应用 了 代理服务 的 部分 功能 ， 一般 用于 对 Internet   IP地址 不 紧张 ， 或 不 需要 用 代理服务器 作为 防火墙 的 单位 或 网站 ， 以 提高 网络 出口 速度 。 许多 大专院校 的 网络 中心 ， 或 某些 Internet   ISP 常 采用 这种 设计 。 
 3   代理 服务器软件 安装 、 配置 与 管理 
 　 　 目前 许多 著名 软件 公司 均 有 自己 的 代理服务 软件产品 。 比较 流行 的 软件 有 ： 微软公司 的 MS   Proxy   Server   2 ． 0 、 Netscape 公司 的 Proxy 及 人们 经常 使用 的 WinGate 、 WinProxy 等 。 本文 将 以 微软公司 的 MS   Proxy   Server   2 ． 0 为例 进行 阐述 。 
 3.1   软件 的 安装 
 　 　 在 安装 之前 需要 注意 以下 几个 方面 的 问题 ： 
 　 　 1 ． MS   Proxy   Server   2 ． 0 运行 在 Windows   NT   Server   4 ． 0 操作系统 下 ， 并 安装 有 IIS （ Internet   Information   Server ） 2 ． 0 或 以上 版本 ， 及 Windows   NT   Server   4 ． 0   Service   Pack   3 ． 0 或 以上 版本 。 
 　 　 2 ． 服务器 应 安装 成主域 服务器 。 
 　 　 3 ． 软件 应 尽量 安装 在 Windows   NT 的 NTFS 分区 中 。 整个 安装 过程 比较简单 ， 用户 可以 根据 提示 进行 操作 。 安装 时会 提示 用户 输入 使用 代理服务 的 IP地址 范围 ， 建立 本地 地址 表 LAT （ Local   Address   Table ） ， 这个 地址 可以 是 连续 的 或 不 连续 的 内部 虚拟地址 ， 也 可以 是 Internet 合法 IP地址 。 如果 是 以 代理服务器 作为 局域网 的 出口 ， 地址 就是 局域网 的 IP地址 范围 ， 这样 就 可 确定 内部 网络 的 虚拟地址 ， 代理服务器 则 以此 表 确定 内部 网络 与 外部 网络 的 界限 ， 否则 由 用户 自行 定义 地址 范围 。 此外 ， 在 安装 过程 中 ， 要求 设置 缓存 （ Cache ） 的 大小 ， Cache 一般 应 设置 200MB 以上 的 磁盘空间 ， 最好 设置 在 NTFS 分区 上 。 
 3.2   软件 的 管理 
 　 　 MS   Proxy   Server   2 ． 0 是 由 Web   Proxy 与 WinSock   Proxy   2 个 彼此 独立 的 代理 服务器软件 组成 ， 安装程序 会 自动 将 这 2 个 服务器 安装 到 Windows   NT 服务器 上 ， 每个 软件 都 能 单独 运行 于 Windows   NT 环境 。 其中 Web   Proxy 能够 为 任何 支持 CERN 兼容 的 客户端 软件 提供 代理服务 ， 这种 服务 是 可 跨越 系统 平台 （ 如 UNIX 、 OS ／ 2 等 ） ， 并 通过 TCP ／ IP   80 端口 传输 WWW 、 FTP 、 Gopher   3 项 服务 请求 ， 但 它 不 支持 邮件 服务 。 而 WinSock   Proxy 则 是 一个 刚 问世 不久 ， 并 只 支持 Windows 环境 的 代理 服务器软件 ， 要 运行 它 的 代理服务 ， 必须 在 客户 机上安装 WinSock   Proxy 客户端 软件 ， 它 支持 包括 邮件 及 ICQ 等 几乎 所有 服务 。 Web   Proxy 及 WinSock   Proxy 代理 软件 都 是 捆绑 在 IIS 管理工具 内 ， 2 个 软件 的 管理 项目 及 方式 基本相同 ， 均 由 5 个 项目 组成 。 
 　 　 Web   Proxy 管理 的 项目 为 Service 、 Permissions 、 Caching 、 Logging 、 Filters ， WinSock   Proxy 管理 的 项目 为 Service 、 Protocols 、 Permissions 、 Logging 、 Filters 。 管理员 可 从 “ IIS ” → “ Web   Proxy 或 WinSock   Proxy ” 进入 代理服务器 配置管理 界面 ， 对 它 进行 设置 管理 。 
 　 　 1 ． 为 用户 开放 Internet 服务 
 　 　 由于 MS   Proxy   Server   2 ． 0 的 每 一个 代理服务 都 必须 授权 ， 只有 合法 用户 才 有权 使用 。 因此 应为 使用 代理服务 的 用户 分配 许可 权限 ， 即 在 IIS 的 Web 或 Winsock 代理 管理器 中将 其 权限 设置 为 “ 允许 ” （ Enable ） ， 设置 步骤 为 ： 从 “ 开始 ” → “ Internet   Information   Server ” → “ Web   Proxy ” 或 “ WinSock   Proxy ” → “ Service   Properties ” → “ Permission ” ， 选中 欲 放开 的 服务 请求 （ 如 ： WWW 、 FTP ） ， 按 “ Add ” ， 添加 用户 。 
 　 　 如果 添加 的 用户 较 多 ， 则 可以 采取 组 方式 来 简化 管理 。 在 Windows   NT “ 域 用户 管理器 ” 中 按 职能 为 用户 建立 不同 的 工作组 ， 并 赋予 相应 的 权限 ， 也 可 在 上述 添加 用户 时 直接 添加 工作组 ， 从而 减少 许多 重复 工作 来 简化 操作 。 
 　 　 2 ． 访问 站点 控制 
 　 　 在 Internet 中有 大量 违法 信息 及 站点 ， 要 限制 或 禁止 访问 这些 站点 ， 可 在 MS   Proxy   Server   2 ． 0 中 设置 禁访 的 IP地址 或 域名 来 解决 。 设置 步骤 为 ： 进入 管理器 从 “ 开始 ” → “ Internet   Information   Server ” → “ Web   Proxy 或 WinSock   Proxy ” → “ Service   Properties ” → “ Filters ” → “ Enables   Filtering ” 。 过滤 方式 有 “ 禁访 ” 和 “ 允许 ” 2 种 。 设置 “ 禁访 ” 时 ， 在 “ Enables   Filtering ” 界面 中 选择 “ Granted ” ， 然后 在 “ Except   to   those   listed   below ” 中 添加 要 禁止 访问 站点 的 地址 或 域名 ， 除了 “ Except   to   those   listed   below ” 中 指定 的 站点 外 ， 用户 可以 访问 其它 所有 Internet 站点 。 设置 “ 允许 ” 用户 访问 时 ， 则 选 “ Denied ” ， 然后 在 “ Except   to   those   listed   below ” 中 输入 允许 访问 的 站点 地址 或 域名 ， 这时 除了 表中 显示 的 站点 外 ， 其余 站点 用户 都 不能 访问 。 选择 “ Granted ” 或 “ Denied ” 后 ， 按 “ Add ” 就 会 出现 3 种 选择 ： 采用 域名 过滤 “ Domain ” 、 单一 IP地址 过滤 “ Single   Computer ” 及 1 组 IP地址 过滤 “ Group   of   Computer ” 3 种 方式 ， 其中 ： 
 　 　 域 过滤 “ Domain ” ， 用户 可以 输入 需要 过滤 的 域名 。 如 ： 要 将 用户 访问 的 站点 限制 在 国内 ， 可以 输入 “ * ． cn ” 来 实现 。 
 　 　 单一 IP地址 过滤 “ Single   Computer ” ， 必须 输入 要 限制 访问 计算机 的 IP地址 。 
 　 　 1 组 IP地址 过滤 “ Group   of   Computer ” ， 需要 用户 输入 禁访 的 IP地址 与 子网掩码 。 
 　 　 由于 用户 的 代理服务 请求 必须 注册 ， 因此 用户 在 客户机 上 使用 某项 服务 时 ， 必须 先 从 客户机 登录 到 服务器 上去 注册 ， 只有 合法 用户 才能 使用 代理服务器 的 所有 服务 ， 否则 除 HTTP 以外 的 所有 服务 用户 都 无权 使用 。 
 　 　 MS   Proxy   Server   2 ． 0 还有 自动 拨号 、 服务器 缓存 阵列 、 代理服务器 性能 监视 、 服务器 管理 等 许多 功能 。 
 　 　 代理服务器 对 提高 网络安全 和 速度 、 降低 用户 流量 极为 有用 。 随着 网络 技术 的 不断 发展 ， 代理服务器 将 逐渐 引起 人们 的 重视 ， 特别 是 防火墙 的 功能 。 因此 ， 代理服务器 的 功能 及 应用 前景 会 越来越 广 。 
 汪 新平 （ 山东省 东营市 石油大学 信息中心  257062 ） 
 王建 （ 山东省 东营市 石油大学 信息中心  257062 ） 
 王 长庆 （ 山东省 东营市 石油大学 信息中心  257062 ） 
 李 庆云 （ 山东省 东营市 石油大学 信息中心  257062 ） 
 参考文献 
 1 ， 王士元 ． Windows   NT 实用 组网 技术 ． 北京 ： 人民邮电 出版   社 ， 1998 
 2 ， 毛 东峰 ， 谭锟 ． IP地址 不足 的 小型 网络 如何 获得 Internet   服务 ． 微型机 与 应用 ， 1998 ； ( 10 ) 
 收稿 日期 ： 1999 － 08 － 29 
