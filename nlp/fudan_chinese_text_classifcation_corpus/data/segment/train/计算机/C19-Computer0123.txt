计算机 工程 
 Computer   Engineering 
 1999 年 　 第 25 卷 　 第 9 期 　 Vol.25   No.9     1999 
 
 
 
 计算机系统 入侵 检测 模型 与 方法 
 阮耀平 　 易 江波 　 赵战生 
 　 　 摘 　 要 ： 简要 介绍 了 系统 评估 和 入侵 检测 的 研究 背景 和 意义 ． 从 攻击 策略 的 角度 ， 阐述 了 入侵 检测 内容 和 方法 ， 并 介绍 了 具有 通用 价值 的 入侵 检测 模型 ． 通过 总结 将 检测 原理 分为 基于 行为 和 基于 知识 两大类 ， 分别 阐述 了 各类 方法 的 具体 实现 手段 和 积压 自 的 优缺点 ． 
 　 　 关键词 ： 入侵 检测 ； 审计 跟踪 ； 行为 特征 
 The   Model   and   Methodology   of   Intrusion   Detection   in   Computer   System 
 Ruan   Yaoping   Yi   Jiangbo   Zhao   Zhansheng 
 ( State   Key   Lab   of   Information   Security ,   Graduate   School   of   USTC ,   Beijing   100039 ) 
 　 　 Abstract 　 The   study   background   and   significance   of   system   evaluation   and   intrusion   detection   are   introduced   in   this   paper . The   contents   and   methodology   of   instrusion   detection   are   presented   from   the   view   of   attack   strategy .   By   classifying   the   detection   principle   into   behavior - based   and   knowledge - based   method ,   a   generic   intrusion   detection   model   is   introduced ,   and   the   respective   implement   measures ,   advantages   and   disadvantages   are   addressed . 
 　 　 Key   words 　 Intrusion   detection ;   Audit   trail ;   Behavior   feature 
 　 　 近 十几年 Internet 的 发展 和 应用 正 逐步 影响 着 人们 的 生活 和 工作 方式 。 在 我国 ， 网络 互联 亦 早已 成为 人们 实现 信息 共享 与 交流 的 有力 手段 。 与此同时 ， 由于 保护 许多 涉及 国家 军政 、 经济 工商业 情报 以及 一些 私人 数据 等 敏感 信息 的 需要 ， 或者 实际 工作 的 需要 ， 信息技术 的 安全性 越来越 引起 业内人士 的 普遍 关注 。 但是 ， 由于 系统 脆弱性 的 客观存在 以及 各种各样 入侵 行为 的 存在 ， 使得 信息系统 的 安全 保护 难度 大为 提高 。 
 　 　 几乎 从 一 开始 起 ， 人们 就 将 " 存取控制 " 或 " 访问控制 " 作为 最 基本 的 一道 安全 防线 ， 并 依此 发展 了 一些 安全 模型 ， 如 著名 的 Bell - Lapadula   安全 操作系统 模型 ， 以及 Biba ,   Clark - Wilson ,   Lipner 完整性 模型 等 。 暂且不说 实现 这些 理论 模型 的 难度 ， 只 从 这样 一个 防御 的 角度 来 保证系统 的 安全性 是 不够 的 。 计算机系统 安全 的 管理 应 包括 4 部分 ， 如图 1 所示 。 其中 构筑 一个 安全 系统 ( 防御 模块 ) 只是 其中 的 一小部分 。 检测 模块 用于 发现 各种 违反 系统安全 规则 的 入侵 行为 。 调查 模块 将 检测 模块 所 获得 数据 加以分析 ， 并 确认 当前 所 发生 的 有关 入侵 企图 。 最后 ， 事后 分析 模块 分析 将来 如何 抵制 类似 入侵 行为 。 
 
 图 1 　 具有 检测 模块 的 安全 系统管理 
 　 　 系统 的 风险 分析 和 入侵 检测 正是 后 几 部分 模块 所 要 完成 的 工作 。 一般 方法 是 通过 分析 系统 的 审计 数据 ， 找出 有关 追踪 安全 侵害 和 入侵 企图 的 有用 信息 。 所以 入侵 检测 系统 不仅 能 发现 非法 用户 的 攻击 以及 合法 用户 滥用特权 等 入侵 行为 ， 还 能够 在 一定 程度 上 提供 追究 入侵者 法律责任 的 有效 证据 。 
 　 　 目前 国外 不但 有 多个 实验室 在 从事 入侵 检测 系统 的 研究 和 开发 ， 并 已 完成 一些 原型 系统 和 商业 产品 。 但是 ， 国内 的 研究 现状 却 相对 落后 。 本文 综合 了 国外 大部分 系统 的 检测 方法 ， 将 它们 从 原理 上作 了 分类 ， 并 指出 了 相应 的 优缺点 ， 希望 能 对 我们 的 进一步 研究 有 一定 的 启发 和 借鉴 作用 。 
 1 　 入侵 检测 模型 
 　 　 入侵 行为 不仅 来自 外部 ， 同时 也 指 内部 用户 的 未 授权 活动 。 从 入侵 策略 的 角度 可 将 入侵 检测 的 内容 分为 ： 试图 闯入 或 成功 闯入 、 冒充 其它 用户 、 违反 安全策略 、 合法 用户 的 泄漏 、 独占 资源 以及 恶意 使用 等 6 个 方面 。 
 
 图 2 　 入侵 检测 模型 
 　 　 最早 的 入侵 检测 模型 由 Dorothy   Denning   在 1986   年 提出 [ 1 ] 。 这个 模型 与 具体 系统 和 具体 输入 无关 ， 对 此后 的 大部分 实用 系统 都 很 有 借鉴 价值 。 图 2 表示 了 这个 通用 模型 的 体系结构 。 事件 产生器 可 根据 具体 应用环境 而 有所不同 ， 一般 可 来自 审计 记录 、 网络 数据包 以及 其它 可视 行为 。 这些 事件 构成 了 检测 的 基础 。 行为 特征 表是 整个 检测 系统 的 核心 ， 它 包含 了 用于 计算 用户 行为 特征 的 所有 变量 ， 这些 变量 可 根据 具体 所 采纳 的 统计 方法 以及 事件 记录 中 的 具体 动作 模式 而 定义 ， 并 根据 匹配 上 的 记录 数据 更新 变量值 。 
 　 　 如果 有 统计 变量 的 值 达到 了 异常 程度 ， 则 行为 特征 表 产生 异常 记录 ， 并 采取 一定 的 措施 。 规则 模块 可以 由 系统 安全策略 ， 入侵 模式 等 组成 。 它 一方面 为 判断 是否 入侵 提供 参考 机制 ， 另一方面 根据 事件 记录 、 异常 记录 以及 有效 日期 等 控制 并 更新 其它 模块 的 状态 。 在 具体 实现 上 ， 规则 的 选择 与 更新 可能 不尽相同 ， 但 一般 地 ， 行为 特征 模块 执行 基于 行为 的 检测 ， 而 规则 模块 执行 基于 知识 的 检测 。 由于 这 两种 方法 具有 一定 的 互补性 ， 实际 系统 中 经常 将 两者 结合 在 一起 使用 ， 下面 分别 加以 介绍 。 
 2 　 基于 行为 的 检测 
 　 　 基于 行为 的 检测 指 根据 使用者 的 行为 或 资源 使用 状况 来 判断 是否 入侵 ， 而 不 依赖于 具体 行为 是否 出现 来 检测 ， 所以 也 被 称为 异常 检测 ( Anomaly   Detection ) 。 基于 行为 的 检测 与 系统 相对 无关 ， 通用性 较强 。 它 甚至 有 可能 检测 出 以前 未 出现 过 的 攻击 方法 ， 不像 基于 知识 的 检测 那样 受 已知 脆弱性 的 限制 。 但 因为 不 可能 对 整个 系统 内 的 所有 用户 行为 进行 全面 的 描述 ， 况且 每个 用户 的 行为 是 经常 改变 的 ， 所以 它 的 主要 缺陷 在于 误检率 很 高 。 尤其 在 用户 数目 众多 ， 或 工作 目的 经常 改变 的 环境 中 。 其次 由于 统计 简表 要 不断更新 ， 入侵者 如果 知道 某 系统 在 检测器 的 监视 之下 ， 他们 能 慢慢 地 训练 检测 系统 ， 以至于 最初 认为 是 异常 的 行为 ， 经 一段时间 训练 后 也 认为 是 正常 的 了 。 基于 行为 的 检测 方法 主要 有 以下 两种 。 
 2.1 　 概率 统计 方法 
 　 　 概率 统计 方法 是 基于 行为 的 入侵 检测 中 应用 最早 也 是 最 多 的 一种 方法 [ 2 ] 。 首先 ， 检测器 根据 用户 对象 的 动作 为 每个 用户 都 建立 一个 用户 特征 表 ， 通过 比较 当前 特征 与 已 存储 定型 的 以前 特征 ， 从而 判断 是否是 异常 行为 。 用户 特征 表 需要 根据 审计 记录 情况 不断 地 加以 更新 。 用于 描述 特征 的 变量 类型 有 ： 1 ) 操作 密度 ： 度量 操作 执行 的 速率 ， 常用 于 检测 通过 长时间 平均 觉察 不到 的 异常 行为 ； 2 ) 审计 记录 分布 ： 度量 在 最新 纪录 中 所有 操作 类型 的 分布 ； 3 ) 范畴 尺度 ： 度量 在 一定 动作 范畴 内 特定 操作 的 分布 情况 ； 4 ) 数值 尺度 ： 度量 那些 产生 数值 结果 的 操作 ， 如 CPU 使用量 ， I / O 使用量 。 
 　 　 这些 变量 所 记录 的 具体操作 包括 ： CPU   的 使用 ， I / O   的 使用 ， 使用 地点 及 时间 ， 邮件 使用 ， 编辑器 使用 ， 编译器 使用 ， 所 创建 、 删除 、 访问 或 改变 的 目录 及 文件 ， 网络 上 活动 等 。 
 　 　 在 SRI / CSL 的 入侵 检测 专家系统 ( IDES ) [ 2 ] 中 给出 了 一个 特征 简表 的 结构 ： 
 　 　 < 变量名 ， 行为 描述 ， 例外情况 ， 资源 使用 ， 时间 周期 ， 变量 类型 ， 门 限值 ， 主体 ， 客体 ， 值 > 
 　 　 其中 的 变量名 、 主体 、 客体 唯一 确定 了 每 一个 特征 简表 ， 特征值 由 系统 根据 审计 数据 周期性地 产生 。 这个 特征值 是 所有 有悖于 用户 特征 的 异常 程度 值 的 函数 。 如果 假设 S1 ， S2 ， … ， Sn   分别 是 用于 描述 特征 的 变量 M1 ， M2 ， … ， Mn   的 异常 程度 值 ， Si 值越 大 说明 异常 程度 越大 。 则 这个 特征值 可以 用 所有 Si 值 的 加权 平方和 来 表示 ： 
 　 　 M = a1s12 +   a2s22 + … +   ansn2 ， ai > 0 ， 其中 ai 表示 每一 特征 的 权重 。 
 　 　 如果 选用 标准偏差 作为 判别 准则 ， 则 
 　 　 标准偏差 ： σ ＝ √ M / ( n - 1 ) -   μ 2 其中 均值   μ = M / n 
 　 　 如果 某 S 值 超出 了 μ ± d σ 就 认为 出现异常 。 
 这种 方法 的 优越性 在于 能 应用 成熟 的 概率 统计 理论 。 但 也 有 一些 不足之处 ， 如 ： 统计 检测 对 事件 发生 的 次序 不 敏感 ， 也就是说 ， 完全 依靠 统计 理论 可能 漏检 那些 利用 彼此 关联 事件 的 入侵 行为 。 其次 ， 定义 是否 入侵 的 判断 阈值 也 比较 困难 。 阈值 太低 则 漏检 率 提高 ， 阈值 太高则 误检率 提高 。 
 2.2 　 神经网络 方法 
 　 　 利用 神经网络 检测 入侵 的 基本 思想 是 用 一系列 信息 单元 ( 命令 ) 训练 神经 单元 ， 这样 在 给定 一组 输入 后 ， 就 可能 预测出 输出 。 与 统计 理论 相比 ， 神经网络 更好 地 表达 了 变量 间 的 非线性 关系 ， 并且 能 自动 学习 并 更新 。 实验 表明 UNIX 系统管理员 的 行为 几乎 全是 可以 预测 的 [ 3 ] ， 对于 一般 用户 ， 不可 预测 的 行为 也 只 占 了 很少 的 一部分 。 用于 检测 的 神经网络 模块 结构 大致 是 这样 的 ： 当前 命令 和 刚过去 的 w 个 命令 组成 了 网络 的 输入 ， 其中 w 是 神经网络 预测 下 一个 命令 时所 包含 的 过去 命令集 的 大小 。 根据 用户 的 代表性 命令 序列 训练 网络 后 ， 该 网络 就 形成 了 相应 用户 的 特征 表 ， 于是 网络 对 下 一 事件 的 预测 错误率 在 一定 程度 上 反映 了 用户 行为 的 异常 程度 。 基于 神经网络 的 检测 思想 可用 图 3 表示 [ 3 ] ： 
 
 图 3 　 用于 入侵 检测 的 神经网络 示意图 
 　 　 图中 输入 层 的 W 个 箭头 代表 了 用户 最近 的 W 个 命令 ， 输出 层 预测 用户 将要 发生 的 下 一个 动作 。 神经网络 方法 的 优点 在于 能 更好 地 处理 原始数据 的 随机 特性 ， 即 不 需要 对 这些 数据 作 任何 统计假设 ， 并且 有 较 好 的 抗干扰能力 。 缺点 在于 网络拓扑 结构 以及 各 元素 的 权重 很难 确定 ， 命令 窗口 w 的 大小 也 难以 选取 。 窗口 太小 ， 则 网络 输出 不好 ， 窗口 太 大 ， 则 网络 会 因为 大量 无关 数据 而 降低 效率 。 
 3 　 基于 知识 的 检测 
 　 　 基于 知识 的 检测 指 运用 已知 攻击 方法 ， 根据 已 定义 好 的 入侵 模式 ， 通过 判断 这些 入侵 模式 是否 出现 来 检测 。 因为 很大 一部分 的 入侵 是 利用 了 系统 的 脆弱性 ， 通过 分析 入侵 过程 的 特征 、 条件 、 排列 以及 事件 间 关系 能 具体 描述 入侵 行为 的 迹象 。 基于 知识 的 检测 也 被 称为 违规 检测 ( Misuse   Detection ) 。 这种 方法 由于 依据 具体 特征 库 进行 判断 ， 所以 检测 准确度 很 高 ， 并且 因为 检测 结果 有 明确 的 参照 ， 也 为 系统管理员 做出 相应措施 提供 了 方便 。 主要 缺陷 在于 与 具体 系统 依赖性 太强 ， 不但 系统 移植性 不好 ， 维护 工作量 大 ， 而且 将 具体 入侵 手段 抽象 成 知识 也 很 困难 。 并且 检测 范围 受 已知 知识 的 局限 ， 尤其 是 难以 检测 出 内部人员 的 入侵 行为 ， 如 合法 用户 的 泄漏 ， 因为 这些 入侵 行为 并 没有 利用 系统 脆弱性 。 基于 知识 的 检测 方法 大致 有 以下 3 种 。 
 3.1 　 专家系统 
 　 　 专家系统 是 基于 知识 的 检测 中 运用 最多 的 一种 方法 [ 2 ] 。 将 有关 入侵 的 知识 转化成 if - then 结构 的 规则 ， 即将 构成 入侵 所 要求 的 条件 转化 为 if   部分 ， 将 发现 入侵 后 采取 的 相应措施 转化成 then 部分 。 当 其中 某个 或 某 部分 条件 满足 时 ， 系统 就 判断 为 入侵 行为 发生 。 其中 的 if - then 结构 构成 了 描述 具体 攻击 的 规则 库 ， 状态 行为 及其 语义 环境 可 根据 审计 事件 得到 ， 推理机 根据 规则 和 行为 完成 判断 工作 。 在 具体 实现 中 ， 专家系统 主要 面临 ① 全面性 问题 ， 即 难以 科学 地 从 各种 入侵 手段 中 抽象 出 全面 的 规则化 知识 ； ② 效率 问题 ， 即 所 需 处理 的 数据 量过大 ， 而且 在 大型 系统 上 ， 如何 获得 实时 连续 的 审计 数据 也 是 个 问题 。 
 　 　 因为 这些 缺陷 ， 专家系统 一般 不 用于 商业 产品 中 ， 运用 较 多 的 是 特征分析 。 像 专家系统 一样 ， 特征分析 也 需要 知道 攻击行为 的 具体 知识 。 但是 ， 攻击 方法 的 语义 描述 不是 被 转化 为 检测 规则 ， 而是 在 审计 纪录 中 能 直接 找到 的 信息 形式 。 这样 就 不 像 专家系统 一样 需要 处理 大量 数据 ， 从而 大大提高 了 检测 效率 。 这种 方法 的 缺陷 也 和 所有 基于 知识 的 检测 方法 一样 ， 即 需要 经常 为 新 发现 的 系统漏洞 更新 知识库 。 另外 ， 由于 对 不同 操作系统 平台 的 具体 攻击 方法 可能 不同 ， 以及 不同 平台 的 审计 方式 也 可能 不同 ， 所以 对 特征分析 检测 系统 进行 构造 和 维护 的 工作量 都 较大 。 
 3.2 　 模型 推理 
 　 　 模型 推理 [ 4 ] 是 指 结合 攻击 脚本 推理 出 入侵 行为 是否 出现 。 其中 有关 攻击者 行为 的 知识 被 描述 为 ： 攻击者 目的 ， 攻击者 达到 此 目的 的 可能 行为 步骤 ， 以及 对系统 的 特殊 使用 等 。 根据 这些 知识 建立 攻击 脚本 库 ， 每一 脚本 都 由 一系列 攻击行为 组成 。 检测 时先 将 这些 攻击 脚本 的 子集 看作 系统 正 面临 的 攻击 。 然后 通过 一个 称为 预测器 的 程序模块 根据 当前 行为 模式 ， 产生 下 一个 需要 验证 的 攻击 脚本 子集 ， 并 将 它 传给 决策 器 。 决策 器 收到 信息 后 ， 根据 这些 假设 的 攻击行为 在 审计 记录 中 的 可能 出现 方式 ， 将 它们 翻译成 与 特定 系统 匹配 的 审计 记录 格式 。 然后 在 审计 记录 中 寻找 相应 信息 来 确认 或 否认 这些 攻击 。 初始 攻击 脚本 子集 的 假设 应 满足 ： 易于 在 审计 记录 中 识别 ， 并且 出现 频率 很 高 。 随着 一些 脚本 被 确认 的 次数 增多 ， 另 一些 脚本 被 确认 的 次数 减少 ， 攻击 脚本 不断 地 得到 更新 。 
 　 　 模型 推理方法 的 优越性 有 ： 对 不确定性 的 推理 有 合理 的 数学 理论 基础 ， 同时 决策 器 使得 攻击 脚本 可以 与 审计 记录 的 上下文 无关 。 另外 ， 这种 检测 方法 也 减少 了 需要 处理 的 数据量 ， 因为 它 首先 按 脚本 类型 检测 相应 类型 是否 出现 ， 然后 再 检测 具体 的 事件 。 但是 创建 入侵 检测 模型 的 工作量 比 别的 方法 要 大 ， 并且 在 系统 实现 时 决策 器 如何 有效 地 翻译 攻击 脚本 也 是 个 问题 。 
 3.3 　 状态 转换 分析 
 　 　 状态 转换 分析 最早 由   R . Kemmerer   提出 [ 5 ] ， 即将 状态 转换 图 应用 于 入侵 行为 的 分析 。 状态 转换法 将 入侵 过程 看作 一个 行为 序列 ， 这个 行为 序列 导致系统 从 初始状态 转入 被 入侵 状态 。 分析 时 首先 针对 每 一种 入侵 方法 确定 系统 的 初始状态 和 被 入侵 状态 ， 以及 导致 状态 转换 的 转换 条件 ， 即 导致系统 进入 被 入侵 状态 必须 执行 的 操作 ( 特征 事件 ) 。 然后 用 状态 转换 图来 表示 每 一个 状态 和 特征 事件 ， 这些 事件 被 集成 于 模型 中 ， 所以 检测 时 不 需要 一个个 地 查找 审计 记录 。 但是 ， 状态 转换 是 针对 事件 序列 分析 ， 所以 不 善于 分析 过分 复杂 的 事件 ， 而且 不能 检测 与 系统 状态 无关 的 入侵 。 
 　 　 Petri   网 用于 入侵 行为 分析 是 一种 类似 于 状态 转换 图 分析 的 方法 [ 6 ] 。 利用 Petri 网 的 有利 之 处 在于 它 能 一般化 、 图形化 地 表达 状态 ， 并且 简洁明了 。 虽然 很 复杂 的 入侵 特征 能用 Petri 网 表达 得 很 简单 ， 但是 对 原始数据 匹配 时 的 计算 量 却 会 很大 。 下面 是 这种 方法 的 一个 简单 示例 ， 表示 在 一分钟 内 如果 登录 失败 的 次数 超过 4 次 ， 系统 便 发出 警报 。 其中 竖线 代表 状态 转换 ， 如果 在 状态   S1 发生 登录 失败 ， 则 产生 一个 标志 变量 ， 并 存储 事件 发生 时间   T1 ， 同时 转入 状态   S2 。 如果 在 状态   S4 时 又 有 登录 失败 ， 而且 这时 的 时间   T2 - T1 < 60   秒 ， 则 系统 转入 状态   S5 ， 即 为 入侵 状态 ， 系统 发出 警报 并作 相应措施 。 
 
 图 4 　 Petri 网 分析 一分钟 内 4 次 登录 失败 
 4 　 结束语 
 　 　 入侵 检测 的 最终 目的 是 有效 地 提高 系统 脆弱性 ， 所以 不能 局限于 检测 已知 脆弱性 ， 而是 要 发现 新 的 脆弱性 ， 反过来 检测 库 也 要 不断更新 ， 检测 与 更新 构成 一个 相辅相成 的 动态 过程 。 目前 对 入侵 检测 的 研究 主要 集中 在 机器 学习 和 自动更新 上 ， 入侵 检测 的 应用 范围 已 从 早期 的 审计 跟踪 数据分析 ， 到 目前 应用 于 大型 网络 和 分布式系统 上 。 本文 通过 总结 介绍 入侵 检测 方法 ， 将 它们 分为 基于 行为 和 基于 知识 两大类 ， 并 阐述 了 各自 的 实现 手段 和 优缺点 ， 目的 在于 能为 我们 的 进一步 研究 起到 启发 和 借鉴 的 作用 。 
 作者简介 ： 阮耀平 ( 1975 ～ ) ， 男 ， 研究生 ， 研究 方向 ： 信息安全 
 作者 单位 ： 中国科技大学 研究生院 信息安全 国家 实验室 ， 北京 　 100039 
 参考文献 
 1   Denning   D   E .   An   Intrusion   Detection   Model .   IEEE   Transaction   on   Software   Engineering ,   1987 ,   2 ( 2 ) :   222 - 232 
 2   Tamaru   A ,   Gilham   F , Jagannathan   R , et   al   A   Real - Time   Intrusion .   Detection   Expert   System   ( IDES ) ,   SRI - CSL - 92 - 05 ,   1992 - 04 
 3   Fox   K   L ,   Henning   R   R ,   Reed   J   H ,   et   al . A   Neural   Network   Appr -   oach   Towards   Intrusion   Detection .   In   Proceedings   of   the   13th   Na -   tional   Computer   Security   Conference   Washington .   DC ,   1990 - 10 :   125 - 134 
 4   Garvey   T   G ,   Lunt   T   F .   Model   Based   Intrusion   Detection .   In   Pro -   ceeding   of   the   14th   National   Computer   Security   Conference ：   1991 - 10 ： 372 - 385 
 5   Porras   P ,   Kemmerer   R .   Penetration   State   Transition   Analysis - A   Rule   Based   Intrusion   Detection   Approach .   In   Proceedings   of   the   Eight   Annual   Computer   Security   Applications   Conference ,   1992 -   11 : 220 - 229 
 6   Kumar   K ,   Spafford   E .   A   Pattern   Matching   Model   for   Misuse   Intrusion   Detection . In   Proceedings   of   the   17th   National   Computer   Security   Conference ,   1994 - 10 : 11 - 12 
 收稿 日期 ： 1999 - 02 - 02 
