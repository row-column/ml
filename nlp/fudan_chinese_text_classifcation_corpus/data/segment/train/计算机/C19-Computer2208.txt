计算机 应用 研究 
 APPLICATION   RESEARCH   OF   COMPUTERS 
 2000 　 Vol.17 　 No.2 　 P.99 - 101 
 
 
 
 基于 网络 的 地下 管线 管理系统 的 研究 与 实现 
 王莹 　 史浩山 　 范磊 
 摘   要   介绍 了 基于 计算机网络 的 地理信息系统 ( GIS ) 的 设计 思路 和 具体 的 实现 。 对于 不同 级别 的 用户 和 接入 方式 ， 提供 了 方便 的 使用 方法 ， 给出 了 保障 系统安全 工作 的 认证 与 日志 记录 体系 。 它 的 特点 是 继承 了 传统 GIS 系统 的 优点 ， 同时 充分利用 了 计算机网络 的 优势 ， 提高 了 系统 的 可扩展性 与 利用率 。 
 关键词   地理信息系统   Internet / Intranet   WWW   B / S   ActiveX 
 1   引言 
 　 　 地理信息系统 ( Geographic   Information   System ,   GIS ) 是 以 采集 、 存储 、 管理 、 分析 和 描述 整个 或 部分 地球表面 与 地理分布 有关 的 空间数据 的 信息系统 。 GIS 系统 目前 已 发展 成 一门 集 计算机科学 、 地理学 、 测绘 遥感 学 、 环境 科学 、 空间科学 、 信息科学 和 管理科学 为 一体 的 新兴 边缘学科 。 
 　 　 信息技术 的 迅速 发展 正在 改变 着 世界 的 面貌 。 以 GIS 为 核心 的 处理 空间信息 的 技术 正在 改变 着 传统 的 数据 信息 的 加工 方式 ， 它 与 遥感 ( RS ) 、 全球定位系统 ( GPS ) 相结合 的 3S 技术 将 对 具有 空间 分布 特征 的 各类 信息 的 处理 带来 一场 革命性 的 变化 。 
 　 　 Internet 即 国际 互联网 是 一个 连接 世界各地 不同 计算机系统 的 全球性 网络系统 ， 是 目前 世界 上规模 最大 、 增长 最快 的 网络系统 。 WWW ( World   Wide   Web ) 是 建立 在 Internet 上以 超文本 传输 协议 为 基础 ， 能够 提供 各种 Internet 服务 的 信息 浏览 系统 。 将 GIS 构筑 于 Internet 之上 将会 使 信息 得到 最 充分 的 利用 。 由于 运行 于 Internet   的 GIS 一般 都 是 运行 于 WWW 上 ， 故 又 常 称为 Web   GIS 。 
 　 　 我们 的 项目 是 为 某 大型 企业 开发 的 综合 管线 管理系统 ， 是 GIS 系统 的 一种 应用 。 在 长期 的 建设 过程 中 ， 许多 大型 企业 ， 架设 了 纵横交错 的 管线 系统 。 长期以来 ， 这些 管线 的 管理 一直 依靠 人工 绘图 ， 不仅 效率 低 而且 差错 多 。 GIS 系统 的 使用 可以 极大地提高 管理 的 效率 与 质量 ， 实现 无纸 管理 ， 并 方便 各种 信息 的 查询 。 整个 系统 采用 C / S 结构 ， 由 服务器 方 和 八个 业务 子系统 组成 ， 同时 也 支持 浏览器 ， 即 Web   GIS 。 
 2   系统结构 
 2.1   系统 的 网络结构 
 　 　 这套 GIS 系统 构筑 于 计算机网络 之上 ， 支持 局域网 与 广域网 的 各种 网络 接入 。 区别对待 不同 类型 的 用户 ， 可以 有 不同 的 使用 权限 与 使用 方式 。 
 　 　 系统 的 核心 用户 ， 包括 管理员 以及 企业 内部 的 相关 部门 ， 采用 C / S 模式 的 管理体系 。 系统 有 一个 文件 服务器 ， 负责 存储 与 管理 所有 的 图形 信息 以及 相关 数据库 。 系统 用户 则 通过 应用软件 使用 这些 信息 ， 包括 各种 查询 以及 对 数据 的 维护 。 系统 的 周边 用户 则 采用 B / S 模式 ， 采用 这种 模式 有利于 降低 用户 成本 ， 扩大 用户数量 ， 提高 系统 的 利用率 。 随着 计算机网络 的 发展 与   Internet 的 发展 ， 越来越 多 的 用户 可以 通过 WWW 浏览器 访问 网络 信息 ， 所以 当 系统 支持 浏览器 后 ， 可 极大地提高 信息 的 使用 效率 。 通过 Internet 上网 的 任何 用户 ， 只要 经过 授权 ， 均 可以 使用 这套 系统 。 系统 典型 的 结构图 如图 1 所示 。 
 
 图 1 　 系统 网络 结构图 
 2.2   系统 的 协议 与 软件结构 
 　 　 网络通信 协议 的 选用 对系统 互连 性 和 数据传输 效率 起着 至关重要 的 作用 ， 我们 采用 在 Internet 上 应用 最 广泛 、 最 成熟 的 TCP / IP 协议 。 在 系统 中 无论是 局域网 内部 ， 还是 广域网 都 使用 统一 的 通信协议 ， 以 提高 系统 的 通用性 与 可扩展性 。 
 　 　 在 系统 内部 ， 系统 用户 需要 访问 文件 服务器 上 的 图形文件 ， 使用 了 文件传输 协议 ( FTP ) ， 该 协议 允许 经过 授权 的 用户 上传 以及 下载 文件 。 采用 C / S 模式 ， 在 客户端 安装 系统 的 使用 软件 ， 用户 可以 在 授权 范围 内 进行 各种 操作 。 
 　 　 对于 外围 用户 ， 由于 采用 B / S 模式 ， 所以 要 提供 WWW 服务器 。 外围 用户 使用 通用 的 浏览器 ， 访问 系统资源 ， 通常 采用 超文本 连接 协议 ( HTTP ) 。 
 　 　 系统 的 软件结构 也 是 围绕 着 这 两种 用户 进行 设计 ， 包括 系统 用户 使用 的 核心 软件 ， 以及 为 外围 用户 设计 的 服务器软件 。 对于 GIS 系统 ， 包括 地理信息 与 属性 信息 两 大部分 数据 ， 这些 数据 都 存放 于 数据 服务器 上 。 由于 地理信息 的 多样性 、 复杂性 ， 所以 形成 的 图形 也 是 多样 的 、 复杂 的 。 因此 图形 采用 的 是 文件 形式 进行 存储 ， 而 属性 信息 由于 比较 规则 ， 采用 SQL   Server 数据库 进行 存储 。 通过 软件 将 两者 紧密 地 连接 在 一起 ， 从而 形成 一套 完整 的 系统 。 对于 WWW 服务器 ， 则 采用 ActiveX 技术 为 外围 用户 提供 服务 。 在 服务器端 ， 通过 ASP 开发 环境 可以 动态 形成 页面 ， 供 外围 用户 浏览 。 
 2.3   系统 的 安全 结构 
 　 　 网络 技术 给 用户 带来 方便 的 同时 ， 也 带来 了 一个 严重 的 安全 问题 。 对于 本 系统 的 两种 用户 ， 也 要 采用 相应 的 安全措施 。 
 　 　 系统 设有 管理员 负责 整个 系统 的 维护 工作 ， 包括 数据 维护 以及 用户 授权 。 对于 系统 用户 ， 采用 集中 的 统一 管理 ， 经过 系统管理员 授权 的 用户 才能 进入 系统 进行 操作 。 同时 对 用户 进行 分级管理 ， 不同 级别 的 用户 可以 进行 操作 的 权限 也 不 相同 。 另外 ， 对 所有 的 操作 建立 系统日志 ， 任何 进入 访问 系统 的 事件 将会 被 自动记录 ， 依此 来 对系统 的 运行 情况 进行 监控 ， 同时 进行 责任 追查 。 
 　 　 对于 外围 用户 ， 采用 分类 的 方法 进行 管理 。 对于 一些 开放 的 信息 ， 所有 访问 Internet 的 用户 均 可 进行 浏览 ， 而 进一步 的 数据 则 需 经过 授权 。 这一 认证 过程 由 WWW 服务器 完成 。 
 3   系统软件 设计 
 3.1   系统核心 软件设计 
 　 　 作为 一套 GIS 系统 ， 要 给 用户 提供 一套 完整 、 方便 的 图形化 的 操作界面 。 以 图形 的 方式 将 地理信息 显示 出来 ， 同时 将 各种 属性 信息 有机 地 组织 起来 ， 与 地理信息 进行 关联 。 在 软件设计 上 ， 针对 不同 的 使用 方式 设计 出 不同 的 子系统 如图 2 所示 。 
 
 图 2 　 子 系统分析 
 　 　 其中 的 图档 管理子系统 是 核心 部分 。 它 包括 图形 的 输入 、 输出 、 编辑 、 修改 、 叠加 、 拼接 、 漫游 以及 属性数据 的 录入 与 组织 。 由于 GIS 系统 采用 矢量化 的 图形 ， 所以 图形 的 录入 是 一个 非常 重要 的 问题 。 我们 采用 的 输入 方式 是 以 扫描仪 录入 栅格 图形 作为 背景图 ， 在 此基础 上 使用 鼠标 录入 矢量 图形 。 图形 的 组织 采用 了 分层 的 方式 ， 用户 可以 将 不同 的 内容 分为 不同 的 层 ， 显示 时 可以 自由选择 所 需 的 层次 ， 由 系统 自动 完成 叠加 。 在 此 引入 工程 文件 的 概念 。 工程 文件 用来 将 同属 某一 区域 的 所有 层次 的 图形 组织 起来 。 如 将 厂区 的 所有 图形 作为 一个 工程 ， 同时 将 某 一 车间 的 所有 图形 作为 另 一 工程 。 这样 图形 的 组织 就 非常 有序 ， 可以 更 有效 地 进行 信息 的 查询 。 系统 同时 支持 工程 的 跳转 ， 如 在 上述 的 例子 中 ， 用户 正在 浏览 厂区 总貌 ， 当 他 需要 某一 车间 的 细节 时 ， 只 需 点击 相应 的 车间 ， 系统 将会 自动 跳转 到 车间 所在 的 工程 。 在 图档 管理 中 还 可以 进行 属性数据 的 录入 与 浏览 。 用户 选中 某个 图元后 ， 即会弹 出 相应 的 属性 信息 ， 如果 具有 修改 的 权限 ， 则 他 还 可以 进行 修改 。 系统 将会 自动 建立 图形 与 属性数据 的 映射 关系 。 
 　 　 其它 的 业务 子系统 根据 用户 的 种类 进行 划分 ， 比如 电力部门 的 用户 将 使用 电力 子系统 。 根据 需要 ， 可以 屏蔽掉 其他 子系统 的 多余 信息 ， 方便 用户 使用 。 
 3.2   WWW 服务器软件 设计 
 　 　 为了 使 外围 用户 可以 通过 Internet 访问 相关 资源 ， 必须 设计 相应 的 WWW 服务器端 软件 ， 我们 采用 的 是 ActiveX 技术 与 ASP 语言 环境 相结合 的 方式 。 首先 开发 出 可以 访问 文件 服务器 内容 的 一组 ActiveX 控件 ， 将 其 嵌入 ASP 环境 中 ， 从而 给 用户 提供 动态 的 HTML 页面 。 远端 就 可以 通过 浏览器 访问 本 系统 。 系统 的 工作 流图 如图 3 所示 。 
 
 图 3 　 WWW 服务器端 软件设计 
 3.3   安全 认证 软件设计 
 　 　 这部分 内容 对 系统安全 起 决定性 作用 ， 它 不是 一个 独立 的 部分 ， 而是 融入 到 整个 系统 的 各个环节 ， 起到 既 方便 合法 用户 的 使用 ， 又 能 防止 非法 侵入 的 功能 。 它 包括 服务器端 的 中心 数据库 、 系统管理员 使用 的 管理软件 和 对系统 事件 自动记录 的 系统日志 ， 还 包括 为 系统核心 用户 和 外围 用户 设计 的 身份 确认 软件 。 系统 的 工作 过程 如图 4 所示 。 
 
 图 4 　 系统 的 安全 体系 
 4   系统 的 具体 实现 
 4.1   鼠标 事件 响应 
 　 　 整套 系统 的 核心 部分 是 一套 与 属性数据 相关联 的 作图 界面 。 用户 的 所有 操作 均 可 在 图形界面 上 直观 地 完成 。 这 就 要求 尽可能 地为 用户 的 使用 提供方便 。 由于 用户 主要 依靠 鼠标 进行 操作 ， 所以 对 鼠标 消息 的 响应 要 精心安排 ， 合理 设置 左右 键 的 功能 。 比如 在 作图 时 ， 当 用户 单击 鼠标 左键 时有 可能 是 想 进行 画图 ， 也 有 可能 是 要 结束 当前 图元 的 绘制 ， 还 可能 是 要 选中 图 元 进行 修改 或是 设置 属性数据 。 所以 必须 针对 用户 的 不同 意图 作出 不同 的 反映 。 图 5 描述 了 鼠标 左键 的 响应 过程 。 再 结合 用户 对 工具条 的 操作 ， 以及 鼠标 右键 的 操作 就 可以 设计 出 完善 的 响应 功能 。 
 
 图 5 　 响应 过程 
 4.2   坐标 的 映射 关系 
 　 　 在 GIS 系统 中 ， 图形 信息 要 能 反映 实际 的 地理位置 ， 也 就是 要 建立 图形文件 与 实际 地理坐标 的 映射 关系 。 在 这种 映射 中有 三个 坐标 需要 处理 。 首先 是 现实 的 地理坐标 ， 它 反映 了 实际 的 地理位置 ； 其次 是 计算机 中 的 屏幕 坐标 ， 屏幕 是 人机 交流 的 界面 ， 屏幕 坐标 直接 将 图形 位置 展现 在 用户 面前 ； 最后 在 前 两种 坐标 之间 还有 一个 图形文件 的 逻辑 坐标 。 由于 计算机屏幕 的 尺寸 都 是 有限 的 ， 所以 不 可能 将 所有 的 信息 同时 展现 在 一个 屏幕 上 。 而 又 要求 能够 将 完整 的 图形 输入 计算机 ， 所以 就要 使用 图形文件 的 逻辑 坐标 。 图形文件 将 整幅 的 地图 存储 起来 ， 同时 建立 起 与 实际 坐标 的 比例 关系 。 屏幕 则 根据 用户 的 需要 截取 相应 的 部分 进行 显示 ， 从而 完成 三种 坐标 的 映射 过程 。 在 操作 中 ， 用户 录入 图形 时 ， 系统 自动 完成 屏幕 坐标 与 逻辑 坐标 的 转换 过程 。 当 一幅 图 输入 后 ， 用户 可以 选择 图上 的 几个 关键点 输入 地理坐标 ， 此时 系统 就 可 根据 这些 点 的 坐标 ， 建立 实际 的 地理坐标 与 逻辑 坐标 的 对应 关系 。 
 4.3   复合 图元 的 生成 
 　 　 由于 经常 要 使用 一些 特定 的 作图 符号 ， 如 阀门 、 变压器 等 ， 因此 系统 为 用户 提供 了 一个 复合 图元 的 生成 工具 。 当 用户 使用 此 工具 作出 某一 复合 图元后 ， 就 可 在 以后 作图 中 进行 使用 。 此图 元 也 为 矢量化 的 图元 ， 可以 随 其它 图形 进行 统一 处理 ， 如 进行 放缩 、 拼接 等 ， 比 使用 栅格 图形 更为 方便 。 
 5   小结 
 　 　 随着 计算机 及 网络 技术 的 发展 ， 给 人们 带来 了 诸多 的 方便 。 GIS 系统 的 应用 可以 将 人们 从 繁杂 、 低效 的 劳动 中 解放出来 。 本文 所 设计 的 GIS 系统 将 传统 的 GIS 技术 与 网络 技术 有机 地 结合 起来 ， 形成 了 Web   GIS 系统 ， 更加 有效 地 利用 了 系统资源 。 
 　 　 本文 介绍 的 网络 GIS 系统 已经 提供 给 某 大型 企业 进行 试运行 。 
 王莹 （ 西北工业大学 电子信息 学院   西安   710072 ） 
 史浩山 （ 西北工业大学 电子信息 学院   西安   710072 ） 
 范磊 （ 西北工业大学 电子信息 学院   西安   710072 ） 
 参考文献 
 1 ， ActiveX   WebSite .   http : / / www . microsoft . com / 
 2 ， MapGuide   WebSite , ESRI .   http : / / 168.160 . 184.10 / periodical / jsjyyyj / jsjy2000 / 0002 / www . esri . com / 
 3 ， MSDN   Library   Visual   Studio   6.0 .   1997 
 4 ， Michael   J . Young ,   Mastering   Microsoft   Visual   C++   4 ,   1997 
 收稿 日期 ： 1999 年 6 月 28 日 
